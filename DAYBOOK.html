


  <table id="dataTable"></table><br/><br/><br/>

<footer class="footer">
  <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
    <div id="poSummaryBox" style="color: white; padding-left: 10px;">Summary</div>

    <!-- Button to open modal -->
<button onclick="openDaybookModal()">DAYBOOK</button>



    <div style="display: flex; align-items: center; gap: 8px; padding-right: 10px;">
      <label for="search123Input" style="color: white;">Search:</label>
      <input type="text" id="search123Input" placeholder="üîç Search..." style="padding: 4px 8px; border-radius: 4px; border: none;" />
    </div>
  </div>
</footer>









<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Daybook MIPL</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    
/* Container to control table width and responsiveness */
.table-container {
  width: 100%;
  overflow-x: auto;
}



 
 /* Table container */
table{
     width: 100%;
  margin-top: 20px;
  border-collapse: collapse;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 14px;
  }

  /* Table border & cell style */
th, 
 td {
    border: 1px solid #dcdcdc;
    padding: 8px 10px;
    text-align: left;
    white-space: nowrap;     /* wrap disable */
    overflow: hidden;
    text-overflow: ellipsis; /* show ... if text overflow */
    vertical-align: middle;
    font-size: clamp(10px, 1vw, 14px); /* auto shrink text */
  }

  /* Header design */
th {
    background: linear-gradient(135deg, #070707, #616161);
    color: #fff;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 13px;
    letter-spacing: 0.5px;
  }

  tr:nth-child(even) {
  background-color: #f9f9f9;
}

  /* Row hover effect */
  tr:hover td {
    background: #fce303;
    transition: background 0.2s ease-in-out;  }
    
    table tr:hover {
  background-color: #f81404;
  color: rgb(1, 20, 37);
  transition: background-color 0.3s ease, color 0.3s ease;
  }

 
        
    #search123Input {
      margin-bottom: 10px;
      padding: 8px;
      width: 250px;
      font-size: 16px;
    }
   
    a {
      text-decoration: none;
      font-size: 18px;
    }
    .blue-bg { color: green; }
    .pink-bg { color: blue; }
    .green-bg { color: #4682b4; }
    .red-bg { color: red; }

    /* Modal styles */
    #dataModal {
       display: none;
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: rgb(230, 231, 231);
    
      padding: 20px;
      z-index: 1000;
      max-height: 75%;
      overflow: auto;
      width: 90%;
      max-width: 1600px;
      border: 10px solid #013355;
      border-radius: 20px;
    }
    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #00000066;
      z-index: 999;
    }
    .btnposummry {
      margin: 10px 5px 0 0;
      padding: 6px 12px;
      cursor: pointer;
    }

  .footer {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background-color: #026186;
  padding: 6px 0;
  z-index: 1000;
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
}

  </style>
</head>
<body>
  <!-- Modal Popup -->
  <div id="overlay" onclick="closeModal()"></div>
  <div id="dataModal">
    <h3>Multitech Infracon Pvt Ltd. <br/>Ledger Details</h3>
     <button class="btnposummry"  onclick="printModal()">üñ®Ô∏è Print</button>
    <button class="btnposummry"  onclick="closeModal()">‚ùå Close</button>
    <div id="modalContent"></div>
  </div>


<script>
const api123Key = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheet123Id = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
const range123 = "POREFF!A:R";
const api103Url = "https://script.google.com/macros/s/AKfycbzBXPXYoX9xp2IqWYXvVYMPhgERM41XQ8CyhOBWtpnFQy2SZIkQqBPlHTfl9-Z3nn8rXg/exec"; 
const apiPOUrl = "https://script.google.com/macros/s/AKfycbxqXzSs-JOBPEUWqrI0-SUVmtGzRJKBoR3srraxO_peECS7ELm-xxZqOUQisJjCwrPW4A/exec";

const headerHTML = `
  <tr>
    <th>PO Link</th>
    <th>Progress %</th>
    <th>JOB NO.</th><th>Ledger</th><th>PO/Reff No</th><th>PO Amount</th>
    <th>Billing Amount</th><th>Balance</th><th>PO Weight</th><th>Billing Weight</th>
    <th>Balance</th><th>Status</th><th>User</th><th>Order By</th>
  </tr>`;

const visibleIndexes = [0,16, 6, 8, 12, 14, 9, 13, 15, 7, 1, 2];
let fullTableData = [];

async function fetch123Data() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet123Id}/values/${range123}?key=${api123Key}`;
  const response = await fetch(url);
  const data = await response.json();
  const rows = data.values || [];

  const header = rows[0];
  const dataRows = rows.slice(1);
  dataRows.sort((a, b) => (parseFloat(b[0]) || 0) - (parseFloat(a[0]) || 0));
  fullTableData = [header, ...dataRows];

  renderPOSUMMRYTable(fullTableData);
  setupSearch(fullTableData);
}

function renderPOSUMMRYTable(data) {
  const table = document.getElementById("dataTable");
  table.innerHTML = "";

  const thead = document.createElement("thead");
  thead.innerHTML = headerHTML;
  table.appendChild(thead);

  const tbody = document.createElement("tbody");
  const filteredData = []; // ‚úÖ keep only rows that pass condition

  for (let i = 1; i < data.length; i++) {
    const dataRow = data[i]; // ‚úÖ FIX: define dataRow for this row

    // --- Filter rows (only LESHANT, remove this line to show all)
//    if ((dataRow[2] || "").toUpperCase() !== "LESHANT") continue;

    filteredData.push(dataRow);

    const row = document.createElement("tr");

    // --- PO Link ---
    const poNo = dataRow[6] || "";
    const poCell = document.createElement("td");

    if (poNo) {
      poCell.textContent = "---";
      fetch(apiPOUrl + "?invoice=" + encodeURIComponent(poNo))
        .then(res => res.text())
        .then(url => {
          if (url && url !== "NOT_FOUND") {
            poCell.textContent = "View PO";
            poCell.style.color = "red";
            poCell.style.textDecoration = "underline";
            poCell.style.cursor = "pointer";
            poCell.onclick = () => window.open(url, "_blank");
          } else {
            poCell.textContent = "---";
            poCell.removeAttribute("style");
            poCell.onclick = null;
          }
        })
        .catch(() => {
          poCell.textContent = "---";
          poCell.removeAttribute("style");
          poCell.onclick = null;
        });
    } else {
      poCell.textContent = "---";
    }
    row.appendChild(poCell);

    // --- Progress % ---
    const poAmount = parseFloat(dataRow[8]) || 0;
    const billingAmount = parseFloat(dataRow[12]) || 0;
    let progress = 0, label = "---";

    if (poAmount !== 0) {
      progress = (billingAmount / poAmount) * 100;
      label = progress <= 100
        ? `${progress.toFixed()}% work complete`
        : `${(progress - 100).toFixed()}% work extra`;
    }

    const progressCell = document.createElement("td");
    progressCell.textContent = label;

    if (progress > 100) progressCell.classList.add("orange-bg");
    else if (progress >= 60) progressCell.classList.add("blue-bg");
    else if (progress >= 30) progressCell.classList.add("pink-bg");
    else progressCell.classList.add("green-bg");

    row.appendChild(progressCell);

    // --- Visible Columns ---
    visibleIndexes.forEach(colIndex => {
      const td = document.createElement("td");
      const cellValue = dataRow[colIndex] || "";

      if (colIndex === 6) {
        td.style.cursor = "pointer";
        td.style.color = "#2980b9";
        td.style.fontSize = "16px";
        td.style.textDecoration = "underline";
        td.addEventListener("click", () => {
          const jobNo = cellValue;
          const ledgerName = dataRow[16] || "---";
          const ledgerAddress = dataRow[17] || "---";
          fetchReffNo(jobNo, ledgerName, ledgerAddress);
        });
      }

      if (colIndex === 16) {
        td.style.cursor = "pointer";
        td.style.color = "#d35400";
        td.style.fontWeight = "bold";
        td.style.textDecoration = "underline";
        td.addEventListener("click", () => {
          const ledgerName = cellValue;
          const ledgerAddress = dataRow[17] || "---";
          fetchLedgerByLedgerName(ledgerName, ledgerAddress);
        });
      }

      if (typeof cellValue === "string" &&
          (cellValue.startsWith("http") || cellValue.startsWith("www"))) {
        const a = document.createElement("a");
        a.href = cellValue.startsWith("http") ? cellValue : "https://" + cellValue;
        a.innerHTML = "&#128221;";
        a.target = "_blank";
        td.appendChild(a);
      } else {
        td.textContent = cellValue;

        if (colIndex === 7) {
          td.style.fontWeight = "bold";
          td.style.fontSize = "13px";
          const colorMap = {
            "CANCELED": "#dc7633",
            "COMPLETED": "#48c9b0",
            "RUNNING": "#808b96",
            "PENDING": "#5dade2"
          };
          td.style.color = colorMap[cellValue] || "black";
        }
      }

      const col5Val = parseFloat(dataRow[14]) || 0;
      const col8Val = parseFloat(dataRow[15]) || 0;
      if (col5Val < 0 && colIndex === 14) td.classList.add("red-bg");
      if (col8Val < 0 && colIndex === 15) td.classList.add("red-bg");

      row.appendChild(td);
    });

    tbody.appendChild(row);
  }

  table.appendChild(tbody);

  // ‚úÖ Now filteredData is available
  displayporeffResults(filteredData);
}



function displayporeffResults(entries) {
  const summaryDiv = document.getElementById("poSummaryBox");
  summaryDiv.innerHTML = "";

  if (!entries || entries.length <= 1) {
    summaryDiv.innerHTML = "<p>No matching records found.</p>";
    return;
  }

  let completed = 0, pending = 0, canceled = 0, running = 0;
  entries.slice(1).forEach(row => {
    const status = (row[7] || "").toLowerCase();
    if (status === "completed") completed++;
    else if (status === "pending") pending++;
    else if (status === "canceled") canceled++;
    else if (status === "running") running++;
  });

  summaryDiv.innerHTML = `
    ‚úÖ Completed: <span class="complete">${completed}</span> |
    ‚è≥ Pending: <span class="pending">${pending}</span> |
    ‚ùå Canceled: <span class="canceled">${canceled}</span> |
    üîÑ Running: <span class="running">${running}</span>
  `;
}

function setupSearch(data) {
  const searchInput = document.getElementById("search123Input");
  searchInput.addEventListener("input", () => {
    const text = searchInput.value.toLowerCase();
    const filtered = data.filter((row, i) => {
      if (i === 0) return true;
      return row.some(cell => (cell || "").toLowerCase().includes(text));
    });
    renderPOSUMMRYTable(filtered);
  });
}

function openModal(htmlContent) {
  document.getElementById("modalContent").innerHTML = htmlContent;
  document.getElementById("dataModal").style.display = "block";
  document.getElementById("overlay").style.display = "block";
}
function closeModal() {
  document.getElementById("dataModal").style.display = "none";
  document.getElementById("overlay").style.display = "none";
}


// ***************  INVOICE PDF OPEN BY CLICK TO INVOICE NO ****************

function attachInvoiceClickREFF(tableId, invoiceColIndex = 3) {
  const table = document.getElementById(tableId);
  if (!table) return;

  for (let i = 1; i < table.rows.length; i++) {
    const row = table.rows[i];
    const cell = row.cells[invoiceColIndex];
    if (!cell) continue;

    const invoiceNo = cell.textContent.trim();
    if (!invoiceNo) continue;

    const invoiceKey = invoiceNo.replace("/", "_");

    fetch(api103Url + "?invoice=" + encodeURIComponent(invoiceKey))
      .then(res => res.text())
      .then(url => {
        if (url && url !== "NOT_FOUND") {
          cell.style.color = "blue";
          cell.style.cursor = "pointer";
          cell.style.textDecoration = "underline";
          cell.onclick = () => window.open(url, "_blank");
        }
      });
  }
}


// ***************  TABLE PO NO BY INVOICE TABLE MODEL 1 ****************
async function fetchReffNo(jobNo, ledgerName = "---", ledgerAddress = "---") {
  const range124 = "LEDGER!B:K";
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet123Id}/values/${range124}?key=${api123Key}`;
  const res = await fetch(url);
  const data = await res.json();
  const rows = data.values || [];
  const headers = rows[0];
  const matched = rows.slice(1).filter(r => r[4] === jobNo);

  if (matched.length === 0) {
    openModal("<p>No Match Found</p>");
    return;
  }

  let totalG = 0, totalH = 0;
  matched.forEach(row => {
    totalG += parseFloat(row[5]) || 0;
    totalH += parseFloat(row[6]) || 0;
  });

  let html = `
   <p><strong>Ledger Name:</strong> ${ledgerName}<br>
   <strong>Address:</strong> ${ledgerAddress}<br>
   <span style="color: green; font-weight: bold;">Total Billing:</span> Rs. ${totalG.toFixed()} /
   <span style="color: blue; font-weight: bold;">Total Weight:</span> ${totalH.toFixed()} Kg.</p>
   <table id="modalLedgerTable" border="1"><tr>`;
  headers.forEach(h => html += `<th>${h}</th>`);
  html += `</tr>`;

  matched.forEach(row => {
    const isCredit = (row[0] || "").toLowerCase().includes("credit note");
    const rowStyle = isCredit ? ` style="color: red;"` : "";
    html += `<tr${rowStyle}>`;
    headers.forEach((_, i) => {
      const cell = row[i] || "";
      if (typeof cell === "string" && (cell.startsWith("http") || cell.startsWith("www"))) {
        const href = cell.startsWith("http") ? cell : "https://" + cell;
        html += `<td><a href="${href}" target="_blank">&#128221;</a></td>`;
      } else {
        html += `<td>${cell}</td>`;
      }
    });
    html += `</tr>`;
  });

  html += `</table>`;
  openModal(html);
  attachInvoiceClickREFF("modalLedgerTable", 3);
}


// ***************  LEDGER SERCH BY LEDGER MODAL 2 ****************
async function fetchLedgerByLedgerName(ledgerName = "---", ledgerAddress = "---") {
  const range124 = "LEDGER!B:K"; // Expanded to column L for full data
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet123Id}/values/${range124}?key=${api123Key}`;
  const res = await fetch(url);
  const data = await res.json();
  const rows = data.values || [];
  const headers = rows[0];
  const matched = rows.slice(1).filter(r => r[2] === ledgerName);

  if (matched.length === 0) {
    openModal("<p>No Match Found</p>");
    return;
  }

  let totalG = 0, totalH = 0, totalD = 0;
  matched.forEach(row => {
    totalG += parseFloat(row[5]) || 0;
    totalH += parseFloat(row[6]) || 0;
    const type = (row[0] || "").toUpperCase();
    if (type.includes("BANK") || type.includes("TDS")) {
      totalD += parseFloat(row[3]) || 0;
    }
  });

  let html = `
   <p>
    <strong>Ledger Name:</strong> ${ledgerName}<br>
    <strong>Address:</strong> ${ledgerAddress}<br>
    <span style="color: green; font-weight: bold;">Total Billing:</span> Rs. ${totalG.toFixed()} /
    <span style="color: blue; font-weight: bold;">Total Weight:</span> ${totalH.toFixed()} Kg. /
    <span style="color: red; font-weight: bold;">Receipt (BANK/TDS):</span> Rs. ${totalD.toFixed()}
   </p>
   <table id="modalLedgerTable" border="1"><tr>`;  // Added ID to table
  headers.forEach(h => html += `<th>${h}</th>`);
  html += `</tr>`;

  matched.forEach(row => {
    const type = (row[0] || "").toLowerCase();
    const color = type.includes("bank") ? "red" : type.includes("credit") ? "blue" : "";
    html += `<tr style="color: ${color};">`;
    headers.forEach((_, i) => {
      const cell = row[i] || "";
      if (typeof cell === "string" && (cell.startsWith("http") || cell.startsWith("www"))) {
        const href = cell.startsWith("http") ? cell : "https://" + cell;
        html += `<td><a href="${href}" target="_blank">&#128221;</a></td>`;
      } else {
        html += `<td>${cell}</td>`;
      }
    });
    html += `</tr>`;
  });

  html += `</table>`;
  openModal(html);

  // ‚úÖ Attach click listener to invoice column (index 3) after rendering modal table
  attachInvoiceClickREFF("modalLedgerTable", 3);
}


// ****************PRINT FUNCTION BOTH TABLE ************


function printModal() {
  const content = document.getElementById("modalContent").innerHTML;

  const printWindow = window.open('', '', 'height=800,width=1000');
  printWindow.document.write(`
    <html>
      <head>
        <title>Print</title>

        <body>

           <span style="color:rgb(246, 156, 156);font-size:130%;font-family:Magneto;">eS |</span> 
  <span style="color:#a0d0f0;font-size:130%;font-family:Magneto;">MTally</span>
            <h4>Multitech Infracon Pvt. Ltd.</h4>
        <style>
          body {
            font-family: Arial, sans-serif;
            margin: 20px;
          }

          table {
  width: 100%;
  margin-top: 20px;
  border-collapse: collapse;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 14px;
}

th, td {
  border: 1px solid #e0e0e0;
  padding: 10px 14px;
  text-align: left;
}

th {
  background-color: #004d80;
  color: white;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

tr:nth-child(even) {
  background-color: #f9f9f9;
}


        </style>
      </head>
      <body>
        ${content}
      </body>
    </html>
  `);

  printWindow.document.close();
  printWindow.focus();
  printWindow.print();
}


fetch123Data();
</script>



</body>
</html>











<!-- loading summry poup box start  script start hare +++++++++++++++++++++++++++++++++++++++++++++-->

<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>4x6 inch Popup</title>
  <style>
    :root{
      --popup-bg:#ffffff;
      --popup-text:#111827;
      --popup-border:#e5e7eb;
      --popup-shadow:0 12px 30px rgba(0,0,0,.15);
      --popup-radius:14px;
    }

    .popup {
      position: fixed;
      left: 16px;
      bottom: 60px;
      width: 900px;   /* 6 inch */
      height: 450px;  /* 4 inch */
      background: var(--popup-bg);
      color: var(--popup-text);
      border: 1px solid var(--popup-border);
      border-radius: var(--popup-radius);
      box-shadow: var(--popup-shadow);
      overflow: hidden;
      opacity: 0;
      transform: translateY(20px);
      pointer-events: none;
      transition: opacity .25s ease, transform .25s ease;
      z-index: 9999;
    }

    .popup.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .popup__header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 12px;
      background: #d2d2d2;
      border-bottom:1px solid var(--popup-border);
    }
    .popup__title{
      margin:0;
      font-size: 15px;
      font-weight: 600;
    }
    .popup__close{
      border:1px solid var(--popup-border);
      background:#fff;
      border-radius:10px;
      width:30px;
      height:30px;
      cursor:pointer;
      font-size:18px;
    }
    .popup__close:hover{ background:#f3f4f6; }

    .popup__body{
      padding:12px;
      font-size:14px;
      height: calc(100% - 52px); /* header ke niche bacha hua area */
      overflow:auto; /* scroll agar zyada content ho */
      background-color: #f8ebe0;
    }
  </style>
</head>
<body>

  <div id="bottomLeftPopup" class="popup">
    <div class="popup__header">
      <h3 class="popup__title">Loading Status</h3>
      <button class="popup__close" id="popupCloseBtn">&times;</button>
    </div>
    <div class="popup__body">
   
     
      
     
<table id="noticeBoard">  <thead ><tr> <th>Type</th><th>Date</th> <th>Name</th><th>Vehicle No.</th><th>Job No.</th> <th>Status</th> <th>Inv. No.</th></tr></thead><tbody></tbody></table>


    </div>
  </div>

  <script>
    const popup = document.getElementById('bottomLeftPopup');
    const closeBtn = document.getElementById('popupCloseBtn');

    window.addEventListener('load', ()=> popup.classList.add('show'));
    closeBtn.addEventListener('click', ()=> popup.classList.remove('show'));
  </script>
</body>
</html>

<!-- loading summry poup box start  script stop hare +++++++++++++++++++++++++++++++++++++++++++++-->







<!-- loading summry  script start hare -->

<script>
// ===== CSS injected via JS (no <style> tag used) =====
const css = `
   /* Status Colors */
  .status-loading    { background-color: #ff4d4d; color: #fff; font-weight: bold; }
  .status-processing { background-color: #fd2222; color: #fff; font-weight: bold; }
  .status-processed  { background-color: #28a745; color: #fff; font-weight: bold; }
  .status-complete   { background-color: #28a745; color: #fff; font-weight: bold; }
  .status-unloading  { background-color: #39b3d8; color: #fff; font-weight: bold; }
`;
(function applyCSS(c){
  const s = document.createElement('style');
  s.textContent = c;
  document.head.appendChild(s);
})(css);

// ===== Notice Board Script =====
const apiNBKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheetNBId = "1Bx0FqnXHadVATN9DGhUtRZr2EDgz10hfDEgIlwtSC_4";
const rangeNB = "DATABASE!K:R";

async function loadNoticeBoard() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetNBId}/values/${rangeNB}?key=${apiNBKey}`;
  const response = await fetch(url);
  const data = await response.json();
  
  const rows = data.values;
  const tbody = document.querySelector("#noticeBoard tbody");
  tbody.innerHTML = "";

  if (!rows || rows.length <= 1) {
    tbody.innerHTML = `<tr><td colspan="7">No Data Found</td></tr>`;
    return;
  }

  // Last 3 days range
  const today = new Date();
  let allowedDates = [];
  for (let i = 0; i < 3; i++) {
    let d = new Date();
    d.setDate(today.getDate() - i);
    allowedDates.push(formatDateToYYYYMMDD(d));
  }

  rows.forEach((row, index) => {
    if (index === 0) return; // skip header

    const dateInL = row[1]; // Column L
    const formattedDate = dateInL ? formatCustomDate(dateInL) : "";

    if (allowedDates.includes(formattedDate)) {
      const tr = document.createElement("tr");

      for (let i = 0; i <= 6; i++) {
        const td = document.createElement("td");
        td.textContent = row[i] || "";

        // Status color coding
        if (i === 5) {
          const status = (row[i] || "").toUpperCase();
          if (status === "LOADING") td.classList.add("status-loading");
          else if (status === "PROCESSING") td.classList.add("status-processing");
          else if (status === "PROCESSED") td.classList.add("status-processed");
          else if (status === "UNLOADING") td.classList.add("status-unloading");
          else if (status === "COMPLETE") td.classList.add("status-complete");
        }
        tr.appendChild(td);
      }

      tbody.appendChild(tr);
    }
  });
}

// Format date to YYYY-MM-DD
function formatDateToYYYYMMDD(dateObj) {
  const y = dateObj.getFullYear();
  const m = String(dateObj.getMonth() + 1).padStart(2, "0");
  const d = String(dateObj.getDate()).padStart(2, "0");
  return `${y}-${m}-${d}`;
}

// Convert "13-Aug-2025" to YYYY-MM-DD
function formatCustomDate(dateStr) {
  const months = {
    Jan: "01", Feb: "02", Mar: "03", Apr: "04", May: "05", Jun: "06",
    Jul: "07", Aug: "08", Sep: "09", Oct: "10", Nov: "11", Dec: "12"
  };
  const parts = dateStr.split("-");
  if (parts.length === 3) {
    const day = parts[0].padStart(2, "0");
    const month = months[parts[1]];
    const year = parts[2];
    return `${year}-${month}-${day}`;
  }
  return "";
}

loadNoticeBoard();
</script>
<!-- loading summry  script stop hare -->

<!-- loading summry  script stop hare -->













<!-- ------------------  daybook, id password modal box and script sectio area -------------------------------------- -->

<style>
  :root {
    --card-bg: #ffffff;
    --border: #e5e7eb;
  }
  body {
    font-family: system-ui, Arial, sans-serif;
    margin: 0;
    background:#f7f7f8;
  }

  /* Background overlay */
  .modal-overlay {
    display: none; /* hidden by default */
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.5);
    z-index: 999;
    justify-content: center;
    align-items: center;
  }

  /* modal box */
  .modalvcr { 
    width: min(1950px, 95%);
    max-height: 95vh;
    background: var(--card-bg); 
    border-radius: 20px;
    border:1px solid var(--border);
    box-shadow: 0 12px 30px rgba(0,0,0,.25);
    display:flex;
    flex-direction: column;
    overflow: hidden;
  }

  .modalvcr-header { 
    display:flex; 
    align-items:center; 
    justify-content:space-between; 
    padding:16px 18px; 
    border-bottom:1px solid var(--border);
    background-color: #caf7e9; 
  }
  .modalvcr-title { font-size: 1.05rem; font-weight:700; }

  .modalvcr-body { 
    display: grid; 
    grid-template-rows: 15vh 54vh;
    min-height: 70vh; 
  }
  .panelvcr { padding: 16px; overflow:auto; }
  .panelvcr + .panelvcr { border-top:1px solid var(--border); }
  .panelvcr h3 { margin: 4px 0 12px; font-size: 1rem; }

  .modalvcr-footer { 
    display:flex; justify-content:flex-start; 
    padding:12px 16px; 
    border-top:1px solid var(--border);
    background-color: #cadff7; 
  }

  /* Inputs & table */
  #inputArea, #DATASEARCMIPL {
    padding:8px;
    border-radius:6px;
    border:1px solid #d1d5db;
    margin:6px 0;
    width: 4in;
    background:#f1d4d4;
  }
  #m1000lTable, #MIPLDATATABLE {
    width:100%; border-collapse: collapse; margin-top:8px;
  }
  #m1000lTable th, #m1000lTable td,
  #MIPLDATATABLE th, #MIPLDATATABLE td {
    border:1px solid #ccc; padding:6px; text-align:left;
  }
  #MIPLDATATABLE th {
    background: linear-gradient(135deg, #620101, #f03838);
    color:#fff;
  }
</style>


<!-- Button to open modal -->



<!-- Modal overlay -->
<div id="daybookModal" class="modal-overlay">
  <div class="modalvcr">   
    <div class="modalvcr-header">
      <div>
        <div class="modalvcr-title">
          <span class="CMNYNAME" style="color: rgb(0, 48, 46); font-weight: bold;">eS|MTally</span>
        </div>
        <div class="muted">ID/Password, Daybook Search</div>
      </div>
      <button onclick="closeDaybookModal()" style="background:none;border:none;font-size:20px;cursor:pointer;">‚ùå</button>
    </div>

    <div class="modalvcr-body">
      <!-- Upper panelvcr -->
      <section class="panelvcr">
        <h3>User:- Mukhtiyar Ahamad</h3>
        <label style="font-size: 16px; font-weight: bold;">Select Option:</label>
        <select onchange="showDiv(this.value)" style="width: 4in; height: 3vh;">
          <option value="">Select an option</option>
          <option value="1">ID | Password </option>
          <option value="2">Daybook</option>
        </select>
      </section>

      <!-- Lower panelvcr -->
      <section class="panelvcr">
    

        <!-- Panel 1 -->
        <div id="1" class="content">
          <span style="font-size: 120%; font-weight: bold;">ID Password Search bar</span><br>
          <input type="text" id="inputArea" placeholder="üîç Search here..." />
          <table id="m1000lTable"></table>
        </div>

        <!-- Panel 2 -->
        <div id="2" class="content">
          <span style="font-size: 120%; font-weight: bold;">Daybook Searchbar</span><br>
          <input type="text" id="DATASEARCMIPL" placeholder="üîç Search Ledger, Invoice..." />
          <table id="MIPLDATATABLE"></table>
        </div>

      </section>
    </div>

    <div class="modalvcr-footer">
      <small>Footer actions can go here</small>
    </div>
  </div>
</div>


<script>
function openDaybookModal() {
  document.getElementById("daybookModal").style.display = "flex";
}
function closeDaybookModal() {
  document.getElementById("daybookModal").style.display = "none";
}
function showDiv(id){
  document.querySelectorAll(".content").forEach(div => div.style.display="none");
  if(id) document.getElementById(id).style.display="block";
}
</script>













 <!-- multi div selection script start -->
       <style>
        .content {
            display: none;
        }
    </style>
    <script>
        function showDiv(selectedValue) {
            // ‡§∏‡§≠‡•Ä div ‡§ï‡•ã ‡§õ‡§ø‡§™‡§æ‡§®‡§æ
            const divs = document.querySelectorAll('.content');
            divs.forEach(div => div.style.display = 'none');
            
            // ‡§ö‡§Ø‡§®‡§ø‡§§ div ‡§ï‡•ã ‡§¶‡§ø‡§ñ‡§æ‡§®‡§æ
            const selectedDiv = document.getElementById(selectedValue);
            if (selectedDiv) {
                selectedDiv.style.display = 'block';
            }
        }
    </script>
 <!-- multi div selection script stop -->












<style>
  .highlight { background: yellow; font-weight: 600; }
  .hidden { display: none; }
  #noResultsMessage { color: red; display: none; margin-top: 8px; }
</style>

<script>
/* --------- PASSWORD SEARCH MODULE (NO window.onload) --------- */

let m1000Data = null;      // raw values array from sheet
let m1000Loaded = false;   // flag so we fetch only once

function escapeRegExp(str) {
  return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

/* Fetch data from Google Sheet and render base table (no highlights) */
async function M1000LoadData() {
  const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
  const sheetId = "1EOO0QzwNaPhwIfZN_DCLlhQB9yeC-j-GpmtM_6JMRmw";
  const range = 'PASSWORD!A:E';
  try {
    const resp = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`);
    const data = await resp.json();
    m1000Data = data.values || [];
    renderM1000Table();
    m1000Loaded = true;
  } catch (err) {
    console.error("M1000LoadData error:", err);
  }
}

/* Render table rows from m1000Data; keep table hidden initially */
function renderM1000Table() {
  const table = document.getElementById('m1000lTable');
  if (!table) return;
  table.innerHTML = '';

  if (!m1000Data || m1000Data.length === 0) {
    // no data - show headerless empty table
    table.style.display = 'none';
    return;
  }

  m1000Data.forEach((row, index) => {
    const tr = document.createElement('tr');

    if (index === 0) {
      // header row
      row.forEach(cell => {
        const th = document.createElement('th');
        th.textContent = cell || '';
        tr.appendChild(th);
      });
    } else {
      // data rows
      row.forEach((cell, cellIndex) => {
        const td = document.createElement('td');

        // detect url and make link
        if (typeof cell === 'string' && (cell.startsWith('http') || cell.startsWith('www'))) {
          const a = document.createElement('a');
          a.href = cell.startsWith('http') ? cell : `http://${cell}`;
          a.target = "_blank";
          a.rel = "noopener";
          a.innerHTML = "&#128221;"; // icon
          td.appendChild(a);
        } else {
          td.textContent = cell ?? '';
        }

        // optional row class based on first column (apply to tr)
        if (cellIndex === 0) {
          const low = (String(cell || '')).toLowerCase();
          if (low === "credit note") tr.classList.add('blue');
          else if (low === "bank") tr.classList.add('red');
        }

        tr.appendChild(td);
      });
    }

    table.appendChild(tr);
  });

  // hide table until a search returns results
  table.style.display = 'none';

  // ensure "no results" element exists (once)
  ensureNoResultsMessage();
}

/* Ensure there's a single #noResultsMessage element next to table (create if missing) */
function ensureNoResultsMessage() {
  let msg = document.getElementById('noResultsMessage');
  if (!msg) {
    msg = document.createElement('p');
    msg.id = 'noResultsMessage';
    msg.style.color = 'red';
    msg.style.display = 'none';
    const table = document.getElementById('m1000lTable');
    if (table && table.parentNode) {
      table.parentNode.insertBefore(msg, table.nextSibling);
    } else {
      document.body.appendChild(msg);
    }
  }
}

/* Search function ‚Äî uses rendered DOM rows; highlights matches */
function serchProfile() {
  const input = document.getElementById('inputArea');
  if (!input) return;
  const queryRaw = (input.value || '').trim();
  const query = queryRaw.toLowerCase();

  const table = document.getElementById('m1000lTable');
  if (!table) return;

  // if no query -> hide all data rows and hide table
  if (!query) {
    Array.from(table.querySelectorAll('tr')).forEach((row, i) => {
      if (i === 0) return; // keep header in DOM but hidden
      row.style.display = 'none';
      // reset cell text (remove previous highlights)
      row.querySelectorAll('td').forEach(td => td.innerHTML = td.textContent);
    });
    table.style.display = 'none';
    showNoResults(false);
    return;
  }

  // build safe regex
  const safe = escapeRegExp(query);
  const regex = new RegExp(`(${safe})`, 'gi');

  let visible = 0;
  const rows = Array.from(table.querySelectorAll('tr'));
  rows.forEach((row, i) => {
    if (i === 0) return; // header row not counted in visible
    const tds = Array.from(row.querySelectorAll('td'));
    const rowText = tds.map(td => td.textContent.toLowerCase()).join(' ');
    if (rowText.includes(query)) {
      // show + highlight
      row.style.display = '';
      visible++;
      tds.forEach(td => {
        // replace & escape properly: use original textContent to avoid nested tags
        const raw = td.textContent;
        td.innerHTML = raw.replace(regex, '<span class="highlight">$1</span>');
      });
    } else {
      // hide and reset if previously highlighted
      row.style.display = 'none';
      tds.forEach(td => td.innerHTML = td.textContent); 
    }
  });

  table.style.display = visible > 0 ? 'table' : 'none';
  showNoResults(visible === 0);
}

/* Show / hide no-results message */
function showNoResults(show) {
  ensureNoResultsMessage();
  const msg = document.getElementById('noResultsMessage');
  if (!msg) return;
  msg.style.display = show ? 'block' : 'none';
  if (show) msg.textContent = 'No matching results found.';
}

/* Public initializer ‚Äî call when you want the module ready.
   We do not call this on window.onload to avoid conflicts.
   Instead we wire this to your dropdown showDiv or modal open. */
async function ensureM1000Initialized() {
  if (!m1000Loaded) {
    await M1000LoadData();
    // attach input listener (safe to attach once)
    const input = document.getElementById('inputArea');
    if (input) {
      input.removeEventListener('input', serchProfile); // prevent duplicates
      input.addEventListener('input', serchProfile);
    }
  }
}

/* -------------- Replace your earlier showDiv with this (or update it) --------------
    When dropdown selects '1', this will both show the div and initialize the M1000 data.
*/
function showDiv(selectedValue) {
  const divs = document.querySelectorAll('.content');
  divs.forEach(div => div.style.display = 'none');

  if (!selectedValue) return;

  const selectedDiv = document.getElementById(selectedValue);
  if (!selectedDiv) return;

  // show the div
  selectedDiv.style.display = 'block';

  // If it's the ID/Password panel, initialize (lazy load) the sheet & search
  if (String(selectedValue) === '1') {
    ensureM1000Initialized().catch(err => console.error(err));
  }
}

/* ---- Notes for integration:
   - Remove previous window.onload block and old M1000/serchProfile definitions to avoid duplicates.
   - This code does not auto-run on page load. It runs when showDiv('1') is called (e.g. when user selects option 1).
   - If you prefer to load data when modal opens, call ensureM1000Initialized() from your modal open handler.
*/
</script>

 <!-- id/password serch bar script stop  -->
















 
<!---------------------------- DATAMIPLTABLE SCRIPT START HARE ---------------------------------------- -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice Table with PDF Open</title>

</head>
<body>

<script>
const api101Key = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheet101Id = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
const range101 = 'LEDGER!A:K';
const api101Url = "https://script.google.com/macros/s/AKfycbwRAHlS8JeIXSEbPVjUNVrXkpfVOmNc2z95OZsygdzebtk-sgLV-86eWyZ20jVHspYe/exec";

let allTableData = [];

// -------------------- Fetch Table --------------------
async function loadDATAMIPLTABLE() {
  const table = document.getElementById("MIPLDATATABLE");
  table.innerHTML = "<tr><th>Loading...</th></tr>";

  try {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet101Id}/values/${range101}?key=${api101Key}`;
    const response = await fetch(url);
    const data = await response.json();

    if (!data.values || data.values.length === 0) {
      table.innerHTML = "<tr><td>No data found</td></tr>";
      return;
    }

    allTableData = data.values;
    renderDATAMIPLTABLE(allTableData);

  } catch (err) {
    console.error(err);
    table.innerHTML = "<tr><td>Error loading data</td></tr>";
  }
}

// -------------------- Render Table with Actions --------------------
// -------------------- Render Table with Actions --------------------
function renderDATAMIPLTABLE(dataArray) {
  const table = document.getElementById("MIPLDATATABLE");
  table.innerHTML = "";

  const thead = document.createElement("thead");
  const tbody = document.createElement("tbody");

  dataArray.forEach((row, rowIndex) => {
    const tr = document.createElement("tr");

    row.forEach(cell => {
      if (rowIndex === 0) {
        const th = document.createElement("th");
        th.textContent = cell || "";
        tr.appendChild(th);
      } else {
        const td = document.createElement("td");
        td.textContent = cell || "";
        tr.appendChild(td);
      }
    });

    // ---------------- Row color condition ----------------
    if (rowIndex > 0) {
      const typeCell = row[1]?.toUpperCase().trim();
      if (typeCell === "BANK") {
        tr.style.color = "red";
      } else if (typeCell === "CREDIT NOTE") {
        tr.style.color = "grey";
      } else if (typeCell === "CHALLAN") {
        tr.style.color = "green";
      }
    }

    // ---------------- Actions column ----------------
    if (rowIndex === 0) {
      const th = document.createElement("th");
      th.textContent = "Actions";
      tr.appendChild(th);
      thead.appendChild(tr);
    } else {
      const actionTd = document.createElement("td");

      const typeCell = row[1]?.toUpperCase().trim();
      const invoiceNo = row[4]?.trim();

      if (invoiceNo && typeCell === "TAX INVOICE") {
        const invoiceKey = invoiceNo.replace("/", "_");
        const packingKey = invoiceNo;

        const container = document.createElement("div");
        container.style.display = "flex";
        container.style.gap = "12px";

        // --- BILL button ---
        const viewInvoiceBtn = document.createElement("button");
        viewInvoiceBtn.textContent = "BILL";
        viewInvoiceBtn.style.color = "white";
        viewInvoiceBtn.style.background = "#1F39FF";
        viewInvoiceBtn.style.border = "none";
        viewInvoiceBtn.style.padding = "3px 8px";
        viewInvoiceBtn.style.cursor = "pointer";
        viewInvoiceBtn.style.borderRadius = "4px";

        viewInvoiceBtn.addEventListener("click", () => {
          fetch(api101Url + "?invoice=" + encodeURIComponent(invoiceKey))
            .then(res => res.text())
            .then(url => {
              if (url !== "NOT_FOUND") {
                window.open(url, "_blank");
              } else {
                alert("Invoice not found!");
              }
            })
            .catch(err => {
              console.error(err);
              alert("Error fetching invoice");
            });
        });

        // --- PL LIST button ---
        const viewPackingBtn = document.createElement("button");
        viewPackingBtn.textContent = "PL LIST";
        viewPackingBtn.style.color = "white";
        viewPackingBtn.style.background = "#28A745";
        viewPackingBtn.style.border = "none";
        viewPackingBtn.style.padding = "3px 8px";
        viewPackingBtn.style.cursor = "pointer";
        viewPackingBtn.style.borderRadius = "4px";

        viewPackingBtn.addEventListener("click", () => {
          fetch(api101Url + "?invoice=" + encodeURIComponent(packingKey))
            .then(res => res.text())
            .then(url => {
              if (url !== "NOT_FOUND") {
                window.open(url, "_blank");
              } else {
                alert("Packing list not found!");
              }
            })
            .catch(err => {
              console.error(err);
              alert("Error fetching packing list");
            });
        });

        container.appendChild(viewInvoiceBtn);
        container.appendChild(viewPackingBtn);
        actionTd.appendChild(container);
      }

      tr.appendChild(actionTd);
      tbody.appendChild(tr);
    }
  });

  table.appendChild(thead);
  table.appendChild(tbody);
}



// -------------------- Search bar Function --------------------
function searchDataMIPL() {
  const query = document.getElementById("DATASEARCMIPL").value.trim().toLowerCase();

  if (!query) {
    renderDATAMIPLTABLE(allTableData);
    return;
  }

  const filtered = allTableData.filter((row, rowIndex) => {
    if (rowIndex === 0) return true; // header keep
    return row.some(cell => cell && cell.toString().toLowerCase().includes(query));
  });

  renderDATAMIPLTABLE(filtered);

  // Highlight matched text
  const table = document.getElementById("MIPLDATATABLE");
  if (table) {
    for (let i = 1; i < table.rows.length; i++) {
      for (let j = 0; j < table.rows[i].cells.length - 1; j++) { // last column skip (Actions)
        const cell = table.rows[i].cells[j];
        const originalText = filtered[i]?.[j] || "";
        if (originalText.toLowerCase().includes(query)) {
          const regex = new RegExp(`(${query})`, "gi");
          cell.innerHTML = originalText.replace(regex, `<span style="background:yellow; font-weight:bold;">$1</span>`);
        } else {
          cell.textContent = originalText;
        }
      }
    }
  }
}

// -------------------- Init --------------------
document.addEventListener("DOMContentLoaded", () => {
  loadDATAMIPLTABLE();
  const searchInput = document.getElementById("DATASEARCMIPL");
  if (searchInput) {
    searchInput.addEventListener("keyup", searchDataMIPL);
  }
});
</script>



</body>
</html>

<!---------------------------- DATAMIPLTABLE SCRIPT START STOP ---------------------------------------- -->



<!-- ------------------  daybook, id password modal box and script sectio area stop -------------------------------------- -->

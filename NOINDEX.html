<body style="background-color: rgb(1, 1, 1);"></body>


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MIPL DASHBOARD</title>
  <style>
    :root {
      --card-bg: #ffffff;
      --border: #e5e7eb;
    }

    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      background: #f7f7f8;
      display: flex;
      justify-content: center;
      align-items: center;
      
    }

    /* Modal container */
    .modalvcr { 
      width: 90in;
      height: 10in;
      background: var(--card-bg); 
      border-radius: 20px; 
      overflow: hidden; 
      border: 1px solid var(--border);
      
      box-shadow: 0 12px 30px rgba(0,0,0,.15);
      display: flex; 
      flex-direction: column;
    }

    /* Header */
    .modalvcr-header { 
      display: flex; 
      flex-direction: column; 
      padding: 16px 18px; 
      border-bottom:1px solid var(--border);
      background-color: #0111c3; 
      flex-shrink: 0;
    }

    .modalvcr-title { font-size: 1.05rem; font-weight:700; color: #b5edeb; }
    .muted { color:#b5edeb; font-weight:bold; }

    /* Navigation */
    nav {
      background-color: #323fcb;
      display: flex;
      justify-content: center;
      border-radius: 8px;
    }

    nav a {
      color: #fff;
      text-decoration: none;
      padding: 8px 14px;
      display: block;
      font-weight: bold;
      transition: background 0.3s;
      cursor: pointer;
      border-radius: 4px;
      margin: 2px;
    }

    nav a:hover { background: #3277cb; }
    nav a.active { background: #65a9f3; }

    /* Body with 20/80 top-bottom split */
    .modalvcr-body {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
      overflow: hidden;
    }

    .top-panel, .bottom-panel {
      flex-shrink: 0;
      position: relative;
      overflow: hidden;
    }

    .top-panel { flex: 0 0 20%; border-bottom:1px solid var(--border); }
    .bottom-panel { flex: 0 0 80%; }

    .panel-content {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      padding: 16px;
      overflow: auto;
      display: none;
    }

    .panel-content.active { display: block; }

   

    .modalvcr-footer {
      display: flex; 
      justify-content: flex-start; 
      gap: 5px; 
      padding: 12px 16px; 
      border-top: 1px solid var(--border);
      background-color: #2c2c2c;
      flex-shrink: 0;   
    }



    /* Container for table to manage height inside bottom panel */
.bottom-panel .table-container {
    height: 100%;          /* take full bottom panel height */
    overflow: auto;        /* scroll if content exceeds */
    padding: 8px;          /* optional padding */
    box-sizing: border-box;
}

/* Table style */
table {
    width: 100%;           /* auto fit container width */
    max-width: 100%;       /* prevent overflow */
    margin: 0 auto;        /* center table */
    border-collapse: collapse;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: clamp(10px, 1vw, 14px); /* dynamic text scaling */
    transform: scale(1);   /* scale table to 70% */
    transform-origin: top left; /* scale relative to top-left */
}

/* Adjusted table border & cell style */
th, td {
    border: 1px solid #dcdcdc;
    padding: 8px 10px;
    text-align: left;
   
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
}

/* Header design */
th {
    background: linear-gradient(135deg, #070707, #616161);
    color: #fff;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 13px;
    letter-spacing: 0.5px;
}

/* Row styling */
tr:nth-child(even) {
    background-color: #f9f9f9;
}

/* Hover effect */
tr:hover td {
    background: #fce303;
    transition: background 0.2s ease-in-out;
}

table tr:hover {
    background-color: #f81404;
    color: rgb(1, 20, 37);
    transition: background-color 0.3s ease, color 0.3s ease;
}

  </style>
</head>
<body>

   <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  modalvcr START  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
  <div class="modalvcr">
    <!-- Header -->
    <div class="modalvcr-header">
      <div style="font-weight: bold; color: white; align-items: center;">
        <div class="modalvcr-title">
         <span id="currentDateTime"  style="color:#caddf5;font-size:100%;font-family:Arial;"></span>
    
      
      
      </div>
       
      </div>
      <br/>
      <nav>
        <a class="active" data-target="home">Home</a>
        <a data-target="btn2">IMPREST LEDGER</a>
        <a data-target="btn3">UPCL Calculator</a>
        <a data-target="btn4">ID/Password</a>
        <a data-target="btn5">Cash Ledger</a>
     

           <!-- Dropdown -->
        <select id="navDropdown" style="background-color: #323fcb; color: yellow; border: #323fcb; font-weight: bold;">
          <option value="">More Options</option>
          <option value="https://www.openai.com">OpenAI</option>
          <option  data-target="btn6">Loan Calculator</option>
        </select>

      </nav>
    </div>

    <!-- Body -->
    <div class="modalvcr-body">
      <!-- Top panel -->
      <div class="top-panel">

<!-- home btn top part start -->   
        <div id="home-top" class="panel-content active" style="background-color: rgb(227, 251, 251); color: black;">

<div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
    <div id="poSummaryBox" style="color: rgb(9, 9, 9); padding-left: 10px;">Summary</div>




    <div style="display: flex; align-items: center; gap: 8px; padding-right: 10px;">
      <label for="search123Input" style="color: rgb(1, 22, 57);">Search:</label>
      <input type="text" id="search123Input" placeholder="üîç Search..." style="padding: 4px 8px; border-radius: 4px; border: none;" />
    </div>
  </div>
<span id="username">Guest</span>

        </div>
<!-- home btn top part stop --> 

<!-- btn2 -IMPREST LEDGER top part start -->
        <div id="btn2-top" class="panel-content">
           
          <div style="margin-bottom:10px;">
  <label>Searchbar:</label>
  <input type="text" id="ivcrGlobalSearch" placeholder=" Type to filter table..." oninput="filterIVCRTableGlobally()">
  <button onclick="refreshIVCRTable()">üîÑ Refresh Table</button>
  <button onclick="printIVCRTable()">üñ®Ô∏è Print Statement</button>
</div>

<button data-target="vbtn2">Click to New Entry</button>



        </div>
<!-- btn2 -IMPREST LEDGER top part stop -->

<!-- btn3 -upcl calculator top part start -->
        <div id="btn3-top" class="panel-content">
          <label>Enter Your  Units: </label>
  <input type="number" id="units" placeholder="Enter units">
  <button onclick="calculateBill()">Calculate</button>
  <button onclick="resetDefaults()">Reset Defaults</button>
        </div>
<!-- btn3 -upcl calculator top part stop -->

<!-- btn4 - top part START -->
        <div id="btn4-top" class="panel-content"> </div>
 <!-- btn4 - top part stop -->

 <!-- btn5 -top part strat -->
        <div id="btn5-top" class="panel-content">  </div>
<!-- btn5 - top part stop -->


 <!-- btn6 -L top part strat -->
        <div id="btn6-top" class="panel-content"> </div>
<!-- btn6 -top part stop -->


      </div>    <!-- XXXXXXXXXXXXXXX TOP PANAL stop XXXXXXXXXXXXXXXXXXX -->



      <!-- Bottom panel -->
      <div class="bottom-panel">

<!-- home btn bottam part start --> 
        <div id="home-bottom" class="panel-content active">
        
          <table id="dataTable"></table><br/><br/><br/>

        </div>
<!-- home btn bottam part start --> 

 <!-- btn2 -IMPREST LEDGER bottam part start -->
        <div id="btn2-bottom" class="panel-content"> 
           
          <!-- Data Table -->
<table id="myIVCRTable"></table>

        </div>   
 <!-- btn2 -IMPREST LEDGER bottam part stop -->

 <!-- btn3 -upcl calculator bottam part start -->
        <div id="btn3-bottom" class="panel-content">
 <span style="max-width:300px; text-align:center; margin:10px 0 20px; font-size:22px; line-height:1.5; color: rgb(7, 7, 7);">
   Uttarakhand Power Corporation Ltd. Energy Charge Calculator
    </span>
<br/>
   <span style="max-width:300px; text-align:center; margin:10px 0 20px; font-size:16px; line-height:1.5; color: rgb(13, 2, 173);">
     *All Rate & Amt only educational and calculation purpose. 
    </span>
<br/><br/>
           <!-- ===== VALUE KO EDITABLE BANANE KE LYE <td> "contenteditable="true" class="editable"" add kro ===== -->
  <table>
    <tr>
      <th>Description</th>
      <th>Units</th>
      <th>Rate</th>
      <th>Amount</th>
    </tr>
    <tr>
      <td>S1 (0‚Äì98.63)</td>
      <td id="s1u">0</td>
      <td contenteditable="true" class="editable" id="r1">3.65</td>
      <td id="s1c">0</td>
    </tr>
    <tr>
      <td>S2 (98.63‚Äì197.26)</td>
      <td id="s2u">0</td>
      <td contenteditable="true" class="editable" id="r2">5.25</td>
      <td id="s2c">0</td>
    </tr>
    <tr>
      <td>S3 (197.26‚Äì394.52)</td>
      <td id="s3u">0</td>
      <td contenteditable="true" class="editable" id="r3">7.15</td>
      <td id="s3c">0</td>
    </tr>
    <tr>
      <td>S4 (Above 394.52)</td>
      <td id="s4u">0</td>
      <td contenteditable="true" class="editable" id="r4">7.8</td>
      <td id="s4c">0</td>
    </tr>
    <tr class="total">
      <td colspan="3">Total Energy Charge</td>
      <td id="totalEnergy">0</td>
    </tr>
    <tr>
      <td>Fixed Charge (‚Çπ/kW) √ó Load</td>
      
      <td contenteditable="true" class="editable" id="fixedLoad" style="background-color: rgb(248, 202, 202);">3</td>
      <td  id="fixedRate">85</td>
      <td id="fixedAmt">0</td>
    </tr>
    <tr>
      <td>Electricity Duty (/kWh)</td>
      <td id="dutyUnits">0</td>
      <td  id="dutyRate">0.15</td>
      <td id="dutyAmt">0</td>
    </tr>
    <tr>
      <td>Fuel Adjustment (/kWh)</td>
      <td id="fuelUnits">0</td>
      <td  id="fuelRate">0.14</td>
      <td id="fuelAmt">0</td>
    </tr>
    <tr class="total">
      <td colspan="3">TOTAL BILL AMOUNT</td>
      <td id="grandTotal">0</td>
    </tr>
  </table>

   <p style="max-width:300px; text-align:center; margin:10px 0 20px; font-size:14px; line-height:1.5; color: red;">
     *All Rate as per Uttarakhand Power Corporation ltd Monthly Bill August 2025 
    </p>
        </div>
 <!-- btn3 -upcl calculator bottam part stop -->

  <!-- btn4 - bottam part START -->
        <div id="btn4-bottom" class="panel-content"> </div>
 <!-- btn4 - bottam part stop -->

  <!-- btn5 - bottam part start -->
        <div id="btn5-bottom" class="panel-content"> </div>
  <!-- btn5 -bottam part stop -->

   <!-- btn6 - bottam part start -->
        <div id="btn6-bottom" class="panel-content">
        
          
 <!-- ...................................Loan Calculator code strat .........................................................................-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Loan Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      padding: 20px;
    }
    .box {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      max-width: 400px;
      margin: auto;
    }
    h2 { margin-top: 0; }
    label { display: block; margin: 8px 0 4px; }
    input {
      width: 100%;
      padding: 6px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    .summary {
      margin-top: 20px;
      background: #f0f4ff;
      padding: 10px;
      border-radius: 8px;
    }
    .summary b { color: #222; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Loan Calculator</h2>

    <label>Loan Amount (‚Çπ):</label>
    <input type="number" id="loan" onblur="calculateLoan()">

    <label>Rate of Interest (% p.a.):</label>
    <input type="number" step="0.01" id="rate" onblur="calculateLoan()">

    <label>EMI (‚Çπ):</label>
    <input type="number" id="emi" onblur="calculateLoan()">

    <label>Tenure (Months):</label>
    <input type="number" id="months" onblur="calculateLoan()">

    <label>Installment Start Date:</label>
    <input type="date" id="startDate">

    <div class="summary" id="summary">
      <h3>üìå Loan Summary</h3>
      <p><b>Loan Amount:</b> ‚Çπ<span id="sLoan">-</span></p>
      <p><b>Rate of Interest:</b> <span id="sRate">-</span> % p.a.</p>
      <p><b>EMI:</b> ‚Çπ<span id="sEmi">-</span></p>
      <p><b>Tenure:</b> <span id="sMonths">-</span> months</p>
      <p><b>Start Date:</b> <span id="sDate">-</span></p>
    </div>
  </div>

  <script>
    function calculateLoan() {
      let P = parseFloat(document.getElementById("loan").value);   // Loan Amount
      let R = parseFloat(document.getElementById("rate").value);   // Annual Interest %
      let EMI = parseFloat(document.getElementById("emi").value);  // EMI
      let N = parseFloat(document.getElementById("months").value); // Tenure in Months

      let r = (R/100)/12; // monthly rate

      // 1Ô∏è‚É£ EMI ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç
      if (!EMI && P && R && N) {
        EMI = (P * r * Math.pow(1+r, N)) / (Math.pow(1+r, N) - 1);
        document.getElementById("emi").value = EMI.toFixed(2);
      }

      // 2Ô∏è‚É£ Tenure ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç
      else if (!N && P && R && EMI) {
        N = Math.log(EMI / (EMI - P*r)) / Math.log(1+r);
        document.getElementById("months").value = Math.round(N);
      }

      // 3Ô∏è‚É£ Loan Amount ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç
      else if (!P && EMI && R && N) {
        P = (EMI * (Math.pow(1+r, N) - 1)) / (r * Math.pow(1+r, N));
        document.getElementById("loan").value = P.toFixed(2);
      }

      // 4Ô∏è‚É£ Rate ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç (iterative method)
      else if (!R && P && EMI && N) {
        let guess = 0.01;
        let maxIter = 1000;
        for (let i = 0; i < maxIter; i++) {
          let emiCalc = (P * guess * Math.pow(1+guess, N)) / (Math.pow(1+guess, N) - 1);
          if (Math.abs(emiCalc - EMI) < 0.1) break;
          if (emiCalc > EMI) guess -= 0.0001;
          else guess += 0.0001;
        }
        R = guess * 12 * 100;
        document.getElementById("rate").value = R.toFixed(2);
      }

      // Summary update
      document.getElementById("sLoan").innerText = P ? P.toFixed(2) : "-";
      document.getElementById("sRate").innerText = R ? R.toFixed(2) : "-";
      document.getElementById("sEmi").innerText = EMI ? EMI.toFixed(2) : "-";
      document.getElementById("sMonths").innerText = N ? N : "-";
      
      let d = document.getElementById("startDate").value;
      document.getElementById("sDate").innerText = d ? d : "-";
    }
  </script>
</body>
</html>

 <!-- ...................................Loan Calculator code stop .........................................................................-->



        </div>
  <!-- btn6 - bottam part stop -->


      </div>    <!-- XXXXXXXXXXXXXXXXXXXXXXXX  BOTTAM PANAL stop  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX -->
    </div>    <!-- XXXXXXXXXXXXXXXXXXXXXXXX  MODALBODY STOP XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX -->

    <!-- Footer START -->
    <div class="modalvcr-footer">
      <div>

  
        <div class="modalvcr-title">eS|MTally</div>
        <div class="muted"> <span>User Name:</span> <span id="username">Guest</span>  <span>User ID:</span> <span id="userid"></span> <span id="authorization" style="color: #2c2c2c;"></span></div> 
      </div>
    </div>    <!-- Footer STOP -->
  </div>    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  modalvcr stop  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

 
 

  <script>
  const navLinks = document.querySelectorAll('nav a');
  const dropdown = document.getElementById('navDropdown');
  const authSpan = document.getElementById('authorization');

  // Helper function: check if authorized
  function isAuthorized(target) {
    const authText = (authSpan.textContent || "").trim();
    if (!authText) return false;
    const allowedList = authText.split(',').map(v => v.trim());
    // e.g. data-target="btn2" ‚Üí extract numeric part '2'
    const num = target.replace(/\D+/g, ''); 
    return allowedList.includes(num);
  }

  // Function to show "Not authorized" alert
  function showNotAuthorized() {
    alert("‚ùå You are not authorized for this menu");
  }

  // Navigation links click handler
  navLinks.forEach(link => {
    link.addEventListener('click', () => {
      const target = link.dataset.target;

      // If link has numeric target and not authorized ‚Üí block
      if (target && target.startsWith('btn') && !isAuthorized(target)) {
        showNotAuthorized();
        return;
      }

      // Update active link
      navLinks.forEach(l => l.classList.remove('active'));
      link.classList.add('active');

      // Update top panels
      document.querySelectorAll('.top-panel .panel-content').forEach(p => p.classList.remove('active'));
      const top = document.getElementById(`${target}-top`);
      if (top) top.classList.add('active');

      // Update bottom panels
      document.querySelectorAll('.bottom-panel .panel-content').forEach(p => p.classList.remove('active'));
      const bottom = document.getElementById(`${target}-bottom`);
      if (bottom) bottom.classList.add('active');
    });
  });

  // Dropdown handler
  dropdown.addEventListener('change', () => {
    const val = dropdown.value;
    const target = dropdown.options[dropdown.selectedIndex].getAttribute("data-target");

    if (val) {
      if (target) {
        // Authorization check for dropdown internal targets
        if (target && target.startsWith('btn') && !isAuthorized(target)) {
          showNotAuthorized();
          dropdown.selectedIndex = 0;
          return;
        }

        // same-page navigation (trigger like nav link)
        navLinks.forEach(l => l.classList.remove('active'));
        const navLink = document.querySelector(`nav a[data-target="${target}"]`);
        if (navLink) navLink.classList.add('active');

        // Panels update
        document.querySelectorAll('.top-panel .panel-content').forEach(p => p.classList.remove('active'));
        const top = document.getElementById(`${target}-top`);
        if (top) top.classList.add('active');

        document.querySelectorAll('.bottom-panel .panel-content').forEach(p => p.classList.remove('active'));
        const bottom = document.getElementById(`${target}-bottom`);
        if (bottom) bottom.classList.add('active');
      } else {
        // External link ‚Üí open in new tab
        window.open(val, "_blank");
      }
    }

    dropdown.selectedIndex = 0; // reset to "More Options"
  });
</script>

</body>
</html>

<!-- ------------------  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX -------------------------------------- -->



 <!-- login code and script start hare ........................................................... -->


 <!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sheet Login Example</title>
  <style>
    /* Simple modal styling */
    .overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.45);
      display:flex; align-items:center; justify-content:center;
      z-index: 9999;
    }
    .modal {
      background: #fff; padding:20px; border-radius:8px;
      width: 320px; box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      font-family: Arial, sans-serif;
    }
    .modal h2 { margin:0 0 10px; font-size:18px; }
    .modal label { display:block; margin:8px 0 4px; font-weight:600; }
    .modal input[type="text"], .modal input[type="password"] {
      width:100%; padding:8px; box-sizing:border-box; border:1px solid #ccc; border-radius:4px;
    }
    .modal .actions { margin-top:12px; display:flex; gap:8px; justify-content:flex-end; }
    button { padding:8px 12px; border:none; border-radius:6px; cursor:pointer; }
    button.primary { background:#2563eb; color:white; }
    button.normal { background:#f59595; }
    .error { color:#b91c1c; margin-top:8px; font-size:13px; }
    /* Page content spacing */
    .content { padding:20px; }
  </style>
</head>
<body>


  <!-- Login modal (hidden once logged in) -->
  <div id="loginOverlay" class="overlay" aria-hidden="false">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <h2 id="loginTitle">Login karein</h2>

      <label for="inputUserId">User ID</label>
      <input id="inputUserId" type="text" autocomplete="username" />

      <label for="inputPassword">Password</label>
      <input id="inputPassword" type="password" autocomplete="current-password" />

      <div class="actions">
        <button id="btnCancel" class="normal" type="button">Cancel</button>
        <button id="btnLogin" class="primary" type="button">Login</button>
      </div>

      <div id="loginError" class="error" style="display:none;"></div>
    </div>
  </div>

 <script>
  // -------------------------
  // CONFIG - user provided
  // -------------------------
  const userApiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
  const userSheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
  const userRange = "USER!A:N"; // full range as requested

  // -------------------------
  // Helper & DOM refs
  // -------------------------
  const overlay = document.getElementById('loginOverlay');
  const btnLogin = document.getElementById('btnLogin');
  const btnCancel = document.getElementById('btnCancel');
  const inputUserId = document.getElementById('inputUserId');
  const inputPassword = document.getElementById('inputPassword');
  const loginError = document.getElementById('loginError');

  // ‚úÖ Updated: Select all spans (not just the first)
  const allUserIdSpans = document.querySelectorAll('#userid');
  const allUserNameSpans = document.querySelectorAll('#username');
  const allAuthorizationSpans = document.querySelectorAll('#authorization');

  // Store fetched sheet rows (array of arrays)
  let sheetRows = null;

  // -------------------------
  // Fetch sheet data
  // -------------------------
  async function fetchSheetData() {
    try {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${encodeURIComponent(userSheetId)}/values/${encodeURIComponent(userRange)}?key=${encodeURIComponent(userApiKey)}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Sheet fetch failed: " + res.statusText);
      const data = await res.json();
      sheetRows = data.values || [];
    } catch (err) {
      console.error(err);
      loginError.style.display = 'block';
      loginError.textContent = "Sheet se data laane me problem: " + (err.message || err);
    }
  }

  fetchSheetData();

  // -------------------------
  // Login logic
  // -------------------------
  function tryLogin() {
    loginError.style.display = 'none';
    const enteredId = inputUserId.value.trim();
    const enteredPwd = inputPassword.value;

    if (!enteredId || !enteredPwd) {
      loginError.style.display = 'block';
      loginError.textContent = "Donon fields bharna zaroori hai.";
      return;
    }

    if (!sheetRows) {
      loginError.style.display = 'block';
      loginError.textContent = "Sheet data abhi tak loaded nahi hua. Thodi der me try karein.";
      return;
    }

    // find matching row
    let matchedRow = null;
    for (let r = 0; r < sheetRows.length; r++) {
      const row = sheetRows[r];
      const colB = (row[1] || "").toString().trim();
      const colC = (row[2] || "").toString();
      if (colB === enteredId && colC === enteredPwd) {
        matchedRow = row;
        break;
      }
    }

    if (!matchedRow) {
      loginError.style.display = 'block';
      loginError.textContent = "User ID ya Password galat hai. Dobara koshish karein.";
      return;
    }

    // ‚úÖ Update all spans across entire page
    const userNameValue = (matchedRow[4] || "").toString();
    const authValue = (matchedRow[5] || "").toString().trim() || "Not authorized any function";

    allUserIdSpans.forEach(span => span.textContent = enteredId);
    allUserNameSpans.forEach(span => span.textContent = userNameValue);
    allAuthorizationSpans.forEach(span => span.textContent = authValue);

    // hide modal
    overlay.style.display = 'none';
  }

  // Cancel button
  btnCancel.addEventListener('click', () => {
    inputUserId.value = "";
    inputPassword.value = "";
  });

  // Login click
  btnLogin.addEventListener('click', tryLogin);

  // Enter key shortcuts
  inputPassword.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') tryLogin();
  });
  inputUserId.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') inputPassword.focus();
  });

  // Focus first field
  inputUserId.focus();
</script>

</body>
</html>


 <!-- login code and script start hare ........................................................... -->







<!-- ------------------  upcl bill calculator start -------------------------------------- -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Energy Charge Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#f4f6f9; }
    h2 { color:#333; }
    
    input { padding:5px; width:200px; }
    .total { font-weight:bold; background:#e6f7ff; }
    .editable { background:#fff8dc; }
  </style>
</head>
<body>

<script>
  // Default Values
  const defaults = {
    r1: 3.65,
    r2: 5.25,
    r3: 7.15,
    r4: 7.80,
    fixedRate: 85,
    fixedLoad: 3,
    dutyRate: 0.15,
    fuelRate: 0.14
  };

  // Reset function
  function resetDefaults() {
    for (let key in defaults) {
      document.getElementById(key).innerText = defaults[key];
    }
    document.getElementById("units").value = "";
    document.querySelectorAll("td[id$='u'], td[id$='c'], #totalEnergy, #grandTotal, #fixedAmt, #dutyAmt, #fuelAmt, #dutyUnits, #fuelUnits")
      .forEach(el => el.innerText = "0");
    document.getElementById("fixedLoad").innerText = defaults.fixedLoad;
  }

  // Calculation
  function calculateBill() {
    let units = parseFloat(document.getElementById("units").value) || 0;

    let rate1 = parseFloat(document.getElementById("r1").innerText) || defaults.r1;
    let rate2 = parseFloat(document.getElementById("r2").innerText) || defaults.r2;
    let rate3 = parseFloat(document.getElementById("r3").innerText) || defaults.r3;
    let rate4 = parseFloat(document.getElementById("r4").innerText) || defaults.r4;

    let fixedRate = parseFloat(document.getElementById("fixedRate").innerText) || defaults.fixedRate;
    let fixedLoad = parseFloat(document.getElementById("fixedLoad").innerText) || defaults.fixedLoad;
    let dutyRate = parseFloat(document.getElementById("dutyRate").innerText) || defaults.dutyRate;
    let fuelRate = parseFloat(document.getElementById("fuelRate").innerText) || defaults.fuelRate;

    // Slabs
    let s1 = Math.min(units, 98.63);
    let s2 = (units > 98.63) ? Math.min(units - 98.63, 98.63) : 0;
    let s3 = (units > 197.26) ? Math.min(units - 197.26, 197.26) : 0;
    let s4 = (units > 394.52) ? (units - 394.52) : 0;

    let c1 = s1 * rate1;
    let c2 = s2 * rate2;
    let c3 = s3 * rate3;
    let c4 = s4 * rate4;

    let totalEnergy = c1 + c2 + c3 + c4;
    let fixed = fixedRate * fixedLoad;
    let duty = units * dutyRate;
    let fuel = units * fuelRate;
    let grandTotal = totalEnergy + fixed + duty + fuel;

    // Update table
    document.getElementById("s1u").innerText = s1.toFixed(2);
    document.getElementById("s2u").innerText = s2.toFixed(2);
    document.getElementById("s3u").innerText = s3.toFixed(2);
    document.getElementById("s4u").innerText = s4.toFixed(2);

    document.getElementById("s1c").innerText = c1.toFixed(2);
    document.getElementById("s2c").innerText = c2.toFixed(2);
    document.getElementById("s3c").innerText = c3.toFixed(2);
    document.getElementById("s4c").innerText = c4.toFixed(2);

    document.getElementById("totalEnergy").innerText = totalEnergy.toFixed(2);

    document.getElementById("fixedAmt").innerText = fixed.toFixed(2);
    document.getElementById("dutyUnits").innerText = units.toFixed(2);
    document.getElementById("dutyAmt").innerText = duty.toFixed(2);
    document.getElementById("fuelUnits").innerText = units.toFixed(2);
    document.getElementById("fuelAmt").innerText = fuel.toFixed(2);

    document.getElementById("grandTotal").innerText = grandTotal.toFixed(2);
  }

  // Use DOMContentLoaded instead of window.onload
  document.addEventListener("DOMContentLoaded", resetDefaults);
</script>


</body>
</html>
<!-- ------------------  upcl bill calculator stop -------------------------------------- -->


<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, M1000 - ID/PASWORD OTHER DETAILS Start Heare -->

 <!DOCTYPE html>
 <html>
 <head>
     <title>ID | PASSWORD ESS</title>
     <style>
         body {
             margin: 0;
             font-family: Arial, sans-serif;
         }
         #searchDiv {
             position: sticky;
             top: 0;
             background: #f8f9fa;
             padding: 10px;
             border-bottom: 2px solid #ccc;
             z-index: 1000; /* Ensure it stays above the table */
         }
         
         tr.hidden {
             display: none;
         }
         #noResultsMessage {
             text-align: center;
             margin-top: 10px;
         }
 
        
         /* ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, Highlight the search value colour in table */
         .highlight {
     background-color: rgb(21, 215, 241);
     font-weight: bold;
 }
     </style>
     <script>
        async function M1000() {
            const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
            const sheetId = "1EOO0QzwNaPhwIfZN_DCLlhQB9yeC-j-GpmtM_6JMRmw";
            const range = 'PASSWORD!A:E';

            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
                );
                const data = await response.json();

                if (data.values) {
                    const table = document.getElementById('m1000lTable');
                    table.innerHTML = ''; // Clear existing table content

                    data.values.forEach((row, index) => {
                        const tr = document.createElement('tr');

                        if (index === 0) {
                            // Header row
                            row.forEach((cell) => {
                                const th = document.createElement('th');
                                th.textContent = cell;
                                tr.appendChild(th);
                            });
                        } else {
                            // Data rows
                            row.forEach((cell, cellIndex) => {
                                const td = document.createElement('td');

                                // Check if the cell contains a URL and create a clickable link
                                if (typeof cell === 'string' && (cell.startsWith('http') || cell.startsWith('www'))) {
                                    const a = document.createElement('a');
                                    a.href = cell.startsWith('http') ? cell : `http://${cell}`; // Add http:// if missing
                                    a.innerHTML = "&#128221; Click to View PO"; // Use icon as link text
                                    a.target = "_blank";
                                    td.appendChild(a);
                                } else {
                                    td.textContent = cell;
                                }

                                // Highlight row based on column value
                                if (cellIndex === 0) {
                                    if (cell.toLowerCase() === "credit note") {
                                        tr.classList.add('blue');
                                    } else if (cell.toLowerCase() === "bank") {
                                        tr.classList.add('red');
                                    }
                                }

                                tr.appendChild(td);
                            });
                        }
                        table.appendChild(tr);
                    });
                } else {
                    console.error("No data found in the specified range.");
                }
            } catch (error) {
                console.error("Error fetching data from Google Sheets:", error);
            }
        }

        function serchProfile() {
            const query = document.getElementById('inputArea').value.toLowerCase();
            const table = document.getElementById('m1000lTable');
            const rows = document.querySelectorAll('#m1000lTable tr');
            let visibleRows = 0; // Track the number of visible rows

            rows.forEach((row, index) => {
                if (index === 0) return; // Skip header row

                // Remove previous highlights
                row.querySelectorAll('td').forEach(cell => {
                    cell.innerHTML = cell.textContent; // Reset any highlights
                });

                if (query.trim() === '') {
                    row.classList.add('hidden'); // Hide all rows if search bar is blank
                } else {
                    const cells = row.querySelectorAll('td');
                    const rowText = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(' ');

                    if (rowText.includes(query)) {
                        row.classList.remove('hidden');
                        visibleRows++;

                        // Highlight the search term within the row
                        cells.forEach(cell => {
                            const cellText = cell.textContent;
                            const regex = new RegExp(`(${query})`, 'gi');
                            const highlightedText = cellText.replace(regex, '<span class="highlight">$1</span>');
                            cell.innerHTML = highlightedText; // Apply highlighting
                        });
                    } else {
                        row.classList.add('hidden');
                    }
                }
            });

            // Show the table if there are visible rows
            if (visibleRows > 0) {
                table.style.display = 'table';
            } else {
                table.style.display = 'none';
            }

            // Display a message if no rows are visible
            const noResultsMessage = document.getElementById('noResultsMessage');
            if (!visibleRows && query.trim() !== '') {
                if (!noResultsMessage) {
                    const message = document.createElement('p');
                    message.id = 'noResultsMessage';
                    message.textContent = 'No matching results found.';
                    document.body.appendChild(message);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }

        window.onload = () => {
            // Hide table initially
           document.getElementById('m1000lTable').style.display = 'none';

            // Load data and set up search
              M1000();
           document.getElementById('inputArea').addEventListener('input', serchProfile);
           };
    </script>
 </head>
 <body>
     

    
 </body>
 </html>
 <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, M1000 - ID/PASWORD OTHER DETAILS stop Heare -->









<!-- Current date and time will be displayed here -->
                    
<meta name="viewport" content="width=device-width, initial-scale=1.0">

            
<script>
    function displayCurrentDateTime() {
        const now = new Date();
        
        // Formatting options
        const options = { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric', 
            hour: '2-digit', 
            minute: '2-digit', 
            second: '2-digit' 
        };
        
        // Formatting date and time
        const formattedDateTime = now.toLocaleString('en-US', options);
        
        // Displaying in the div
        document.getElementById("currentDateTime").textContent = `Today: ${formattedDateTime}`;
    }

    // Call the function on page load to show the current date and time
    displayCurrentDateTime();
    
    // Update the date and time every second
    setInterval(displayCurrentDateTime, 1000);
</script>
 <!-- Current date and time will be displayed Stop -->






























































 <!-- IMPREST LEDGER code and script start hare ........................................................... -->
 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IVCR Sheet Viewer (User Filtered)</title>
<style>

  label {
    font-size: 18px;
    color: #013aac;
    margin-right: 8px;
  }
  input[type="text"] {
    padding: 6px 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    width: 260px;
  }
  button {
    background: #013aac;
    color: white;
    border: none;
    padding: 7px 12px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
  }
  button:hover {
    background: #011f66;
  }
  tr.receipt {
    color: #cc0909;
  }
  tr.bill {
    background-color: #ffe7e7;
  }
</style>



<style>
.dropdown-container {
  position: relative;
  width: 250px;
  margin-bottom: 20px;
}

.dropdownCSSlist {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid #ccc;
  border-radius: 4px;
  max-height: 180px;
  overflow-y: auto;
  list-style: none;
  padding: 0;
  margin: 4px 0 0;
  display: none;
  z-index: 1000;
}

.dropdownCSSlist li:hover {
  background-color: #f0f0f0;
}
</style>


</head>
<body>




<script>
  const ivcrKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
  const ivcrSheetId = "1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA";
  const ivcrRange = 'IVCR!W:AD';
  let fulivcrData = [];

  // üìÑ Load IVCR Sheet from Google Sheets
  async function loadIVCRSheet() {
    try {
      const response = await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${ivcrSheetId}/values/${ivcrRange}?key=${ivcrKey}`
      );
      const data = await response.json();
      if (data.values) fulivcrData = data.values;

      renderTableForCurrentUser();
      populateDropdownList(fulivcrData); // ‚úÖ FIX: Populate dropdown after data loads
    } catch (err) {
      console.error("Error fetching IVCR data:", err);
    }
  }

  // üßæ Filter data based on <span id="userid">
  function renderTableForCurrentUser() {
    const currentUser = document.getElementById('userid').textContent.trim().toLowerCase();
    if (!currentUser || currentUser === "not logged in") return;

    const filtered = fulivcrData.filter(
      (row, i) => i === 0 || (row[1] || '').trim().toLowerCase() === currentUser
    );

    populateIVCRTable(filtered);
  }

  // ü™Ñ Populate Table
  function populateIVCRTable(data) {
    const table = document.getElementById("myIVCRTable");
    table.innerHTML = '';

    data.forEach((row, index) => {
      const tr = document.createElement("tr");

      if (index === 0) {
        row.forEach(cell => {
          const th = document.createElement("th");
          th.textContent = cell;
          tr.appendChild(th);
        });
        const th = document.createElement("th");
        th.textContent = "Balance";
        tr.appendChild(th);
      } else {
        row.forEach((cell, idx) => {
          const td = document.createElement("td");
          td.textContent = cell;
          tr.appendChild(td);

          if (idx === 2) {
            const type = cell.trim().toLowerCase();
            if (type === 'receipt') tr.classList.add('receipt');
            if (type === 'bill') tr.classList.add('bill');
          }
        });
        const td = document.createElement("td");
        td.className = "runningBalance";
        tr.appendChild(td);
      }
      table.appendChild(tr);
    });

    calculateIVCRRunningBalance();
  }

  // üí∞ Calculate Running Balance
  function calculateIVCRRunningBalance() {
    const rows = Array.from(document.querySelectorAll("#myIVCRTable tr")).slice(1);
    if (rows.length === 0) return;
    let balance = 0;

    for (let i = rows.length - 1; i >= 0; i--) {
      const row = rows[i];
      const tds = row.querySelectorAll('td');
      const amt = parseFloat(tds[5]?.textContent || "0");
      const typ = tds[2]?.textContent.trim().toLowerCase();

      if (!isNaN(amt)) {
        if (typ === 'receipt' || typ === 'salary') balance += amt;
        else if (typ === 'payment' || typ === 'bill') balance -= amt;
      }
      tds[tds.length - 1].textContent = balance.toFixed();
    }
  }

  // üîÑ Refresh Function
  async function refreshIVCRTable() {
    await loadIVCRSheet();
  }

  // üîç Global Search
  function filterIVCRTableGlobally() {
    const input = document.getElementById("ivcrGlobalSearch").value.toLowerCase();
    const table = document.getElementById("myIVCRTable");
    const rows = table.querySelectorAll("tr");

    rows.forEach((row, index) => {
      if (index === 0) return;
      const match = Array.from(row.querySelectorAll("td")).some(td =>
        td.textContent.toLowerCase().includes(input)
      );
      row.style.display = match ? "" : "none";
    });
  }

  // ‚úÖ FIX: DROPDOWN FUNCTIONS
  function populateDropdownList(data) {
    const ul = document.getElementById("dropdownIVCRList");
    ul.innerHTML = '';
    const uniqueValues = [...new Set(data.slice(1).map(row => row[4]))].filter(v => v);

    uniqueValues.forEach(value => {
      const li = document.createElement("li");
      li.textContent = value;
      li.style.padding = "6px 10px";
      li.style.cursor = "pointer";
      li.style.borderBottom = "1px solid #ddd";

      li.onclick = () => {
        document.getElementById('dropdownIVCRSearch').value = value;
        ul.style.display = "none";
        filterTableByLedger(value);
      };

      ul.appendChild(li);
    });
  }

  function filterIVCRDropdown() {
    const searchInput = document.getElementById("dropdownIVCRSearch");
    const list = document.getElementById("dropdownIVCRList");
    const searchVal = searchInput.value.toLowerCase();

    const items = list.querySelectorAll("li");
    let found = false;

    items.forEach(item => {
      const match = item.textContent.toLowerCase().includes(searchVal);
      item.style.display = match ? "block" : "none";
      if (match) found = true;
    });

    list.style.display = found && searchVal !== "" ? "block" : "none";
  }

  // ‚úÖ FIX: Filter table by ledger name
  function filterTableByLedger(ledgerName) {
    const rows = document.querySelectorAll("#myIVCRTable tr");
    rows.forEach((row, index) => {
      if (index === 0) return;
      const ledgerCell = row.querySelectorAll("td")[4];
      row.style.display = ledgerCell && ledgerCell.textContent === ledgerName ? "" : "none";
    });
  }

  // üñ® Print Function
  function printIVCRTable() {
    const table = document.getElementById("myIVCRTable").outerHTML;
    const today = new Date().toLocaleString();
    const user = document.getElementById('userid').textContent.trim();

    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
      <html>
        <head>
          <title>${user} - Account Statement</title>
          <style>
            body { font-family: 'Segoe UI', sans-serif; margin: 20px; color: #000; }
            h2 { text-align: center; text-transform: uppercase; }
            .subtitle { text-align: center; font-size: 14px; color: #555; margin-bottom: 20px; }
            table { width: 100%; border-collapse: collapse; font-size: 13px; }
            th, td { border: 1px solid #333; padding: 6px 8px; text-align: left; }
            th { background: #f0f0f0; font-weight: bold; }
            tr:nth-child(even) { background-color: #fafafa; }
            .footer { margin-top: 30px; font-size: 12px; text-align: center; color: #555; }
            @media print { button { display: none; } }
          </style>
        </head>
        <body>
          <h2>${user} - Account Statement</h2>
          <div class="subtitle">Printed on: ${today}</div>
          ${table}
          <div class="footer">System-generated statement. No signature required.</div>
          <script>window.print();<\/script>
        </body>
      </html>
    `);
    printWindow.document.close();
  }

  // ‚ö° DOM Load + Watch for Login
  document.addEventListener("DOMContentLoaded", () => {
    const userSpan = document.getElementById('userid');
    const observer = new MutationObserver(() => {
      const value = userSpan.textContent.trim();
      if (value && value !== "Not logged in") {
        observer.disconnect();
        loadIVCRSheet();
      }
    });
    observer.observe(userSpan, { childList: true });
  });
</script>





</body>
</html>
 <!-- IMPREST LEDGER code and script STOP hare ........................................................... -->








 











 <!-- IVCR form div script start hare -->
<!-- ‚úÖ IVCR Form Script (Full Fixed Version) -->
<script>
  const scriptIVCRURL = 'https://script.google.com/macros/s/AKfycbz-lyd06EKKSO4xVaTSRWoIgMWS0C9nZvzipEP59K25TZSOSdL5CMpYJNPgmF1nyyGrXg/exec';

  // üîπ Handle form submission
  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainIVCRForm") return;

    e.preventDefault();

    const formMode = document.getElementById("formModeIVCR").value;
    const submitIVCRButton = document.getElementById("submitIVCRButton");
    submitIVCRButton.disabled = true;
    submitIVCRButton.value = "Wait...";

    // üîπ Add timestamp
    const now = new Date();
    document.getElementById('timestampIVCR').value =
      `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    // üîπ Convert text to uppercase
    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    // üîπ Choose submit or modify
    if (formMode === "modify") {
      await modifyIVCREntry();
    } else {
      await submitIVCREntry(form);
    }

    submitIVCRButton.disabled = false;
    submitIVCRButton.value = "Submit";
  });

  // üîπ Submit new entry
  async function submitIVCREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptIVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset();

        // ‚úÖ Reset form state
        document.getElementById("formModeIVCR").value = "new";
        document.getElementById("sNo").value = "";

        // ‚úÖ Refresh sheet & table
        await loadIVCRSheet();
 

        // ‚úÖ Remove DLT option
        const voucherDropdown = document.getElementById("voucherType");
        const dltOption = [...voucherDropdown.options].find(opt => opt.value === "DLT");
        if (dltOption) voucherDropdown.removeChild(dltOption);

      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }

  // üîπ Fetch details by S.No for modify/delete
  async function fetchIVCRDetails() {
    const sNo = document.getElementById("searchIVCRSNo").value;
    const waitMessage = document.getElementById("waitIVCRMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

    try {
      const response = await fetch(`${scriptIVCRURL}?sNo=${sNo}`);
      const data = await response.json();

      const voucherTypeDropdown = document.getElementById("voucherType");
      const selectedIVVoucher = voucherTypeDropdown.value;

      if (data.result !== "error" && data.Voucher === selectedIVVoucher) {

        // ‚úÖ Fill fetched data
        document.getElementById("sNo").value = data.SNo;
        document.getElementById("voucherType").value = data.Voucher;
        document.getElementById("ivcr0").value = data.Type;
        document.getElementById("ivcr1").value = data.Date;
        document.getElementById("dropdownIVCRSearch").value = data.Ledger;
        document.getElementById("ivcr2").value = data.Amount;
        document.getElementById("ivcr3").value = data.Narration;

        // ‚úÖ Add DLT option if missing
        if (![...voucherTypeDropdown.options].some(opt => opt.value === "DLT")) {
          const deleteOption = document.createElement("option");
          deleteOption.value = "DLT";
          deleteOption.text = "Delete";
          deleteOption.style.color = "red";
          deleteOption.style.backgroundColor = "blue";
          voucherTypeDropdown.appendChild(deleteOption);
        }

        // ‚úÖ Set modify mode
        document.getElementById("formModeIVCR").value = "modify";
        alert("Select 'Delete' Option in User Section to Delete Entry or Modify Details.");
      } else {
        alert("No record found for the given S.No.");
      }

    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  // üîπ Modify existing entry
  async function modifyIVCREntry() {
    const waitMessage = document.getElementById("waitIVCRMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";

    const form = document.getElementById('mainIVCRForm');

    // ‚úÖ New timestamp
    const now = new Date();
    document.getElementById('timestampIVCR').value =
      `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptIVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();

        // ‚úÖ Reset state for new entry
        document.getElementById("sNo").value = "";
        document.getElementById("formModeIVCR").value = "new";
        document.getElementById("submitIVCRButton").value = "Submit";
        document.getElementById("submitIVCRButton").disabled = false;

        // ‚úÖ Reload & refresh
        await loadIVCRSheet();
     

        // ‚úÖ Remove DLT option
        const voucherDropdown = document.getElementById("voucherType");
        const dltOption = [...voucherDropdown.options].find(opt => opt.value === "DLT");
        if (dltOption) voucherDropdown.removeChild(dltOption);

      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  // üîπ Optional reset function (can be reused)
  function resetIVCRState() {
    document.getElementById("formModeIVCR").value = "new";
    document.getElementById("sNo").value = "";
  }
</script>
<!-- ‚úÖ End of IVCR Form Script -->
<!-- IVCR form div script stop hare -->














 <!-- -------------------------------------------PO/REF NO SERCH SCRIPT AND CODE STOP ........................................................... -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Daybook MIPL</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    
/* Container to control table width and responsiveness */
.table-container {
  width: 100%;
  overflow-x: auto;
}



 
 /* Table container */

  /* Row hover effect */
  tr:hover td {
    background: #fce303;
    transition: background 0.2s ease-in-out;  }
    
    table tr:hover {
  background-color: #f81404;
  color: rgb(1, 20, 37);
  transition: background-color 0.3s ease, color 0.3s ease;
  }

 

        
    #search123Input {
      margin-bottom: 10px;
      padding: 8px;
      width: 250px;
      font-size: 16px;
    }
   
    a {
      text-decoration: none;
      font-size: 18px;
    }
    .blue-bg { color: green; }
    .pink-bg { color: blue; }
    .green-bg { color: #4682b4; }
    .red-bg { color: red; }

    /* Modal styles */
    #dataModal {
       display: none;
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: rgb(230, 231, 231);
    
      padding: 20px;
      z-index: 1000;
      max-height: 75%;
      overflow: auto;
      width: 90%;
      max-width: 1600px;
      border: 10px solid #810301;
      border-radius: 20px;
    }
    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #00000066;
      z-index: 999;
    }
    .btnposummry {
      margin: 10px 5px 0 0;
      padding: 6px 12px;
      cursor: pointer;
    }

  .footer {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background-color: #026186;
  padding: 6px 0;
  z-index: 1000;
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
}

  </style>
</head>
<body>
  <!-- Modal Popup -->
  <div id="overlay" onclick="closeModal()"></div>
  <div id="dataModal">
    <h3>Multitech Infracon Pvt Ltd. <br/>Ledger Details</h3>
     <button class="btnposummry"  onclick="printModal()">üñ®Ô∏è Print</button>
    <button class="btnposummry"  onclick="closeModal()">‚ùå Close</button>
    <div id="modalContent"></div>
  </div>


<script>


const api123Key = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheet123Id = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
const range123 = "POREFF!A:R";
const api103Url = "https://script.google.com/macros/s/AKfycbzBXPXYoX9xp2IqWYXvVYMPhgERM41XQ8CyhOBWtpnFQy2SZIkQqBPlHTfl9-Z3nn8rXg/exec"; 
const apiPOUrl = "https://script.google.com/macros/s/AKfycbxqXzSs-JOBPEUWqrI0-SUVmtGzRJKBoR3srraxO_peECS7ELm-xxZqOUQisJjCwrPW4A/exec";

const headerHTML = `
  <tr>
    <th>PO Link</th>
    <th>Progress %</th>
    <th>JOB NO.</th><th>Ledger</th><th>PO/Reff No</th><th>PO Amount</th>
    <th>Billing Amount</th><th>Balance</th><th>PO Weight</th><th>Billing Weight</th>
    <th>Balance</th><th>Status</th><th>User</th><th>Order By</th>
  </tr>`;

const visibleIndexes = [0,16, 6, 8, 12, 14, 9, 13, 15, 7, 1, 2];
let fullTableData = [];

async function fetch123Data() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet123Id}/values/${range123}?key=${api123Key}`;
  const response = await fetch(url);
  const data = await response.json();
  const rows = data.values || [];

  const header = rows[0];
  const dataRows = rows.slice(1);
  dataRows.sort((a, b) => (parseFloat(b[0]) || 0) - (parseFloat(a[0]) || 0));
  fullTableData = [header, ...dataRows];

  renderPOSUMMRYTable(fullTableData);
  setupSearch(fullTableData);
}

function renderPOSUMMRYTable(data) {
  const table = document.getElementById("dataTable");
  table.innerHTML = "";
  const thead = document.createElement("thead");
  thead.innerHTML = headerHTML;
  table.appendChild(thead);
  const tbody = document.createElement("tbody");

  // üî¥ Filter rows where column[2] === "LESHANT"
  const filteredData = [data[0], ...data.slice(1).filter(row => (row[2] || "").toUpperCase() === "LESHANT")];

  for (let i = 1; i < filteredData.length; i++) {
    const dataRow = filteredData[i];
    const row = document.createElement("tr");

    // --- PO Link ---
    const poNo = dataRow[6] || "";
    const poCell = document.createElement("td");

    if (poNo) {
      poCell.textContent = "---";
      fetch(apiPOUrl + "?invoice=" + encodeURIComponent(poNo))
        .then(res => res.text())
        .then(url => {
          if (url && url !== "NOT_FOUND") {
            poCell.textContent = "View PO";
            poCell.style.color = "red";
            poCell.style.textDecoration = "underline";
            poCell.style.cursor = "pointer";
            poCell.onclick = () => window.open(url, "_blank");
          } else {
            poCell.textContent = "---";
            poCell.removeAttribute("style");
            poCell.onclick = null;
          }
        })
        .catch(() => {
          poCell.textContent = "---";
          poCell.removeAttribute("style");
          poCell.onclick = null;
        });
    } else {
      poCell.textContent = "---";
    }
    row.appendChild(poCell);

    // --- Progress % ---
    const poAmount = parseFloat(dataRow[8]) || 0;
    const billingAmount = parseFloat(dataRow[12]) || 0;
    let progress = 0, label = "---";
    if (poAmount !== 0) {
      progress = (billingAmount / poAmount) * 100;
      label = progress <= 100
        ? `${progress.toFixed()}% work complete`
        : `${(progress - 100).toFixed()}% work extra`;
    }
    const progressCell = document.createElement("td");
    progressCell.textContent = label;
    if (progress > 100) progressCell.classList.add("orange-bg");
    else if (progress >= 60) progressCell.classList.add("blue-bg");
    else if (progress >= 30) progressCell.classList.add("pink-bg");
    else progressCell.classList.add("green-bg");
    row.appendChild(progressCell);

    // --- Visible Columns ---
    visibleIndexes.forEach(colIndex => {
      const td = document.createElement("td");
      const cellValue = dataRow[colIndex] || "";

      if (colIndex === 6) {
        td.style.cursor = "pointer";
        td.style.color = "#2980b9";
        td.style.fontSize = "16PX";
        td.style.textDecoration = "underline";
        td.addEventListener("click", () => {
          const jobNo = cellValue;
          const ledgerName = dataRow[16] || "---";
          const ledgerAddress = dataRow[17] || "---";
          fetchReffNo(jobNo, ledgerName, ledgerAddress);
        });
      }

      if (colIndex === 16) {
        td.style.cursor = "pointer";
        td.style.color = "#d35400";
        td.style.fontWeight = "bold";
        td.style.textDecoration = "underline";
        td.addEventListener("click", () => {
          const ledgerName = cellValue;
          const ledgerAddress = dataRow[17] || "---";
          fetchLedgerByLedgerName(ledgerName, ledgerAddress);
        });
      }

      if (typeof cellValue === 'string' && (cellValue.startsWith("http") || cellValue.startsWith("www"))) {
        const a = document.createElement("a");
        a.href = cellValue.startsWith("http") ? cellValue : "https://" + cellValue;
        a.innerHTML = "&#128221;";
        a.target = "_blank";
        td.appendChild(a);
      } else {
        td.textContent = cellValue;

        if (colIndex === 7) {
          td.style.fontWeight = "bold";
          td.style.fontSize = "13px";
          const colorMap = {
            "CANCELED": "#dc7633",
            "COMPLETED": "#48c9b0",
            "RUNNING": "#808b96",
            "PENDING": "#5dade2"
          };
          td.style.color = colorMap[cellValue] || "black";
        }
      }

      const col5Val = parseFloat(dataRow[14]) || 0;
      const col8Val = parseFloat(dataRow[15]) || 0;
      if (col5Val < 0 && colIndex === 14) td.classList.add("red-bg");
      if (col8Val < 0 && colIndex === 15) td.classList.add("red-bg");

      row.appendChild(td);
    });

    tbody.appendChild(row);
  }

  table.appendChild(tbody);

  // ‚úÖ Call summary function ONLY for filtered LESHANT data
  displayporeffResults(filteredData);
}


function displayporeffResults(entries) {
  const summaryDiv = document.getElementById("poSummaryBox");
  summaryDiv.innerHTML = "";

  if (!entries || entries.length <= 1) {
    summaryDiv.innerHTML = "<p>No matching records found.</p>";
    return;
  }

  let completed = 0, pending = 0, canceled = 0, running = 0;
  entries.slice(1).forEach(row => {
    const status = (row[7] || "").toLowerCase();
    if (status === "completed") completed++;
    else if (status === "pending") pending++;
    else if (status === "canceled") canceled++;
    else if (status === "running") running++;
  });

  summaryDiv.innerHTML = `
    ‚úÖ Completed: <span class="complete">${completed}</span> |
    ‚è≥ Pending: <span class="pending">${pending}</span> |
    ‚ùå Canceled: <span class="canceled">${canceled}</span> |
    üîÑ Running: <span class="running">${running}</span>
  `;
}

function setupSearch(data) {
  const searchInput = document.getElementById("search123Input");
  searchInput.addEventListener("input", () => {
    const text = searchInput.value.toLowerCase();
    const filtered = data.filter((row, i) => {
      if (i === 0) return true;
      return row.some(cell => (cell || "").toLowerCase().includes(text));
    });
    renderPOSUMMRYTable(filtered);
  });
}

function openModal(htmlContent) {
  document.getElementById("modalContent").innerHTML = htmlContent;
  document.getElementById("dataModal").style.display = "block";
  document.getElementById("overlay").style.display = "block";
}
function closeModal() {
  document.getElementById("dataModal").style.display = "none";
  document.getElementById("overlay").style.display = "none";
}


// ***************  INVOICE PDF OPEN BY CLICK TO INVOICE NO ****************

function attachInvoiceClickREFF(tableId, invoiceColIndex = 3) {
  const table = document.getElementById(tableId);
  if (!table) return;

  for (let i = 1; i < table.rows.length; i++) {
    const row = table.rows[i];
    const cell = row.cells[invoiceColIndex];
    if (!cell) continue;

    const invoiceNo = cell.textContent.trim();
    if (!invoiceNo) continue;

    const invoiceKey = invoiceNo.replace("/", "_");

    fetch(api103Url + "?invoice=" + encodeURIComponent(invoiceKey))
      .then(res => res.text())
      .then(url => {
        if (url && url !== "NOT_FOUND") {
          cell.style.color = "blue";
          cell.style.cursor = "pointer";
          cell.style.textDecoration = "underline";
          cell.onclick = () => window.open(url, "_blank");
        }
      });
  }
}


// ***************  TABLE PO NO BY INVOICE TABLE MODEL 1 ****************
async function fetchReffNo(jobNo, ledgerName = "---", ledgerAddress = "---") {
  const range124 = "LEDGER!B:K";
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet123Id}/values/${range124}?key=${api123Key}`;
  const res = await fetch(url);
  const data = await res.json();
  const rows = data.values || [];
  const headers = rows[0];
  const matched = rows.slice(1).filter(r => r[4] === jobNo);

  if (matched.length === 0) {
    openModal("<p>No Match Found</p>");
    return;
  }

  let totalG = 0, totalH = 0;
  matched.forEach(row => {
    totalG += parseFloat(row[5]) || 0;
    totalH += parseFloat(row[6]) || 0;
  });

  let html = `
   <p><strong>Ledger Name:</strong> ${ledgerName}<br>
   <strong>Address:</strong> ${ledgerAddress}<br>
   <span style="color: green; font-weight: bold;">Total Billing:</span> Rs. ${totalG.toFixed()} /
   <span style="color: blue; font-weight: bold;">Total Weight:</span> ${totalH.toFixed()} Kg.</p>
   <table id="modalLedgerTable" border="1"><tr>`;
  headers.forEach(h => html += `<th>${h}</th>`);
  html += `</tr>`;

  matched.forEach(row => {
    const isCredit = (row[0] || "").toLowerCase().includes("credit note");
    const rowStyle = isCredit ? ` style="color: red;"` : "";
    html += `<tr${rowStyle}>`;
    headers.forEach((_, i) => {
      const cell = row[i] || "";
      if (typeof cell === "string" && (cell.startsWith("http") || cell.startsWith("www"))) {
        const href = cell.startsWith("http") ? cell : "https://" + cell;
        html += `<td><a href="${href}" target="_blank">&#128221;</a></td>`;
      } else {
        html += `<td>${cell}</td>`;
      }
    });
    html += `</tr>`;
  });

  html += `</table>`;
  openModal(html);
  attachInvoiceClickREFF("modalLedgerTable", 3);
}


// ***************  LEDGER SERCH BY LEDGER MODAL 2 ****************
async function fetchLedgerByLedgerName(ledgerName = "---", ledgerAddress = "---") {
  const range124 = "LEDGER!B:K"; // Expanded to column L for full data
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet123Id}/values/${range124}?key=${api123Key}`;
  const res = await fetch(url);
  const data = await res.json();
  const rows = data.values || [];
  const headers = rows[0];
  const matched = rows.slice(1).filter(r => r[2] === ledgerName);

  if (matched.length === 0) {
    openModal("<p>No Match Found</p>");
    return;
  }

  let totalG = 0, totalH = 0, totalD = 0;
  matched.forEach(row => {
    totalG += parseFloat(row[5]) || 0;
    totalH += parseFloat(row[6]) || 0;
    const type = (row[0] || "").toUpperCase();
    if (type.includes("BANK") || type.includes("TDS")) {
      totalD += parseFloat(row[3]) || 0;
    }
  });

  let html = `
   <p>
    <strong>Ledger Name:</strong> ${ledgerName}<br>
    <strong>Address:</strong> ${ledgerAddress}<br>
    <span style="color: green; font-weight: bold;">Total Billing:</span> Rs. ${totalG.toFixed()} /
    <span style="color: blue; font-weight: bold;">Total Weight:</span> ${totalH.toFixed()} Kg. /
    <span style="color: red; font-weight: bold;">Receipt (BANK/TDS):</span> Rs. ${totalD.toFixed()}
   </p>
   <table id="modalLedgerTable" border="1"><tr>`;  // Added ID to table
  headers.forEach(h => html += `<th>${h}</th>`);
  html += `</tr>`;

  matched.forEach(row => {
    const type = (row[0] || "").toLowerCase();
    const color = type.includes("bank") ? "red" : type.includes("credit") ? "blue" : "";
    html += `<tr style="color: ${color};">`;
    headers.forEach((_, i) => {
      const cell = row[i] || "";
      if (typeof cell === "string" && (cell.startsWith("http") || cell.startsWith("www"))) {
        const href = cell.startsWith("http") ? cell : "https://" + cell;
        html += `<td><a href="${href}" target="_blank">&#128221;</a></td>`;
      } else {
        html += `<td>${cell}</td>`;
      }
    });
    html += `</tr>`;
  });

  html += `</table>`;
  openModal(html);

  // ‚úÖ Attach click listener to invoice column (index 3) after rendering modal table
  attachInvoiceClickREFF("modalLedgerTable", 3);
}


// ****************PRINT FUNCTION BOTH TABLE ************


function printModal() {
  const content = document.getElementById("modalContent").innerHTML;

  const printWindow = window.open('', '', 'height=800,width=1000');
  printWindow.document.write(`
    <html>
      <head>
        <title>Print</title>

        <body>

           <span style="color:rgb(246, 156, 156);font-size:130%;font-family:Magneto;">eS |</span> 
  <span style="color:#a0d0f0;font-size:130%;font-family:Magneto;">MTally</span>
            <h4>Multitech Infracon Pvt. Ltd.</h4>
        <style>
          body {
            font-family: Arial, sans-serif;
            margin: 20px;
          }

          table {
  width: 100%;
  margin-top: 20px;
  border-collapse: collapse;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 14px;
}

th, td {
  border: 1px solid #e0e0e0;
  padding: 10px 14px;
  text-align: left;
}

th {
  background-color: #004d80;
  color: white;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

tr:nth-child(even) {
  background-color: #f9f9f9;
}


        </style>
      </head>
      <body>
        ${content}
      </body>
    </html>
  `);

  printWindow.document.close();
  printWindow.focus();
  printWindow.print();
}


fetch123Data();


</script>



</body>
</html>


 <!-- -------------------------------------------PO/REF NO SERCH SCRIPT AND CODE STOP ........................................................... -->


















 


<!-- ---------------------------------------------------- VOUCHER FORM POUP STOP --------------------------------------------------------------------------------- -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voucher Popup (Non-interactive 35% Overlay)</title>

<style>
/* ==== POPUP BACKGROUND (Overlay) ==== */
#popupVOUCHEROverlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.35); /* ‚úÖ 35% transparent black overlay */
  z-index: 999;
  pointer-events: auto; /* ‚úÖ block all clicks behind popup */
}

/* ==== POPUP BOX ==== */
.voucher-popup {
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  background: #fff;
  border-radius: 12px;
  width: 70%;
  max-width: 900px;
  padding: 20px 30px;
  box-shadow: 0 0 25px rgba(0,0,0,0.4);
  animation: fadeIn 0.3s ease-in-out;
  font-family: Arial, sans-serif;
  z-index: 1000;
}
@keyframes fadeIn {
  from { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
  to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}

/* ==== CLOSE BUTTON ==== */
.voucher-popup .closeBtn {
  position: absolute;
  top: 10px; right: 15px;
  background: #ff3c3c;
  color: white;
  border: none;
  border-radius: 50%;
  width: 30px; height: 30px;
  font-weight: bold;
  cursor: pointer;
}

/* ==== POPUP FORM ELEMENTS ==== */
.voucher-popup label {
  font-weight: bold;
  display: block;
  margin-top: 8px;
}
.voucher-popup input,
.voucher-popup select {
  margin-top: 5px;
  padding: 6px;
  border: 1px solid #ccc;
  border-radius: 4px;
  width: 100%;
}
.voucher-popup input[type="submit"],
.voucher-popup .fetchbtn {
  background: #04a777;
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  margin-top: 10px;
  cursor: pointer;
}
.voucher-popup input[type="submit"]:hover,
.voucher-popup .fetchbtn:hover {
  background: #03885f;
}
.voucher-popup h2 {
  text-align: center;
  color: #003366;
}

/* ==== FORM SECTIONS ==== */
.form-section { display: none; }
.form-section.active { display: block; }

/* ==== DISABLE BACKGROUND INTERACTION ==== */
body.popup-active {
  overflow: hidden;          /* ‚úÖ Disable scrolling */
  user-select: none;         /* ‚úÖ Disable text selection */
  pointer-events: none;      /* ‚úÖ Disable clicks */
}
body.popup-active #popupVOUCHEROverlay,
body.popup-active .voucher-popup {
  pointer-events: auto;      /* ‚úÖ Allow interaction only with popup */
}
</style>
</head>
<body>




<!-- ==== POPUP OVERLAY ==== -->
<div id="popupVOUCHEROverlay"></div>

<!-- ==== POPUP BOX ==== -->
<div id="popupVOUCHERBox" class="voucher-popup" style="display:none;">
  <button class="closeBtn" onclick="closeVOUCHERPopup()">√ó</button>
  <h2 id="popupTitle">Voucher Form</h2>

  <!-- ==== SALE FORM ==== -->
  <div id="saleForm" class="form-section">
    <form id="mainVCRForm">
      <input type="hidden" name="SNo" id="sNo">
      <select id="msaf21" name="Voucher" style="color:#6803a2;font-size:100%;" required>
        <option value="SALE">SALE</option>
      </select>

      <label>Date</label>
      <input type="date" id="msaf11" name="Date" required>

      <label>Tr. Type</label>
      <select id="msaf12" name="Type" style="color:#6803a2;font-size:100%;" required>
        <option value="TAX INVOICE">Tax Invoice</option>
        <option value="CREDIT NOTE">Credit Note</option>
        <option value="CANCEL">Cancel Invoice</option>
        <option value="CHALLAN">CHALLAN</option>
      </select>

      <label for="msaf13">Select VCR Ledger:</label>
      <select class="ledger-dropdown" id="msaf13" required name="Ledger"></select>

      <label for="msaf15">Job/Reff:</label>
      <select class="Reff-dropdown" id="msaf15" required name="Reff"></select>

      <input type="text" id="msaf14" name="VNo" placeholder="Enter Invoice No. (25-26/xxxx)" required>
      <input type="text" id="msaf16" name="Amount" placeholder="Enter Amount" required>
      <input type="text" id="msaf17" name="Weight" placeholder="Enter Weight" required>
      <input type="text" id="msaf18" name="Rate" placeholder="Enter Rate" required>
      <input type="text" id="msaf19" name="Narration" placeholder="Narration if any">

      <input type="hidden" name="Timestamp" id="timestampVCR">
      <input type="submit" id="submitVCRButton" value="Submit">

      <h3 style="background-color:#d1f4f7;color:#022d46;font-size:120%;text-align:center;font-weight:bold;">Entry Modify</h3>

      <form id="modifyVCRForm">
        <input type="hidden" id="formModeVCR" name="formModeVCR" value="new">
        <input type="number" id="searchVCRSNo" placeholder="Enter S.No. to Modify Entry">
        <button type="button" class="fetchbtn" onclick="fetchVCRDetails()">Fetch Details</button>
        <button type="button" class="fetchbtn" id="modifyVCRButton" onclick="modifyVCREntry()" style="display:none;">Modify Entry</button>
        <div id="waitVCRMessage" style="display:none;color:red;font-size:16px;font-weight:bold;"></div>
      </form>
    </form>
  </div>

  <!-- ==== VBTN2 FORM START ==== -->
  <div id="vbtn2" class="form-section">
    <h3><span id="username">Guest</span></h3>
   
  
    
<form id="mainIVCRForm">
  <input type="hidden" name="SNo" id="sNo" />



<div style="display: flex; align-items: center; gap: 25px; flex-wrap: wrap; margin-bottom: 12px;">

  <!-- USER ID -->
  <div style="display: flex; align-items: center; gap: 8px;">
    <label style="color: rgb(1, 23, 64); font-weight: bold;">User ID:</label>
    <select id="voucherType" class="userDropdown" name="Voucher" required 
      style="width: 3in; font-size: 16px; text-align: center; 
             background-color: #014060; color: white; border: none; border-radius: 6px; padding: 6px;">
    </select>
  </div>

  <!-- TRANSACTION TYPE -->
  <div style="display: flex; align-items: center; gap: 8px;">
    <label style="color: rgb(1, 23, 64); font-weight: bold;">Select Tr. Type:</label>
    <select id="ivcr0" name="Type" required 
      style="width: 3in; font-size: 16px; text-align: center; 
             background-color: #f2f4f6; color: #0e0e0e; border: 1px solid #ccc; border-radius: 6px; padding: 6px;">
      <option value="PAYMENT" style="color: green;">Payment</option>
      <option value="RECEIPT" style="color: red;">Receipt</option>
    </select>
  </div>

</div>



<!-- User ID: AUTO PAPULATE BY <span id="userid"> script code start -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const spanUser = document.getElementById("userid");
    const selectVoucher = document.getElementById("voucherType");

    if (spanUser && selectVoucher) {
      const userValue = spanUser.textContent.trim();

      if (userValue) {
        // Agar option exist karta hai, to usko select karo
        const optionToSelect = Array.from(selectVoucher.options)
          .find(opt => opt.value.toLowerCase() === userValue.toLowerCase());
        
        if (optionToSelect) {
          selectVoucher.value = optionToSelect.value;
        } else {
          // Agar option nahi mila to new option add karo
          const newOption = new Option(userValue, userValue, true, true);
          selectVoucher.add(newOption);
        }
      }
    }

    // Agar baad me span ki value change ho to select bhi update ho jaye
    const observer = new MutationObserver(() => {
      const updatedValue = spanUser.textContent.trim();
      if (updatedValue) {
        const existingOption = Array.from(selectVoucher.options)
          .find(opt => opt.value.toLowerCase() === updatedValue.toLowerCase());

        if (existingOption) {
          selectVoucher.value = existingOption.value;
        } else {
          const newOption = new Option(updatedValue, updatedValue, true, true);
          selectVoucher.add(newOption);
        }
      }
    });

    observer.observe(spanUser, { childList: true });
  });
</script>
<!-- User ID: AUTO PAPULATE BY <span id="userid"> script code start -->



           <label >Date</label>
         <input type="date" id="ivcr1" name="Date" required>


          <!-- (VCN- 111) dropdown div start -->
         <div class="dropdown-container" >
            <label >Serch IV Ledger</label>
            <input type="text" id="dropdownIVCRSearch" placeholder=" Search..." oninput="filterIVCRDropdown()" name="Ledger" required>
            <ul id="dropdownIVCRList" class="dropdownCSSlist" >
                <!-- The dropdown options will be populated here -->
            </ul>
        </div>
 <!-- (VCN- 111) dropdown div stop -->
        

         <label >Amount</label>
         <input type="number" id="ivcr2" name="Amount" required placeholder="Amount">
          <label >Narration</label>
         <input type="text" id="ivcr3" name="Narration" placeholder="Narration"style="text-transform: uppercase;">

         <input type="hidden" name="Timestamp" id="timestampIVCR">
         <input type="submit" id="submitIVCRButton" value="Submit">
       </form>
   
     <!-- Form for Fetching and Modifying Entries -->
    <form id="modifyIVCRForm">
      <input type="hidden" id="formModeIVCR" name="formModeIVCR" value="new">
        <input type="number" id="searchIVCRSNo" placeholder="Enter S.No. to Modify Entry" >
        <button type="button" class="fetchbtn" onclick="fetchIVCRDetails()"  style="background-color: black; color: white; font-size: 12px; ">Fetch Details</button>
        <button type="button" class="fetchbtn" id="modifyIVCRButton" onclick="modifyIVCREntry()" style="display:none;">Modify Entry</button>



        <!-- Wait message div -->
<div id="waitIVCRMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
       </form>




  </div>      <!-- ==== VBTN2 FORM STOP ==== -->

  <!-- ==== BANK FORM ==== -->
  <div id="bankForm" class="form-section">
    <h3>Bank Form</h3>
    <p>Yahan aapka bank form ka content aayega...</p>
  </div>
</div>

<script>
/* ==== BUTTON CLICK TO OPEN SPECIFIC FORM ==== */
document.querySelectorAll('button[data-target]').forEach(btn => {
  btn.addEventListener('click', e => {
    const sectionId = e.target.getAttribute('data-target');
    openPopup(sectionId, e.target.innerText);
  });
});

/* ==== POPUP OPEN FUNCTION ==== */
function openPopup(sectionId, title) {
  document.body.classList.add("popup-active"); // ‚úÖ Lock background
  document.getElementById('popupVOUCHEROverlay').style.display = 'block';
  document.getElementById('popupVOUCHERBox').style.display = 'block';
  document.getElementById('popupTitle').innerText = title;

  document.querySelectorAll('.form-section').forEach(div => div.classList.remove('active'));
  document.getElementById(sectionId)?.classList.add('active');
}

/* ==== POPUP CLOSE FUNCTION ==== */
function closeVOUCHERPopup() {
  document.body.classList.remove("popup-active"); // ‚úÖ Unlock background
  document.getElementById('popupVOUCHEROverlay').style.display = 'none';
  document.getElementById('popupVOUCHERBox').style.display = 'none';
}
</script>

</body>
</html>
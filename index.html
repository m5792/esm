<!-- ==============================================dashboard start================================================================================ -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MIPL e|SmTally</title>
 <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
      
     
    }

    /* Login section with full screen and positioned at top */
    #login-section {
      display: flex;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 10;
      background-color: #fff;
    }

    .left-panel {
      flex: 1;
      background-color: #026186;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 40px;

      overflow: hidden;
  z-index: 1;
  position: relative; /* if only image show in right panal "position: relative;" */
    }

    .left-panel h1 {
      font-size: 32px;
      margin-bottom: 20px;
    }

    .right-panel {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #ffffff;


  background-image: url('https://i.pinimg.com/originals/0e/e2/4d/0ee24d4171affdf14f051d8a81b325e4.jpg'); /* Replace with your image URL "https://i.gifer.com/OFAF.gif" */
  background-size: cover;
  background-position: center;
       
    }

    .left-panel::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: url('https://cdn.pixabay.com/video/2022/11/01/137374-766338347_tiny.jpg'); /* Replace with your image URL "https://i.gifer.com/OFAF.gif" */
  background-size: cover;
  background-position: center;
  opacity: 0.4; /* Change opacity here */
  z-index: -1; /* Keep it behind the login box */
}


    .login-box {
      width: 300px;
    }

    .login-box h2 {
      margin-bottom: 20px;
      text-align: center;
    }

    .login-box input {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

   
    .login-box button {
      width: 100%;
      padding: 10px;
      background-color: #026186;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      border-radius: 4px;
    }

    .login-box button:hover {
      background-color: #026186;
    }

    #login-msg {
      color: red;
      margin-top: 10px;
      text-align: center;
    }

    /* Dashboard styles */
    #dashboard {
      top: 20px;
      display: none;
      padding: 10px;
      min-height: 90vh;
      background-color: rgb(255, 255, 255);
    }

   
    .section {
      border: 1px solid #ccc;
      padding: 2px;
      background-color: #f8f9fa;
      border-radius: 1px;
    }

#sections {
  position: fixed;
  top: 50px; /* 1 inch from top */
  left: 0;
  right: 0;
  bottom: 0; /* allows full height scrolling inside */
  overflow-y: auto; /* only inner content scrolls */
  padding: 1px;
  background-color: #e9f7fc;
}
  .message {
    display: none;
  }

    .hidden {
      display: none;
    }



   header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: #f9fafa;
      color: white;
      padding: 5px 10px;
      text-align: center;
      z-index: 1000;
    }

    #top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 2px;
  background-color: #060606;
  color: white;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 999;
   border: 4px solid #7e7d7d;
   border-radius: 8px;
}

.button-div {
  display: flex;
  flex-wrap: nowrap;              /* ‚ùå wrapping band */
  overflow-x: auto;               /* ‚úÖ horizontal scroll */
  white-space: nowrap;            /* ‚úÖ content ek line me */
  gap: 1px;
}

.button-div button {
  flex: 0 0 auto;                 /* ‚úÖ fixed width, no shrink/wrap */
  min-width: 200px;
  padding: 10px 10px;
  background-color: #060606;
  color: white;
  border: none;
  border-radius: 0px;
  cursor: pointer;
  font-size: 18px;
}


.button-div button:hover {
  background-color: #cfcfcf;
  color: rgb(0, 9, 16);
}


#logout-btn {
  background-color: #f44336;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
}

#logout-btn:hover {
  background-color: #e53935;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 16px;
  background-color: rgb(8, 8, 8);
  color: white;
  border: 1px solid rgb(1, 45, 75);       /* "border: yes;" ko correct kiya */
  border-radius: 4px;
  padding-left: 5px;              /* Left se 5px space */
  padding-right: 5px;             /* Right se 5px space */
}

#username {
  font-size: 20px;
  font-weight: bold;
  color: rgb(243, 243, 242);
  text-align: center;
}


  .multidivbar {
            margin-bottom: 10px;
            padding: 5px 2px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }


/* Table Styling */
/* Container to control table width and responsiveness */
.table-container {
  width: 100%;
  overflow-x: auto;
}

 
 /* Table container ************/
table{
    width: 100%;
  border-collapse: collapse;
  table-layout: auto;
  font-family: Arial, sans-serif;
  font-size: 14px;
  background: #ffffff;
  border: 1px solid #d0d0d0;

  }

/* Optional heder alwayas fix on top and table scrolling  */
  table{
  overflow-x: auto;
  display: block;
  max-height: 670px; /* Optional scrolling */
  }

  /* Table border & cell style */
th {
   background: #01305c;
  color: #ffffff;
  padding: 10px;
  border: 1px solid #b5b5b5;
  text-align: left;
  font-weight: 600;
  position: sticky;
  top: 0;
  z-index: 1;
  white-space: nowrap;
  border-bottom:5px solid #dfc206;
  }


 td {
   padding: 8px 10px;
  border: 1px solid #e0e0e0;
  vertical-align: top;
  word-wrap: break-word; /* Wrap long text */
  white-space: normal;
  }

  /* Header design */


  tr:nth-child(even) {
  background-color: #f9f9f9;
}

  /* Row hover effect */
  tr:hover td {
   background: #fccc49;
 color: rgb(0, 15, 15);
  transition: background-color 1s ease, color 1s ease;
  }
    

 

/* Form Styling Scoped to .form-container */
.form-container input,
.form-container select {
    width: 100%;
    padding: 6px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 16px;
    box-sizing: border-box;
}

.form-container input[type="text"],
.form-container input[type="number"],
.form-container input[type="date"],
.form-container select {
    background-color: #f9f9f9;
}

.form-container input[type="submit"],
.form-container button {
    background-color: #080808;
    color: #f6f6f8;
    font-weight: bold;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.form-container input[type="submit"]:hover,
.form-container button:hover {
    background-color: #575555;
    transform: translateY(-2px);
}


.fetchbtn {
  background-color: #b9e0f9;
  color: rgb(44, 3, 0);
  border: none;
  font-size: 16px;
  font-weight: bold;
  font-family: 'Eras Bold ITC', sans-serif;
  width: 1.5in;
  padding: 5px;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.fetchbtn:hover {
  background-color: #a5d4f0;
}

  </style>
</head>
<body>

  <!-- Login Section -->
  <div id="login-section">
    <div class="left-panel">
     
<br/><br/><br/><br/><br/>
<h1 style="color:#2F4F4F;text-align:center;font-size:150%">
<span style="color:#f8f9fa;font-size: 150%;">Multitech Infracon Pvt. Ltd.</span>
</h1>

 <h1 style="color:rgb(251, 249, 249); text-align: center; font-size: 100%;">Nh 74 12th Km Stone <br/> Vill Dabhora Mustakam Bazpur Road Kashipur <br/>U.S Nagar Uttarakhand 244713</h1>
<h1 style="color:#2F4F4F;text-align:center;font-size:100%">
<span style="color:#def8f8;font-size: 100%;">#9719012011,9639012011</span>
<span style="color:#f8e1e1;font-size: 100%;">(mail:-multitechsolutions@yahoo.com)</span>
</h1>



<br/>
<h3>
        <span style="color:rgb(250, 218, 218);font-size:130%;font-family:Magneto;">eS | <span style="color:#e0f5f5;font-size:130%;font-family:Magneto;">MTally</span></span> 
       </h3> 

    </div>
    <div class="right-panel">
    
      <div class="login-box">
        <h2>Login</h2>
        <input type="text" id="user-id" placeholder="User ID" />
        <input type="password" id="password" placeholder="Password" />
        <button onclick="login()">Login</button>
        <div id="login-msg"></div>
      </div>
    </div>
  </div>

  <!-- Dashboard div start !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
  <div id="dashboard">  <!-- Dashboard div open -->
    <header>
    <div id="top-bar">
  <div class="button-div">
    <button onclick="showSection(1)" id="f1" style="color: rgb(1, 250, 105); font-weight: bold;">HOME &nbsp;<span style="color:  red;font-weight: bold;">(F1)</span> </button>
    <button onclick="showSection(2)">Cash Ledger Report</button>
    <button onclick="showSection(3)" id="f3">Display Reports &nbsp;<span style="color: red; font-weight: bold;">(F3)</button>
    <button onclick="showSection(4)">Imprest Voucher Report</button>
    <button onclick="window.open('https://m5792.github.io/esm/DAYBOOK.html','_blank')" id="f4">Job/Reff Summry &nbsp;<span style="color: red; font-weight: bold;">(F4)</span></button>


  <button onclick="showSection(15)">Tools</button>
    
     <!-- <button onclick="showSection(6)">Job/Reff</button> -->
  
    <button onclick="showSection(7)" id="f6" style="color: rgb(2, 79, 245);" >Admin* &nbsp;<span style="color:  red;font-weight: bold;">(F6)</span></button>
 
      
  
  </div>
  <div class="user-info">
    <span id="username"></span>
    <button id="logout-btn" onclick="logout()">Logout</button>
  </div>
</div>

  </header>



  

   <!-- ======================== login section user name password, button authorized script start hare =============== -->
  <script>
  const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
  const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
  const range = 'USER!A:G';

  let users = {};
  let currentUser = "";

  // --- New helper functions to set/clear username in any element with id="username" ---
  function setUsernameDisplays(name) {
    // Select all elements that (incorrectly) share the id "username"
    const elems = document.querySelectorAll('#username');
    elems.forEach(el => {
      const tag = el.tagName?.toLowerCase();
      // input / textarea / select -> set .value
      if (tag === 'input' || tag === 'textarea' || tag === 'select') {
        el.value = name || "";
      } else if (el.isContentEditable) {
        el.textContent = name || "";
      } else {
        // other elements (span, div, etc.)
        el.innerText = name || "";
      }
    });
  }

  function clearUsernameDisplays() {
    const elems = document.querySelectorAll('#username');
    elems.forEach(el => {
      const tag = el.tagName?.toLowerCase();
      if (tag === 'input' || tag === 'textarea' || tag === 'select') {
        el.value = "";
      } else if (el.isContentEditable) {
        el.textContent = "";
      } else {
        el.innerText = "";
      }
    });
  }
  // -------------------------------------------------------------------------------

  async function fetchUserData() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;

    try {
      const response = await fetch(url);
      const data = await response.json();

      const rows = data.values;
      users = {};

      for (let i = 1; i < rows.length; i++) {
        const [enabled, userId, password, status, displayName, perms, report] = rows[i];

        if (enabled === "1") {
          users[userId] = {
            password: password,
            displayName: displayName,
            status: status?.toLowerCase() || "unlocked",
            permissions: perms?.split(',').map(p => parseInt(p.trim())),
            reportAuth: report || "" // ‚úÖ Column G
          };
        }
      }
    } catch (error) {
      console.error("Error fetching user data:", error);
      document.getElementById('login-msg').innerText = "Failed to load user data.";
    }
  }

  async function login() {
    const userId = document.getElementById('user-id').value.trim();
    const password = document.getElementById('password').value;

    if (!users[userId]) {
      document.getElementById('login-msg').innerText = "Invalid User ID or Password!";
      return;
    }

    const user = users[userId];

    // ===== ACCOUNT STATUS VALIDATION =====
    const status = user.status;
    if (status === "locked") {
      document.getElementById('login-msg').innerText = "Your account is locked!";
      return;
    }

    const expiryDate = Date.parse(status);
    if (!isNaN(expiryDate)) {
      const today = new Date();
      const expiry = new Date(expiryDate);
      const diffTime = expiry - today;
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

      if (diffDays < 0) {
        document.getElementById('login-msg').innerText = "Your Licence Expired, Please Contact Admin";
        return;
      } else if (diffDays <= 5) {
        const msg = `Your licence will expire in ${diffDays} day${diffDays === 1 ? '' : 's'}`;
        alert(msg);
        document.getElementById('login-msg').innerText = msg;
      }
    }
    // =======================================

    if (user.password === password) {
      currentUser = userId;

      document.getElementById('login-section').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
      // --- replace single-line assignment with helper that updates all places ---
      setUsernameDisplays(user.displayName);
       checkPopupCondition(user.displayName);  // attendance confermation username apdate
      document.getElementById('login-msg').innerText = "";
      document.getElementById('user-id').value = "";
      document.getElementById('password').value = "";
      document.querySelector('.button-div').style.display = 'flex';

      // ‚úÖ SHOW COLUMN G VALUE IN SPAN
      document.getElementById('reportauth').innerText = user.reportAuth;

      window.scrollTo(0, 0);

      showSection(1);
      fetchGlobalMessage();
      speakOnce();
    } else {
      document.getElementById('login-msg').innerText = "Invalid User ID or Password!";
    }
  }

  function showSection(buttonNum) {
    document.querySelectorAll('.section').forEach(div => div.classList.add('hidden'));
    
    const permissions = users[currentUser]?.permissions || [];
    if (permissions.includes(buttonNum)) {
      document.getElementById(`section${buttonNum}`).classList.remove('hidden');
      document.getElementById(`section${buttonNum}b`).classList.remove('hidden');
    } else {
      alert("You are not authorized for this Tab.\n\nMore Details Contact Admin:\nMukhtar Ahamad\n+91-9756735792");

      document.getElementById(`section1`).classList.remove('hidden');
      document.getElementById(`section1b`).classList.remove('hidden');
    }
  }

  async function fetchGlobalMessage() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/USER!H2?key=${apiKey}`;

    try {
      const response = await fetch(url);
      const data = await response.json();

      const message = data?.values?.[0]?.[0] || "";
      const globalMessageDiv = document.getElementById('globalMessage');

      if (message.trim() !== "") {
        globalMessageDiv.innerText = message;
        globalMessageDiv.style.display = "block";
      } else {
        globalMessageDiv.style.display = "none";
      }
    } catch (error) {
      console.error("Error fetching global message:", error);
    }
  }

  function logout() {
    currentUser = "";
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('login-section').style.display = 'flex';
    document.querySelectorAll('.section').forEach(div => div.classList.add('hidden'));
    document.getElementById('message').innerText = "";
    // clear all username displays
    clearUsernameDisplays();
    document.querySelector('.button-div').style.display = 'none';
    document.getElementById('reportauth').innerText = "";

    window.scrollTo(0, 0);
    location.reload();
  }

  window.onload = fetchUserData;
</script>


<!-- Welcome Massage start-->
 <script>
    //   let hasSpoken = false;
    //   function speakOnce() {
     //  if (hasSpoken) return;
   //    hasSpoken = true;
     // const msg = new SpeechSynthesisUtterance("Welcome");
   //   window.speechSynthesis.speak(msg);
  //   }
  </script>
   <!-- Welcome Massage Stop-->
</body>
</html>
 <!-- login section user name password, button authorized script start hare  -->


<!-- ============================================== sections start =============================================================== -->

  <div id="sections">  <!-- sections Div open-->

 <div id="section1" class="section hidden"> <!--  sections1 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
   
      
<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) container content start  Heare ((CODE501)) -->
    <div class="container">  <div class="left" style="background-color: #f5f5f5; border: none;">   <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content start -->

<style>
  .voucher-button-panel {
    background-color: #cfcfcf;
    border: 2px solid #b0d4ec;
    border-radius: 10px;
    padding: 20px;
    width: 300px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    font-family: 'Eras Bold ITC', sans-serif;
    margin: 20px auto;
  }

  .voucher-button-panel button {
    background-color: #00090f;
    color: rgb(248, 249, 250);
    border: none;
    font-size: 18px;
    font-weight: bold;
    margin: 10px 0;  
    width: 100%;
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .voucher-button-panel button:hover {
    background-color: #113954;
  }
</style>




<div class="voucher-button-panel">


  <button onclick="showSection(8)" id="f2">Cash Voucher &nbsp;<span style="color:  red;font-weight: bold;">(F2)</span></button><br/>
  <button onclick="showSection(9)">Store Register Voucher</button><br/>
  <button onclick="showSection(10)">Sales Voucher</button><br/>
  <button onclick="showSection(11)">Banking Voucher</button><br/>
  <button onclick="showSection(12)">Imprest Voucher</button><br/>
  <button onclick="showSection(13)">Job/Ref Voucher </button><br/>
   <button onclick="showSection(14)">Chander Shekher Voucher</button><br/>

 
</div>

<br/><br/>
<div style="height:230px; overflow-y:auto; overflow-x:auto; border:1px solid #ccc; padding:8px; background-color: #f4faf3;" >

<div id="section1b" class="section hidden" style="background-color: rgb(211, 212, 212);border: none;"></div>    
<!-- ========================= -->
<span  style="color: rgb(1, 26, 116); font-size: 16px; font-weight: bold;">Notice Board:</span><br/>
      <span id="globalMessage" style="color: rgb(16, 15, 15); font-size: 16px;"></span>

     

   

      <div id="greetingMessage" 
     style="display:none; font-size:18px; 
     font-weight:bold; color:green; padding:10px;">
</div>



<br><br>

<span id="statusText" style="font-weight:bold;"></span><br>
<span style="color: blue;">Your Network ID:- </span>
<span id="ipBox" style="color: rgb(78, 78, 243);"></span>

<script>
// Allowed Office Network Starting Values
const officeList = ["152.59", "152.58", "49.36", "106.205", "103.93", "117.99"];

// Fetch IP
fetch("https://api.ipify.org?format=json")
  .then(response => response.json())
  .then(data => {
    const ip = data.ip;
    document.getElementById("ipBox").innerText = ip;

    // First two segments of IP -> (e.g. 203.81)
    const ipStart = ip.split(".")[0] + "." + ip.split(".")[1];

    // Check match
    const statusSpan = document.getElementById("statusText");

    if (officeList.includes(ipStart)) {
      statusSpan.innerHTML = `<span style="color:red;">Office Network Not Connected</span>`;
    } else {
      statusSpan.innerHTML = `<span style="color:green;">Office Network Connected</span>`;
    }
  })
  .catch(() => {
    document.getElementById("ipBox").innerText = "Error fetching IP";
  });
</script>



    </div> 
   
      

        </div> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content stop -->
<div class="right" style="background-color: white;"> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) right content start -->



<div style="height:480px; overflow-y:auto; overflow-x:auto; border:5px solid #002b46;border-radius: 10px; padding:8px; background-color: #dff8fc;" >

   <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">    
    <label style="color: rgb(1, 26, 71); font-weight: bold;"> Daybook Search :</label>                            <!-- Search Box -->
<input type="text" id="DATASEARCMIPL" placeholder="üîç Search Ledger, Invoice, Reff, Vehicle No...." style="padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; margin-bottom:10px; width:200px; width: 4in; background-color: rgb(241, 212, 212);" />


    <select id="monthDropdown" style="padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; margin-bottom:10px; width:200px; width: 1.5in; background-color: rgb(1, 42, 61); color: white;"></select>
<sapn id="monthlyTotals"></sapn>



</td>

  <style> #MIPLDATATABLE {overflow-x: auto; display: block; max-height: 430px; /*heder alwayas fix on top and table scrolling  */} </style>
<table id="MIPLDATATABLE"></table>
</div>

<BR/>
 <div class="container2">  
  <div class="leftdiv"  style="max-height: 350px;width: 800px; overflow-y: auto; border: 3px solid #013342; padding: 5px; border-radius: 6px;background-color: #f3f9f8;" >

  <span style="color: #8b0202; font-weight: bold;font-size: 16px;">Loading Status</span>
<table id="noticeBoard">  <thead ><tr> <th>Type</th><th>Date</th> <th>Name</th><th>Vehicle No.</th><th>Job No.</th> <th>Status</th> <th>Inv. No.</th></tr></thead><tbody></tbody></table>

</div>

<div class="rightdiv" style="max-height: 350px;width: 800px; overflow-y: auto; border: 3px solid #013342; padding: 5px; border-radius: 6px;background-color: #f3f9f8;"  >

 <span style="color: #901803; font-weight: bold;font-size: 16px;">Important Points</span>
<ul id="pointsList"></ul>


 
</div></div>





<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) right content stop -->
</div> </div>  <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->

</div>  <!--  sections1 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->


<!-- section2B content start hare *********************************************************************************************************-->
      <div id="section2b" class="section hidden" >

<div style="text-align:center; background-color: #dcdddd; color: #002630; font-weight: bold;"> <strong>Cash Ledger Report</strong></div> <br/>


  <!-- Ledger Filter -->
  <div id="ledger5792Select" >
    <span style="color: black;">Ledger Name:</span>
    <input type="text" id="ledger5792Input"
      style="padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; margin-bottom:10px; width: 4in; background-color: rgb(236, 241, 212); font-size: 14px;"
      placeholder="üîç Type to search ledger...">
    <div id="ledger5792Dropdown" class="dp5792"></div>

    <button onclick="print5792Table()" style="background-color: white;  color: #00254d;border: none; cursor: pointer;">üñ®Ô∏è Print Table</button>
<button onclick="refresh5792Table()"  style="background-color: white;  color: #00254d; border: none; cursor: pointer;">üîÑ Refresh Table</button>
  </div>

          <div id="search5792Bar" style="padding: 5px 10px;">
  <input type="text" id="search5792Input" placeholder="üîç Search in Cash Ledger  table...">

  <strong style="color: white;"> Select User:</strong>
    <select id="user5792" style="border-radius: 4px; ">
    <option value="">--Select Type--</option>
    <option value="MA">MUKHTIYAR (MA)</option>
    <option value="TA">TUSHAR (TA)</option>
    <option value="BANK">BANK</option>
    <option value="JLN">JOURNAL</option>
    <option value="DB">DAYBOOK</option>
  </select>

  <label>From:</label>
  <input type="date" id="start5792Date">
  <label>To:</label>
  <input type="date" id="end5792Date">

  <button id="export5792" data-value="export5792" data-target="table5792Container" style="border: none; font-weight: bold; cursor: pointer; background-color: #424242; color: rgb(245, 242, 163);">üè¢ Export</button>

  </div>
      
      </div>  <!-- section2B content stop hare *********************************************************************************************************-->


      <div id="section2" class="section hidden"><div id="table5792Container"></div> <br/><br/><br/><br/><br/></div>  <!--  sections2 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
      
      
      
      
      
      <!-- section3B content start hare *********************************************************************************************************-->
<div id="section3b" class="section hidden">




<style>
 .filter-btn {
  background: rgb(0, 47, 74);
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
 
  transition: background 0.2s ease;
  min-width: 90px;            /* optional: makes buttons uniform width */
  text-align: center;
}
.filter-btn:hover {
  background: rgb(1, 76, 119);
}
.filter-btn.active {
  background: #932001;
  color: rgb(252, 250, 250);
  font-weight: bold;
}

</style>




<div style="text-align:center; background-color: #c1f1f3; color: #002630; font-weight: bold;"> <strong>Dishplay Ledger Report</strong>  </div> <br/>


 <!--  mipl2011Buttons div start  -->
<div id="mipl2011Buttons" style="display: flex; gap: 8px;  border-bottom:5px solid #822501;  flex-wrap: wrap; justify-content: center; margin-bottom: 10px; background-color: rgb(0, 47, 74); padding: 2px 2px; ">
  
   <strong style="color: rgb(2, 98, 153); font-size: 25px; font-weight: bold;">|</strong>

  <button class="filter-btn" data-value="search">üîç Searchbar</button>
  <button class="filter-btn" data-value="ledger">üìò Ledger</button>
  <button class="filter-btn" data-value="poreff">üìÑ PO/REFF</button>
  <button class="filter-btn" data-value="receipt">üí∞ Receipt</button>
  <button class="filter-btn" data-value="sale">üßæ Sale</button>
  <button class="filter-btn" data-value="address">üè¢ Address</button>
  <button class="filter-btn" id="openULUBtn" data-value="atn">üè¢ Attendance</button>
  <button class="filter-btn" data-value="psw">üè¢ ID/Password</button>

<button onclick="print2011Report()" style="border: none; color: rgb(251, 197, 197); font-weight: bold;  cursor: pointer; background-color: rgb(0, 47, 74);;">üñ®Ô∏è Print Report</button>
<button id="refresh2011Btn" style="border: none; color: rgb(196, 248, 181); font-weight: bold;  cursor: pointer; background-color: rgb(0, 47, 74);;"> üîÑ Refresh</button>

   <strong style="color: rgb(2, 98, 153); font-size: 25px; font-weight: bold;">|</strong>




<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, Dropdown URL  Script Start Heare -->

    <script>
        // Function to handle dropdown selection
        function handleDropdownChange() {
            const dropdown = document.getElementById('linkDropdown');
            const selectedOption = dropdown.options[dropdown.selectedIndex];

            if (selectedOption.value) {
                // Open the link in a new tab
                window.open(selectedOption.value, '_blank');
            }
        }
    </script>
 


    <select id="linkDropdown" onchange="handleDropdownChange()"  data-value="url" style="background-color: rgb(0, 47, 74);color: white; font-size: 16px;  border-radius: 8px; border: none;">
        <option value="" style="text-align: center; font-weight: bold; ">Other Option </option>

        <option value="https://drive.google.com/drive/folders/1Dc4In3NfpKdFdOLqcgyTFNC2tch7b6q2?usp=sharing"   style="color: rgb(248, 160, 148); font-weight: bold;">AFI Drive</option>

        <option value="https://docs.google.com/spreadsheets/d/1FXdbotep3MTk34gUdSF0e0h_hN_Uz66AL0Gnvc-pt_s/edit?gid=475142657#gid=475142657">	Party Weight Sheet</option>
        <option value="https://docs.google.com/spreadsheets/d/1EMIe8Y50_vMXg7y9zT7lXV0vgLyOZuSKdthf8C5XUXc/edit?gid=1752231070#gid=1752231070">	Mukhtiyar</option>
        <option value="https://docs.google.com/spreadsheets/d/1F3Wf5V8sLxENPJFtHij-0GDGBXfeYByGx0DSafDucgM/edit?gid=90095763#gid=90095763">	Tushar</option>
	<option value="https://www.google.com/android/find/">	Find My Device</option>
  <option value="https://maps.app.goo.gl/znrnuQTZatuzQJGC6">	Find My Device - Mukhtiyar</option>
	<option value="https://docs.google.com/spreadsheets/d/1wvsPdAQA57HxhTxA3cCcQvUEz93IWkBre_Ix-qvzwss/edit?gid=627393391#gid=627393391">	Store Database SHeet*</option>
	<option value="https://docs.google.com/spreadsheets/d/1U_jwvZNtFuP91Gljjrbz_cpmb1OIkeDHnKa7aDe7F20/edit?gid=1511450281#gid=1511450281">	Clint List Sheet*</option>
	<option value="https://docs.google.com/spreadsheets/d/17GZv2O6uupdA5r6p7-zqKZ8AQgZozbGQf2aXPlUzhDA/edit?gid=1122888223#gid=1122888223">	Mipl Office</option>
	<option value="https://docs.google.com/spreadsheets/d/13N0HBuorZJM-ARnlTh36EUaD1-uQckaC6sLLzMnWAks/edit?gid=696561165#gid=696561165">	Office Noida</option>
	<option value="https://docs.google.com/spreadsheets/d/1Rw_6cDYP-ETicn9YhHkdF_Sgmi8ps5JhjhlrkWvtwRQ/edit?gid=2123243236#gid=2123243236">	GUPTA CAMUNICATION Sheet*</option>
    <option value="https://docs.google.com/spreadsheets/d/1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4/edit?gid=0#gid=0">	INDEX SHEET MIPL Sheet*</option>
    <option value="https://docs.google.com/spreadsheets/d/1B6dyXPay3Tyl_7RzGuL9Rg8AhkzdBNhJNRu-T-3kmvI/edit?gid=147958071#gid=147958071">	MIPL Clint Cash Ledger Sheet*</option>
     <option value="https://docs.google.com/spreadsheets/d/1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0/edit?gid=0#gid=0">	Cash Management Sheet*</option>
     <option value="https://docs.google.com/spreadsheets/d/1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA/edit?gid=0#gid=0">	Imprest Voucher Sheet*</option>
      <option value="https://docs.google.com/spreadsheets/d/1B6dyXPay3Tyl_7RzGuL9Rg8AhkzdBNhJNRu-T-3kmvI/edit?pli=1&gid=207048997#gid=207048997">	MIPL Party Weight REport*</option>
     <option value="MULTITECH V.2023.html">	MIPL DASHBOARD OLD</option>
     <option value="MULTITECH2023.html">MIPL Old Dashboard</option>
     <option value="https://github.com/">	github (mukhtarahamadksp@gmail.com)</option>
     <option value="eTally.html">	eTally Dashboard</option>
		  <option value="https://m5792.github.io/esmTally/AFI.html"> A.F.I Medical Dashboard </option>
		<option value="DAYBOOK.html">Daybook</option>
    </select>


<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, Dropdown URL  Script Stop Heare -->


</div>   <!--  mipl2011Buttons div stop  -->

<div id="search2011Bar">
  <input type="text" id="search2011Input" placeholder="üîç Search in Dishplay Report table...">
  <label>From:</label>
  <input type="date" id="start2011Date">
  <label>To:</label>
  <input type="date" id="end2011Date">

   
   <button id="exportBtn" data-value="exportBtn" data-target="mipl2011Table" style="border: none; font-weight: bold; cursor: pointer; background-color: #027175; color: rgb(245, 242, 163);">üè¢ Export</button>

</div>   <!-- <div id="search2011Bar"> stop  -->

<style>
  #search2011Bar {
    background-color: #027175; /* blue */
    width: 100%;
    height: 20px;
    display: flex;
    align-items: center;
    padding: 20px;
    gap: 10px;
    box-sizing: border-box;
  }

  #search2011Input {
    flex: 1;
    background-color: #fdfdf6; /* grey */
    border: none;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 14px;
    outline: none;
  }

  #search2011Bar label {
    font-weight: bold;
    color: rgb(247, 244, 244);
    margin-left: 10px;
  }

  #search2011Bar input[type="date"] {
    padding: 4px 6px;
    border-radius: 4px;
    border: 1px solid #ccc;
    font-size: 14px;
  }
</style>


        
    <!-- Totals (Only for Ledger) -->
<div id="totals2011mipl">

  <!-- Ledger Filter -->
<div id="ledger2011Select" class="filter-container">
 <span style="color: black;">Ledger Name:</span>
  <input type="text" id="ledger2011Input" style="padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; margin-bottom:10px; width:200px; width: 4in; background-color: rgb(241, 212, 212); font-size: 14px;" placeholder="üîç Type to search ledger...">
  <div id="ledger2011Dropdown" class="dropdown"></div>

  <span id="address2011"></span>
</div>

  <span>Total Receipt:</span> <span id="totalReceipt">0</span> |
  <span>Total TDS:</span> <span id="totalTds">0</span> |
  <span>Total Bill:</span> <span id="totalBill">0</span> |
  <span>Total Credit Note:</span> <span id="totalCn">0</span> |
  <span>Total Weight:</span> <span id="totalPEBWeight">0</span> |
  <span>Balance:</span> <span id="totalDifference">0</span>
</div>       


<!-- PO Filter -->
<div id="po2011Select" class="filter-container" style="display:none;">
  <br/> <strong style="color: black;">PO / Reff No.:</strong>
  <input type="text" id="po2011Input" style="padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; margin-bottom:10px; width:200px; width: 4in; background-color: rgb(228, 241, 212); font-size: 14px;" placeholder="üîç Type PO No..."
    style="padding:4px 8px;border-radius:4px;border:1px solid #ccc;
    margin-bottom:10px;width:4in;background:#f7f7f7;font-size:14px;">
  <div id="po2011Dropdown" class="dropdown"></div>

  <!-- ‚úÖ Totals For PO -->
  <div id="poTotals2011mipl" style="display:none;margin-top:10px;
    padding:8px;background:#f8f0ff;border:1px solid #ccc;border-radius:4px;">
    <strong>Total Bill:</strong> ‚Çπ<span id="poTotalAmount">0</span> &nbsp;&nbsp;
    <strong>Total Weight:</strong> <span id="poTotalWeight">0</span> Kg
  </div>
</div>


      </div>  <!-- section3B content stop hare *********************************************************************************************************-->


  <div id="section3" class="section hidden" style="max-height: 570px;color: black;overflow-y: auto;">  <table id="mipl2011Table"><thead id="tableHead"></thead> <tbody id="table2011Body"></tbody></table>
<br/>
</div>  <!--  sections3 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->



<style>

#mipl2011Table {
  width: 100%;
  border-collapse: collapse;
  table-layout: auto;
  font-family: Arial, sans-serif;
  font-size: 14px;
  background: #ffffff;
  border: 1px solid #d0d0d0;
}

#mipl2011Table thead th {
  background: #01305c;
  color: #ffffff;
  padding: 8px 5px;
  border: 1px solid #013a70;
  text-align: left;
  font-weight: 600;
  position: sticky;
  top: 0;
  z-index: 1;
  white-space: nowrap;
  border-bottom:5px solid #4a4a4a;
}

#mipl2011Table tbody td {
  padding: 8px 10px;
  border: 1px solid #e0e0e0;
  vertical-align: top;
  word-wrap: break-word; /* Wrap long text */
  white-space: normal;
}

#mipl2011Table tbody tr:nth-child(even) {
  background: #f7faff;
}

#mipl2011Table tbody tr:hover {
  background: #e2f0ff;
  
}

#mipl2011Table {
  overflow-x: auto;
  display: block;
  max-height: 400px; /* Optional scrolling */
}


</style>
     
      <div id="section4" class="section hidden">
        
 
<div style="text-align:center; background-color: #eef1ba; color: #002630; font-weight: bold;"> <strong>Imprest Voucher Report</strong></div> <br/>


  <!-- Ledger Filter -->
  <div id="ledger5793Select" >
    <span style="color: black;">Ledger Name:</span>
    <input type="text" id="ledger5793Input"
      style="padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; margin-bottom:10px; width: 4in; background-color: rgb(212, 241, 233); font-size: 14px;"
      placeholder="üîç Type to search ledger...">
    <div id="ledger5793Dropdown" class="dp5793"></div>

    <button onclick="print5793Table()" style="background-color: white;  color: #00254d;border: none; cursor: pointer;">üñ®Ô∏è Print Table</button>
<button onclick="refresh5793Table()"  style="background-color: white;  color: #00254d; border: none; cursor: pointer;">üîÑ Refresh Table</button>
  </div>

          <div id="search5793Bar" style="padding: 5px 10px;">
  <input type="text" id="search5793Input" placeholder="üîç Search in Imprest Voucher table...">

  <strong style="color: white;"> Select User:</strong>
    <select id="user5793" style="border-radius: 4px; ">
    <option value="">--Select Type--</option>
    <option value="IV01">IV01-Amarbahadur</option>
    <option value="IV02">IV02-Vijender Sharma</option>
     <option value="IV03">IV03-Rahul</option>
      <option value="IV04">IV04-Raju</option>
     <option value="IV05">IV05- Mannu</option>
     <option value="IV06">IV06- Aakash</option>
     <option value="IV07">IV07- Manjeet</option>
     <option value="IV08">IV08- Nitin Kumar</option>
     <option value="IV09">IV09- Sunil Yadav</option> 
     <option value="IV10">IV10- Ajay Kumar</option>
     <option value="IV11">IV11- Ravinder Kumar</option>
     <option value="IV12">IV12- Mahender</option>
     <option value="DLT">Delete</option>

  </select>

  <label>From:</label>
  <input type="date" id="start5793Date">
  <label>To:</label>
  <input type="date" id="end5793Date">

  
<button id="export5793" data-value="export5793"  data-target="table5793Container" style="border: none; font-weight: bold; cursor: pointer; background-color: #014842; color: rgb(245, 242, 163);">üè¢ Export</button>

  </div>
      
      
      </div>    <!--  sections4 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
      
      <!-- section4B content start hare *********************************************************************************************************-->
       <div id="section4b" class="section hidden">
<div id="table5793Container"></div> 
 </div>  <!-- section4B content stop hare *********************************************************************************************************-->



      <!--  sections5 START  AAAAAAAAAAAAAAAAAAA  X -->
      <div id="section5" class="section hidden"> 
      
      
      </div>    <!--  sections5 stop  AAAAAAAAAAAAAAAAAAA  X -->
      





<div id="section7" class="section hidden">   <!--  sections7 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
  
<BR/>



<br/><br/><br/>

 <a href="http://192.168.1.49:8000/" target="_blank"><img src="https://cdn-icons-png.freepik.com/512/7575/7575914.png" alt="You Tube" width="60" height="60" /></a>
                            

</div>  <!--  sections7 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->









<!--  sections8 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA   -->
      <div id="section8" class="section hidden">

    <div class="container">  <div class="left" style="background-color: rgb(247, 249, 249);color:#004d80;font-weight: bold;">   <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content start ((CODE501)) -->


        
    <div class="form-container">
<form id="mainIVMAForm">
        <input type="hidden" name="SNo" id="sNo">
      

<label style="color: red;font-weight: bold;" >User*</label>
          <!-- User selection dropdown -->
<select class="userDropdown" id="msaf51" name="Voucher" required>
 
</select>



          <label  >Select Voucher</label>
          <select id="msaf52" name="Type" required>
            <option value="PAYMENT" style="color: green;">Payment</option>
            <option value="RECEIPT" style="color: red;">Receipt</option>
            <option value="BILLDR">Bills Payable</option>
            <option value="BILLCR">Bills Receivable</option>
            <option value="SALARY">Salary</option>
          </select>
          
          <label >Select Date</label>
          <input type="date" id="msaf53" name="Date" required>

<!-- Searchable Ledger Dropdown -->
  <div class="dropdownWrapper">
    <label">Search & Select Ledger</label>
    <input type="text" id="msaf54" name="Ledger" class="dropdownCLSearch" placeholder="üîç Search Ledger..." />
    <ul id="ledgerDropdown" class="dropdownList"></ul>
  </div>


         
        <label  >Enter Amount</label>
          <input type="number" id="msaf55" name="Amount" required placeholder="Amount" > 

          <label >Enter Narration</label>
          <input type="text" id="msaf56" name="Narration" placeholder="Narration"style="text-transform: uppercase;">
   
          <input type="hidden" name="Timestamp" id="timestampIVMA">

        <input type="submit" id="submitIVMAButton" value="Submit">

        <H3 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Entry Modify</H3>

         <!-- Form for Fetching and Modifying Entries -->
    <form id="modifyIVMAForm">
       <input type="hidden" id="formModeIVMA" name="formModeIVMA" value="new">
        <input type="number" id="searchIVMASNo" placeholder="Enter S.No. to Modify Entry" >
        <button type="button" class="fetchbtn" onclick="fetchIVMADetails()">Fetch Details</button>
        <button type="button" class="fetchbtn" id="modifyIVMAButton" onclick="modifyIVMAEntry()" style="display:none;">Modify Entry</button>
        <!-- Wait message div -->
<div id="waitIVMAMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
    </form>

    </form>

     
     <br/> <br/> <br/>
      <label style="color: #014060; font-weight: bold;font-size: 18px;">Search MA,TA,JLN,Bank Entry.</label>
    <input type="text" id="searchCLedger" placeholder="üîç Search in Table..." />
    </div>

<button onclick="printCUSERTable()" style="border: none; color: rgb(0, 27, 37); font-weight: bold;  cursor: pointer;">üñ®Ô∏è Print Table</button>
  

        </div> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) right content start -->




<!-- First dropdown populated based on username -->
 <label style="font-size: 20px; font-weight: bold;">Select User Name:</label>
<select id="cu123" required style="width: 3in; font-size: 16px; text-align: center; background-color: #014060;color: white;"></select>

<script>
// 1. All dropdown options
const allOptions = [
{ value: "", text: "Select a User" },
  { value: "MA", text: "MUKHTAR" },
  { value: "TA", text: "TUSHAR" },
  { value: "JLN", text: "JOURNAL" },
  { value: "BANK", text: "BANK" },
  { value: "DB", text: "DAYBOOK" }
];

// 2. Which user sees which options
const userOptionsMap = {
  "Anchal": [0,2, 3,4],              // TUSHAR, JOURNAL, BANK
  "Mukhtar (Admin)": [0, 1, 2, 3,4,5]   // All options
};

// 3. Populate cu123 dropdown based on username
function updateDropdown(username) {
  const cu123 = document.getElementById("cu123");
  cu123.innerHTML = ""; // Clear existing options

  const allowedIndexes = userOptionsMap[username] || [];

  allowedIndexes.forEach(index => {
    const option = document.createElement("option");
    option.value = allOptions[index].value;
    option.textContent = allOptions[index].text;
    cu123.appendChild(option);
  });

  // Trigger sync after populating cu123
  syncledgerOption();
}

// 4. Sync selected cu123 option to msaf51
function syncledgerOption() {
  const cu123Select = document.getElementById("cu123");
  const ledgerSelect = document.getElementById("msaf51");

  const selectedValue = cu123Select.value;
  const selectedText = cu123Select.options[cu123Select.selectedIndex]?.text || "";

  // Clear and set new option
  ledgerSelect.innerHTML = "";
  if (selectedValue && selectedText) {
    const newOption = document.createElement("option");
    newOption.value = selectedValue;
    newOption.textContent = selectedText;
    ledgerSelect.appendChild(newOption);
  }
}

// 5. Wait until username appears, then update dropdown
const checkUsername = setInterval(() => {
  const username = document.getElementById("username").textContent.trim();
  if (username) {
    updateDropdown(username);
    clearInterval(checkUsername); // Stop checking
  }
}, 300);

// 6. Attach sync on change event after DOM is ready
document.addEventListener("DOMContentLoaded", function () {
  const cu123Select = document.getElementById("cu123");
  cu123Select.addEventListener("change", syncledgerOption);
});
</script>






<!-- Table Output -->
  <div id="tableContainer" style="background-color: #fef8f6;"></div>

</div> </div>  <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections8 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->


<!--  sections9 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section9" class="section hidden">

    <div class="container">  <div class="left" style="background-color: #e3ecf2;color: white;">   <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content start ((CODE501)) -->


       <div class="form-container">
 <form id="mainSRRForm">
              <input type="hidden" name="SNo" id="sNo" />

             <label  style="color:#fd0505;font-size:90%;font-family:Arial; font-weight: bold;">User*</label>
             <input type="text" id="msaf91" name="User" value="STORE" readonly>


              <label  style="color:#0a0a0a;font-size:90%;font-family:Arial;">Select Date*</label>
  <input type="date" id="msaf92" name="Date" required>
<!-- (VCN-111) dropdown div start -->
<div class="dropdown-container">
    <label for="dropdownSRRSearch" style="color:#0c0c0c;font-size:90%;font-family:Arial;">Search SRR Ledger*</label><br/>
    <input type="text" id="dropdownSRRSearch" placeholder="üîç Search Ledger..." oninput="filterDropdown()" name="Ledger" required autocomplete="off">
    <ul id="dropdownList" class="dropdown-list">
        <!-- The dropdown options will be populated here -->
    </ul>
</div>
<!-- (VCN-111) dropdown div stop -->

<label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Select Entry Type</label><br/>
  <select id="msaf93" name="cl1" required>
              <option value="">--Select Type--</option>
                <option value="IN">IN</option>
                <option value="OUT">OUT</option>
                <option value="OTHER">OTHER</option>
              </select>
<label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Select Tr. Type</label><br/>
              <select id="msaf94" name="cl2" required>
                <option value="">--Select Type--</option>
                <option value="P">PURCHASE</option>
                <option value="S">SALE</option>
                <option value="RGP">RGP</option>
                 <option value="NRGP">NRGP</option>
                  <option value="C">CHALLAN</option>
                   <option value="O">OTHER</option>
              </select>

               <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Enter Document No.</label><br/>
          <input type="text" id="msaf95" name="cl3" placeholder="Enter Document No." >

                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Enter Weight*</label><br/>
                <input type="number" id="msaf96" name="cl4" placeholder="Enter Weight" required>
                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Item Discription</label><br/>
                <input type="text" id="msaf97" name="cl5" placeholder="Enter Item Discription" required>
                 <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Vehicle No.</label><br/>
                <input type="text" id="msaf98" name="cl6" placeholder="Enter Vehicle No." >

<!-- STATUS WITH INIQU DROPDOWN START here -----------------------------------> 
<label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Select Status</label><br/>
<select id="msaf99" name="cl7" required></select>

<script>
// 1. All dropdown options
const allmsaf99Options = [
  { value: "", text: "Select a Status" },
  { value: "LOAD", text: "LOADING" },
  { value: "UNLOAD", text: "UNLOADING" },
  { value: "---", text: "COMPLETE" },
  { value: "O", text: "OTHER" },
  { value: "‚úî", text: "VERIFIED" },
  { value: "X", text: "UNVERIFIED" }
];

// 2. User-specific options by index
const userOptionsmsaf99Map = {
  "Anchal": [0,5,6],
  "Mukhtar (Admin)": [0, 1, 2, 3, 4,5,6],
  "Suryabhan": [0, 1,2,3,4],
  "Divesh": [0, 1,2,3,4]
};

// 3. Populate dropdown based on username
function updateMsaf99Dropdown(username) {
  const msaf99 = document.getElementById("msaf99");
  msaf99.innerHTML = ""; // Clear existing options

  const allowedIndexes = userOptionsmsaf99Map[username] || [];

  allowedIndexes.forEach(index => {
    const optionData = allmsaf99Options[index];
    const option = document.createElement("option");
    option.value = optionData.value;
    option.textContent = optionData.text;
    msaf99.appendChild(option);
  });

  // Optional: handle syncing after change
  syncLedgerMsaf99Option();
}

// 4. Wait until username appears, then update dropdown
const checkMsaf99Username = setInterval(() => {
  const usernameEl = document.getElementById("username");
  if (usernameEl && usernameEl.textContent.trim()) {
    updateMsaf99Dropdown(usernameEl.textContent.trim());
    clearInterval(checkMsaf99Username);
  }
}, 300);

// 5. Attach event listener after DOM is ready
document.addEventListener("DOMContentLoaded", () => {
  const msaf99Select = document.getElementById("msaf99");
  msaf99Select.addEventListener("change", syncLedgerMsaf99Option);
});

// 6. Dummy function for sync (implement as needed)
function syncLedgerMsaf99Option() {
  console.log("Dropdown changed. Implement sync logic here.");
}
</script>
<!-- STATUS WITH INIQU DROPDOWN STOP here -----------------------------------> 

              
              <input type="hidden" name="Timestamp" id="timestampSRR">
              <input type="submit" id="submitSRRButton" value="Submit">
     
        
              <H2 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Entry Modify</H2>
    <!-- Wait message div -->
    <div id="waitSRRMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
   </form>


            <form id="modifySRRForm">
               <input type="hidden" id="formModeSRR" name="formModeSRR" value="new">
              <input type="number" id="searchSRRSNo" placeholder="Enter S.No. to Modify Entry"  />
              <button type="button" class="fetchbtn" onclick="fetchSRRDetails()">Fetch Details</button>
              <button type="button" class="fetchbtn" id="modifySRRButton" onclick="modifySRREntry()" style="display:none;">Modify Entry</button>
    </form>  

<br/><br/><br/>
    </div>



        </div> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) right content start -->

  <div id="tableDiv"></div>


</div> </div>  <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections9 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->


<!--  sections10 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section10" class="section hidden">

    <div class="container">  <div class="left" style="background-color: rgb(233, 252, 228);color:#003e3f;font-weight: bold;">   <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content start ((CODE501)) -->

    <div class="form-container">

<form id="mainVCRForm">
        <input type="hidden" name="SNo" id="sNo">
        
        <select id="msaf21"  name="Voucher" style="color: #6803a2 ;font-size:100%;" required>
            <option value="SALE">SALE</option>
        </select>

          <label > Date</label>
         <input type="date" id="msaf11" name="Date" required>
        
        <label > Tr. Type</label>
        <select id="msaf12" name="Type" style="color: #6803a2 ;font-size:100%;" required>
           <option value="TAX INVOICE">Tax Invoice</option>
           <option value="CREDIT NOTE">Credit Note</option>
           <option value="CANCEL">Cancel Invoice</option>
            <option value="CHALLAN">CHALLAN</option>
        </select>

         

        
<!-- Form Section 1: Ledger + Reff -->

    <label for="msaf13">Select VCR Ledger:</label>
    <select class="ledger-dropdown" id="msaf13" required name="Ledger"></select>

    <label for="msaf15">Job/Reff:</label>
    <select class="Reff-dropdown" id="msaf15" required name="Reff"></select>




        <input type="text" id="msaf14" name="VNo" placeholder="Enter Invoice No. (25-26/xxxx)" required >
        

        <input type="number" id="msaf16" name="Amount" placeholder="Enter Amount" required>
        <span id="amountWords16" style="font-size: 15px; color: rgb(45, 68, 133);;">...</span>  <br/>

        <input type="text" id="msaf17" name="Weight" placeholder="Enter Weight" required >
        <input type="text" id="msaf18" name="Rate" placeholder="Enter Rate" required >

            <input type="text" id="msaf19" name="Narration" placeholder="Vehicle No., Narration if any">

         <input type="hidden" name="Timestamp" id="timestampVCR">

        <input type="submit" id="submitVCRButton" value="Submit">

        <H3 style="background-color: #d1f4f7;color: rgb(2, 45, 70);font-size: 120%; text-align: center;font-weight: bold;">Entry Modify</H3>

        <form id="modifyVCRForm">
           <input type="hidden" id="formModeVCR" name="formModeVCR" value="new">
            <input type="number" id="searchVCRSNo" placeholder="Enter S.No. to Modify Entry" >
            <button type="button" class="fetchbtn" onclick="fetchVCRDetails()">Fetch Details</button>
            <button type="button" class="fetchbtn"  id="modifyVCRButton" onclick="modifyVCREntry()" style="display:none;">Modify Entry</button>
             <!-- Wait message div -->
<div id="waitVCRMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
        </form>
    </form>
    

   
</div>   




        </div> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) right content start -->
  <div id="saleContainer" class="entry-box"></div>
<BR/><BR/>
  <BR/><a href="https://docs.google.com/spreadsheets/d/1Bx0FqnXHadVATN9DGhUtRZr2EDgz10hfDEgIlwtSC_4/edit?gid=2081509697#gid=2081509697" target="_blank" style="color:rgb(1, 41, 1); text-align: center; font-size: 100%;">Click to Open Packing List</a>

 


</div> </div>  <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections10stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->


<!--  sections11 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section11" class="section hidden">

    <div class="container">  <div class="left" style="background-color: rgb(248, 238, 238);color: rgb(0, 2, 27);font-weight: bold;">   <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content start ((CODE501)) -->

    <div class="form-container">

  
<form id="mainBANKForm">
        <input type="hidden" name="SNo" id="sNo">
        <select id="msaf7"  name="Voucher" style="color: #6803a2 ;font-size:100%;" required>
            <option value="RECEIPT">RECEIPT</option>
        </select>

         <label >Date</label>
         <input type="date" id="msaf1" name="Date" required>
        

        <label >Type</label>
        <select id="msaf2" name="Type" style="color: #6803a2 ;font-size:100%;" required>
            <option value="BANK">Receipt (87-1723)</option>
            <option value="CASH">CASH</option>
            <option value="TDS">TDS</option>
        </select>

         
   <!-- Form Section 2: Ledger Only (No Reff dropdown update) -->
  <div class="form-section">
    <label for="msaf3">Select Bank Ledger:</label>
    <select class="ledgerVCRdropdown" id="msaf3" required name="Ledger"></select>
  </div>


   <label >Sekect Dr./Cr.</label>
             <select id="msaf4" name="VType" style="color: #6803a2 ;font-size:100%;" required>
                    <option value="CR">CR</option>
                    <option value="DR">DR</option>
                </select>
         <label >Amount</label>   
         <input type="number" id="msaf5" name="VNo" placeholder="Enter Amount" required>
          <span id="amountWords5" style="font-size: 15px; color: rgb(45, 68, 133);">...</span> <br/>

        <label >Narration</label>
        <input type="text" id="msaf6" name="Narration" placeholder="Narration if any">

        <input type="hidden" name="Timestamp" id="timestampBANK">

        <input type="submit" id="submitBANKButton" value="Submit">
 </form>

 <H3 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Entry Modify</H3>

          <!-- Form for Fetching and Modifying Entries -->
    <form id="modifyBANKForm">
       <input type="hidden" id="formModeBANK" name="formModeBANK" value="new">
        <input type="number" id="searchBANKSNo" placeholder="Enter S.No. to Modify Entry" >
        <button type="button" class="fetchbtn"  onclick="fetchBANKDetails()">Fetch Details</button>
        <button type="button"  class="fetchbtn" id="modifyBANKButton" onclick="modifyBANKEntry()" style="display:none;">Modify Entry</button>
        <div id="waitBANKMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
    </form>

    

    <br/>
        <span style="color:rgb(129, 1, 1);font-size:130%;font-family:Magneto;">eS |</span> 
        <span style="color:#004d80;font-size:130%;font-family:Magneto;">MTally</span>
</div>   

   <!-- ************************* number in words start *************************************************** -->
<script>
const ones = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Ten",
              "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen",
              "Seventeen", "Eighteen", "Nineteen"];
const tens = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];

function twoDigitToWords(n) {
  n = Number(n);
  if (n < 20) return ones[n];
  const t = Math.floor(n / 10);
  const o = n % 10;
  return tens[t] + (o ? " " + ones[o] : "");
}

function numToChunk(n) {
  n = Number(n);
  if (n === 0) return "";
  const h = Math.floor(n / 100);
  const r = n % 100;
  let s = "";
  if (h) s += ones[h] + " Hundred ";
  if (r) s += (h ? "and " : "") + twoDigitToWords(r);
  return s.trim();
}

function numToWordsIndian(num) {
  if (num === 0) return "Zero";
  let words = "";

  const crore = Math.floor(num / 10000000);
  num = num % 10000000;
  const lakh = Math.floor(num / 100000);
  num = num % 100000;
  const thousand = Math.floor(num / 1000);
  num = num % 1000;
  const hundred = Math.floor(num / 100);
  const rest = num % 100;

  if (crore) words += numToChunk(crore) + " Crore ";
  if (lakh) words += numToChunk(lakh) + " Lakh ";
  if (thousand) words += numToChunk(thousand) + " Thousand ";
  if (hundred) words += ones[hundred] + " Hundred ";
  if (rest) words += (words ? "and " : "") + twoDigitToWords(rest) + " ";
  return words.trim();
}

function convertNumberToWords(value) {
  if (value === "" || isNaN(value)) return "";
  const num = parseFloat(value);
  if (isNaN(num)) return "";
  const intPart = Math.floor(num);
  const fracPart = Math.round((num - intPart) * 100);

  let result = "";
  if (intPart > 0) result += numToWordsIndian(intPart) + " Rupees";
  if (fracPart > 0) result += " and " + numToWordsIndian(fracPart) + " Paise";
  if (result === "") result = "Zero Rupees";
  result += " Only";
  return result;
}

// === Attach Live Conversion to Both Inputs ===
function attachWordConverter(inputId, spanId) {
  const input = document.getElementById(inputId);
  const span = document.getElementById(spanId);
  input.addEventListener("input", () => {
    const words = convertNumberToWords(input.value);
    span.textContent = words ? words : "...";
  });
}

attachWordConverter("msaf16", "amountWords16");
attachWordConverter("msaf5", "amountWords5");
</script>

   <!-- ************************* number in words stop *************************************************** -->

        </div> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) right content start -->
 <div id="receiptContainer" class="entry-box"></div>

</div> </div>  <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections11stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->

<!--  sections12 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section12" class="section hidden">

    <div class="container">  <div class="left" style="background-color: white;">   <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content start ((CODE501)) -->

    <div class="form-container">

  
<form id="mainIVCRForm">
  <input type="hidden" name="SNo" id="sNo" />

   <label style="color: red;font-weight: bold;">User</label>
  <select id="voucherType" name="Voucher" required style="font-size: 20px; text-align: center;">
  <!-- Populated dynamically -->
</select>



          <label >Select Tr. Type</label>
         <select id="ivcr0" name="Type" required>
           <option value="PAYMENT" style="color: green;">Payment</option>
           <option value="RECEIPT" style="color: red;">Receipt</option>
          
         </select>
           <label >Date</label>
         <input type="date" id="ivcr1" name="Date" required>


          <!-- (VCN- 111) dropdown div start -->
         <div class="dropdown-container" >
            <label >Serch IV Ledger</label>
            <input type="text" id="dropdownIVCRSearch" placeholder="üîç Search..." oninput="filterIVCRDropdown()" name="Ledger" required>
            <ul id="dropdownIVCRList" class="dropdownCSSlist">
                <!-- The dropdown options will be populated here -->
            </ul>
        </div>
 <!-- (VCN- 111) dropdown div stop -->
        

         <label >Amount</label>
         <input type="number" id="ivcr2" name="Amount" required placeholder="Amount">
          <label >Narration</label>
         <input type="text" id="ivcr3" name="Narration" placeholder="Narration"style="text-transform: uppercase;">

         <input type="hidden" name="Timestamp" id="timestampIVCR">
         <input type="submit" id="submitIVCRButton" value="Submit">
       </form>
   
     <!-- Form for Fetching and Modifying Entries -->
    <form id="modifyIVCRForm">
      <input type="hidden" id="formModeIVCR" name="formModeIVCR" value="new">
        <input type="number" id="searchIVCRSNo" placeholder="Enter S.No. to Modify Entry" >
        <button type="button" class="fetchbtn" onclick="fetchIVCRDetails()">Fetch Details</button>
        <button type="button" class="fetchbtn" id="modifyIVCRButton" onclick="modifyIVCREntry()" style="display:none;">Modify Entry</button>
        <!-- Wait message div -->
<div id="waitIVCRMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
       </form>

    <br/>
        <span style="color:rgb(129, 1, 1);font-size:130%;font-family:Magneto;">eS |</span> 
        <span style="color:#004d80;font-size:130%;font-family:Magneto;">MTally</span>
</div>   

        </div> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) right content start -->

    <!-- IV User Selection -->
     
 <!-- IV User Selection -->
<label style="font-size: 20px; font-weight: bold;">Select IV User:</label>
<select id="ivuser" style="width: 3in; font-size: 16px; text-align: center; background-color: #014060;color: white;">

</select>


<script>
// 1. All dropdown options
const allivuserOptions = [
{ value: "", text: "Select a User" },
  { value: "IV03", text: "RAHUL KUMAR-IV03" },
  { value: "IV08", text: "NITIN KUMAR-IV08" },
  { value: "IV09", text: "SUNIL KUMAR-IV09" },
  { value: "IV04", text: "RAJU-IV04" },
  { value: "IV05", text: "MANNU-IV05" },
   { value: "IV06", text: "AAKASH-IV06" },
  { value: "IV07", text: "MANJEET-IV07" },
  { value: "IV10", text: "AJAY KUMAR-IV10" },
  { value: "IV12", text: "MAHENDER-IV12" }
];

// 2. Which user sees which options
const userOptionsivuserMap = {
   "NITIN": [0,2],          // 
  "Anchal": [0,2, 3,4,5,6,7,8,9],              // 
  "Mukhtar (Admin)": [0, 1, 2, 3,4,5,6,7,8,9],   // All options
   "Rahul Kumar": [0,1]   // All options
};

// 3. Populate ivuser dropdown based on username
function updateivuserDropdown(username) {
  const ivuser = document.getElementById("ivuser");
  ivuser.innerHTML = ""; // Clear existing options

  const allowedIndexes = userOptionsivuserMap[username] || [];

  allowedIndexes.forEach(index => {
    const option = document.createElement("option");
    option.value = allivuserOptions[index].value;
    option.textContent = allivuserOptions[index].text;
    ivuser.appendChild(option);
  });

  // Trigger sync after populating ivuser
  syncledgerivuserOption();
}

// 4. Sync selected ivuser option to voucherType
function syncledgerivuserOption() {
  const ivuserSelect = document.getElementById("ivuser");
  const ledgerSelect = document.getElementById("voucherType");

  const selectedValue = ivuserSelect.value;
  const selectedText = ivuserSelect.options[ivuserSelect.selectedIndex]?.text || "";

  // Clear and set new option
  ledgerSelect.innerHTML = "";
  if (selectedValue && selectedText) {
    const newOption = document.createElement("option");
    newOption.value = selectedValue;
    newOption.textContent = selectedText;
    ledgerSelect.appendChild(newOption);
  }
}

// 5. Wait until username appears, then update dropdown
const checkivuserUsername = setInterval(() => {
  const username = document.getElementById("username").textContent.trim();
  if (username) {
    updateivuserDropdown(username);
    clearInterval(checkivuserUsername); // Stop checking
  }
}, 300);

// 6. Attach sync on change event after DOM is ready
document.addEventListener("DOMContentLoaded", function () {
  const ivuserSelect = document.getElementById("ivuser");
  ivuserSelect.addEventListener("change", syncledgerivuserOption);
});
</script>




  <table id="myIVCRTable" style="background-color: rgb(239, 249, 246);"></table>

</div> </div>  <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections12stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->



<!--  sections13 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section13" class="section hidden">

    <div class="container">  <div class="left" style="background-color: #e2e5e6;">   <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content start ((CODE501)) -->

      <label style="font-size: 16px; font-weight: bold;color: rgb(1, 25, 68);">Select Voucher:</label>
<select id="designUSER" required onchange="showForm(this.value)" style="width: 3in; font-size: 18px; text-align: center; background-color: #030010;color: rgb(247, 247, 247);">
     <option value="MFDY">Modify Entry</option>
      <option value="CREAT">New Job/Reff No.</option>
</select>


    <div class="form-container">

<div id="formContent">
    <!-- Form will be injected here -->
  </div>
       
</div>   

        </div> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) right content start -->

  <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, uniq option selectio id msaf71 start -->
   <label style="font-size: 20px; font-weight: bold;">Select Job/Reff User:</label>
 <select id="jobreffuser" name="Type" required style="width: 3in; font-size: 16px; text-align: center; background-color: #014060;color: white;"></select> 
<script>
// 1. All dropdown options
const alljobreffuserOptions = [
{ value: "", text: "Select a User" },
  { value: "PRAKHAR", text: "PRAKHAR" },
  { value: "HARSHIT", text: "HARSHIT" }
];

// 2. Which user sees which options
const userOptionsjobreffuserMap = {
  "Prakhar": [0,1],              // TUSHAR, JOURNAL, BANK
  "Mukhtar (Admin)": [0, 1, 2],   // All options
   "Harshit": [0,2]   // All options
};

// 3. Populate jobreffuser dropdown based on username
function updatejobreffuserDropdown(username) {
  const jobreffuser = document.getElementById("jobreffuser");
  jobreffuser.innerHTML = ""; // Clear existing options

  const allowedIndexes = userOptionsjobreffuserMap[username] || [];

  allowedIndexes.forEach(index => {
    const option = document.createElement("option");
    option.value = alljobreffuserOptions[index].value;
    option.textContent = alljobreffuserOptions[index].text;
    jobreffuser.appendChild(option);
  });

  // Trigger sync after populating jobreffuser
  syncledgerjobreffuserOption();
}

// 4. Sync selected jobreffuser option to msaf71
function syncledgerjobreffuserOption() {
  const jobreffuserSelect = document.getElementById("jobreffuser");
  const ledgerSelect = document.getElementById("msaf71");

  const selectedValue = jobreffuserSelect.value;
  const selectedText = jobreffuserSelect.options[jobreffuserSelect.selectedIndex]?.text || "";

  // Clear and set new option
  ledgerSelect.innerHTML = "";
  if (selectedValue && selectedText) {
    const newOption = document.createElement("option");
    newOption.value = selectedValue;
    newOption.textContent = selectedText;
    ledgerSelect.appendChild(newOption);
  }
}

// 5. Wait until username appears, then update dropdown
const checkjobreffuserUsername = setInterval(() => {
  const username = document.getElementById("username").textContent.trim();
  if (username) {
    updatejobreffuserDropdown(username);
    clearInterval(checkjobreffuserUsername); // Stop checking
  }
}, 300);

// 6. Attach sync on change event after DOM is ready
document.addEventListener("DOMContentLoaded", function () {
  const jobreffuserSelect = document.getElementById("jobreffuser");
  jobreffuserSelect.addEventListener("change", syncledgerjobreffuserOption);
});
</script>

<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, uniq option selectio id stop start -->




<div id="results"></div> <!-- For displayJOBNOResults function -->


<div style="display: flex; align-items: center; gap: 10px;">
    <select id="filterType" onchange="jobPOreffDropdown()" style="background-color: #0026ff; color: white;">
        <option value="latestEntry">Latest 10 Entries</option>
        <option value="allJobreff">All JOB/REFF Entries</option>
        <option value="userHarshit">Harshit's Entries</option>
        <option value="userPrakhar">Prakhar's Entries</option>
    </select>
    
    <div id="summary"></div>
    <div id="jobRefResults" style="color: red;"></div>
</div>


  <BR/><a href="https://docs.google.com/spreadsheets/d/1Bx0FqnXHadVATN9DGhUtRZr2EDgz10hfDEgIlwtSC_4/edit?gid=2081509697#gid=2081509697" target="_blank" style="color:blue; text-align: center; font-size: 100%;">Click to Open Packing List</a>



   <div id="jobReffContainer" class="entry-box"></div>   <!-- top 10 job/reff no by function fetchldgrreffDP(); (close) script --> 
 
 

</div> </div>  <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections13stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->




<!--  sections14 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section14" class="section hidden">

    <div class="container">  <div class="left" >   <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content start ((CODE501)) -->

    <div class="form-container">

      
            <form id="mainSKHRForm">
              <input type="hidden" name="SNo" id="sNo" />

              <label for="dropdownskhrSearch" style="color:#f90404;font-size:90%;font-family:Arial;font-weight: bold;" >User*</label><br/>
              <select id="msaf101" name="User" required>
                <option value="SHEKHER">SHEKHER</option>
              </select>

              <label  style="color:#0a0a0a;font-size:90%;font-family:Arial;">Select Date*</label>
  <input type="date" id="msaf102" name="Date" required>

  <!-- (VCN- 112) dropdown div start -->
<div class="dropdown-container">
<label for="dropdownskhrSearch" style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Search SKHR Ledger*</label><br/>
<input type="text" id="dropdownskhrSearch" placeholder="üîç Search .." oninput="filterSKHRDropdown()" name="Ledger" required autocomplete="off">
<ul id="dropdownSKHRList" class="dp-list">
<!-- The dropdown options will be populated here -->
</ul>
</div>
<!-- (VCN- 112) dropdown div stop -->
                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Enter Weight*</label><br/>
                <input type="text" id="msaf103" name="cl1" placeholder="Enter Weight" required>
                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Rate</label><br/>
                <input type="text" id="msaf104" name="cl2" value="3.9" readonly>
                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Amount</label><br/>
                <input type="text" id="msaf105" name="cl3" placeholder="Enter Amount" required readonly>
                
                <script>
                function calculateAmount() {
                  const weight = parseFloat(document.getElementById('msaf103').value) || 0;
                //  const rate = parseFloat(document.getElementById('msaf104').value) || 0;    if rate manual type than use this code
                const rate = 3.9; // Fixed rate
                  const amount = weight * rate;
                
                  document.getElementById('msaf105').value = amount.toFixed(); // two decimal places
                }
                
                // Attach the event listeners to both input fields
                document.getElementById('msaf103').addEventListener('input', calculateAmount);
              //  document.getElementById('msaf104').addEventListener('input', calculateAmount);   if rate manual type than use this code
                </script>
           <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Enter Narration If Any</label><br/>
          <input type="text" id="msaf106" name="cl4" placeholder="Enter Narration" >
              
              <input type="hidden" name="Timestamp" id="timestampSKHR">
              <input type="submit" id="submitSKHRButton" value="Submit">
            </form>
        
    
            <form id="modifySKHRForm">
               <input type="hidden" id="formModeSKHR" name="formModeSKHR" value="new">
              <input type="number" id="searchSKHRSNo" placeholder="Enter S.No. to Modify Entry" required />
              <button type="button" class="fetchbtn" onclick="fetchSKHRDetails()">Fetch Details</button>
              <button type="button" class="fetchbtn" id="modifySKHRButton" onclick="modifySKHREntry()" style="display:none;">Modify Entry</button>
    
              <!-- Wait message div -->
    <div id="waitSKHRMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
            </form>
      
    <br/>
        <span style="color:rgb(129, 1, 1);font-size:130%;font-family:Magneto;">eS |</span> 
        <span style="color:#004d80;font-size:130%;font-family:Magneto;">MTally</span>
</div>   

        </div> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) right content start -->

  

 <style>
        .date-filter-row {
          display: flex;
          align-items: center;
          gap: 10px;
          margin-bottom: 20px;
          flex-wrap: wrap;
        }
      
        .date-filter-row label {
          font-size: 14px;
        }
      
        .date-filter-row input[type="date"],
        .date-filter-row button {
          width: 192px; /* ~2 inches */
          padding: 6px 10px;
          font-size: 14px;
          box-sizing: border-box;
        }
      
        .date-filter-row input[type="date"] {
          border: 1px solid #ccc;
          border-radius: 4px;
        }
      
        .date-filter-row button {
          background-color: #0077b6;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
        }
      
        .date-filter-row button:hover {
          background-color: #005f8a;
        }
      </style>
      <div class="date-filter-row">
        <label for="fromDate">From: </label>
        <input type="date" id="fromDate">
      
        <label for="toDate">To: </label>
        <input type="date" id="toDate">
      
        <button onclick="filterSKHRByDate()">Filter by Date</button>
        <button id="printButton" onclick="printSHEKHERTable()">Print</button>
      </div>
      
<div id="tableSKHRDiv"></div>


</div> </div>  <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections14stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->








<!--  sections15 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section15" class="section hidden">

  <!--  <div class="container">  <div class="left" >   </div> -->

  

<div class="right"> <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) right content start -->


        <label style="font-size: 16px; font-weight: bold;">Select Option:</label>
        <select onchange="show123Div(this.value)" style="background-color: rgb(8, 130, 161);color: white; font-size: 16px;  border-radius: 8px; border: none;">
          <option value="">Select an option</option>
          
           <option value="1"> UPCL Bill Calculator</option>
           <option value="2"> Loan Calculator</option>
           <option value="3"> Repayment Schedule</option>
           <option value="4"> Employee/Event Search</option>
            <option value="5"> Payroll</option>
        </select>


        <style>
    .contentEMS {
        display: none;
    }
</style>

<script>
    function show123Div(selectedValue) {
        // ‡§™‡§π‡§≤‡•á ‡§∏‡§≠‡•Ä content div hide ‡§ï‡§∞ ‡§¶‡•ã
        const divs = document.querySelectorAll('.contentEMS');
        divs.forEach(div => div.style.display = 'none');

        if (selectedValue) {
            // ‡§ú‡§ø‡§® divs ‡§ï‡§æ id selected value ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à (‡§ú‡•à‡§∏‡•á "2", "2a", "2b" ...)
            const relatedDivs = document.querySelectorAll(`.contentEMS[id^="${selectedValue}"]`);
            
            relatedDivs.forEach(div => {
                div.style.display = 'block';
            });
        }
    }
</script>

    <br/>  <br/>

<!--  --------------------------------------------------------------------------------------------------------------------------------------------------------- -->

     <!-- Panel 1a -->
<div id="1a" class="contentEMS">

  

  <label>Enter Your  Units: </label>
  <input type="number" id="units" placeholder="Enter units">
  <button onclick="calculateBill()">Calculate</button>
  <button onclick="resetDefaults()">Reset Defaults</button>

 </div>

<!--  --------------------------------------------------------------------------------------------------------------------------------------------------------- -->


<!--  --------------------------------------------------------------------------------------------------------------------------------------------------------- -->

     <!-- Panel 1a -->
<div id="2a" class="contentEMS"> <div class="LRSSMLY" id="LRSSMLY"></div> </div>

<!--  --------------------------------------------------------------------------------------------------------------------------------------------------------- -->


 <!-- Panel 3a -->
<div id="3a" class="contentEMS">
  
 <h4>üìä Smart Loan Viewer (Fixed)</h4>

    <label for="loanDropdown">Select Loan No. (from Sheet):</label>
    <select id="loanDropdown" onchange="fillLoanDetails()" style="width: 3.5in;">
      <option value="">-- Select Loan --</option>
    </select>

    <div class="LRSMRY" id="LRSMRY"></div>


    

</div>

<!--  --------------------------------------------------------------------------------------------------------------------------------------------------------- -->






 
         <!-- Panel 1 -->
        <div id="1" class="contentEMS">
          
 <span style="max-width:300px; text-align:center; margin:10px 0 20px; font-size:22px; line-height:1.5; color: rgb(7, 7, 7);">
   Uttarakhand Power Corporation Ltd. Energy Charge Calculator
    </span>
<br/>
   <span style="max-width:300px; text-align:center; margin:10px 0 20px; font-size:16px; line-height:1.5; color: rgb(13, 2, 173);">
     *All Rate & Amt only educational and calculation purpose. 
    </span>
<br/><br/>
           <!-- ===== VALUE KO EDITABLE BANANE KE LYE <td> "contenteditable="true" class="editable"" add kro ===== -->
  <table>
    <tr>
      <th>Description</th>
      <th>Units</th>
      <th>Rate</th>
      <th>Amount</th>
    </tr>
    <tr>
      <td>S1 (0‚Äì100)</td>
      <td id="s1u">0</td>
      <td contenteditable="true" class="editable" id="r1">3.65</td>
      <td id="s1c">0</td>
    </tr>
    <tr>
      <td>S2 (100‚Äì200)</td>
      <td id="s2u">0</td>
      <td contenteditable="true" class="editable" id="r2">5.25</td>
      <td id="s2c">0</td>
    </tr>
    <tr>
      <td>S3 (197.26‚Äì394.52)</td>
      <td id="s3u">0</td>
      <td contenteditable="true" class="editable" id="r3">7.15</td>
      <td id="s3c">0</td>
    </tr>
    <tr>
      <td>S4 (Above 394.52)</td>
      <td id="s4u">0</td>
      <td contenteditable="true" class="editable" id="r4">7.8</td>
      <td id="s4c">0</td>
    </tr>
    <tr class="total">
      <td colspan="3">Total Energy Charge</td>
      <td id="totalEnergy">0</td>
    </tr>
    <tr>
      <td>Fixed Charge (‚Çπ/kW) √ó Load</td>
      
      <td contenteditable="true" class="editable" id="fixedLoad" style="background-color: rgb(248, 202, 202);">3</td>
      <td  id="fixedRate">85</td>
      <td id="fixedAmt">0</td>
    </tr>
    <tr>
      <td>Electricity Duty (/kWh)</td>
      <td id="dutyUnits">0</td>
      <td  id="dutyRate">0.15</td>
      <td id="dutyAmt">0</td>
    </tr>
    <tr>
      <td>Fuel Adjustment (/kWh)</td>
      <td id="fuelUnits">0</td>
      <td  id="fuelRate">0.14</td>
      <td id="fuelAmt">0</td>
    </tr>
    <tr class="total">
      <td colspan="3">TOTAL BILL AMOUNT</td>
      <td id="grandTotal">0</td>
    </tr>
  </table>

   <p style="max-width:300px; text-align:center; margin:10px 0 20px; font-size:14px; line-height:1.5; color: red;">
     *All Rate as per Uttarakhand Power Corporation ltd Monthly Bill August 2025 
    </p>
        </div>
<!--  --------------------------------------------------------------------------------------------------------------------------------------------------------- -->


<!--  --------------------------------------------------------------------------------------------------------------------------------------------------------- -->

<!-- Panel 2 -->
 <div id="2" class="contentEMS">

  <div class="LRScontainer">
    <h2>üìä Smart Loan Calculator</h2>
    <label>Loan Name:</label>
   <textarea id="loanName" placeholder="Enter Loan Name" rows="2" style="width:100%; resize:vertical;"></textarea>

 <br/> <br/>
    <label>Loan Type:</label>
    <input type="text" id="loanType" placeholder="Enter Loan Type">

     <label>Installment Start Date:*</label>
    <input type="date" id="startDate">
 <br/><br/>

    <label>Loan Amount (‚Çπ):*</label>
    <input type="number" id="loan" placeholder="Enter loan amount">

     <label>EMI (‚Çπ):*</label>
    <input type="number" id="emi" placeholder="Enter EMI">

    <label>No. of Months:*</label>
    <input type="number" id="months" placeholder="Enter number of months">

 <br/><br/>

    <label>R.O.I (%):*</label>
    <div style="display:flex; gap:10px;">
      <input type="number" step="0.01" id="rate" placeholder="Enter rate">

      <select id="rateType" style="width: 1.5in;">
        <option value="annual">Annual (% p.a.)</option>
        <option value="monthly">Monthly (% per month)</option>
      </select>
    </div>

 <br/> <br/>
    <div class="btn-row">
      <button onclick="autoCalculate()">üîÑ Calculate</button>
      <button class="reset-btn" onclick="resetFORM()">‚ôª Reset</button>
      <button onclick="generateLRSschedule()">üìë Show Repayment LRSschedule</button>
    </div>

    <div class="error" id="error"></div>

    <div class="LRSschedule" id="LRSschedule">

       <span style="color:rgb(246, 156, 156);font-size:130%;font-family:Magneto;">eS |</span> 
  <span style="color:#a0d0f0;font-size:130%;font-family:Magneto;">MTally</span>
  <br/>
      <h3>üìë Repayment LRSschedule</h3>
      <div id="LRSscheduleTable"></div>
<button class="printLRSbtn" onclick="printLRSschedule()">üñ® Print LRSschedule</button>

    </div>
  </div>

 </div>
<!--  --------------------------------------------------------------------------------------------------------------------------------------------------------- -->




<!-- Panel 3 -->
 <div id="3" class="contentEMS">


   <div class="scheduleLR" id="scheduleLR">
      <h3>üìë Repayment schedule</h3>
      <button onclick="printLoanSummaryAndSchedule()">üñ® Print Repayment Schedule</button> <br/>
      <div id="scheduleLRTable"></div>
    </div>

    <button onclick="printLoanBalance()">üñ® Print Loans Overview</button>
    <div id="loanbalance"></div>

<br/><br/><br/><br/>
 </div>
<!--  --------------------------------------------------------------------------------------------------------------------------------------------------------- -->


<!-- Panel 4 -->
 <div id="4" class="contentEMS">

<!-- SEARCH INPUT -->
<input type="text" id="searchEVENTInput" placeholder="Search..." 
       style="padding:6px;width:100%;border-radius:6px;border:1px solid #999;margin:10px 0;" />

<!-- DROPDOWN -->
<div id="eventDropdown" 
     style="display:none;border:1px solid #ccc;border-radius:6px;padding:5px;background:#fff;position:relative;z-index:99;">
</div>
<!-- NOTES SHOW DIV -->
<div id="eventDetails" style="margin-top:10px;font-weight:bold;color:#444; background-color: white;"></div>


 </div>
<!--  --------------------------------------------------------------------------------------------------------------------------------------------------------- -->


<!--  --------------------------------------------------------------------------------------------------------------------------------------------------------- -->

<!-- Panel 5 -->
 <div id="5" class="contentEMS">


    <style>
     
        .absent { color: red; font-weight: bold; }
        .pwl { color: rgb(0, 122, 131);  }
        select { padding: 8px; margin-right: 10px; }
    </style>
</head>
<body>

<h4>Employees Attendance</h4>


<div  style="display: flex; gap: 8px;  border-bottom:5px solid #00462e;  flex-wrap: wrap; justify-content: center; margin-bottom: 10px; background-color: rgb(8, 161, 128); padding: 1px 1px; ">


<select id="monthPRLSelect" onchange="showPayroll()" style="background-color: rgb(8, 161, 128);color: white; font-size: 16px;  border-radius: 8px; border: none;"></select>


<select id="viewType" onchange="showPayroll()" style="background-color: rgb(8, 161, 128);color: white; font-size: 16px;  border-radius: 8px; border: none;">
    <option value="pa">P/A Wise</option>
    <option value="time">In Time Wise</option>
</select>

<button onclick="printPayroll()" style="background-color: rgb(8, 161, 128) ; color: rgb(248, 224, 224); border: none; font-weight: bold;"> Print</button>

</div>

<div id="attendancePRLTable"></div>


 </div>
<!--  --------------------------------------------------------------------------------------------------------------------------------------------------------- -->




</div> </div>  <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections15 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->



    
    </div>  <!-- sections Div close-->
  </div>  <!-- Dashboard div open -->
<!-- ============================================== sections stop =============================================================== -->
<!-- Dashboard div stop !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->






<!-- ==============================================footer start================================================================================ -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fixed Footer Example</title>
  <style>

  .footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: #000000;
    color: white;
   
    text-align: center;
    padding: 0; /* Remove padding */
    font-size: 14px;
    z-index: 1000;
    box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.3);
   
  }

  .footer table {
    margin: 0;               /* Remove default table margin */
    padding: 0;              /* Remove default table padding */
    border-spacing: 0;       /* Remove spacing between table cells */
    border-collapse: collapse; /* Optional: tighter table */
    width: 100%;  
    
          
  }

  .footer td {
     padding: 5px 10px; /* Top-Bottom = 0, Left-Right = 10px gap */
  }
</style>

</head>
<body>


  <div class="footer" >   <!-- footer div start---- -->



     

      <div id="section5b" class="section hidden" style="background-color: #d7d9dc;">  <!-- section5B content START hare ****-->
        

      
      </div> <!-- section5B content stop hare ****-->



<!-- section9B content start hare *********************************************************************************************************-->
 <div id="section9b" class="section hidden">
        
        
<style>
      #divsrr {
            position: sticky;
            top: 0;
           left: 0;
      width: 100%;
      background: #ebecec;
      padding: 10px 20px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1000;
      color: #000;
        }

        .divsrr select,
    .divsrr input,   .divsrr date  {
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }
       
      </style>
      <div id="divsrr">

        
  <blink> <span style="color:rgb(1, 60, 60);font-size:120%;font-family:Arial Black;" id="resultDiv">Store Ragister Voucher</span> </blink> <br/>
        <label for="fromSRRDate">From: </label>
        <input type="date" id="fromSRRDate">
      
        <label for="toSRRDate">To: </label>
        <input type="date" id="toSRRDate">
      
        <button onclick="filterByDate()">Filter by Date</button>
        <button id="printButton" onclick="printSRRTable()">Print</button>

        <a href="https://m5792.github.io/esmTally/PAYROLL.html" target="_blank" style="color:rgb(1, 41, 1); text-align: center; font-size: 100%;">Payroll</a>

      </div>
      
     
</div>  <!-- section9B content stop hare *******************************************************************-->




<!-- section14B content start hare *********************************************************************************************************-->
 <div id="section14b" class="section hidden">
  <blink><span style="color:#012760;font-size:120%;font-family:Arial Black;">Chander Shekher</span> </blink><br/>      
    
<div id="summaryRow" style="display: flex; justify-content: center; gap: 30px; font-weight: bold; font-size: 16px; color: black;">
  
  <div id="totalWeightDiv"></div>
  <div id="totalAmountDiv"></div>
  <div id="retentionDiv"></div>
  <div id="tdsSKHRDiv"></div>
  <div id="billAmountDiv"></div>
</div>

     
</div>  <!-- section14B content stop hare *******************************************************************-->














<div style="display: flex; justify-content: center; align-items: center; background-color: #f7f8fa; color: rgb(1, 1, 1); font-size: 12px; font-weight: bold;  border: 5px solid #003444; ">
  
  <!-- Current Time -->
  <div id="currentDateTime" style="padding: 5px 10px; white-space: nowrap; font-size: 16px; background-color: blue; color: white; "></div>

 

   <marquee behavior="left" direction="RIG" scrollamount="5">
  <span id="todayEvent" style="color: rgb(0, 65, 69);font-weight: bold;font-size: 14px; "></span>
  </marquee>

    <span id="reportauth" style="color: #f7f8fa;"></span>
  <span id="username" style="color: #f7f8fa;font-size: 12px;"></span>

</div>
 
<!-- ============ website open navgation buttan code start start  ========= -->  
<style>
    :root{ --gap:5px; --btn-bg:#1e1d1d; --btn-border:#6a6a6a; --radius:10px; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; }
  
    .row{ display:flex; gap:var(--gap); align-items:center; flex-wrap:wrap; justify-content: center;}

    .item{ display:flex; align-items:center; gap:10px; padding:4px 12px; background:var(--btn-bg); border:1px solid var(--btn-border); border-radius:var(--radius); box-shadow:0 6px 18px rgba(0,0,0,0.05); text-decoration:none; color:#111; }
    .item img{ width:25px; height:25px; object-fit:cover; border-radius:8px; }
    .name{ font-weight:700; font-size:14px; color: white;}

    @media (max-width:560px){ .row{ width:100%; flex-direction:column; align-items:stretch; } .item{ width:100%; } }
  </style>
</head>
<body>
  <nav class="row" aria-label="Quick image links" style=" border: 3px solid #ffffff; padding: 5px 10px;">


     <!-- Google (favicon used as image) -->
    <a class="item" href="https://www.google.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://cdn.dribbble.com/users/1717214/screenshots/4124610/g-logo.gif" alt="Google" width="50" height="50" />
      <span class="name">Google</span>
    </a>

     <!-- Gmail (favicon used as image) -->
    <a class="item" href="https://mail.google.com/mail/u/0/" target="_blank" rel="noopener noreferrer">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSjpEIz6vZxfKx_cLh8Y6tDWalIuwi08MCggUEXk8cXLAy8NUilIHwNgrsjtFIxgEWCWAE&usqp=CAU" alt="Google" width="50" height="50" />
      <span class="name">Gmail</span>
    </a>

     <!-- zoho (favicon used as image) -->
    <a class="item" href="https://accounts.zoho.in/signin?servicename=VirtualOffice&signupurl=https://www.zoho.com/mail/zohomail-pricing.html&serviceurl=https://mail.zoho.in" target="_blank" rel="noopener noreferrer">
      <img src="https://zenatta.com/wp-content/uploads/2020/08/mail-256-300x300.png" alt="zoho" width="50" height="50" />
      <span class="name">Zoho Mail</span>
    </a>

      <!-- youtube (favicon used as image) -->
    <a class="item" href="https://www.youtube.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://cliply.co/wp-content/uploads/2019/07/371907120_YOUTUBE_ICON_TRANSPARENT_400.gif" alt="Google" width="50" height="50" />
      <span class="name">YouTube</span>
    </a>

       <!-- pnb natbanking (favicon used as image) -->
    <a class="item" href="https://ibanking.pnb.bank.in/" target="_blank" rel="noopener noreferrer">
      <img src="https://i0.wp.com/www.logotaglines.com/wp-content/uploads/2016/08/Punjab-National-Bank-Logo.jpg?resize=400%2C391" alt="pnb" width="50" height="50" />
      <span class="name">PNB Netbanking</span>
    </a>

       <!-- hdfc natbanking (favicon used as image) -->
    <a class="item" href="https://netbanking.hdfcbank.com/netbanking/" target="_blank" rel="noopener noreferrer">
      <img src="https://p.kindpng.com/picc/s/284-2843275_online-donation-shri-ramakrishna-ashrama-rajkot-using-hdfc.png" alt="hdfc" width="50" height="50" />
      <span class="name">HDFC Netbanking</span>
    </a>

       <!-- sbi natbanking (favicon used as image) -->
    <a class="item" href="https://retail.onlinesbi.sbi/retail/login.htm" target="_blank" rel="noopener noreferrer">
      <img src="https://image3.mouthshut.com/images/ImagesR/2015/12/State-Bank-Anywhere-925771560-7182350-1.png" alt="sbi" width="50" height="50" />
      <span class="name">SBI Netbanking</span>
    </a>

    <!-- WhatsApp (user-provided gif) -->
    <a class="item" href="https://web.whatsapp.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://cliply.co/wp-content/uploads/2021/08/372108180_WHATSAPP_ICON_400.gif" alt="WhatsApp" width="50" height="50" />
      <span class="name">WhatsApp</span>
    </a>

    <!-- Facebook (user-provided gif) -->
    <a class="item" href="https://www.facebook.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExNTZuaHQ1ZjdnajNwMWtrZHVhN3Q4djdwMDZmYWZuYzRoYTA0Ymx4MiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/IeRI0TleieCJ6ytPUr/giphy.gif" alt="Facebook" width="50" height="50" />
      <span class="name">Facebook</span>
    </a>

   

    <!-- Chat GPT (favicon) -->
    <a class="item" href="https://chatgpt.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://static.vecteezy.com/system/resources/previews/022/841/114/original/chatgpt-logo-transparent-background-free-png.png" alt="Gmail" width="50" height="50" />
      <span class="name">Chat GPT</span>
    </a>

    <!-- html ( favicon) -->
    <a class="item" href="https://m5792.github.io/esmTally/AFI.html" target="_blank" rel="noopener noreferrer">
      <img src="https://cdn-icons-png.flaticon.com/512/1197/1197396.png" alt="PNB Netbanking" width="50" height="50" />
      <span class="name">AFI Dashboard</span>
    </a>

     <!-- gst login ( favicon) -->
    <a class="item" href="https://services.gst.gov.in/services/login" target="_blank" rel="noopener noreferrer">
      <img src="https://cdn.uxhack.co/product_logos/gstn_logo.jpg" alt="gst" width="50" height="50" />
      <span class="name">GST Login</span>
    </a>

       <!-- eway bill login ( favicon) -->
    <a class="item" href="https://ewaybillgst.gov.in/Login.aspx" target="_blank" rel="noopener noreferrer">
      <img src="https://bizdesk.in/wp-content/uploads/2019/11/E-Way-Bills-as-Per-New-GST-Rules.png" alt="gst" width="50" height="50" />
      <span class="name">Eway Login</span>
    </a>


  </nav>

  <!-- small script: open links with Enter when focused for accessibility -->
  <script>
    document.querySelectorAll('.item').forEach(el=>{
      el.addEventListener('keydown', e=>{ if(e.key === 'Enter' || e.key === ' ') el.click(); });
    });
  </script>
<!-- ============ website open navgation buttan code start stop  ========= -->



   <!-- Current date and time will be displayed here -->
            
<meta name="viewport" content="width=device-width, initial-scale=1.0">
            

 
<script>
function displayCurrentDateTime() {
const now = new Date();

// Formatting options
const options = { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric', 
    hour: '2-digit', 
    minute: '2-digit', 
    second: '2-digit' 
};

// Formatting date and time
const formattedDateTime = now.toLocaleString('en-US', options);

// Displaying in the div
document.getElementById("currentDateTime").textContent = `Today: ${formattedDateTime}`;
}

// Call the function on page load to show the current date and time
displayCurrentDateTime();

// Update the date and time every second
setInterval(displayCurrentDateTime, 1000);
</script>
<!-- Current date and time will be displayed Stop -->

  </div>    <!-- footer div stop---- -->

</body>
</html>
<!-- ==============================================footer stop================================================================================ -->






<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, -------------------------  SCRIPT AND CODE START----------------------------------------- -->
      
<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) code start  Heare  (CODE501) -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>70-30 Split</title>
    <style>
        .container {
            display: flex;
           

            flex-direction: row; /* Arrange child divs side-by-side (flex-direction: column;) */

          /*  flex-direction: column;  Arrange child divs vertically */
            height: 83vh; /* Full viewport height */
        }
      .left {
    flex: 2; /* 70% */
    background-color: #dddedf;
      border: 7px solid #004d80;
      padding: 10px;
      z-index: 99;
      overflow-y: auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      border-radius: 8px;
}

.right {
    flex: 8; /* 30% */
    background-color: #eaeaea;
    padding: 20px;
    overflow: auto; /* Scroll content if it overflows */
}
    </style>


 <style>
        .container2 {
            display: flex;
           

            flex-direction: row; /* Arrange child divs side-by-side (flex-direction: column;) */

          /*  flex-direction: column;  Arrange child divs vertically */
            /*  height: 48vh;   Full viewport height */
        }
      .leftdiv {
    flex: 5.4; /* 70% */
    background-color: #e7eef5;
      border: 3px solid #004d80;
      padding: 10px;
      z-index: 99;
      overflow-y: auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      border-radius: 8px;
   
}

.rightdiv {
    flex: 4.6; /* 30% */
    background-color: #eaeaea;
    border: 3px solid #004d80;
      padding: 10px;
      z-index: 99;
    overflow: auto; /* Scroll content if it overflows */
    border-radius: 8px;
}
    </style>
</head>
<body>
</body> </html>
  <!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, vertical Two Part Div (30-70) code stop  Heare -->









<!-- =============== today events script start ===================== -->

<script>
const apiEVENTKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheetEVENTId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
const rangeEVENT = "HOLIDAY!A:D"; // A=Type, B=Name, C=Date, D=Optional Notes

function convertToDate(str) {
    const [d, m, y] = str.split("-");

    const mon = {
        Jan:0, Feb:1, Mar:2, Apr:3, May:4, Jun:5,
        Jul:6, Aug:7, Sep:8, Oct:9, Nov:10, Dec:11
    }[m];

    if (mon === undefined) return null;

    let year = Number(y);

    // allow "yy" and "yyyy"
    if (year < 100) year = 2000 + year;

    return new Date(year, mon, Number(d));
}

async function loadTodayEvent() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetEVENTId}/values/${rangeEVENT}?key=${apiEVENTKey}`;

    try {
        const response = await fetch(url);
        const data = await response.json();
        const rows = data.values || [];

        let todayEvents = [];
        let yearlyRemaining = [];
        let monthlyRemaining = [];

        const today = new Date();
        today.setHours(0,0,0,0);
        const today_dd = today.getDate();
        const today_mm = today.getMonth();
        const today_yy = today.getFullYear();

        rows.forEach(row => {
            const type = row[0]; 
            const name = row[1];
            const dateStr = row[2];

            if (!dateStr || !name) return;

            let eventDate = convertToDate(dateStr);
            if (!eventDate) return;

            eventDate.setHours(0,0,0,0);

            // --- YEARLY EVENTS ---
            if (type === "Yearly") {
                eventDate.setFullYear(today_yy);
                const diffDays = Math.floor((eventDate - today) / (1000*60*60*24));

                if (diffDays === 0) todayEvents.push(name);
                if (diffDays === 1 || diffDays === 2) {
                    yearlyRemaining.push(
                        `<span style="color:grey"> ‚ú® <span style="color:red">${diffDays} Days Left ‚Äì</span> ${name}</span>`
                    );
                }
            }

            // --- MONTHLY EVENTS ---
            if (type === "Monthly") {
                const eventDay = eventDate.getDate();
                let diffDays = eventDay - today_dd;

                if (diffDays < 0)
                    diffDays += new Date(today_yy, today_mm + 1, 0).getDate();

                if (diffDays === 0) todayEvents.push(name);
                if (diffDays === 1 || diffDays === 2) {
                    monthlyRemaining.push(
                        `<span style="color:#026c96"> ‚ú¶ <span style="color:red">${diffDays} Days Left ‚Äì</span> ${name}</span>`
                    );
                }
            }

            // --- SINGLE EVENT (Exact Date: dd-mm-yyyy) ---
            if (type === "Event") {
                if (
                    eventDate.getDate() === today_dd &&
                    eventDate.getMonth() === today_mm &&
                    eventDate.getFullYear() === today_yy     // FIX Added
                ) {
                    todayEvents.push(name);
                }
            }
        });

        let finalOutput = [];

        if (todayEvents.length > 0) {
            finalOutput.push(
                `<span>‚ú≠ <strong>Today: </strong> ${todayEvents.join(" ‚ú® ")} ‚ú≠</span>`
            );
        }

        if (yearlyRemaining.length > 0) 
            finalOutput = finalOutput.concat(yearlyRemaining);

        if (monthlyRemaining.length > 0) 
            finalOutput = finalOutput.concat(monthlyRemaining);

        document.getElementById("todayEvent").innerHTML =
            finalOutput.length > 0 ? finalOutput.join(" | ") : "";

    } catch (err) {
        console.error(err);
        document.getElementById("todayEvent").innerHTML = "Error loading events";
    }
}

loadTodayEvent();



/* ===================================================================
   üîµ INDEPENDENT SEARCH FUNCTIONS (NO MIXING WITH OLD SCRIPT)
=================================================================== */

let EVENT_DATA = []; // ONLY for search dropdown, NOT used by old script

// Load only for search dropdown
async function loadEventSearchData() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetEVENTId}/values/${rangeEVENT}?key=${apiEVENTKey}`;

    try {
        const response = await fetch(url);
        const data = await response.json();
        EVENT_DATA = data.values || [];

    } catch (err) {
        console.error("Search data load error:", err);
    }
}

loadEventSearchData(); // Run ONLY for search feature


/* ===================================================================
   üîµ SEARCHABLE DROPDOWN (FULLY SEPARATE FUNCTION)
=================================================================== */

const searchInput = document.getElementById("searchEVENTInput");
const dropdown = document.getElementById("eventDropdown");
const eventDetails = document.getElementById("eventDetails");

searchInput.addEventListener("keyup", () => {
    let q = searchInput.value.trim().toLowerCase();
    dropdown.innerHTML = "";

    if (q.length < 1) {
        dropdown.style.display = "none";
        return;
    }

    let filtered = EVENT_DATA.filter(row => {
        let name = row[1] ? row[1].toLowerCase() : "";
        let date = row[2] ? row[2].toLowerCase() : "";
        return name.includes(q) || date.includes(q);
    });

    if (filtered.length === 0) {
        dropdown.style.display = "none";
        return;
    }

    dropdown.style.display = "block";

    filtered.forEach(row => {
        let name = row[1];
        let date = row[2];
        let notes = row[3] || "";

        let item = document.createElement("div");
        item.style.padding = "6px";
        item.style.cursor = "pointer";
        item.style.borderBottom = "1px solid #eee";

        item.innerHTML = `<strong>${name}</strong> <span style="color:#888">(${date})</span>`;

        item.onclick = () => {
            searchInput.value = name;
            dropdown.style.display = "none";
            eventDetails.innerHTML = `<span style="color:#c20;font-size:14px;">${notes}</span>`;
        };

        dropdown.appendChild(item);
    });
});
//******************
</script>


<!-- =============== today events script stop ===================== -->


  
<!-- daybook serchbar script start (CODE502) -->


<!DOCTYPE html>
<html>
<head>
    <title>MIPL SEARCH</title>
    <style>
      
        #searchContainer {
           padding: 5px 10px;
            top: 0;
            background: #026186;
          padding: auto;
            border-bottom: 2px solid #263054;
            z-index: 1000;
         
        }
        #searchBar, #dateFilter {
            padding: 5px;
            margin: 5px 0;
            width: 30%;
            box-sizing: border-box;
            border: 2px solid #d4ac0d ;
            border-radius: 4px;
        }
        #totals {
            padding: 1px;
            background: #f9fafa;
            color: black;
            border-bottom: 2px solid #fafbfc;
            border: 2px solid #0f0f0f ;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            
        }
        
        #printButton {
            position: absolute;
           
            right: 100px;
            padding: 8px;
            background: #026186;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        #printButton:hover {
            background: #0c0c0c;
        }
        

        tr.hidden {
            display: none;
        }
        tr.blue {
            color: #bb0101;
        }
        tr.red {
            color: #7a0192;
        }

	tr.yellow {
            color: #0026ff;
        }

        #miplTable.hidden {
            display: none;
        }
        table {
            overflow-x: auto;
            display: block;
        }

        /* Print-specific styles */
        @media print {
            body {
                font-family: "Times New Roman", serif;
                background-color: #fff;
                padding: 0;
            }
            #searchContainer, #printButton {
                display: none;
            }
            #totals, #difference {
                font-size: 18px;
                margin-bottom: 10px;
            }
            table, th, td {
                border: 1px solid #000;
                border-collapse: collapse;
                font-size: 10PX;
            }
            th, td {
                padding: 10px;
                text-align: left;
                font-size: 14px;
            }
            tr.hidden {
                display: table-row;
            }
        }
    </style>
    
    


</head>



<!-- daybook serchbar script stop  (CODE502)-->







 
 <!-- monthly sale & receipt Script & code Start Heare  (CODE504)  --> 
 

    <script>
// -------------------- Onload --------------------
window.onload = () => {

    jobbPOReffload();
    loadIVCRSheet();
    filterSKHR();
    fetchUserData();
    filterDp();
    document.getElementById("designUSER").value = "CREAT";
    showForm("CREAT");  
};
    </script>



<!-- monthly sale & receipt Script & code stop  Heare  (CODE504)--> 




<!-- ============== CASH LEDGER REPORT (5792) SCRIPT START HARE ================= -->
<style>
  #search5792Bar {
    background-color: #424242;
    width: 100%;
    display: flex;
    align-items: center;
    padding: 10px;
    flex-wrap: wrap;
    gap: 10px;
    box-sizing: border-box;
  }

  #search5792Input {
    flex: 1;
    background-color: #fdfdf6;
    border: none;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 14px;
    outline: none;
  }

  #search5792Bar label { font-weight: bold; color: rgb(247, 244, 244); margin-left: 10px;}
  #search5792Bar input[type="date"] { padding: 4px 6px; border-radius: 4px;border: 1px solid #ccc; font-size: 14px;}


.dp5792 { position: absolute;top: 80px;left: 0; right: 0;background: white; border: 6px solid #280101;height: 700px; width: 500px;overflow-y: auto; display: none; z-index: 100;background-color: #e4e4e6;}
.dp5792 div { padding: 6px; cursor: pointer;}
.dp5792 div:hover { background: #e8cd36; color: rgb(1, 3, 30);font-weight: bold;}

</style>



<script>
const api5792Key = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheet5792Id = "1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0";
const range5792 = "FORM!A:G";

let all5792Data = [];
let filtered5792Data = [];

// ‚úÖ Convert "7-Oct-2025" ‚Üí Date object
function parseCustomDate(dateStr) {
  if (!dateStr) return null;
  const parts = dateStr.split("-");
  if (parts.length !== 3) return null;
  const day = parseInt(parts[0]);
  const monthStr = parts[1].toLowerCase().substring(0, 3);
  const year = parseInt(parts[2]);
  const months = {
    jan: 0, feb: 1, mar: 2, apr: 3, may: 4, jun: 5,
    jul: 6, aug: 7, sep: 8, oct: 9, nov: 10, dec: 11
  };
  const month = months[monthStr];
  if (isNaN(day) || isNaN(year) || month === undefined) return null;
  return new Date(year, month, day);
}

// ‚úÖ Fetch Google Sheet Data
// ‚úÖ Fetch Google Sheet Data (skip rows where column B == "DLT")
async function fetch5792Data() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet5792Id}/values/${range5792}?key=${api5792Key}`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    let rows = data.values || [];

    // üîπ Skip header row (first row)
    const header = rows[0];
    const filtered = rows.slice(1).filter(row => (row[1] || "").trim().toUpperCase() !== "DLT");

    // üîπ Combine header + filtered rows
    const finalData = [header, ...filtered];
    return finalData;
  } catch (err) {
    console.error("Error fetching data:", err);
    return [];
  }
}

// ‚úÖ Process Rows (convert only JNP ‚Üí MA)
function processRows(rows) {
  if (!rows || rows.length < 2) return [];
  const headers = rows[0];

  let data = rows.slice(1).map(r => {
    let obj = {};
    headers.forEach((h, i) => obj[h] = r[i] || "");
    obj._serial = parseFloat(r[0]) || 0;
    obj._user = (r[1] || "").trim().toUpperCase();
    obj._type = (r[2] || "").trim().toLowerCase();
    obj._dateStr = r[3] || "";
    obj._date = parseCustomDate(r[3]);
    obj._ledger = r[4] || "";
    obj._amount = parseFloat(r[5]) || 0;

    // ‚úÖ Only JNP ‚Üí MA (JNR unaffected)
      if (obj._user === "JNP") obj._user = "MA";

    // ‚úÖ Convert JNP & JNR ‚Üí MA
//  if (obj._user === "JNP" || obj._user === "JNR") {
  //  obj._user = "MA";
//    }


    return obj;
  });

  data.sort((a, b) => b._serial - a._serial);
  return data;
}

// ‚úÖ Render Table + Color Formatting
function render5792Table(data) {
  const container = document.getElementById("table5792Container");
  if (!data.length) {
    container.innerHTML = "<p>No records found.</p>";
    return;
  }

  // ‚úÖ Ensure each record has parsed date before sorting  ---------------
  data.forEach(r => {
    if (!r._date && r["Date"]) {
      const d = r["Date"].trim();
      const parts = d.split("-");
      if (parts.length === 3) {
        const day = parseInt(parts[0]);
        const mon = parts[1].substring(0, 3).toLowerCase();
        const yr = parseInt(parts[2]);
        const months = {
          jan: 0, feb: 1, mar: 2, apr: 3, may: 4, jun: 5,
          jul: 6, aug: 7, sep: 8, oct: 9, nov: 10, dec: 11
        };
        r._date = new Date(yr, months[mon], day);
      } else {
        r._date = null;
      }
    }
  });

  // ‚úÖ Sort by date descending (latest ‚Üí oldest)
  data.sort((a, b) => {
    const da = a._date ? a._date.getTime() : 0;
    const db = b._date ? b._date.getTime() : 0;
    return db - da;
  });
//----- DATE WISE TABLE SHORT ----------------


  const headers = Object.keys(data[0]).filter(h => !h.startsWith("_"));
  const html = `
    <table id="my5792Table" border="1" style="border-collapse:collapse;width:100%;font-size:14px;">
      <thead style="background:#004d80;color:white;">
        <tr>${headers.map(h => `<th>${h}</th>`).join("")}<th>Running Balance</th></tr>
      </thead>
      <tbody>
        ${data.map(r => {
          let color = "";
          const type = r._type.toLowerCase();
          if (type === "receipt") color = "red";
          else if (type === "salary") color = "blue";
          else if (type === "billdr") color = "green";

          return `
            <tr style="color:${color};">
              ${headers.map(h => `<td>${r[h]}</td>`).join("")}
              <td class="runningBalance"></td>
            </tr>`;
        }).join("")}
      </tbody>
    </table>
  `;
  container.innerHTML = html;

  // ‚úÖ Ensure "JNP" converted to "MA" even after render
  const rows = container.querySelectorAll("#my5792Table tbody tr");
  rows.forEach(row => {
    const userCell = row.cells[1];
    if (!userCell) return;
    const val = userCell.textContent.trim().toUpperCase();
  //  if (val === "JNP") userCell.textContent = "MA"; // Only JNP ‚Üí MA

if (val === "JNP" || val === "JNR") {
    userCell.textContent = "MA";
}


  });
  //------------------
  calculate5792RunningBalance();
}

// ‚úÖ Calculate Running Balance
function calculate5792RunningBalance() {
  const rows = Array.from(document.querySelectorAll('#my5792Table tbody tr'));
  if (rows.length === 0) return;

  const lastRow = rows[rows.length - 1];
  const lastCells = lastRow.querySelectorAll('td');
  const lastType = lastCells[2]?.textContent.trim().toLowerCase();
  const lastAmount = parseFloat(lastCells[5]?.textContent || 0);

  const creditTypes = ["receipt", "salary", "billcr"];
  let runningBalance = creditTypes.includes(lastType) ? lastAmount : -lastAmount;

  lastRow.querySelector('.runningBalance').textContent = runningBalance.toFixed(2);

  for (let i = rows.length - 2; i >= 0; i--) {
    const cells = rows[i].querySelectorAll('td');
    const type = cells[2]?.textContent.trim().toLowerCase();
    const amount = parseFloat(cells[5]?.textContent || 0);

    if (!isNaN(amount)) {
      if (creditTypes.includes(type)) {
        runningBalance += amount;
      } else if (["payment", "billdr"].includes(type)) {
        runningBalance -= amount;
      }
    }
    rows[i].querySelector('.runningBalance').textContent = runningBalance.toFixed();
  }
}

// ‚úÖ Apply Filters (Search + Ledger + User + Date)
function apply5792Filters() {
  const searchVal = document.getElementById("search5792Input")?.value.toLowerCase() || "";
  const ledgerVal = document.getElementById("ledger5792Input")?.value.toLowerCase() || "";
  const userVal = document.getElementById("user5792")?.value || "";
  const startDateStr = document.getElementById("start5792Date")?.value;
  const endDateStr = document.getElementById("end5792Date")?.value;

  const startDate = startDateStr ? new Date(startDateStr) : null;
  const endDate = endDateStr ? new Date(endDateStr) : null;

  filtered5792Data = all5792Data.filter(row => {
    const rowDate = row._date;
    if (!rowDate) return false;

    const rowTime = rowDate.setHours(0, 0, 0, 0);
    const startTime = startDate ? startDate.setHours(0, 0, 0, 0) : null;
    const endTime = endDate ? endDate.setHours(0, 0, 0, 0) : null;

    // ‚úÖ Start date inclusive
    const inDateRange =
      (!startTime || rowTime >= startTime) &&
      (!endTime || rowTime <= endTime);

    const matchesUser = !userVal || row._user === userVal;
    const matchesLedger = !ledgerVal || (row._ledger || "").toLowerCase().includes(ledgerVal);
    const matchesSearch = !searchVal || Object.values(row)
      .some(v => String(v).toLowerCase().includes(searchVal));

    return inDateRange && matchesUser && matchesLedger && matchesSearch;
  });

  filtered5792Data.sort((a, b) => b._serial - a._serial);
  render5792Table(filtered5792Data);
}

// ‚úÖ Ledger Dropdown Setup
function setupLedger5792Dropdown() {
  const ledgerInput = document.getElementById("ledger5792Input");
  const dropdown = document.getElementById("ledger5792Dropdown");
  if (!ledgerInput || !dropdown) return;

  // ‚úÖ Create sorted ledger list
  const ledgers = [...new Set(all5792Data.map(r => r._ledger).filter(Boolean))].sort((a, b) =>
    a.localeCompare(b)
  );

  // ‚úÖ On input ‚Üí filter dropdown
  ledgerInput.addEventListener("input", () => {
    const value = ledgerInput.value.trim().toLowerCase();
    dropdown.innerHTML = "";

    const matches = value
      ? ledgers.filter(l => l.toLowerCase().includes(value))
      : ledgers; // if no input, show all

    matches.forEach(item => {
      const div = document.createElement("div");
      div.textContent = item;
      div.style.padding = "4px";
      div.style.cursor = "pointer";
      div.onclick = () => {
        ledgerInput.value = item;
        dropdown.style.display = "none";
        apply5792Filters();
      };
      dropdown.appendChild(div);
    });

    dropdown.style.display = matches.length ? "block" : "none";
  });

  // ‚úÖ On focus (click on input) ‚Üí show full dropdown
  ledgerInput.addEventListener("focus", () => {
    dropdown.innerHTML = "";
    ledgers.forEach(item => {
      const div = document.createElement("div");
      div.textContent = item;
      div.style.padding = "4px";
      div.style.cursor = "pointer";
      div.onclick = () => {
        ledgerInput.value = item;
        dropdown.style.display = "none";
        apply5792Filters();
      };
      dropdown.appendChild(div);
    });
    dropdown.style.display = ledgers.length ? "block" : "none";
  });

  // ‚úÖ Hide dropdown when clicked outside
  document.addEventListener("click", e => {
    if (!ledgerInput.contains(e.target) && !dropdown.contains(e.target)) {
      dropdown.style.display = "none";
    }
  });
}
//-------------------------------------------------------


// ‚úÖ Setup Event Listeners
function setup5792Events() {
  document.getElementById("search5792Input")?.addEventListener("input", apply5792Filters);
  document.getElementById("user5792")?.addEventListener("change", apply5792Filters);
  document.getElementById("start5792Date")?.addEventListener("change", apply5792Filters);
  document.getElementById("end5792Date")?.addEventListener("change", apply5792Filters);
}

// ‚úÖ Refresh Function (Reload All)
async function refresh5792Table() {
  document.getElementById("search5792Input").value = "";
  document.getElementById("ledger5792Input").value = "";
  document.getElementById("user5792").value = "";
  document.getElementById("start5792Date").value = "";
  document.getElementById("end5792Date").value = "";
  const rows = await fetch5792Data();
  all5792Data = processRows(rows);
  filtered5792Data = [...all5792Data];
  render5792Table(all5792Data);
  setupLedger5792Dropdown();
}

// ‚úÖ Print Function
// ‚úÖ Print Function (with Ledger Name condition)
function print5792Table() {
  const table = document.getElementById("my5792Table");
  if (!table) {
    alert("No table data to print!");
    return;
  }

  // üîπ Ledger name fetch karo
  const ledgerName = document.getElementById("ledger5792Input")?.value.trim() || "";
  let ledgerHTML = "";
  if (ledgerName) {
    ledgerHTML = `<h4 style="text-align:center; margin-top:-10px;">Ledger: ${ledgerName}</h4>`;
  }

  const printWindow = window.open("", "_blank");
  printWindow.document.write(`
    <html>
      <head>
        <title>Print Table</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          table { width:100%; border-collapse:collapse; font-size:14px; }
          th, td { border:1px solid #444; padding:6px; text-align:left; }
          th { background:#004d80; color:white; }
          h3, h4 { text-align:center; }
        </style>
      </head>
      <body>
        <h3>Cash Ledger Report</h3>
        ${ledgerHTML}
        ${table.outerHTML}
      </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.print();
}


// ‚úÖ Initialize
document.addEventListener("DOMContentLoaded", async () => {
  const rows = await fetch5792Data();
  all5792Data = processRows(rows);
  filtered5792Data = [...all5792Data];
  render5792Table(all5792Data);
  setupLedger5792Dropdown();
  setup5792Events();
});
</script>




<!-- ============== CASH LEDGER REPORT (5792) SCRIPT STOP HARE ================= -->



<!-- IVMA form div script start here -->
<script>
  const scriptIVMAURL = 'https://script.google.com/macros/s/AKfycbz1qX7pBpLSoZRDEUqIs1B-DZCVBuUCYQvGKDPRPwLC4OJY_07Ooi0AI8SzRJbi9yyQWg/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainIVMAForm") return;

    e.preventDefault();
    const formMode = document.getElementById("formModeIVMA").value;
    console.log("Current form mode:", formMode);

    const submitIVMAButton = document.getElementById("submitIVMAButton");
    submitIVMAButton.disabled = true;
    submitIVMAButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampIVMA').value =
      `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    if (formMode === "modify") {
      await modifyIVMAEntry();
    } else {
      await submitIVMAEntry(form);
    }

    submitIVMAButton.disabled = false;
    submitIVMAButton.value = "Submit";
  });

  async function submitIVMAEntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptIVMAURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully! ‚úî');
        form.reset();

        // ‚úÖ Clear mode & sNo after reset
        setTimeout(() => {
          document.getElementById("formModeIVMA").value = "new";
          document.getElementById("sNo").value = "";
          document.getElementById("searchIVMASNo").value = "";
        }, 50);

              // cash user table refresh start--------------------
         
// Re-fetch the data and re-render the table
const raw = await fetchSheetData();
fullData = processRawData(raw);

// Get current filters (if any)
const currentAccountType = document.getElementById("cu123")?.value || "";
const currentLedgerFilter = document.getElementById("msaf54")?.value.trim() || "";

// Re-render the table with current filters
filterAndRender(currentAccountType, currentLedgerFilter);
//  // cash user table refresh stop -------------------------
      
       

        // ‚úÖ Remove DLT option if exists
        const msaf51Dropdown = document.getElementById("msaf51");
        const dltIVMAOption = [...msaf51Dropdown.options].find(opt => opt.value === "DLT");
        if (dltIVMAOption) {
          msaf51Dropdown.removeChild(dltIVMAOption);
        }

      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }

  async function modifyIVMAEntry() {
    const waitMessage = document.getElementById("waitIVMAMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";

    const form = document.getElementById('mainIVMAForm');

    // ‚úÖ Set new timestamp
    const now = new Date();
    document.getElementById('timestampIVMA').value =
      `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptIVMAURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();

        // ‚úÖ Clear mode & sNo after reset
        setTimeout(() => {
          document.getElementById("formModeIVMA").value = "new";
          document.getElementById("sNo").value = "";
          document.getElementById("searchIVMASNo").value = "";
        }, 50);

              // cash user table refresh start-------------------------
         
// Re-fetch the data and re-render the table
const raw = await fetchSheetData();
fullData = processRawData(raw);

// Get current filters (if any)
const currentAccountType = document.getElementById("cu123")?.value || "";
const currentLedgerFilter = document.getElementById("msaf54")?.value.trim() || "";

// Re-render the table with current filters
filterAndRender(currentAccountType, currentLedgerFilter);
//  // cash user table refresh stop --------------------
       
        document.getElementById("submitIVMAButton").style.display = "inline-block";
        document.getElementById("modifyIVMAButton").style.display = "none";

        // ‚úÖ Remove DLT option
        const msaf51Dropdown = document.getElementById("msaf51");
        const dltIVMAOption = [...msaf51Dropdown.options].find(opt => opt.value === "DLT");
        if (dltIVMAOption) {
          msaf51Dropdown.removeChild(dltIVMAOption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function fetchIVMADetails() {
    const sNo = document.getElementById("searchIVMASNo").value;
    const waitMessage = document.getElementById("waitIVMAMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

    try {
      const response = await fetch(`${scriptIVMAURL}?sNo=${sNo}`);
      const data = await response.json();
      

      //**** option value ke base par data fetch krna
const msaf51Dropdown = document.getElementById("msaf51");
const selectedVoucher = msaf51Dropdown.value;

if (data.result !== "error" && data.Voucher === selectedVoucher) {
  document.getElementById("sNo").value = data.SNo;
  msaf51Dropdown.value = data.Voucher;
  document.getElementById("msaf52").value = data.Type;
  document.getElementById("msaf53").value = data.Date;
  document.getElementById("msaf54").value = data.Ledger;
  document.getElementById("msaf55").value = data.Amount;
  document.getElementById("msaf56").value = data.Narration;

  // ‚úÖ Add "DLT - delete" option if not present
  if (![...msaf51Dropdown.options].some(opt => opt.value === "DLT")) {
    const dlt51Option = document.createElement("option");
    dlt51Option.value = "DLT";
    dlt51Option.text = "Delete";
    dlt51Option.style.color = "red";
    dlt51Option.style.backgroundColor = "blue";
    msaf51Dropdown.appendChild(dlt51Option);
  }
 
        //

        // ‚úÖ Switch to modify mode
        document.getElementById("formModeIVMA").value = "modify";

         // ‚úÖ Show alert after successful data fetch
      alert("Select Delete Option in User Section For Delete Entry");

      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }
</script>
<!-- IVMA form div script stop here -->






<!-- ledger dropdown with USER SELECTION ENTRY (cash user) code stop hare -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ledger Table with Running Balance</title>
  <style>
    body {
      font-family: Arial;
    }

    .dropdownWrapper {
      position: relative;
      width: 300px;
    
    }

    .dropdownSearch {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      border: 1px solid #a3a1a1;
      border-radius: 4px;
    }

    .dropdownList {
      list-style: none;
      border: 1px solid #ccc;
      max-height: 5000px;
      width: 3in;
      overflow-y: auto;
      margin: 0;
      padding: 0;
      display: none;
      background: white;
      position: absolute;
      width: 100%;
      z-index: 1000;
      border-radius: 0 0 4px 4px;
    }
/* Style for the entire dropdown container */
  #ledgerDropdown.dropdownList {
    list-style-type: none;
    margin: 0;
    padding: 0;
    position: absolute;
    z-index: 999;
    width: 100%;
    max-height: 500px;
    overflow-y: auto;
    border: 1px solid #ccc;
    background-color: white;
    color: #000;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15);
    font-size: 16px;
    border-radius: 4px;
  }

  /* Style for each dropdown item */
  #ledgerDropdown.dropdownList li {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
    transition: background-color 0.2s ease-in-out;
  }

  /* Highlight on hover */
  #ledgerDropdown.dropdownList li:hover {
    background-color: #007BFF;
    color: white;
   
  }

  /* Optional: remove border from last item */
  #ledgerDropdown.dropdownList li:last-child {
    border-bottom: none;
  }

    .positive {
      color: RED;
      font-weight: bold;
      
    }
  </style>
</head>
<body>

 <script>
  const apiCLKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
  const sheetCLId = "1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0";
  const rangeCL = "FORM!A:G";

  let fullData = [];
  let filteredByAccount = [];

  // ===== Fetch Google Sheet Data =====
  async function fetchSheetData() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetCLId}/values/${rangeCL}?key=${apiCLKey}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      return data.values || [];
    } catch (err) {
      console.error("Error fetching data:", err);
      return [];
    }
  }

  // ===== Process Raw Sheet Rows =====
  function processRawData(rows) {
    return rows.slice(1).map(row => ({
      date: row[0],
      cUser: row[1],
      type: row[1],
      dt: row[3] || "-",
      drcr: row[2],
      ldgr: row[4],
      amount: parseFloat(row[5]) || 0,
      narration: row[6] || "-"
    }));
  }

  // ===== Render Table =====
  function renderTable(data) {
    const tableContainer = document.getElementById("tableContainer");
    if (!data || data.length === 0) {
      tableContainer.innerHTML = "<p>No matching records found.</p>";
      return;
    }

    // ‚úÖ Normalize: Replace JNP ‚Üí MA before processing
    const normalizedData = data.map(row => ({
      ...row,
      cUser: row.cUser === "JNP" ? "MA" : row.cUser,
      type: row.type === "JNP" ? "MA" : row.type
    }));

    // ‚úÖ Sort by date/T.No descending
    const sortedData = [...normalizedData].sort((a, b) => {
      const numA = parseFloat(a.date) || 0;
      const numB = parseFloat(b.date) || 0;
      return numB - numA;
    });

    // ‚úÖ Running balance calculation
    let balance = 0;
    const reversed = [...sortedData].reverse();
    const rowsWithBalance = reversed.map(row => {
      const type = row.drcr.toLowerCase();
      const isNegative = type === "payment" || type === "billdr";
      const signed = isNegative ? -row.amount : row.amount;
      balance += signed;
      return { ...row, signedAmount: signed, running: balance };
    }).reverse();

    // ‚úÖ Build Table
    const table = document.createElement("table");
    table.id = "ledgerTable";
    table.innerHTML = `
      <thead>
        <tr>
          <th>T.No.</th>
          <th>User</th>
         <th>Type</th>
          <th>Date</th>
          <th>Ledger</th>
          <th>Narration</th>
          <th>Amount (‚Çπ)</th>
          <th>Balance (‚Çπ)</th>
        </tr>
      </thead>
      <tbody>
        ${rowsWithBalance.map(row => `
          <tr style="${row.drcr.toLowerCase() === 'receipt' ? 'color: RED; background-color: rgb(248,229,229);' : ''}">
            <td>${row.date}</td>
            <td>${row.cUser}</td>
           <td>${row.drcr}</td>
            <td>${row.dt}</td>
            <td>${row.ldgr}</td>
            <td>${row.narration}</td>
            <td class="${row.signedAmount < 0 ? 'negative' : 'positive'}">${row.signedAmount.toFixed()}</td>
            <td>${row.running.toFixed()}</td>
          </tr>
        `).join("")}
      </tbody>
    `;

    // ‚úÖ Show Table
    tableContainer.innerHTML = "";
    tableContainer.appendChild(table);
  


  // ‚úÖ Replace "JNR" with "MA" in User column (index 1)    serbar ke lye condition
    const rows = table.querySelectorAll("tbody tr");
    rows.forEach(row => {
      const userCell = row.cells[1];
      if (userCell && userCell.textContent.trim() === "JNR") {
        userCell.textContent = "MA";
      }
    });
  }
    // ===== Filter by Account + Ledger =====
  function filterAndRender(accountType, ledgerFilter = "") {
    let filteredByAccount = [];

    // ‚úÖ Include MA + JNP if MA selected
    if (accountType === "MA") {
      filteredByAccount = fullData.filter(
        row => row.type === "MA" || row.type === "JNP"
      );
    } else {
      filteredByAccount = fullData.filter(row => row.type === accountType);
    }

    // ‚úÖ Ledger filter
    let visible = filteredByAccount;
    if (ledgerFilter.trim() !== "") {
      visible = filteredByAccount.filter(row =>
        row.ldgr.toLowerCase().includes(ledgerFilter.toLowerCase())
      );
    }

    // ‚úÖ Render with normalization (OPTP ‚Üí MA)
    renderTable(visible);
  }

  // ===== Ledger Search (Auto Dropdown) =====
  async function setupLedgerSearch() {
    const input = document.getElementById("msaf54");
    const dropdown = document.getElementById("ledgerDropdown");

    const ledgers = [...new Set(fullData.map(row => row.ldgr).filter(Boolean))];

    input.addEventListener("input", () => {
      const value = input.value.trim().toLowerCase();
      dropdown.innerHTML = "";

      if (value === "") {
        dropdown.style.display = "none";
        filterAndRender(document.getElementById("cu123").value);
        return;
      }

      const matches = ledgers.filter(l => l.toLowerCase().includes(value));
      matches.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item;
        li.onclick = () => {
          input.value = item;
          dropdown.style.display = "none";
          filterAndRender(document.getElementById("cu123").value, item);
        };
        dropdown.appendChild(li);
      });

      dropdown.style.display = matches.length ? "block" : "none";
      filterAndRender(document.getElementById("cu123").value, value);
    });

    document.addEventListener("click", e => {
      if (!input.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.innerHTML = "";
        dropdown.style.display = "none";
      }
    });
  }

  // ===== Account Type Dropdown =====
  async function setupAccountSelect() {
    const select = document.getElementById("cu123");
    select.addEventListener("change", () => {
      const selected = select.value;
      document.getElementById("msaf54").value = "";
      document.getElementById("searchCLedger").value = "";
      filterAndRender(selected);
    });
  }

  // ===== Global Search =====
  function setupGlobalSearch() {
    const input = document.getElementById("searchCLedger");

    input.addEventListener("input", () => {
      const query = input.value.trim().toLowerCase();

      if (query === "") {
        const selected = document.getElementById("cu123").value;
        filterAndRender(selected);
        return;
      }

      const results = fullData.filter(row =>
        Object.values(row).some(val => String(val).toLowerCase().includes(query))
      );

      renderTable(results);
    });
  }

  // ===== Print Table =====
  function printCUSERTable() {
    const tableHTML = document.getElementById("tableContainer").innerHTML;
    const style = `
      <style>
        body { font-family: Arial; padding: 20px; }
        table {
          width: 100%;
          margin-top: 20px;
          border-collapse: collapse;
          border-radius: 8px;
          overflow: hidden;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          font-size: 14px;
        }
        th, td {
          border: 1px solid #e0e0e0;
          padding: 10px 14px;
          text-align: left;
        }
        th {
          background-color: #004d80;
          color: white;
          font-weight: bold;
          text-transform: uppercase;
        }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .negative { color: black; }
        .positive { color: red; }
      </style>
    `;
    const win = window.open("", "_blank");
    win.document.write(`
      <html>
        <head><title>Print Table</title>${style}</head>
        <body>
          <h2>MIPL Cash Ledger</h2>
          ${tableHTML}
          <script>
            window.onload = function() {
              window.print();
              window.onafterprint = function() { window.close(); };
            };
          <\/script>
        </body>
      </html>
    `);
    win.document.close();
  }

  // ===== Initialization =====
  document.addEventListener("DOMContentLoaded", async () => {
    const raw = await fetchSheetData();
    fullData = processRawData(raw);

    await setupLedgerSearch();
    await setupAccountSelect();
    setupGlobalSearch();

    const defaultValue = document.getElementById("cu123").value;
    if (defaultValue) {
      filterAndRender(defaultValue);
    }
  });
</script>

</body>
</html>


<!-- ledger dropdown with USER SELECTION ENTRY (cash user) code stop hare -->












<!-- BANKING form div script start hare -->
<script>
  const scriptBANKURL = 'https://script.google.com/macros/s/AKfycbw0xCIuyevQ3rXPs_sa-9yQGZ50eSIFGMwta7Rq0GqEXHCWDJqi5e4xvdE1hh1NSdU/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainBANKForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeBANK").value; //****
    const submitBANKButton = document.getElementById("submitBANKButton");
    submitBANKButton.disabled = true;
    submitBANKButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampBANK').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifyBANKEntry();
    } else {
      await submitBANKEntry(form);
    }

    submitBANKButton.disabled = false;
    submitBANKButton.value = "Submit";
  });

  async function submitBANKEntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptBANKURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully! ‚úî');
        form.reset(); // FORM RESET
        document.getElementById("formModeBANK").value = "new";
       fetchldgrreffDP();  // ‚úÖ Refresh dropdowns or UI
        refreshAll();

           // ‚úÖ Remove DLT option after submit
        const BANKDropdown = document.getElementById("msaf7");
        const dltBANKOption = [...BANKDropdown.options].find(opt => opt.value === "DLT");
        if (dltBANKOption) {
          BANKDropdown.removeChild(dltBANKOption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchBANKDetails() {
    const sNo = document.getElementById("searchBANKSNo").value;
    const waitMessage = document.getElementById("waitBANKMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitBANKButton").style.display = "none";  //****
    try {
      const response = await fetch(`${scriptBANKURL}?sNo=${sNo}`);
      const data = await response.json();

    if (data.result !== "error" && data.Voucher === "RECEIPT") {
        document.getElementById("sNo").value = data.SNo;
        document.getElementById("msaf1").value = data.Date;
        document.getElementById("msaf2").value = data.Type;
        document.getElementById("msaf3").value = data.Ledger;
        document.getElementById("msaf4").value = data.VType;
        document.getElementById("msaf5").value = data.VNo;
        document.getElementById("msaf6").value = data.Narration;
        document.getElementById("msaf7").value = data.Voucher;
      //  document.getElementById("modifyBANKButton").style.display = "inline-block";


       // ‚úÖ Add "DLT - delete" option if it doesn't exist already
const BANKDropdown = document.getElementById("msaf7");
if (![...BANKDropdown.options].some(opt => opt.value === "DLT")) {
  const dltRECEIPTOption = document.createElement("option");
  dltRECEIPTOption.value = "DLT";
  dltRECEIPTOption.text = "Delete";
  dltRECEIPTOption.style.color = "red";
  dltRECEIPTOption.style.backgroundColor = "blue";
  BANKDropdown.appendChild(dltRECEIPTOption);
}

       document.getElementById("formModeBANK").value = "modify"; // ‚úÖ Set to modify

       // ‚úÖ Show alert after successful data fetch
      alert("Select Delete Option in User Section For Delete Entry");
       
    //    document.getElementById("modifyBANKButton").style.display = "inline-block";
      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifyBANKEntry() {
    const waitMessage = document.getElementById("waitBANKMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainBANKForm');

    // ‚úÖ Set new timestamp
    const now = new Date();
    document.getElementById('timestampBANK').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptBANKURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeBANK").value = "new"; // ‚úÖ Reset to new
       fetchldgrreffDP();  // ‚úÖ Refresh dropdowns or UI
        refreshAll();
        document.getElementById("submitBANKButton").style.display = "inline-block";
        document.getElementById("modifyBANKButton").style.display = "none";

          // ‚úÖ Remove DLT option after modify
        const BANKDropdown = document.getElementById("msaf7");
        const dltBANKOption = [...BANKDropdown.options].find(opt => opt.value === "DLT");
        if (dltBANKOption) {
          BANKDropdown.removeChild(dltBANKOption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>
<!-- BANKING form div script stop hare -->




<!-- sale VOUCHER form div script start hare -->
<script>
  const scriptVCRURL = 'https://script.google.com/macros/s/AKfycbw0xCIuyevQ3rXPs_sa-9yQGZ50eSIFGMwta7Rq0GqEXHCWDJqi5e4xvdE1hh1NSdU/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainVCRForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeVCR").value; //****
    const submitVCRButton = document.getElementById("submitVCRButton");
    submitVCRButton.disabled = true;
    submitVCRButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampVCR').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifyVCREntry();
    } else {
      await submitVCREntry(form);
    }

    submitVCRButton.disabled = false;
    submitVCRButton.value = "Submit";
  });

  async function submitVCREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully! ‚úî');
        form.reset(); // FORM RESET
        document.getElementById("formModeVCR").value = "new";
       fetchldgrreffDP();  // ‚úÖ Refresh dropdowns or UI
        refreshAll();

           // ‚úÖ Remove DLT option after submit
        const SALEDropdown = document.getElementById("msaf21");
        const dltVCROption = [...SALEDropdown.options].find(opt => opt.value === "DLT");
        if (dltVCROption) {
          SALEDropdown.removeChild(dltVCROption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchVCRDetails() {
    const sNo = document.getElementById("searchVCRSNo").value;
    const waitMessage = document.getElementById("waitVCRMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitVCRButton").style.display = "none";  //****
    try {
      const response = await fetch(`${scriptVCRURL}?sNo=${sNo}`);
      const data = await response.json();

    
    if (data.result !== "error" && data.Voucher === "SALE") {
      document.getElementById("sNo").value = data.SNo;
      document.getElementById("msaf11").value = data.Date;
      document.getElementById("msaf12").value = data.Type;
      document.getElementById("msaf13").value = data.Ledger;
      document.getElementById("msaf14").value = data.VNo;
      document.getElementById("msaf15").value = data.Reff;
      document.getElementById("msaf16").value = data.Amount;
      document.getElementById("msaf17").value = data.Weight;
      document.getElementById("msaf18").value = data.Rate;
      document.getElementById("msaf19").value = data.Narration;
      document.getElementById("msaf21").value = data.Voucher;
      //  document.getElementById("modifyVCRButton").style.display = "inline-block";


       // ‚úÖ Add "DLT - delete" option if it doesn't exist already
const SALEDropdown = document.getElementById("msaf21");
if (![...SALEDropdown.options].some(opt => opt.value === "DLT")) {
  const dltSALEOption = document.createElement("option");
  dltSALEOption.value = "DLT";
  dltSALEOption.text = "Delete";
  dltSALEOption.style.color = "red";
  dltSALEOption.style.backgroundColor = "blue";
  SALEDropdown.appendChild(dltSALEOption);
}

       document.getElementById("formModeVCR").value = "modify"; // ‚úÖ Set to modify

       // ‚úÖ Show alert after successful data fetch
      alert("Select Delete Option in User Section For Delete Entry");
       
    //    document.getElementById("modifyVCRButton").style.display = "inline-block";
      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifyVCREntry() {
    const waitMessage = document.getElementById("waitVCRMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainVCRForm');

    // ‚úÖ Set new timestamp
    const now = new Date();
    document.getElementById('timestampVCR').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeVCR").value = "new"; // ‚úÖ Reset to new
       fetchldgrreffDP();  // ‚úÖ Refresh dropdowns or UI
        refreshAll();
        document.getElementById("submitVCRButton").style.display = "inline-block";
        document.getElementById("modifyVCRButton").style.display = "none";

          // ‚úÖ Remove DLT option after modify
        const SALEDropdown = document.getElementById("msaf21");
        const dltVCROption = [...SALEDropdown.options].find(opt => opt.value === "DLT");
        if (dltVCROption) {
          SALEDropdown.removeChild(dltVCROption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>
<!-- sale VOUCHER form div script stop hare -->





 <!-- ledger/jobb/reff code start hare *****************************-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ledger & Last 5 Entries</title>
  <style>
    .entry-box {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 20px 0;
      background-color: #f9f9f9;
    }
    .entry-box h4 {
      margin-top: 0;
      color: #333;
    }
  
  </style>
</head>
<body>





<script>
/* ============================================================
   CONFIG
============================================================ */
const ENABLE_MANUAL_LEDGER = true;
const ENABLE_MANUAL_REFF   = true;

/* ============================================================
   GLOBALS
============================================================ */
let rawData = [];
let dataHeader = [];

/* ============================================================
   MANUAL OPTION HELPER (REFRESH SAFE)
============================================================ */
function attachManualOption(select, type) {

  if (
    (type === "ledger" && !ENABLE_MANUAL_LEDGER) ||
    (type === "reff" && !ENABLE_MANUAL_REFF)
  ) return;

  // Reset-safe check
  if (select.querySelector('option[value="__manual__"]')) return;

  const manualOption = document.createElement("option");
  manualOption.value = "__manual__";
  manualOption.textContent = "‚ûï Create New Entry";
  manualOption.style.color = "red";

  select.insertBefore(manualOption, select.children[1]);

  select.addEventListener("change", function () {

    if (this.value !== "__manual__") return;

    let label =
      type === "ledger"
        ? "Enter New Ledger Name:"
        : "Enter New Job/Reff No:";

    let val = prompt(label);

    if (val && val.trim() !== "") {
      val = val.trim();

      const exists = [...this.options].some(o => o.value === val);

      if (!exists) {
        const opt = document.createElement("option");
        opt.value = val;
        opt.textContent = val;
        this.appendChild(opt);
      }

      this.value = val;

      if (type === "ledger" && this.classList.contains("ledger-dropdown")) {
        updateReffDropdown(val);
      }

    } else {
      this.value = "";
    }
  });
}

/* ============================================================
   FETCH DATA (REFRESH SAFE)
============================================================ */
async function fetchldgrreffDP() {
  const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
  const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
  const range = "FORM!A:K";

  try {
    const response = await fetch(
      `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
    );
    const data = await response.json();

    if (!data.values || data.values.length === 0) return;

    dataHeader = data.values[0];
    rawData = data.values.slice(1);

    const allLedgerOptions = [...new Set(
      rawData.map(r => r[3]).filter(Boolean)
    )].sort((a, b) => a.localeCompare(b));

    const taxInvoiceOptions = [...new Set(
      rawData
        .filter(r => r[1] === "TAX INVOICE")
        .map(r => r[3])
        .filter(Boolean)
    )].sort((a, b) => a.localeCompare(b));

    /* ===============================
       LEDGER DROPDOWNS
    =============================== */
    document
      .querySelectorAll(".ledger-dropdown, .ledgerVCRdropdown")
      .forEach(select => {

        select.innerHTML = '<option value="">Select Ledger</option>';

        const isMsaf13 = select.id === "msaf13";
        const optionsToUse = isMsaf13 ? taxInvoiceOptions : allLedgerOptions;

        optionsToUse.forEach(item => {
          const option = document.createElement("option");
          option.value = item;
          option.textContent = item;
          select.appendChild(option);
        });

        attachManualOption(select, "ledger");

        if (select.classList.contains("ledger-dropdown")) {
          select.onchange = function () {
            if (this.value !== "__manual__") {
              updateReffDropdown(this.value);
            }
          };
        }
      });

    showLastFiveEntriesByType("RECEIPT", "receiptContainer");
    showLastFiveEntriesByType("SALE", "saleContainer");

  } catch (error) {
    console.error("Error fetching data:", error);
    alert("Failed to fetch ledger list.");
  }
}

/* ============================================================
   UPDATE REFF DROPDOWN (REFRESH SAFE)
============================================================ */
function updateReffDropdown(selectedLedger) {
  const reffSelect = document.querySelector(".Reff-dropdown");

  reffSelect.innerHTML = '<option value="">Select Job/Reff No.</option>';

  if (!selectedLedger) {
    attachManualOption(reffSelect, "reff");
    return;
  }

  const reffValues = rawData
    .filter(row => row[3] === selectedLedger && row[5])
    .map(row => row[5]);

  const uniqueReffs = [...new Set(reffValues)].sort((a, b) =>
    a.localeCompare(b)
  );

  uniqueReffs.forEach(ref => {
    const option = document.createElement("option");
    option.value = ref;
    option.textContent = ref;
    reffSelect.appendChild(option);
  });

  attachManualOption(reffSelect, "reff");
}

/* ============================================================
   LAST ENTRIES TABLE
============================================================ */
function showLastFiveEntriesByType(type, containerId) {
  const filtered = rawData.filter(
    row => row[10]?.toUpperCase() === type.toUpperCase()
  );
  const lastFive = filtered.slice(-10).reverse();

  const container = document.getElementById(containerId);
  container.innerHTML = `<h4>Last 5 ${type} Entries</h4>`;

  if (lastFive.length === 0) {
    container.innerHTML += "<p>No entries found.</p>";
    return;
  }

  const table = document.createElement("table");
  const thead = document.createElement("thead");
  const headerRow = document.createElement("tr");

  dataHeader.forEach(header => {
    const th = document.createElement("th");
    th.textContent = header;
    headerRow.appendChild(th);
  });

  thead.appendChild(headerRow);
  table.appendChild(thead);

  const tbody = document.createElement("tbody");
  lastFive.forEach(row => {
    const tr = document.createElement("tr");
    dataHeader.forEach((_, index) => {
      const td = document.createElement("td");
      td.textContent = row[index] || "";
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  table.appendChild(tbody);
  container.appendChild(table);
}

/* ============================================================
   INIT
============================================================ */
document.addEventListener("DOMContentLoaded", fetchldgrreffDP);
</script>

</body>
</html>
 <!-- ledger/jobb/reff code stop hare *****************************-->




 





<!-- ============== IMPERST LEDGER REPORT (5793) SCRIPT START HARE ================= -->
<style>
  #search5793Bar {
    background-color: #014842;
    width: 100%;
    display: flex;
    align-items: center;
    padding: 10px;
    flex-wrap: wrap;
    gap: 10px;
    box-sizing: border-box;
  }

  #search5793Input {
    flex: 1;
    background-color: #fdfdf6;
    border: none;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 14px;
    outline: none;
  }

  #search5793Bar label { font-weight: bold; color: rgb(247, 244, 244); margin-left: 10px;}
  #search5793Bar input[type="date"] { padding: 4px 6px; border-radius: 4px;border: 1px solid #ccc; font-size: 14px;}


.dp5793 { position: absolute;top: 80px;left: 0; right: 0;background: white; border: 6px solid #280101;height: 700px; width: 500px;overflow-y: auto; display: none; z-index: 100;background-color: #e4e4e6;}
.dp5793 div { padding: 6px; cursor: pointer;}
.dp5793 div:hover { background: #e8cd36; color: rgb(1, 3, 30);font-weight: bold;}

</style>

<style>

#table5793Container {
  width: 100%;
  border-collapse: collapse;
  table-layout: auto;
  font-family: Arial, sans-serif;
  font-size: 14px;
  background: #ffffff;
  border: 1px solid #d0d0d0;
}

#table5793Container thead th {
  background: #01305c;
  color: #ffffff;
  padding: 10px;
  border: 1px solid #b5b5b5;
  text-align: left;
  font-weight: 600;
  position: sticky;
  top: 0;
  z-index: 1;
  white-space: nowrap;
}

#table5793Container tbody td {
  padding: 8px 10px;
  border: 1px solid #e0e0e0;
  vertical-align: top;
  word-wrap: break-word; /* Wrap long text */
  white-space: normal;
}

#table5793Container tbody tr:nth-child(even) {
  background: #f7faff;
}

#table5793Container tbody tr:hover {
  background: #e2f0ff;
  
}

#table5793Container {
  overflow-x: auto;
  display: block;
  max-height: 800px; /* Optional scrolling */
}

</style>

<script>
const api5793Key = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheet5793Id = "1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA";
const range5793 = "IVCR!W:AD";

let all5793Data = [];
let filtered5793Data = [];

// ‚úÖ Convert "7-Oct-2025" ‚Üí Date object
function parseCustom5793Date(dateStr) {
  if (!dateStr) return null;
  const parts = dateStr.split("-");
  if (parts.length !== 3) return null;
  const day = parseInt(parts[0]);
  const monthStr = parts[1].toLowerCase().substring(0, 3);
  const year = parseInt(parts[2]);
  const months = {
    jan: 0, feb: 1, mar: 2, apr: 3, may: 4, jun: 5,
    jul: 6, aug: 7, sep: 8, oct: 9, nov: 10, dec: 11
  };
  const month = months[monthStr];
  if (isNaN(day) || isNaN(year) || month === undefined) return null;
  return new Date(year, month, day);
}

// ‚úÖ Fetch Google Sheet Data
async function fetch5793Data() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet5793Id}/values/${range5793}?key=${api5793Key}`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    return data.values || [];
  } catch (err) {
    console.error("Error fetching data:", err);
    return [];
  }
}

// ‚úÖ Process Rows (convert only JNP ‚Üí MA)
function processRows(rows) {
  if (!rows || rows.length < 2) return [];
  const headers = rows[0];

  let data = rows.slice(1).map(r => {
    let obj = {};
    headers.forEach((h, i) => obj[h] = r[i] || "");
    obj._serial = parseFloat(r[0]) || 0;
    obj._user = (r[1] || "").trim().toUpperCase();
    obj._type = (r[2] || "").trim().toLowerCase();
    obj._dateStr = r[3] || "";
    obj._date = parseCustom5793Date(r[3]);
    obj._ledger = r[4] || "";
    obj._amount = parseFloat(r[5]) || 0;

    // ‚úÖ Only JNP ‚Üí MA (JNR unaffected)
    if (obj._user === "JNP") obj._user = "MA";

    return obj;
  });

  data.sort((a, b) => b._serial - a._serial);
  return data;
}

// ‚úÖ Render Table + Color Formatting
function render5793Table(data) {
  const container = document.getElementById("table5793Container");
  if (!data.length) {
    container.innerHTML = "<p>No records found.</p>";
    return;
  }


  // ‚úÖ Ensure each record has parsed date before sorting  ---------------
  data.forEach(r => {
    if (!r._date && r["Date"]) {
      const d = r["Date"].trim();
      const parts = d.split("-");
      if (parts.length === 3) {
        const day = parseInt(parts[0]);
        const mon = parts[1].substring(0, 3).toLowerCase();
        const yr = parseInt(parts[2]);
        const months = {
          jan: 0, feb: 1, mar: 2, apr: 3, may: 4, jun: 5,
          jul: 6, aug: 7, sep: 8, oct: 9, nov: 10, dec: 11
        };
        r._date = new Date(yr, months[mon], day);
      } else {
        r._date = null;
      }
    }
  });

  // ‚úÖ Sort by date descending (latest ‚Üí oldest)
  data.sort((a, b) => {
    const da = a._date ? a._date.getTime() : 0;
    const db = b._date ? b._date.getTime() : 0;
    return db - da;
  });
//----- DATE WISE TABLE SHORT ----------------


  const headers = Object.keys(data[0]).filter(h => !h.startsWith("_"));
  const html = `
    <table id="my5793Table" border="1" style="border-collapse:collapse;width:100%;font-size:14px;">
      <thead style="background:#004d80;color:white;">
        <tr>${headers.map(h => `<th>${h}</th>`).join("")}<th>Running Balance</th></tr>
      </thead>
      <tbody>
        ${data.map(r => {
          let color = "";
          const type = r._type.toLowerCase();
          if (type === "receipt") color = "red";
          else if (type === "salary") color = "blue";
          else if (type === "billdr") color = "green";

          return `
            <tr style="color:${color};">
              ${headers.map(h => `<td>${r[h]}</td>`).join("")}
              <td class="runningBalance"></td>
            </tr>`;
        }).join("")}
      </tbody>
    </table>
  `;
  container.innerHTML = html;

  // ‚úÖ Ensure "JNP" converted to "MA" even after render
  const rows = container.querySelectorAll("#my5793Table tbody tr");
  rows.forEach(row => {
    const userCell = row.cells[1];
    if (!userCell) return;
    const val = userCell.textContent.trim().toUpperCase();
    if (val === "JNP") userCell.textContent = "MA"; // Only JNP ‚Üí MA
  });
  //------------------
  calculate5793RunningBalance();
}

// ‚úÖ Calculate Running Balance
function calculate5793RunningBalance() {
  const rows = Array.from(document.querySelectorAll('#my5793Table tbody tr'));
  if (rows.length === 0) return;

  const lastRow = rows[rows.length - 1];
  const lastCells = lastRow.querySelectorAll('td');
  const lastType = lastCells[2]?.textContent.trim().toLowerCase();
  const lastAmount = parseFloat(lastCells[5]?.textContent || 0);

  const creditTypes = ["receipt", "salary", "billcr"];
  let runningBalance = creditTypes.includes(lastType) ? lastAmount : -lastAmount;

  lastRow.querySelector('.runningBalance').textContent = runningBalance.toFixed(2);

  for (let i = rows.length - 2; i >= 0; i--) {
    const cells = rows[i].querySelectorAll('td');
    const type = cells[2]?.textContent.trim().toLowerCase();
    const amount = parseFloat(cells[5]?.textContent || 0);

    if (!isNaN(amount)) {
      if (creditTypes.includes(type)) {
        runningBalance += amount;
      } else if (["payment", "billdr"].includes(type)) {
        runningBalance -= amount;
      }
    }
    rows[i].querySelector('.runningBalance').textContent = runningBalance.toFixed();
  }
}

// ‚úÖ Apply Filters (Search + Ledger + User + Date)
function apply5793Filters() {
  const searchVal = document.getElementById("search5793Input")?.value.toLowerCase() || "";
  const ledgerVal = document.getElementById("ledger5793Input")?.value.toLowerCase() || "";
  const userVal = document.getElementById("user5793")?.value || "";
  const startDateStr = document.getElementById("start5793Date")?.value;
  const endDateStr = document.getElementById("end5793Date")?.value;

  const startDate = startDateStr ? new Date(startDateStr) : null;
  const endDate = endDateStr ? new Date(endDateStr) : null;

  filtered5793Data = all5793Data.filter(row => {
    const rowDate = row._date;
    if (!rowDate) return false;

    const rowTime = rowDate.setHours(0, 0, 0, 0);
    const startTime = startDate ? startDate.setHours(0, 0, 0, 0) : null;
    const endTime = endDate ? endDate.setHours(0, 0, 0, 0) : null;

    // ‚úÖ Start date inclusive
    const inDateRange =
      (!startTime || rowTime >= startTime) &&
      (!endTime || rowTime <= endTime);

    const matchesUser = !userVal || row._user === userVal;
    const matchesLedger = !ledgerVal || (row._ledger || "").toLowerCase().includes(ledgerVal);
    const matchesSearch = !searchVal || Object.values(row)
      .some(v => String(v).toLowerCase().includes(searchVal));

    return inDateRange && matchesUser && matchesLedger && matchesSearch;
  });

  filtered5793Data.sort((a, b) => b._serial - a._serial);
  render5793Table(filtered5793Data);
}

// ‚úÖ Ledger Dropdown Setup
function setupLedger5793Dropdown() {
  const ledgerInput = document.getElementById("ledger5793Input");
  const dropdown = document.getElementById("ledger5793Dropdown");
  if (!ledgerInput || !dropdown) return;

  // ‚úÖ Create sorted ledger list
  const ledgers = [...new Set(all5793Data.map(r => r._ledger).filter(Boolean))].sort((a, b) =>
    a.localeCompare(b)
  );

  // ‚úÖ On input ‚Üí filter dropdown
  ledgerInput.addEventListener("input", () => {
    const value = ledgerInput.value.trim().toLowerCase();
    dropdown.innerHTML = "";

    const matches = value
      ? ledgers.filter(l => l.toLowerCase().includes(value))
      : ledgers; // if no input, show all

    matches.forEach(item => {
      const div = document.createElement("div");
      div.textContent = item;
      div.style.padding = "4px";
      div.style.cursor = "pointer";
      div.onclick = () => {
        ledgerInput.value = item;
        dropdown.style.display = "none";
        apply5793Filters();
      };
      dropdown.appendChild(div);
    });

    dropdown.style.display = matches.length ? "block" : "none";
  });

  // ‚úÖ On focus (click on input) ‚Üí show full dropdown
  ledgerInput.addEventListener("focus", () => {
    dropdown.innerHTML = "";
    ledgers.forEach(item => {
      const div = document.createElement("div");
      div.textContent = item;
      div.style.padding = "4px";
      div.style.cursor = "pointer";
      div.onclick = () => {
        ledgerInput.value = item;
        dropdown.style.display = "none";
        apply5793Filters();
      };
      dropdown.appendChild(div);
    });
    dropdown.style.display = ledgers.length ? "block" : "none";
  });

  // ‚úÖ Hide dropdown when clicked outside
  document.addEventListener("click", e => {
    if (!ledgerInput.contains(e.target) && !dropdown.contains(e.target)) {
      dropdown.style.display = "none";
    }
  });
}
//-------------------------------------------------------


// ‚úÖ Setup Event Listeners
function setup5793Events() {
  document.getElementById("search5793Input")?.addEventListener("input", apply5793Filters);
  document.getElementById("user5793")?.addEventListener("change", apply5793Filters);
  document.getElementById("start5793Date")?.addEventListener("change", apply5793Filters);
  document.getElementById("end5793Date")?.addEventListener("change", apply5793Filters);
}

// ‚úÖ Refresh Function (Reload All)
async function refresh5793Table() {
  document.getElementById("search5793Input").value = "";
  document.getElementById("ledger5793Input").value = "";
  document.getElementById("user5793").value = "";
  document.getElementById("start5793Date").value = "";
  document.getElementById("end5793Date").value = "";
  const rows = await fetch5793Data();
  all5793Data = processRows(rows);
  filtered5793Data = [...all5793Data];
  render5793Table(all5793Data);
  setupLedger5793Dropdown();
}

// ‚úÖ Print Function
// ‚úÖ Print Function (with Ledger Name condition)
function print5793Table() {
  const table = document.getElementById("my5793Table");
  if (!table) {
    alert("No table data to print!");
    return;
  }

  // üîπ Ledger name fetch karo
  const ledgerName = document.getElementById("ledger5793Input")?.value.trim() || "";

  // üîπ User name fetch karo (select ke selected option ka text)
  const userSelect = document.getElementById("user5793");
  const userText = userSelect ? userSelect.options[userSelect.selectedIndex].text.trim() : "";

  // üîπ Ledger aur User dono ke HTML ready karo
  let headerHTML = "";
  if (ledgerName) headerHTML += `<h4 style="margin:4px 0;">Ledger: ${ledgerName}</h4>`;
  if (userText) headerHTML += `<h4 style="margin:4px 0;">User: ${userText}</h4>`;

  // üîπ Print window open karo
  const printWindow = window.open("", "_blank");
  printWindow.document.write(`
    <html>
      <head>
        <title>Print Table</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          table { width:100%; border-collapse:collapse; font-size:14px; }
          th, td { border:1px solid #444; padding:6px; text-align:left; }
          th { background:#004d80; color:white; }
          h3, h4 { text-align:center; }
        </style>
      </head>
      <body>
        <h3>Imprest Voucher Report</h3>
        ${headerHTML}
        ${table.outerHTML}
      </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.print();
}

// ‚úÖ Initialize
document.addEventListener("DOMContentLoaded", async () => {
  const rows = await fetch5793Data();
  all5793Data = processRows(rows);
  filtered5793Data = [...all5793Data];
  render5793Table(all5793Data);
  setupLedger5793Dropdown();
  setup5793Events();
});
</script>

<!-- ============== IMPERST LEDGER REPORT (5793) SCRIPT STOP HARE ================= -->




 <!-- IVCR form div script start hare -->
<script>
  const scriptIVCRURL = 'https://script.google.com/macros/s/AKfycbz-lyd06EKKSO4xVaTSRWoIgMWS0C9nZvzipEP59K25TZSOSdL5CMpYJNPgmF1nyyGrXg/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainIVCRForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeIVCR").value; //****
    const submitIVCRButton = document.getElementById("submitIVCRButton");
    submitIVCRButton.disabled = true;
    submitIVCRButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampIVCR').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifyIVCREntry();
    } else {
      await submitIVCREntry(form);
    }

    submitIVCRButton.disabled = false;
    submitIVCRButton.value = "Submit";
  });

  async function submitIVCREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptIVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully! ‚úî');
        form.reset(); // FORM RESET
        document.getElementById("formModeIVCR").value = "new";
        loadIVCRSheet(); //REFRESH
        

           // ‚úÖ Remove DLT option after submit
        const voucherDropdown = document.getElementById("voucherType");
        const dltOption = [...voucherDropdown.options].find(opt => opt.value === "DLT");
        if (dltOption) {
          voucherDropdown.removeChild(dltOption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchIVCRDetails() {
    const sNo = document.getElementById("searchIVCRSNo").value;
    const waitMessage = document.getElementById("waitIVCRMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitIVCRButton").style.display = "none";  //****
 //   try {
  //    const response = await fetch(`${scriptIVCRURL}?sNo=${sNo}`);
   //   const data = await response.json();

    //   if (data.Voucher === "IV03" || data.Voucher === "IV10" ||data.Voucher === "IV04" ||data.Voucher === "IV05" || data.Voucher === "IV06"|| data.Voucher === "IV07"|| data.Voucher === "IV08"|| data.Voucher === "IV09") {
     


    //**** option value ke base par data fetch krna

    try {
  const response = await fetch(`${scriptIVCRURL}?sNo=${sNo}`);
  const data = await response.json(); // ‚úÖ You need this line!

const voucherTypeDropdown = document.getElementById("voucherType");
const selectedIVVoucher = voucherTypeDropdown.value;

if (data.result !== "error" && data.Voucher === selectedIVVoucher) {
    
    document.getElementById("sNo").value = data.SNo;
        document.getElementById("voucherType").value = data.Voucher;
        document.getElementById("ivcr0").value = data.Type;
        document.getElementById("ivcr1").value = data.Date;
        document.getElementById("dropdownIVCRSearch").value = data.Ledger;
        document.getElementById("ivcr2").value = data.Amount;
        document.getElementById("ivcr3").value = data.Narration;
      //  document.getElementById("modifyIVCRButton").style.display = "inline-block";


       // ‚úÖ Add "DLT - delete" option if it doesn't exist already
const voucherDropdown = document.getElementById("voucherType");
if (![...voucherDropdown.options].some(opt => opt.value === "DLT")) {
  const deleteOption = document.createElement("option");
  deleteOption.value = "DLT";
  deleteOption.text = "Delete";
  deleteOption.style.color = "red";
  deleteOption.style.backgroundColor = "blue";
  voucherDropdown.appendChild(deleteOption);
}

       document.getElementById("formModeIVCR").value = "modify"; // ‚úÖ Set to modify
    //    document.getElementById("modifyIVCRButton").style.display = "inline-block";

    // ‚úÖ Show alert after successful data fetch
      alert(" Select Delete Option in User Section For Delete Entry");

      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifyIVCREntry() {
    const waitMessage = document.getElementById("waitIVCRMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainIVCRForm');

    // ‚úÖ Set new timestamp
    const now = new Date();
    document.getElementById('timestampIVCR').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptIVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeIVCR").value = "new"; // ‚úÖ Reset to new
      loadIVCRSheet(); //REFRESH
        
        document.getElementById("submitIVCRButton").style.display = "inline-block";
        document.getElementById("modifyIVCRButton").style.display = "none";

          // ‚úÖ Remove DLT option after modify
        const voucherDropdown = document.getElementById("voucherType");
        const dltOption = [...voucherDropdown.options].find(opt => opt.value === "DLT");
        if (dltOption) {
          voucherDropdown.removeChild(dltOption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>
<!-- IVCR form div script stop hare -->





 <!-- IMPREST VOUCHER FORM LEDGER DROPDOWN & TABLE CODE START -->
<!DOCTYPE html>
<html>
<head>
  <title>Ledger Filter</title>
  <style>
   
    tr.receipt { background-color: #ffe6e6; color: #a10404; }
    tr.bill { background-color: #e6f3ff; color: #1d03c6; }
    .runningBalance { font-weight: bold; }

      .dropdown-container {
    position: relative;
    margin-top: 20px;
  }

  #dropdownIVCRSearch {
    width: 3in;
  }

  ul.dropdownCSSlist {
    display: none;
    list-style: none;
    padding: 0;
    margin: 0;
    border: 1px solid #ccc;
    max-height: 8in; /* ‚úÖ 8-inch height */
    overflow-y: auto;
    background: white;
    position: absolute;
    z-index: 10;
    width: 4in;
  }

  ul.dropdownCSSlist li {
    padding: 5px;
    cursor: pointer;
  }

  ul.dropdownCSSlist li:hover {
    background-color: #ddd;
  }
  </style>
</head>
<body>



 
  <script>
    let fulivcrData = [];

    async function loadIVCRSheet() {
      const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
      const sheetId = "1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA";
      const range = 'IVCR!W:AD';

      try {
        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`);
        const data = await response.json();
        if (data.values) {
          fulivcrData = data.values;
          updateIVCRTableAndDropdown();
        }
      } catch (err) {
        console.error("Error fetching Google Sheets data:", err);
      }
    }

    function updateIVCRTableAndDropdown() {
      const selectedVoucher = document.getElementById('ivuser').value;
      const filteredData = fulivcrData.filter((row, i) => i === 0 || row[1] === selectedVoucher);
      populateDropdownList(filteredData);
      populateIVCRTable(filteredData);
    }

    function populateDropdownList(data) {
      const ul = document.getElementById("dropdownIVCRList");
      ul.innerHTML = '';
      const uniqueValues = [...new Set(data.slice(1).map(row => row[4]))];

      uniqueValues.forEach(value => {
        const li = document.createElement("li");
        li.textContent = value;
        li.onclick = () => {
          document.getElementById('dropdownIVCRSearch').value = value;
          ul.style.display = "none";
          const filtered = data.filter((row, i) => i === 0 || row[4] === value);
          populateIVCRTable(filtered);
        };
        ul.appendChild(li);
      });
    }

   function filterIVCRDropdown() {
  const searchInput = document.getElementById("dropdownIVCRSearch");
  const list = document.getElementById("dropdownIVCRList");
  const searchVal = searchInput.value.toLowerCase();

  if (searchVal === "") {
    list.style.display = "none";
    return;
  }

  let found = false;
  const items = list.querySelectorAll("li");
  items.forEach(item => {
    const match = item.textContent.toLowerCase().includes(searchVal);
    item.style.display = match ? "block" : "none";
    if (match) found = true;
  });

  list.style.display = found ? "block" : "none";
}

function populateDropdownList(data) {
  const ul = document.getElementById("dropdownIVCRList");
  ul.innerHTML = '';
  const uniqueValues = [...new Set(data.slice(1).map(row => row[4]))];

  uniqueValues.forEach(value => {
    const li = document.createElement("li");
    li.textContent = value;

    // When clicked, just fill the input, DO NOT filter the table
    li.onclick = () => {
      document.getElementById('dropdownIVCRSearch').value = value;
      ul.style.display = "none";
      // üî¥ No effect on the table
    };

    ul.appendChild(li);
  });
}


    function populateIVCRTable(data) {
      const table = document.getElementById("myIVCRTable");
      table.innerHTML = '';

      data.forEach((row, index) => {
        const tr = document.createElement("tr");
        if (index === 0) {
          row.forEach(cell => {
            const th = document.createElement("th");
            th.textContent = cell;
            tr.appendChild(th);
          });
          const th = document.createElement("th");
          th.textContent = "Balance";
          tr.appendChild(th);
        } else {
          row.forEach((cell, idx) => {
            const td = document.createElement("td");
            td.textContent = cell;
            tr.appendChild(td);

            if (idx === 2) {
              const type = cell.trim().toLowerCase();
              if (type === 'receipt') tr.classList.add('receipt');
              if (type === 'bill') tr.classList.add('bill');
            }
          });
          const td = document.createElement("td");
          td.className = "runningBalance";
          tr.appendChild(td);
        }
        table.appendChild(tr);
      });

      calculateIVCRRunningBalance();
    }

    function calculateIVCRRunningBalance() {
      const rows = Array.from(document.querySelectorAll("#myIVCRTable tr")).slice(1);
      if (rows.length === 0) return;

      let lastRow = rows[rows.length - 1];
      let cells = lastRow.querySelectorAll('td');
      let amount = parseFloat(cells[5]?.textContent || 0);
      let type = cells[2]?.textContent.trim().toLowerCase();

      let balance = (type === 'receipt') ? amount : -amount;
      cells[cells.length - 1].textContent = balance.toFixed(2);

      for (let i = rows.length - 2; i >= 0; i--) {
        const row = rows[i];
        const tds = row.querySelectorAll('td');
        const amt = parseFloat(tds[5]?.textContent || 0);
        const typ = tds[2]?.textContent.trim().toLowerCase();

        if (!isNaN(amt)) {
          if (typ === 'receipt' || typ === 'salary') balance += amt;
          else if (typ === 'payment' || typ === 'bill') balance -= amt;
        }
        tds[tds.length - 1].textContent = balance.toFixed();
      }
    }

    document.getElementById("ivuser").addEventListener("change", updateIVCRTableAndDropdown);

    // Hide dropdown when clicking outside
    document.addEventListener('click', function (e) {
      const searchBox = document.getElementById("dropdownIVCRSearch");
      const list = document.getElementById("dropdownIVCRList");
      if (!searchBox.contains(e.target) && !list.contains(e.target)) {
        list.style.display = "none";
      }
    });

  //  window.onload = loadIVCRSheet;
  </script>

</body>
</html>

  
 <!-- IMPREST VOUCHER FORM LEDGER DROPDOWN & TABLE CODE STOP -->

  


 <!-- mainSRRForm  code start hare -->


             <!-- SRR form div script start hare -->
             <script>
                const scriptSRRURL = 'https://script.google.com/macros/s/AKfycbxNCtOS7UZu2mw_Zuwkx-KHdORL1DATDoSp0Gv2Q5EQw6CKJOSPowawczVE_7uYHQw_/exec';
              
                document.addEventListener("submit", async function (e) {
                  const form = e.target;
                  if (form.id !== "mainSRRForm") return;
              
                  e.preventDefault();
                   const formMode = document.getElementById("formModeSRR").value;   //****
                  const submitSRRButton = document.getElementById("submitSRRButton");
                  submitSRRButton.disabled = true;
                  submitSRRButton.value = "Wait..";
              
                  const now = new Date();
                  document.getElementById('timestampSRR').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
              
                  const formInputs = form.querySelectorAll('input, textarea');
                  formInputs.forEach(input => {
                    if (input.type === 'text' || input.type === 'textarea') {
                      input.value = input.value.toUpperCase();
                    }
                  });
                  //
              
                 if (formMode === "modify") {
      await modifySRREntry();
    } else {
      await submitSRREntry(form);
    }

    submitSRRButton.disabled = false;
    submitSRRButton.value = "Submit";
  });

  async function submitSRREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptSRRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully! ‚úî');
        form.reset();
        document.getElementById("formModeSRR").value = "new";
        filterDp();
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
   //           
                async function fetchSRRDetails() {
                  const sNo = document.getElementById("searchSRRSNo").value;
                  const waitMessage = document.getElementById("waitSRRMessage");
                  waitMessage.innerText = "Fetching data... Please wait...";
                  waitMessage.style.display = 'block';
              

                   // üîª HIDE SUBMIT BUTTON WHEN FETCH STARTS
          //    document.getElementById("submitSRRButton").style.display = "none";

                  try {
                    const response = await fetch(`${scriptSRRURL}?sNo=${sNo}`);
                    const data = await response.json();
              
                    if (data.result !== "error" && data.User === "STORE") {
                      document.getElementById("sNo").value = data.SNo;
                      document.getElementById("msaf91").value = data.User;
                      document.getElementById("dropdownSRRSearch").value = data.Ledger;
                      document.getElementById("msaf92").value = data.Date;
                      document.getElementById("msaf93").value = data.cl1;
                      document.getElementById("msaf94").value = data.cl2;
                      document.getElementById("msaf95").value = data.cl3;
                      document.getElementById("msaf96").value = data.cl4;
                      document.getElementById("msaf97").value = data.cl5;
                      document.getElementById("msaf98").value = data.cl6;
                      document.getElementById("msaf99").value = data.cl7;
                     
                        document.getElementById("formModeSRR").value = "modify"; // ‚úÖ Set to modify   ****
             //         document.getElementById("modifySRRButton").style.display = "inline-block";  // Show modify
                    } else {
                      alert("No record found for the given S.No. with Type 'SHEKHER'.");
                    }
                  } catch (error) {
                    console.error("Error fetching details:", error);
                    alert("Please reconcile details or contact admin.");
                  } finally {
                    setTimeout(() => waitMessage.style.display = 'none', 2000);
                  }
                }
              
                async function modifySRREntry() {

                  const waitMessage = document.getElementById("waitSRRMessage");
                   waitMessage.innerText = "Please wait...";
                     waitMessage.style.display = "block";

                 const form = document.getElementById('mainSRRForm');

                 // ‚úÖ Set new timestamp
    const now = new Date();
    document.getElementById('timestampSRR').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
//
                const formData = new FormData(form);
                formData.set('SNo', document.getElementById('sNo').value);
                     try {
              const response = await fetch(scriptSRRURL, { method: 'POST', body: formData });
               const result = await response.json();

               if (result.result === 'success') {
               alert('Entry modified successfully!');
                document.getElementById("formModeSRR").value = "new"; // ‚úÖ Reset to new
               form.reset(); // ‚úÖ Reset form
       filterDp();  // ‚úÖ Refresh 
      document.getElementById("submitSRRButton").style.display = "inline-block"; // ‚úÖ Show submit button
      document.getElementById("modifySRRButton").style.display = "none";         // ‚úÖ Hide modify button
    } else {
      alert(`Error modifying entry: ${result.error}`);
    }
  } catch (error) {
    alert(`Error: ${error.message}`);
  } finally {
    setTimeout(() => waitMessage.style.display = 'none', 2000); // ‚úÖ Hide wait message
  }
}


              </script>
 <!-- mainSRRForm body code stop hare -->

       
<!-- STOCK RAGISTER TABLE AND LEDGER SERCH BAR CODE AND SCRIPT START -->
              
                           <style>
                            .dropdown-container {
                                position: relative;
                                width: 250px;
                            }
                            
                            #dropdownSRRSearch {
                                width: 100%;
                                padding: 8px;
                                border: 1px solid #ccc;
                                border-radius: 5px;
                            }
                            
                            .dropdown-list {
                                position: absolute;
                                width: 4in;
                                background: white;
                                color: black;
                                border: 1px solid #ccc;
                                max-height: 500px;
                                overflow-y: auto;
                                display: none;
                                z-index: 1000;
                                list-style: none;
                                padding: 0;
                                margin: 0;
                                
                            }
                            
                            .dropdown-list.show {
                                display: block;
                            }
                            
                            .dropdown-list li {
                                padding: 8px;
                                cursor: pointer;
                                border-bottom: 1px solid #ddd;
                            }
                            
                            .dropdown-list li:hover {
                                background: #f0f0f0;
                            }
                            
                            /* Hide last border */
                            .dropdown-list li:last-child {
                                border-bottom: none;
                            }

                            
                            </style>
                            


<script>
    let columnSRRData = [];
    let allStoreData = [];
    let tableData = [];

    async function filterDp() {
        const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
        const sheetId = "1wvsPdAQA57HxhTxA3cCcQvUEz93IWkBre_Ix-qvzwss";
        const range = 'FORM!A:L';

        try {
            const response = await fetch(
                `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
            );
            const data = await response.json();

            if (data.values) {
                columnSRRData = [];
                allStoreData = [];

                const seenValues = new Set();

                data.values.forEach((row, index) => {
                    if (index !== 0) {
                        const value = row[3];
                        const type = row[1]?.trim().toUpperCase();

                        if (value && !seenValues.has(value)) {
                            seenValues.add(value);
                            columnSRRData.push(value);
                        }

                        if (type === "STORE") {
                            allStoreData.push({ indexNo: index, row });
                        }
                    }
                });

                // Show all data (no limit to 10 entries)
                tableData = allStoreData.reverse();

                populatedpDropdown();
                populatedpTable();
            } else {
                console.error("No data found in the specified range.");
            }
        } catch (error) {
            console.error("Error fetching data from Google Sheets:", error);
        }
    }

    function populatedpDropdown() {
        const dropdownList = document.getElementById("dropdownList");
        dropdownList.innerHTML = "";

        columnSRRData.forEach(option => {
            const li = document.createElement("li");
            li.textContent = option;
            li.onclick = function () {
                document.getElementById("dropdownSRRSearch").value = option;
                dropdownList.classList.remove("show");
                filterByDropdownSelection();
            };
            dropdownList.appendChild(li);
        });
    }

    function filterDropdown() {
        const input = document.getElementById("dropdownSRRSearch").value.toLowerCase().trim();
        const dropdownList = document.getElementById("dropdownList");
        dropdownList.innerHTML = "";

        // Filter only dropdown options (columnSRRData)
        const filteredDropdown = columnSRRData.filter(item =>
            item.toLowerCase().includes(input)
        );

        if (filteredDropdown.length > 0) {
            dropdownList.classList.add("show");
            filteredDropdown.forEach(option => {
                const li = document.createElement("li");
                li.textContent = option;
                li.onclick = function () {
                    document.getElementById("dropdownSRRSearch").value = option;
                    dropdownList.classList.remove("show");
                    filterByDropdownSelection();
                };
                dropdownList.appendChild(li);
            });
        } else {
            dropdownList.classList.remove("show");
        }

        // Table search across ALL cells
        const filteredTable = allStoreData.filter(item =>
            item.row.some(cell =>
                cell?.toLowerCase().includes(input)
            )
        );

        tableData = filteredTable;
        renderFilteredSRRTable(filteredTable);
    }

    function filterByDropdownSelection() {
        const selectedValue = document.getElementById("dropdownSRRSearch").value.trim().toLowerCase();
        if (!selectedValue) {
            tableData = allStoreData;
            populatedpTable();
            return;
        }

        const filtered = allStoreData.filter(item => {
            const party = item.row[3]?.toLowerCase();
            return party && party.includes(selectedValue);
        });

        tableData = filtered;
        renderFilteredSRRTable(filtered);
    }

    function filterByDate() {
        const fromDate = document.getElementById("fromSRRDate").value;
        const toDate = document.getElementById("toSRRDate").value;

        if (!fromDate || !toDate) {
            alert("Please select both From and To dates.");
            return;
        }

        const from = new Date(fromDate);
        const to = new Date(toDate);

        const filtered = allStoreData.filter(item => {
            const rowDateStr = item.row[2];
            if (!rowDateStr) return false;
            const rowDate = new Date(rowDateStr);
            return rowDate >= from && rowDate <= to;
        });

        tableData = filtered;
        renderFilteredSRRTable(filtered);
    }

    function populatedpTable() {
        renderFilteredSRRTable(tableData);
    }

    function renderFilteredSRRTable(dataArray) {
    const tableDiv = document.getElementById("tableDiv");

    let table = `<table border='1'>
        <thead>
            <tr>
                <th>SNo</th><th>User</th><th>Date</th><th>Party</th><th>Type</th>
                <th>Vcr. Type</th><th>Doc No.</th><th>Weight</th>
                <th>Item Details</th><th>Vehicle No.</th><th>Status</th>
            </tr>
        </thead>
        <tbody>`;

    dataArray.forEach(item => {
        const row = item.row || [];

        const isLoad = row.length > 10 && row[10].toLowerCase() === "load";
        const isX = row.length > 10 && row[10].toLowerCase() === "x";
        const isUnload = row.length > 10 && row[10].toLowerCase() === "unload";

        let rowStyle = "";
        if (isLoad || isUnload) {
           // rowStyle = "style='background-color: rgb(170, 230, 247);'";
              rowStyle = "style='background-color: rgb(209, 238, 238);color: blue; font-weight: bold;'";
        } else if (isX) {
            rowStyle = "style='background-color: rgb(238, 209, 209);color: red; font-weight: bold;'";
        }

        table += `<tr ${rowStyle}>
            <td>${item.indexNo}</td>
            <td>${row[1] || ""}</td>
            <td>${row[2] || ""}</td>
            <td>${row[3] || ""}</td>
            <td>${row[4] || ""}</td>
            <td>${row[5] || ""}</td>
            <td>${row[6] || ""}</td>
            <td>${row[7] || ""}</td>
            <td>${row[8] || ""}</td>
            <td>${row[9] || ""}</td>
            <td>${row[10] || ""}</td>
        </tr>`;
    });

    table += `</tbody></table>`;
    tableDiv.innerHTML = table;

    // Dropdown close on outside click
    document.addEventListener("click", function (event) {
        const dropdown = document.getElementById("dropdownList");
        const searchBox = document.getElementById("dropdownSRRSearch");
        if (!searchBox.contains(event.target) && !dropdown.contains(event.target)) {
            dropdown.classList.remove("show");
        }
    });
}


    function printSRRTable() {
        const tableDiv = document.getElementById("tableDiv");
        const fromDate = document.getElementById("fromSRRDate").value;
        const toDate = document.getElementById("toSRRDate").value;

        const formattedFromDate = formatSRRDate(fromDate);
        const formattedToDate = formatSRRDate(toDate);

        const printWindow = window.open("", "", "width=800, height=600");

        let printContent = `
            <html>
            <head>
                <title>Store Ragister</title>
                <style>
                    body { font-family: Arial, sans-serif; padding: 20px; }
                    table {
                        width: 100%;
                        border-collapse: collapse;
                        font-size: 8px;
                        word-wrap: break-word;
                    }
                    table, th, td {
                        border: 1px solid #c1c2c2;
                        padding: 5px;
                        text-align: left;
                        overflow: hidden;
                        text-overflow: ellipsis;
                    }
                    th { background-color: #013b76; color: white; }
                    table tr:hover { background-color: yellow; }
                </style>
            </head>
            <body>
                <h4>Store Register Report</h4>
                <p><strong>From:</strong> ${formattedFromDate} <strong>To:</strong> ${formattedToDate}</p>
                <span style="color:black;font-size:90%;font-family:Arial Black;">Weight/Bill Report:</span><br/>
                ${tableDiv.innerHTML}
            </body>
            </html>`;

        function formatSRRDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            const date = new Date(dateString);
            return date.toLocaleDateString('en-GB', options);
        }

        printWindow.document.write(printContent);
        printWindow.document.close();
        printWindow.print();
        printWindow.close();
    }

//    window.onload = () => {
  //      filterDp();

      
 //   };
</script>


<!-- STOCK RAGISTER TABLE AND LEDGER SERCH BAR CODE AND SCRIPT START -->
                      
                      
              
                        
        
 
<!-- SHEKHER FORM ENTRY SCRIPT SCRIPT START -->
<style>
           
          
/* Dropdown Styling */
.dropdown-container {
position: relative;
text-align: left;
}         
     /* Dropdown styling */
     #ledgerDropdown {
       display: none;
       position: absolute;
       background-color: rgb(12, 1, 1);
       color: rgb(245, 239, 239);
       width: 50%;
       border: 1px solid #ccc;
       border-radius: 8px;
       max-height: 150px;
       overflow-y: auto;
       box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
       margin-top: 5px;
       z-index: 10;
     }
 
     #ledgerDropdown li {
       padding: 10px;
       cursor: pointer;
       transition: background-color 0.3s ease;
     }
 
     #ledgerDropdown li:hover {
       background-color: #01534d;
     }
 
   </style>

             <!-- SKHR form div script start hare -->
             <script>
  const scriptSKHRURL = 'https://script.google.com/macros/s/AKfycbxNCtOS7UZu2mw_Zuwkx-KHdORL1DATDoSp0Gv2Q5EQw6CKJOSPowawczVE_7uYHQw_/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainSKHRForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeSKHR").value; //****
    const submitSKHRButton = document.getElementById("submitSKHRButton");
    submitSKHRButton.disabled = true;
    submitSKHRButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampSKHR').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifySKHREntry();
    } else {
      await submitSKHREntry(form);
    }

    submitSKHRButton.disabled = false;
    submitSKHRButton.value = "Submit";
  });

  async function submitSKHREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptSKHRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully! ‚úî');
        form.reset(); // FORM RESET
        document.getElementById("formModeSKHR").value = "new";
        filterSKHR();  // ‚úÖ Refresh 
        

           // ‚úÖ Remove DLT option after submit
        const SKHRDropdown = document.getElementById("msaf101");
        const dltSKHROption = [...SKHRDropdown.options].find(opt => opt.value === "DLT");
        if (dltSKHROption) {
          SKHRDropdown.removeChild(dltSKHROption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchSKHRDetails() {
    const sNo = document.getElementById("searchSKHRSNo").value;
    const waitMessage = document.getElementById("waitSKHRMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitSKHRButton").style.display = "none";  //****
    try {
      const response = await fetch(`${scriptSKHRURL}?sNo=${sNo}`);
      const data = await response.json();

     if (data.result !== "error" && data.User === "SHEKHER") {
                    document.getElementById("sNo").value = data.SNo;
      document.getElementById("msaf101").value = data.User;
      document.getElementById("dropdownskhrSearch").value = data.Ledger;
      document.getElementById("msaf102").value = data.Date;
      document.getElementById("msaf103").value = data.cl1;
      document.getElementById("msaf104").value = data.cl2;
      document.getElementById("msaf105").value = data.cl3;
      document.getElementById("msaf106").value = data.cl4;
      //  document.getElementById("modifySKHRButton").style.display = "inline-block";


       // ‚úÖ Add "DLT - delete" option if it doesn't exist already
const SKHRDropdown = document.getElementById("msaf101");
if (![...SKHRDropdown.options].some(opt => opt.value === "DLT")) {
  const dlt101Option = document.createElement("option");
  dlt101Option.value = "DLT";
  dlt101Option.text = "Delete";
  dlt101Option.style.color = "red";
  dlt101Option.style.backgroundColor = "blue";
  SKHRDropdown.appendChild(dlt101Option);
}

       document.getElementById("formModeSKHR").value = "modify"; // ‚úÖ Set to modify

       // ‚úÖ Show alert after successful data fetch
      alert(" Select Delete Option in User Section For Delete Entry");
       
    //    document.getElementById("modifySKHRButton").style.display = "inline-block";
      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifySKHREntry() {
    const waitMessage = document.getElementById("waitSKHRMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainSKHRForm');

    // ‚úÖ Set new timestamp
    const now = new Date();
    document.getElementById('timestampSKHR').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptSKHRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeSKHR").value = "new"; // ‚úÖ Reset to new
        filterSKHR(); // ‚úÖ Refresh dropdowns or UI
        
        document.getElementById("submitSKHRButton").style.display = "inline-block";
        document.getElementById("modifySKHRButton").style.display = "none";

          // ‚úÖ Remove DLT option after modify
        const SKHRDropdown = document.getElementById("msaf101");
        const dltSKHROption = [...SKHRDropdown.options].find(opt => opt.value === "DLT");
        if (dltSKHROption) {
          SKHRDropdown.removeChild(dltSKHROption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>

<!-- SHEKHER FORM ENTRY SCRIPT SCRIPT STOP -->



              

                        
              
<!-- SHEKHER TABLE AND LEDGER SERCH BAR CODE AND SCRIPT START -->
              
<style>
.dropdown-container {
 position: relative;
width: 250px;
}
                            
#dropdownskhrSearch {
 width: 100%;
  padding: 8px;
 border: 1px solid #ccc;
 border-radius: 5px;
}
                            
.dp-list {
 position: absolute;
width: 100%;
 background: white;
  border: 1px solid #ccc;
max-height: 500px;
overflow-y: auto;
 display: none;
 z-index: 1000;
 list-style: none;
 padding: 0;
margin: 0;
 }
                            
.dp-list.show {
 display: block;
}

 .dp-list li {
 padding: 8px;
 cursor: pointer;
 border-bottom: 1px solid #ddd;
 }
                            
.dp-list li:hover {
 background: #f0f0f0;
 }
                            
 /* Hide last border */
 .dp-list li:last-child {
  border-bottom: none;
}
 </style>
                            
            
 <script>
 let skhrData = [];
 let allShekherData = []; // All SHEKHER entries
 let tableSKHRData = [];      // Currently displayed data (e.g., last 10 or filtered by date)
                          
 async function filterSKHR() {
    const apiSKHRKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
    const sheetSKHRId = "1wvsPdAQA57HxhTxA3cCcQvUEz93IWkBre_Ix-qvzwss";
    const rangeSKHR = 'FORM!A:H';

    try {
        const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${sheetSKHRId}/values/${rangeSKHR}?key=${apiSKHRKey}`
        );
        const data = await response.json();

        if (data.values) {
            skhrData = [];
            allShekherData = [];

            // Collect all unique values from Column D (index 3)
            const seenValues = new Set();

            data.values.forEach((row, index) => {
                if (index !== 0) {
                    const value = row[3];
                    const type = row[1]?.trim().toUpperCase();

                    // Unique column 4 (D column) data for dropdown
                    if (value && !seenValues.has(value)) {
                        seenValues.add(value);
                        skhrData.push(value);
                    }

                    // Filter only SHEKHER entries
                    if (type === "SHEKHER") {
                        allShekherData.push({ indexNo: index, row });
                    }
                }
            });

            // Show last 10 SHEKHER entries
            tableSKHRData = allShekherData.slice(-100).reverse();

            populatedpSKHRDropdown();
            populateSKHRTable();
        } else {
            console.error("No data found in the specified range.");
        }
    } catch (error) {
        console.error("Error fetching data from Google Sheets:", error);
    }
}

                          
                              function populatedpSKHRDropdown() {
                                  const dropdownSKHRList = document.getElementById("dropdownSKHRList");
                                  dropdownSKHRList.innerHTML = "";
                          
                                  skhrData.forEach(option => {
                                      const li = document.createElement("li");
                                      li.textContent = option;
                                      li.onclick = function () {
                                          document.getElementById("dropdownskhrSearch").value = option;
                                          dropdownSKHRList.classList.remove("show");
                                      };
                                      dropdownSKHRList.appendChild(li);
                                  });
                              }
                          
                              function populateSKHRTable() {
                                  renderFilteredSKHRTable(tableSKHRData);
                              }
                          
                              function filterSKHRDropdown() {
                                  const input = document.getElementById("dropdownskhrSearch").value.toLowerCase();
                                  const dropdownSKHRList = document.getElementById("dropdownSKHRList");
                                  dropdownSKHRList.innerHTML = "";
                          
                                  const filteredData = skhrData.filter(item => item.toLowerCase().includes(input));
                                  if (filteredData.length > 0) {
                                      dropdownSKHRList.classList.add("show");
                                      filteredData.forEach(option => {
                                          const li = document.createElement("li");
                                          li.textContent = option;
                                          li.onclick = function () {
                                              document.getElementById("dropdownskhrSearch").value = option;
                                              dropdownSKHRList.classList.remove("show");
                                          };
                                          dropdownSKHRList.appendChild(li);
                                      });
                                  } else {
                                      dropdownSKHRList.classList.remove("show");
                                  }
                              }
                          
                             function filterSKHRByDate() {
    const fromDate = document.getElementById("fromDate").value;
    const toDate = document.getElementById("toDate").value;

    if (!fromDate || !toDate) {
        alert("Please select both From and To dates.");
        return;
    }

    // ---- Convert to inclusive range ----
    const from = new Date(fromDate + "T00:00:00");
    const to = new Date(toDate + "T23:59:59");

    const filtered = allShekherData.filter(item => {
        const rowDateStr = item.row[2];
        if (!rowDateStr) return true; // agar date blank hai to row ko skip na kare (show kare)
        const rowDate = new Date(rowDateStr);
        if (isNaN(rowDate)) return true; // invalid date bhi show kare

        return rowDate >= from && rowDate <= to;
    });

    if (filtered.length === 0) {
        document.getElementById("tableSKHRDiv").innerHTML = "<p>No records found for selected date range.</p>";
    } else {
        tableSKHRData = filtered; // Update tableSKHRData if needed elsewhere
        renderFilteredSKHRTable(filtered);
    }
}

                          
                              function renderFilteredSKHRTable(dataArray) {
  const tableSKHRDiv = document.getElementById("tableSKHRDiv");
  const totalWeightDiv = document.getElementById("totalWeightDiv");
  const totalAmountDiv = document.getElementById("totalAmountDiv");

  let totalWeight = 0;
  let totalAmount = 0;

  let table = `<table border='1'>
      <tr>
        <th>SNo</th>
        <th>User</th>
        <th>Date</th>
        <th>Party</th>
        <th>Weight</th>
        <th>Rate</th>
        <th>Amount</th>
        <th>Narration</th>
      </tr>`;

  dataArray.forEach(item => {
    let row = item.row.map(cell => {
      return (!cell || cell.toString().trim().toLowerCase() === "undefined") ? "" : cell;
    });

    const weight = parseFloat(row[4]);
    const amount = parseFloat(row[6]);

    if (!isNaN(weight)) {
      totalWeight += weight;
    }

    if (!isNaN(amount)) {
      totalAmount += amount;
    }

    table += `
      <tr>
        <td>${item.indexNo}</td>
        <td>${row[1] || ""}</td>
        <td>${row[2] || ""}</td>
        <td>${row[3] || ""}</td>
        <td>${row[4] || ""}</td>
        <td>${row[5] || ""}</td>
        <td>${row[6] || ""}</td>
        <td>${row[7] || ""}</td>
      </tr>`;
  });

  table += `</table>`;
  tableSKHRDiv.innerHTML = table;

  const retention = totalAmount * 0.10;
  const tdsSKHR = totalAmount * 0.01;
  const billAmount = totalAmount - retention - tdsSKHR;

  totalWeightDiv.innerHTML = `Total Weight: <span style="color: #0077b6;">${totalWeight.toFixed()}</span>`;
  totalAmountDiv.innerHTML = `Total Amount: <span style="color: #0077b6;">${totalAmount.toFixed()}</span>`;
  document.getElementById("retentionDiv").innerHTML = `Retention (10%): <span style="color: #0077b6;">${retention.toFixed()}</span>`;
  document.getElementById("tdsSKHRDiv").innerHTML = `TDS (1%): <span style="color: #0077b6;">${tdsSKHR.toFixed()}</span>`;
  document.getElementById("billAmountDiv").innerHTML = `Total Bill Amount: <span style="color: #0077b6;">${billAmount.toFixed()}</span>`;
}


// print function start
                              function printSHEKHERTable() {
    const tableSKHRDiv = document.getElementById("tableSKHRDiv");
    const totalWeightDiv = document.getElementById("totalWeightDiv");
    const totalAmountDiv = document.getElementById("totalAmountDiv");
    const retentionDiv = document.getElementById("retentionDiv");
    const tdsSKHRDiv = document.getElementById("tdsSKHRDiv");
    const billAmountDiv = document.getElementById("billAmountDiv");
    const fromDate = document.getElementById("fromDate").value;
    const toDate = document.getElementById("toDate").value;

     // Format the dates to "5-May-2025"
     const formattedFromDate = formatSKHRDate(fromDate);
    const formattedToDate = formatSKHRDate(toDate);

    // Create a printable window
    const printWindow = window.open("", "", "width=800, height=600");

    // Build the content for printing
    let printContent = `
        <html>
        <head>
            <title>Chander Shekher</title>
            <style>
                body {
                    font-family: Arial, sans-serif;
                    padding: 20px;
                }
                  table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 5px;
  font-size: 12px;
  table-layout: auto; /* Let column widths auto adjust */
  word-wrap: break-word;
}

table, th, td {
  border: 1px solid #c1c2c2;
  padding: 5px 5px;
  text-align: left;
   /* Prevent text from wrapping   white-space: nowrap; */
   white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis; /* Add ... if text overflows */
}

th {
  background-color: #013b76;
  color: white;
}

table tr:hover {
  background-color: yellow;
}

                
            </style>
        </head>
        <body>
            <h4>Chander Shekher Weight Report</h4>
            <p><strong>From:</strong> ${formattedFromDate} <strong>To:</strong> ${formattedToDate}</p>
            
            <div class="summary" style="display: flex; gap: 30px; margin-top: 20px; font-weight: bold; font-size: 16px;">
                <p>${totalWeightDiv.innerHTML}</p>
                <p>${totalAmountDiv.innerHTML}</p>
                <p>${retentionDiv.innerHTML}</p>
                <p>${tdsSKHRDiv.innerHTML}</p>
                <p>${billAmountDiv.innerHTML}</p>
            </div>
           
            <span style="color:black;font-size:90%;font-family:Arial Black;"id="resultIVDiv"> Weight/Bill Report:  </span> <br/>
            ${tableSKHRDiv.innerHTML}
        </body>
        </html>
    `;

    function formatSKHRDate(dateString) {
    const options = { year: 'numeric', month: 'short', day: 'numeric' };
    const date = new Date(dateString);
    return date.toLocaleDateString('en-GB', options); // This will return the date in the desired format: 5-May-2025
}
    // Write the content into the print window and trigger print
    printWindow.document.write(printContent);
    printWindow.document.close();  // Needed for IE
    printWindow.print();
    printWindow.close();
}
// print function stop
                          
// window.onload = () => {
 // filterSKHR();
   //};
 </script>
<!-- SHEKHER TABLE AND LEDGER SERCH BAR CODE AND SCRIPT STOP -->










<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, REFRESH BUTTON START HARE -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Single Button for Multiple Function Refresh</title>

  <style>
    /* üëá Refresh button fixed to bottom-right corner */
    #refreshButton {
      position: fixed;
      bottom: 3px;
      right: 10px;
      padding: 2px 5px;
      background-color: #00254d;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      z-index: 1000;
    }

    #refreshButton:hover {
      background-color: #0056b3;
    }
  </style>

  <!-- ‚úÖ Fixed Positioned Refresh Button -->
  <button id="refreshButton" onclick="refreshAll()">Refresh</button>

   <!-- Combine Refresh Script -->
  <script>
    function refreshAll() {
      filterDp();  // SRR TABLE 
      loadDATAMIPLTABLE();
      loadIVCRSheet();   // IVCR ENTRY FORM TABLE

      loadNoticeBoard();  // loding summry notice board
    }


    // ‚úÖ Auto Refresh Every 1 Minute (60000 milliseconds)
  setInterval(refreshAll, 300000);  // auto refresh after 5 mnt
    // Optional: Run once on page load
  //  window.onload = refreshAll;
  </script>


</body>
</html>
<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, REFRESH BUTTON START STOP -->








<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, logo code start -->

<style>
#floatingBrand {
  position: fixed;
  top: 8px;
  right: 400px;
  z-index: 9999;
  background: transparent;
  padding: 5px 10px;
  pointer-events: auto; /* Prevent clicks if needed */
}

/* Sticky Note Style */
#noteTooltip {
  display: none;
  position: absolute;
  top: 40px;
  right: 0;
  background-color: #cceaff;
  border: 1px solid #013556;
  padding: 10px;
  width: 200px;
  font-family: Arial, sans-serif;
  font-size: 90%;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
  z-index: 10000;
  border-radius: 5px;
}
</style>
</style>

<div id="floatingBrand">
  <span style="color:rgb(246, 156, 156);font-size:130%;font-family:Magneto;">eS |</span> 
  <span style="color:#a0d0f0;font-size:130%;font-family:Magneto;">MTally</span>
   <div id="noteTooltip">Design By: eS|MTally <br/> Admin: Mukhtiyar Ahamad <br/> Contect: +91-9756735792</div>
</div>


<script>
const brand = document.getElementById('floatingBrand');
const tooltip = document.getElementById('noteTooltip');

// Show on hover
brand.addEventListener('mouseenter', () => {
  tooltip.style.display = 'block';
});

// Hide when mouse leaves
brand.addEventListener('mouseleave', () => {
  tooltip.style.display = 'none';
});
</script>
<!-- ‡§Ø‡§π ‡§è‡§ï ‡§®‡•ã‡§ü ‡§π‡•à, logo code stop -->






<!-- job/reff VOUCHER form div code  start hare -->
<script>
  function showForm(type) {
  

    const contentMap = {
      MFDY: `
        
       <H3 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Entry Sr. No. For Entry Search</H3>

        <form id="modifyReffMDFYForm">
          <input type="hidden" id="formModeReffMDFY" name="formModeReffMDFY" value="new">
            <input type="number" id="searchReffMDFYSNo" placeholder="Enter S.No. to Modify Entry" >
            <button type="button" class="fetchbtn" onclick="fetchReffMDFYDetails()">Fetch Details</button>
            <button type="button" class="fetchbtn" id="modifyReffMDFYButton" onclick="modifyReffMDFYEntry()" style="display:none;">Modify Entry</button>
             <!-- Wait message div -->
<div id="waitReffMDFYMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
        </form>  

<H3 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Edit Modify Modify</H3>
       <form id="mainJBMDFYForm">
          <input type="hidden" name="SNo" id="sNo" />


          <!-- Hidden inputs to preserve fetched values -->
<input type="hidden" id="savedVoucher" name="Voucher">
<input type="hidden" id="savedType" name="Type">
<input type="hidden" id="savedRate" name="Rate">
<input type="hidden" id="savedNarration" name="Narration">
<input type="hidden" id="savedVType" name="VType">


          <label  style="font-size:100%;font-family:Arial;color: black ;font-weight: bold;">Voucher (Readonly)</label>
          <input type="text" id="msafMFDY70" name="Voucher" value="" readonly>

            <label  style="color:black;font-size:100%;font-family:Arial;color: black;font-weight: bold;">User Name (Readonly)</label>
            <input type="text" id="msafMFDY71" name="Type" value="" readonly>

           <label  style="color:#a93226;font-size:100%;font-family:Arial;font-weight: bold; ">Order By*</label>
          <select id="msafMFDY72" name="Date" required>
            <option value="RAHUL">RAHUL</option>
            <option value="TUSHAR AGARWAR (MD)">TUSHAR AGARWAL (MD)</option>
            <option value="LESHANT">LESHANT</option>
            <option value="OTHER">OTHER</option>
           </select>

           <label  style="color:#a93226 ;font-size:100%;font-family:Arial; font-weight: bold;">Clint Name*</label>
            <input type="text" id="msafMFDY73" name="Ledger" required placeholder="Enter Cline Name"> 

            <label  style="color:#a93226 ;font-size:100%;font-family:Arial; font-weight: bold;">Firm Name/ Order Details*</label>
            <input type="text" id="msafMFDY74" name="VNo" required placeholder="Enter Firm Name/ Order Details"> 

            <label  style="color:#a93226; font-size:100%;font-family:Arial; font-weight: bold;">Address*</label>
            <input type="text" id="msafMFDY75" name="Reff" placeholder="Enter Address"style="text-transform: uppercase;">
         
       

          <label  style="color:#a93226; font-size:100%;font-family:Arial; font-weight: bold;">Job/Reff No.*</label>
          <input type="text" id="msafMFDY76" name="Amount" placeholder="Enter Job/Reff No."style="text-transform: uppercase;">

          <label  style="color:#a93226; font-size:90%;font-family:Arial; font-weight: bold;">Status</label>
          <select id="msafMFDY77" name="Weight" required>
            <option value="RUNNING">Running</option>
            <option value="COMPLETED">Completed</option>
            <option value="CANCELED">Canceled</option>
            <option value="PENDING">Pending</option>
           </select>

          <input type="hidden" name="Timestamp" id="timestampReffMDFY">
          <input  style="display:none;" type="submit" id="submitReffMDFYButton" value="Submit">
        </form>
    
      `,
      CREAT: `
  <form id="mainREFFNOForm">
          <input type="hidden" name="SNo" id="sNo" />

          <label  style="font-size:100%;font-family:Arial;color: #a93226;font-weight: bold;">User*</label>
          <select id="msaf70" name="Voucher" required>
            <option value="JOB/REFF">Job Details</option>
           </select>

<label  style="color:black;font-size:100%;font-family:Arial;color: #a93226;font-weight: bold;">Select Job/Reff. User*</label>
<select id="msaf71" name="Type" required></select> 



           <label  style="color: #a93226;font-weight: bold; font-size:100%;font-family:Arial;">Order By</label>
          <select id="msaf72" name="Date" required>
            <option value="RAHUL">RAHUL</option>
            <option value="TUSHAR AGARWAR (MD)">TUSHAR AGARWAL (MD)</option>
            <option value="LESHANT">LESHANT</option>
            <option value="OTHER">OTHER</option>
           </select>

           <label  style="color: #a93226;font-weight: bold; font-size:100%;font-family:Arial;">Clint Name*</label>
            <input type="text" id="msaf73" name="Ledger" required placeholder="Enter Cline Name"> 

            <label  style="color: #a93226;font-weight: bold; font-size:100%;font-family:Arial;">Firm Name/ Order Details*</label>
            <input type="text" id="msaf74" name="VNo" required placeholder="Enter Firm Name/ Order Details"> 

            <label  style="color: #a93226;font-weight: bold; font-size:100%;font-family:Arial;">Address*</label>
            <input type="text" id="msaf75" name="Reff" placeholder="Enter Address"style="text-transform: uppercase;">
         
       

          <label  style="color: #a93226;font-weight: bold; font-size:100%;font-family:Arial;">Job/Reff No.*</label>
          <input type="text" id="msaf76" name="Amount" placeholder="Enter Job/Reff No."style="text-transform: uppercase;">

          <label  style="color: #a93226;font-weight: bold; font-size:90%;font-family:Arial;">Status</label>
          <select id="msaf77" name="Weight" required>
            <option value="RUNNING">Running</option>
            <option value="COMPLETED">Completed</option>
            <option value="CANCELED">Canceled</option>
            <option value="PENDING">Pending</option>
           </select>

          <input type="hidden" name="Timestamp" id="timestampREFFNO">
          <input type="submit" id="submitREFFNOButton" value="Submit">
        </form>
    

         <H3 style="color: red ;font-size: 100%; text-align: center;">**Select the Voucher option for Entry Mody</H3>

        <form id="modifyREFFNOForm">
          <input type="hidden" id="formModeREFFNO" name="formModeREFFNO" value="new">
            <input type="number" style="display:none;" id="searchREFFNOSNo" placeholder="Enter S.No. to Modify Entry" >
            <button type="button" class="fetchbtn" onclick="fetchREFFNODetails()" style="display:none;">Fetch Details</button>
            <button type="button" class="fetchbtn" id="modifyREFFNOButton" onclick="modifyREFFNOEntry()" style="display:none;">Modify Entry</button>
             <!-- Wait message div -->
<div id="waitREFFNOMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
        </form>  

    <br/>
        <span style="color:rgb(248, 163, 163);font-size:130%;font-family:Magneto;">eS |</span> 
        <span style="color:#88c5ee;font-size:130%;font-family:Magneto;">MTally</span>
   
      `

    };

   
   document.getElementById("formContent").innerHTML = contentMap[type] || "";
  }

  // ‚úÖ ‡§Ø‡§π ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§™‡•á‡§ú ‡§≤‡•ã‡§° ‡§π‡•ã‡§§‡•á ‡§π‡•Ä default option ‡§ï‡§æ content ‡§¶‡§ø‡§ñ‡•á
  //window.onload = function () {
    //  document.getElementById("designUSER").value = "CREAT";
    // showForm("CREAT");
  // };
  

</script>


<!-- job/reff VOUCHER form div code  stop hare -->


            
<!-- job/reff VOUCHER new entry form div script start hare 11111111111111111111111111111111 -->
<script>
  const scriptREFFNOURL = 'https://script.google.com/macros/s/AKfycbw0xCIuyevQ3rXPs_sa-9yQGZ50eSIFGMwta7Rq0GqEXHCWDJqi5e4xvdE1hh1NSdU/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainREFFNOForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeREFFNO").value; //****
    const submitREFFNOButton = document.getElementById("submitREFFNOButton");
    submitREFFNOButton.disabled = true;
    submitREFFNOButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampREFFNO').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifyREFFNOEntry();
    } else {
      await submitREFFNOEntry(form);
    }

    submitREFFNOButton.disabled = false;
    submitREFFNOButton.value = "Submit";
  });

  async function submitREFFNOEntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptREFFNOURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully! ‚úî');
        form.reset(); // FORM RESET
        document.getElementById("formModeREFFNO").value = "new";
     
         fetchldgrreffDP();  // ‚úÖ Refresh dropdowns or UI
         jobbPOReffload(); //

           // ‚úÖ Remove DLT option after submit
        const jobreffDropdown = document.getElementById("msaf70");
        const dltJOBOption = [...jobreffDropdown.options].find(opt => opt.value === "DLT");
        if (dltJOBOption) {
          jobreffDropdown.removeChild(dltJOBOption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchREFFNODetails() {
    const sNo = document.getElementById("searchREFFNOSNo").value;
    const waitMessage = document.getElementById("waitREFFNOMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitREFFNOButton").style.display = "none";  //****
    try {
      const response = await fetch(`${scriptREFFNOURL}?sNo=${sNo}`);
      const data = await response.json();

      if (data.result !== "error" && (data.Type === "PRAKHAR" || data.Type === "HARSHIT")) {
        document.getElementById("sNo").value = data.SNo;
        document.getElementById("msaf70").value = data.Voucher;
        document.getElementById("msaf71").value = data.Type;
        document.getElementById("msaf72").value = data.Date;
        document.getElementById("msaf73").value = data.Ledger;
        document.getElementById("msaf74").value = data.VNo;
        document.getElementById("msaf75").value = data.Reff;
        document.getElementById("msaf76").value = data.Amount;
        document.getElementById("msaf77").value = data.Weight;
      //  document.getElementById("modifyREFFNOButton").style.display = "inline-block";


       // ‚úÖ Add "DLT - delete" option if it doesn't exist already
const jobreffDropdown = document.getElementById("msaf70");
if (![...jobreffDropdown.options].some(opt => opt.value === "DLT")) {
  const dltOptionJOBREFF = document.createElement("option");
  dltOptionJOBREFF.value = "DLT";
  dltOptionJOBREFF.text = "Delete";
  dltOptionJOBREFF.style.color = "red";
  dltOptionJOBREFF.style.backgroundColor = "blue";
  jobreffDropdown.appendChild(dltOptionJOBREFF);
}

       document.getElementById("formModeREFFNO").value = "modify"; // ‚úÖ Set to modify
    //    document.getElementById("modifyREFFNOButton").style.display = "inline-block";

    // ‚úÖ Show alert after successful data fetch
      alert(" Select Delete Option in User Section For Delete Entry");

      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifyREFFNOEntry() {
    const waitMessage = document.getElementById("waitREFFNOMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainREFFNOForm');

    // ‚úÖ Set new timestamp
    const now = new Date();
    document.getElementById('timestampREFFNO').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptREFFNOURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeREFFNO").value = "new"; // ‚úÖ Reset to new
      
         fetchldgrreffDP();  // ‚úÖ Refresh dropdowns or UI
         jobbPOReffload(); //
        document.getElementById("submitREFFNOButton").style.display = "inline-block";
        document.getElementById("modifyREFFNOButton").style.display = "none";

          // ‚úÖ Remove DLT option after modify
        const jobreffDropdown = document.getElementById("msaf71");
        const dltJOBOption = [...jobreffDropdown.options].find(opt => opt.value === "DLT");
        if (dltJOBOption) {
          jobreffDropdown.removeChild(dltJOBOption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>

<!-- job/reff VOUCHER new entry form div script stop hare 11111111111111111111111111111111 -->



<!-- job/reff VOUCHER form entry modify form div script start hare 2222222222222222222222222222 -->

       <script>
  const scriptReffMDFYURL = 'https://script.google.com/macros/s/AKfycbw0xCIuyevQ3rXPs_sa-9yQGZ50eSIFGMwta7Rq0GqEXHCWDJqi5e4xvdE1hh1NSdU/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainJBMDFYForm") return;

    e.preventDefault();

    const formMode = document.getElementById("formModeReffMDFY").value;
    const submitReffMDFYButton = document.getElementById("submitReffMDFYButton");
    submitReffMDFYButton.disabled = true;
    submitReffMDFYButton.value = "Wait..";

    const now = new Date();
    const timestamp = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
    document.getElementById('timestampReffMDFY').value = timestamp;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    if (formMode === "modify") {
      await modifyReffMDFYEntry(timestamp);
    } else {
      await submitReffMDFYEntry(form);
    }

    submitReffMDFYButton.disabled = false;
    submitReffMDFYButton.value = "Submit";
  });

  async function submitReffMDFYEntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptReffMDFYURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully! ‚úî');
        form.reset();
        document.getElementById("formModeReffMDFY").value = "new";
      document.getElementById("submitReffMDFYButton").style.display = "none";
      
        fetchldgrreffDP();
        jobbPOReffload();

        const jobreffDropdown = document.getElementById("msafMFDY70");
        const dltJOBOption = [...jobreffDropdown.options].find(opt => opt.value === "DLT");
        if (dltJOBOption) {
          jobreffDropdown.removeChild(dltJOBOption);
        }
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }

  async function fetchReffMDFYDetails() {
    const sNo = document.getElementById("searchReffMDFYSNo").value;
    const waitMessage = document.getElementById("waitReffMDFYMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

    try {
      const response = await fetch(`${scriptReffMDFYURL}?sNo=${sNo}`);
      const data = await response.json();

      if (data.result !== "error" && (data.Type === "PRAKHAR" || data.Type === "HARSHIT")) {
        document.getElementById("sNo").value = data.SNo;
        document.getElementById("msafMFDY70").value = data.Voucher;
        document.getElementById("msafMFDY71").value = data.Type;
        document.getElementById("msafMFDY72").value = data.Date;
        document.getElementById("msafMFDY73").value = data.Ledger;
        document.getElementById("msafMFDY74").value = data.VNo;
        document.getElementById("msafMFDY75").value = data.Reff;
        document.getElementById("msafMFDY76").value = data.Amount;
        document.getElementById("msafMFDY77").value = data.Weight;

        // ‚úÖ Save to hidden fields for modify
        document.getElementById("savedVoucher").value = data.Voucher;
        document.getElementById("savedType").value = data.Type;
        document.getElementById("savedRate").value = data.Rate;
        document.getElementById("savedNarration").value = data.Narration;
        document.getElementById("savedVType").value = data.VType;

         document.getElementById("submitReffMDFYButton").style.display = "inline-block";  // Show modify

    

        document.getElementById("formModeReffMDFY").value = "modify";
        alert(" View Entry Details and Modify Field.");
      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }
async function modifyReffMDFYEntry(timestamp) {
  const form = document.getElementById("mainJBMDFYForm");
  const waitMessage = document.getElementById("waitReffMDFYMessage");
  waitMessage.innerText = "Please wait...";
  waitMessage.style.display = "block";

  const formData = new FormData();
  formData.append('SNo', document.getElementById('sNo').value);
  formData.append('Voucher', document.getElementById('savedVoucher').value);
  formData.append('Type', document.getElementById('savedType').value);
  formData.append('Date', document.getElementById('msafMFDY72').value);
  formData.append('Ledger', document.getElementById('msafMFDY73').value);
  formData.append('VNo', document.getElementById('msafMFDY74').value);
  formData.append('Rate', document.getElementById('savedRate').value);
  formData.append('Narration', document.getElementById('savedNarration').value);
  formData.append('VType', document.getElementById('savedVType').value);
  formData.append('Reff', document.getElementById('msafMFDY75').value);
  formData.append('Amount', document.getElementById('msafMFDY76').value);
  formData.append('Weight', document.getElementById('msafMFDY77').value);
  formData.append('timestamp', timestamp);
  formData.append('formMode', 'modify');

     

  try {
    const response = await fetch(scriptReffMDFYURL, {
      method: 'POST',
      body: formData
    });

    const result = await response.json();

    if (result.result === 'success') {
      alert('Entry modified successfully!');
      form.reset();
      document.getElementById("formModeReffMDFY").value = "new";
     
      fetchldgrreffDP();
      jobbPOReffload();
      document.getElementById("submitReffMDFYButton").style.display = "none";
    } else {
      alert(`Error modifying entry: ${result.error}`);
    }
  } catch (error) {
    alert(`Error: ${error.message}`);
  } finally {
    setTimeout(() => waitMessage.style.display = 'none', 2000);
  }
}

</script>

<!-- job/reff VOUCHER form entry modify form div script stop  hare 22222222222222222222222222-->




<!-- job/reff TOP 10 ENTRY WITH TOTAL JOB BY USER script START hare -->

<script>
   let sheetJRdata = []; // Store filtered and sorted data

// Function to load the data from Google Sheets
async function jobbPOReffload() {
    const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
    const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
    const range = 'FORM!A:N';
    const jobRefResultsDiv = document.getElementById("jobRefResults");

    try {
        jobRefResultsDiv.innerHTML = "<p>Loading job reference data...</p>";

        const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
        );
        const data = await response.json();

        if (data.values) {
            // Filter and store only the entries where column K (index 10) is "JOB/REFF"
            sheetJRdata = data.values.filter(row => row.length > 10 && row[10] === "JOB/REFF");

            // Sort the filtered data by column A (index 0) in descending order
            sheetJRdata.sort((a, b) => (b[0] > a[0] ? 1 : -1));

            console.log("Filtered and Sorted Data:", sheetJRdata);

            // Display results and summary
            displayJOBNOResults(getFilteredJOBNOData("latestEntry"));
            displayJOBNOSummary();

            // Update `jobRefResults` div with summary
            jobRefResultsDiv.innerHTML = `
                <p><strong>Total Job/Ref:</strong> ${sheetJRdata.length}</p>
                <p><strong>Last Updated:</strong> ${new Date().toLocaleString()}</p>
            `;
        } else {
            jobRefResultsDiv.innerHTML = "<p>No data found in the specified range.</p>";
            console.error("No data found in the specified range.");
        }
    } catch (error) {
        jobRefResultsDiv.innerHTML = "<p>Error loading data.</p>";
        console.error("Error fetching data from Google Sheets:", error);
    }
}

// Function to handle the dropdown selection
function jobPOreffDropdown() {
    const filterType = document.getElementById("filterType").value;
    displayJOBNOResults(getFilteredJOBNOData(filterType));
}

// Function to filter data based on the selected option
function getFilteredJOBNOData(filterType) {
    let filteredData = [];
    switch (filterType) {
        case "latestEntry":
            filteredData = sheetJRdata.slice(0, 10); // Get last 10 entries
            break;
        case "allJobreff":
            filteredData = sheetJRdata; // Show all "JOB/REFF" entries
            break;
        case "userHarshit":
            filteredData = sheetJRdata.filter(row => row.length > 1 && row[1].toLowerCase() === "harshit");
            break;
        case "userPrakhar":
            filteredData = sheetJRdata.filter(row => row.length > 1 && row[1].toLowerCase() === "prakhar");
            break;
    }
    return filteredData;
}

// Function to display the filtered results in a table
function displayJOBNOResults(entries) {
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    if (entries.length === 0) {
        resultsDiv.innerHTML = "<p>No matching records found.</p>";
        return;
    }

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const tbody = document.createElement("tbody");

    // Create table header
    const headerRow = document.createElement("tr");
    const headers = ["S.No", "User", "Order By", "Client Name", "Firm Name/Details", "Address", "Job/Reff No.", "Status", "PO Amount", "PO Weight", "V.Code", "Pdf."];
    headers.forEach(headerText => {
        const th = document.createElement("th");
        th.textContent = headerText;
        headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    // Create table body with filtered entries
    entries.forEach(entry => {
        const row = document.createElement("tr");

        entry.forEach((cell, index) => {
            const td = document.createElement(index === 0 ? 'th' : 'td');

            // If the cell is a URL, make it clickable
            if (typeof cell === "string" && (cell.startsWith('http') || cell.startsWith('www'))) {
                const a = document.createElement('a');
                a.href = cell;
                a.innerHTML = "&#128221;"; // Icon (üìë)
                a.target = "_blank";
                td.appendChild(a);
            } else {
                td.textContent = cell;
            }

            row.appendChild(td);
        });

        tbody.appendChild(row);
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    resultsDiv.appendChild(table);
}

// Function to display the summary of "Prakhar" and "Harshit" counts
function displayJOBNOSummary() {
    const summaryDiv = document.getElementById("summary");
    
    const prakharCount = sheetJRdata.filter(row => row.length > 1 && row[1].toLowerCase() === "prakhar").length;
    const harshitCount = sheetJRdata.filter(row => row.length > 1 && row[1].toLowerCase() === "harshit").length;

    summaryDiv.innerHTML = `
        <p><strong>Total Project By Prakhar:</strong> ${prakharCount}</p>
        <p><strong>Total Project By Harshit:</strong> ${harshitCount}</p>
    `;
}

// Run on page load
//  window.onload = jobbPOReffload;
</script>




<!-- job/reff TOP 10 ENTRY WITH TOTAL JOB BY USER  script stop hare -->

<!-- Finction Key Attech SCript Start  hare  ================= -->
<script>
// ‚úÖ Keyboard shortcuts
document.addEventListener("keydown", function(event) {
  // üü¢ F1
  if (event.key === "F1") {
    event.preventDefault();
    document.getElementById("f1")?.click();
    setTimeout(() => document.getElementById("closeDialog")?.focus(), 50);
  }

  // üü¢ F2
  if (event.key === "F2") {
    event.preventDefault();
    document.getElementById("f2")?.click();
  }

  // üü¢ F3
  if (event.key === "F3") {
    event.preventDefault();
    document.getElementById("f3")?.click();
    setTimeout(() => document.getElementById("searchBar")?.focus(), 50);
  }

  // üü¢ F4
  if (event.key === "F4") {
    event.preventDefault();
    document.getElementById("f4")?.click();
    setTimeout(() => document.getElementById("search123Input")?.focus(), 50);
  }

  // üü¢ F6
  if (event.key === "F6") {
    event.preventDefault();
    document.getElementById("f6")?.click();
    setTimeout(() => document.getElementById("searchADMINInput")?.focus(), 50);
  }

  // üü¢ F9 (New)
  if (event.key === "F9") {
    event.preventDefault();
    document.getElementById("f3")?.click(); // Step 1: Click f3

    // Step 2: Wait and click button with data-value="psw"
    setTimeout(() => {
      const pswButton = document.querySelector('button[data-value="psw"]');
      if (pswButton) pswButton.click();

      // Step 3: Focus the input box after everything is ready
      setTimeout(() => {
        const input = document.getElementById("search2011Input");
        if (input) input.focus();
      }, 100);
    }, 100);
  }
});
</script>
<!-- Finction Key Attech SCript stop  hare  ================= -->




<!-- loading summry  script start hare -->

<script>
// ===== CSS injected via JS (no <style> tag used) =====
const css = `
   /* Status Colors */
  .status-loading    { background-color: #ff4d4d; color: #fff; font-weight: bold; }
  .status-processing { background-color: #fd2222; color: #fff; font-weight: bold; }
  .status-processed  { background-color: #28a745; color: #fff; font-weight: bold; }
  .status-complete   { background-color: #28a745; color: #fff; font-weight: bold; }
  .status-unloading  { background-color: #39b3d8; color: #fff; font-weight: bold; }
`;
(function applyCSS(c){
  const s = document.createElement('style');
  s.textContent = c;
  document.head.appendChild(s);
})(css);

// ===== Notice Board Script =====
const apiNBKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheetNBId = "1Bx0FqnXHadVATN9DGhUtRZr2EDgz10hfDEgIlwtSC_4";
const rangeNB = "DATABASE!K:R";

async function loadNoticeBoard() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetNBId}/values/${rangeNB}?key=${apiNBKey}`;
  const response = await fetch(url);
  const data = await response.json();
  
  const rows = data.values;
  const tbody = document.querySelector("#noticeBoard tbody");
  tbody.innerHTML = "";

  if (!rows || rows.length <= 1) {
    tbody.innerHTML = `<tr><td colspan="7">No Data Found</td></tr>`;
    return;
  }

  // Last 3 days range
  const today = new Date();
  let allowedDates = [];
  for (let i = 0; i < 3; i++) {
    let d = new Date();
    d.setDate(today.getDate() - i);
    allowedDates.push(formatDateToYYYYMMDD(d));
  }

  rows.forEach((row, index) => {
    if (index === 0) return; // skip header

    const dateInL = row[1]; // Column L
    const formattedDate = dateInL ? formatCustomDate(dateInL) : "";

    if (allowedDates.includes(formattedDate)) {
      const tr = document.createElement("tr");

      for (let i = 0; i <= 6; i++) {
        const td = document.createElement("td");
        td.textContent = row[i] || "";

        // Status color coding
        if (i === 5) {
          const status = (row[i] || "").toUpperCase();
          if (status === "LOADING") td.classList.add("status-loading");
          else if (status === "PROCESSING") td.classList.add("status-processing");
          else if (status === "PROCESSED") td.classList.add("status-processed");
          else if (status === "UNLOADING") td.classList.add("status-unloading");
          else if (status === "COMPLETE") td.classList.add("status-complete");
        }
        tr.appendChild(td);
      }

      tbody.appendChild(tr);
    }
  });
}

// Format date to YYYY-MM-DD
function formatDateToYYYYMMDD(dateObj) {
  const y = dateObj.getFullYear();
  const m = String(dateObj.getMonth() + 1).padStart(2, "0");
  const d = String(dateObj.getDate()).padStart(2, "0");
  return `${y}-${m}-${d}`;
}

// Convert "13-Aug-2025" to YYYY-MM-DD
function formatCustomDate(dateStr) {
  const months = {
    Jan: "01", Feb: "02", Mar: "03", Apr: "04", May: "05", Jun: "06",
    Jul: "07", Aug: "08", Sep: "09", Oct: "10", Nov: "11", Dec: "12"
  };
  const parts = dateStr.split("-");
  if (parts.length === 3) {
    const day = parts[0].padStart(2, "0");
    const month = months[parts[1]];
    const year = parts[2];
    return `${year}-${month}-${day}`;
  }
  return "";
}


//................................
// ===== UL for Points in Column S2:S6 =====
async function loadPointsList() {
  const pointRange = "DATABASE!S2:S6";
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetNBId}/values/${pointRange}?key=${apiNBKey}`;
  const response = await fetch(url);
  const data = await response.json();
  
  const rows = data.values;
  const ul = document.getElementById("pointsList");
  ul.innerHTML = "";

  if (!rows || rows.length === 0) {
    ul.innerHTML = "<li>No Points Found</li>";
    return;
  }

  rows.forEach(row => {
    const val = row[0]?.trim();
    if (val) {
      const li = document.createElement("li");
      li.textContent = val;
      ul.appendChild(li);
    }
  });
}

loadPointsList();
//................................

loadNoticeBoard();
</script>
<!-- loading summry  script stop hare -->







<!---------------------------- DATAMIPLTABLE SCRIPT START HERE ---------------------------------------- -->

<script>
const apidbookKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheetdbookId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
const rangedbook = 'FORM!A:K';
const apipdfUrl = "https://script.google.com/macros/s/AKfycbwRAHlS8JeIXSEbPVjUNVrXkpfVOmNc2z95OZsygdzebtk-sgLV-86eWyZ20jVHspYe/exec";

let allTableData = [];
let monthlyData = {};

function getMonthFromDate(dateStr) {
  const d = new Date(dateStr);
  if (isNaN(d)) return "";
  return d.toLocaleString('default', { month: 'short' }) + "-" + d.getFullYear();
}

// ‚úÖ Main data load
async function loadDATAMIPLTABLE() {
  const table = document.getElementById("MIPLDATATABLE");
  table.innerHTML = "<tr><th>Loading...</th></tr>";

  try {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetdbookId}/values/${rangedbook}?key=${apidbookKey}`;
    const response = await fetch(url);
    const data = await response.json();

    if (!data.values) {
      table.innerHTML = "<tr><td>No data</td></tr>";
      return;
    }

    const header = data.values[0];
    const allRows = data.values.slice(1);

    // ‚úÖ Table rows ‚Äî only show where column K (index 10) = "SALE"
    const tableRows = allRows.filter(r => r[10]?.toUpperCase().trim() === "SALE");
    tableRows.sort((a, b) => Number(b[0]) - Number(a[0]));
    allTableData = [header, ...tableRows];

    // ‚úÖ Monthly totals from *all* rows (SALE + RECEIPT etc.)
    monthlyData = {};
    allRows.forEach(r => {
      const month = getMonthFromDate(r[2]);
      if (!month) return;
      if (!monthlyData[month]) monthlyData[month] = { receipt: 0, sale: 0 };

      const type = r[1]?.toUpperCase().trim();
      if (["BANK", "RECEIPT"].includes(type)) {
        monthlyData[month].receipt += Number(r[4]) || 0;
      }
      if (type === "TAX INVOICE") {
        monthlyData[month].sale += Number(r[6]) || 0;
      }
    });

    populateMonthDropdown(Object.keys(monthlyData));

    // ‚úÖ Show only latest 10 entries at start
    renderDATAMIPLTABLE(allTableData, true);

    // ‚úÖ Show current month totals
    const today = new Date();
    const currentKey = today.toLocaleString('default', { month: 'short' }) + "-" + today.getFullYear();
    const dropdown = document.getElementById("monthDropdown");

    if (monthlyData[currentKey]) {
      dropdown.value = currentKey;
      updateMonthlyTotalsDisplay(monthlyData[currentKey]);
    }

  } catch (err) {
    console.error(err);
    table.innerHTML = "<tr><td>Load Error</td></tr>";
  }
}

// ‚úÖ Dropdown
function populateMonthDropdown(months) {
  const dropdown = document.getElementById("monthDropdown");
  dropdown.innerHTML = `<option value="">Select Month</option>`;
  months.forEach(m => {
    const opt = document.createElement("option");
    opt.value = m;
    opt.textContent = m;
    dropdown.appendChild(opt);
  });

  dropdown.addEventListener("change", () => {
    const m = dropdown.value;
    if (m) {
      updateMonthlyTotalsDisplay(monthlyData[m]);
      filterMonthTable(m);
    }
  });
}

// ‚úÖ Filter table by month (still only "SALE" rows)
function filterMonthTable(month) {
  const filtered = [
    allTableData[0],
    ...allTableData.slice(1).filter(r => getMonthFromDate(r[2]) === month)
  ];
  renderDATAMIPLTABLE(filtered, false);
}

// ‚úÖ Totals display
function updateMonthlyTotalsDisplay(t) {
  if (!t) return;
  document.getElementById("monthlyTotals").innerHTML = `
    <span style="color:#4067DD;font-weight:bold;">Receipt: ‚Çπ${t.receipt.toFixed()}</span> | 
    <span style="color:#710000;font-weight:bold;">Sale: ‚Çπ${t.sale.toFixed()}</span>
  `;
}

// ‚úÖ Render table
function renderDATAMIPLTABLE(data, limit10 = false) {
  const table = document.getElementById("MIPLDATATABLE");
  table.innerHTML = "";

  const thead = document.createElement("thead");
  const tbody = document.createElement("tbody");

  const headerRow = data[0];
  const trh = document.createElement("tr");
  headerRow.forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    trh.appendChild(th);
  });
  trh.appendChild(document.createElement("th")).textContent = "Actions";
  thead.appendChild(trh);

  let rows = data.slice(1);
  if (limit10) rows = rows.slice(0, 9); // startup limit

  rows.forEach(r => {
    const tr = document.createElement("tr");
    const type = r[1]?.toUpperCase();

    // ‚úÖ Color logic
    if (type === "BANK") tr.style.color = "red";
    if (type === "CREDIT NOTE") tr.style.color = "grey";
    if (type === "CHALLAN") tr.style.color = "green";

    r.forEach(c => {
      const td = document.createElement("td");
      td.textContent = c || "";
      tr.appendChild(td);
    });

    // ‚úÖ BILL + PL LIST buttons
    const action = document.createElement("td");
    const invoice = r[4]?.trim();

    if (invoice && type === "TAX INVOICE") {
      const b1 = document.createElement("button");
      b1.textContent = "BILL";
      b1.onclick = () => openFile(invoice.replace("/", "_"));

      const b2 = document.createElement("button");
      b2.textContent = "PL LIST";
      b2.onclick = () => openFile(invoice);

      b1.style.cssText = b2.style.cssText = "padding:3px 7px;color:white;border:none;border-radius:4px;cursor:pointer;";
      b1.style.background = "#1F39FF";
      b2.style.background = "#28A745";

      action.style.display = "flex";
      action.style.gap = "8px";
      action.append(b1, b2);
    }

    tr.appendChild(action);
    tbody.appendChild(tr);
  });

  table.append(thead, tbody);
}

// ‚úÖ PDF Open
function openFile(key) {
  fetch(apipdfUrl + "?invoice=" + encodeURIComponent(key))
    .then(res => res.text())
    .then(url => url !== "NOT_FOUND" ? window.open(url, "_blank") : alert("File not found!"))
    .catch(() => alert("Error loading file"));
}

// ‚úÖ Search system
function searchDataMIPL() {
  const q = document.getElementById("DATASEARCMIPL").value.toLowerCase();
  if (!q) return renderDATAMIPLTABLE(allTableData, true);

  const filtered = [
    allTableData[0],
    ...allTableData.slice(1).filter(r => r.some(c => c?.toLowerCase().includes(q)))
  ];

  renderDATAMIPLTABLE(filtered, false);
}

// ‚úÖ Initialize
document.addEventListener("DOMContentLoaded", () => {
  loadDATAMIPLTABLE();
  document.getElementById("DATASEARCMIPL").addEventListener("keyup", searchDataMIPL);
});
</script>

<!---------------------------- DATAMIPLTABLE SCRIPT STOP ---------------------------------------- -->



<!-- ------------------  upcl bill calculator start -------------------------------------- -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Energy Charge Calculator</title>
  <style>

    h2 { color:#333; }
    
    input { padding:5px; width:200px; }
    .total { font-weight:bold; background:#e6f7ff; }
    .editable { background:#fff8dc; }
  </style>
</head>
<body>

<script>
  // Default Values
  const defaults = {
    r1: 3.65,
    r2: 5.25,
    r3: 7.15,
    r4: 7.80,
    fixedRate: 85,
    fixedLoad: 3,
    dutyRate: 0.15,
    fuelRate: 0.14
  };

  // Reset function
  function resetDefaults() {
    for (let key in defaults) {
      document.getElementById(key).innerText = defaults[key];
    }
    document.getElementById("units").value = "";
    document.querySelectorAll("td[id$='u'], td[id$='c'], #totalEnergy, #grandTotal, #fixedAmt, #dutyAmt, #fuelAmt, #dutyUnits, #fuelUnits")
      .forEach(el => el.innerText = "0");
    document.getElementById("fixedLoad").innerText = defaults.fixedLoad;
  }

  // Calculation
  function calculateBill() {
    let units = parseFloat(document.getElementById("units").value) || 0;

    let rate1 = parseFloat(document.getElementById("r1").innerText) || defaults.r1;
    let rate2 = parseFloat(document.getElementById("r2").innerText) || defaults.r2;
    let rate3 = parseFloat(document.getElementById("r3").innerText) || defaults.r3;
    let rate4 = parseFloat(document.getElementById("r4").innerText) || defaults.r4;

    let fixedRate = parseFloat(document.getElementById("fixedRate").innerText) || defaults.fixedRate;
    let fixedLoad = parseFloat(document.getElementById("fixedLoad").innerText) || defaults.fixedLoad;
    let dutyRate = parseFloat(document.getElementById("dutyRate").innerText) || defaults.dutyRate;
    let fuelRate = parseFloat(document.getElementById("fuelRate").innerText) || defaults.fuelRate;

    // Slabs
    let s1 = Math.min(units, 100);
    let s2 = (units > 100) ? Math.min(units - 100, 100) : 0;
    let s3 = (units > 197.26) ? Math.min(units - 200, 200) : 0;
    let s4 = (units > 394.52) ? (units - 394.52) : 0;

    let c1 = s1 * rate1;
    let c2 = s2 * rate2;
    let c3 = s3 * rate3;
    let c4 = s4 * rate4;

    let totalEnergy = c1 + c2 + c3 + c4;
    let fixed = fixedRate * fixedLoad;
    let duty = units * dutyRate;
    let fuel = units * fuelRate;
    let grandTotal = totalEnergy + fixed + duty + fuel;

    // Update table
    document.getElementById("s1u").innerText = s1.toFixed(2);
    document.getElementById("s2u").innerText = s2.toFixed(2);
    document.getElementById("s3u").innerText = s3.toFixed(2);
    document.getElementById("s4u").innerText = s4.toFixed(2);

    document.getElementById("s1c").innerText = c1.toFixed(2);
    document.getElementById("s2c").innerText = c2.toFixed(2);
    document.getElementById("s3c").innerText = c3.toFixed(2);
    document.getElementById("s4c").innerText = c4.toFixed(2);

    document.getElementById("totalEnergy").innerText = totalEnergy.toFixed(2);

    document.getElementById("fixedAmt").innerText = fixed.toFixed(2);
    document.getElementById("dutyUnits").innerText = units.toFixed(2);
    document.getElementById("dutyAmt").innerText = duty.toFixed(2);
    document.getElementById("fuelUnits").innerText = units.toFixed(2);
    document.getElementById("fuelAmt").innerText = fuel.toFixed(2);

    document.getElementById("grandTotal").innerText = grandTotal.toFixed(2);
  }

  // Use DOMContentLoaded instead of window.onload
  document.addEventListener("DOMContentLoaded", resetDefaults);
</script>


</body>
</html>
<!-- ------------------  upcl bill calculator stop -------------------------------------- -->






<!-- ------------------  MIPL Repayment Sedual script and code start -------------------------------------- -->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Smart Loan Viewer ‚Äî Fixed</title>
  <style>
    :root{--primary:#007bff;--accent:#e9f1ff;--success:#28a745;--danger:#dc3545}
   
  
   
    .LRSMRY{margin-top:16px;background:var(--accent);padding:14px;border-radius:10px;display:none}
    .LRSMRY h3{margin:0 0 8px}
    .LRSMRY p{margin:6px 0}
    .scheduleLR{margin-top:18px;display:none}
   
    tfoot td{font-weight:700;background:var(--accent)}
    .printLRbtn{background:var(--success);margin-top:10px}
    .printLRbtn:hover{filter:brightness(.95)}
    .red-value{color:var(--danger);font-weight:800}
    .muted{color:#6b7280}
    .grid-row{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:8px}
    @media (max-width:720px){.grid-row{grid-template-columns:1fr}}
  </style>
</head>
<body>
 
<script>
// ---------- CONFIG (keep your key/range as needed) ----------
const apiLCKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM"; // consider securing this
const sheetLCId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
const rangeLC = "HOLIDAY!I:S"; // values returned will map to row[0]..row[10]

let loanData = []; 
let currentLoan = null;

// ---------- small helpers ----------
function parseNumber(val){
  if (val === null || val === undefined) return null;
  const s = String(val).trim();
  if (s === "") return null;
  const cleaned = s.replace(/[^0-9.\-]/g, '');
  if (cleaned === '' || isNaN(Number(cleaned))) return null;
  return Number(cleaned);
}
function formatNum(n){
  if (n === null || n === undefined || isNaN(Number(n))) return '0.00';
  return Number(n).toFixed(2);
}
function safeStr(v){ return (v === undefined || v === null) ? '' : String(v); }

function tryParseDateToISO(s){
  if (!s) return null;
  s = String(s).trim();
  const m = s.match(/^(\d{1,2})-([A-Za-z]{3})-(\d{4})$/);
  if (m){
    const day = m[1].padStart(2,'0');
    const monthMap = {Jan:'01',Feb:'02',Mar:'03',Apr:'04',May:'05',Jun:'06',Jul:'07',Aug:'08',Sep:'09',Oct:'10',Nov:'11',Dec:'12'};
    const mon = monthMap[m[2]] || '01';
    return `${m[3]}-${mon}-${day}`;
  }
  if (/^\d{4}-\d{1,2}-\d{1,2}/.test(s)){
    const d = new Date(s);
    if (!isNaN(d)) return d.toISOString().slice(0,10);
  }
  const d = new Date(s);
  if (!isNaN(d)) return d.toISOString().slice(0,10);
  return null;
}

// NEW: format date as "26-Sep-2025"
function formatDateDisplay(input){
  if (!input) return '-';
  let d;
  if (input instanceof Date) d = input;
  else d = new Date(String(input));
  if (isNaN(d)) return '-';
  const day = String(d.getDate()).padStart(2,'0');
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const mon = months[d.getMonth()];
  const year = d.getFullYear();
  return `${day}-${mon}-${year}`;
}

// ---------- EMI formulas ----------
function calcEMI(P, R, N){
  P = Number(P) || 0; R = Number(R) || 0; N = Number(N) || 0;
  if (N <= 0) return 0;
  const r = R/12/100;
  if (r === 0) return P / N;
  return P*r*Math.pow(1+r,N)/(Math.pow(1+r,N)-1);
}
function calcMonths(P, R, EMI){
  P = Number(P) || 0; R = Number(R) || 0; EMI = Number(EMI) || 0;
  if (EMI <= 0) return null;
  const r = R/12/100;
  if (r === 0) return Math.ceil(P/EMI);
  const denom = Math.log(1+r);
  const months = Math.log(EMI/(EMI - P*r))/denom;
  return Math.max(0, Math.round(months));
}
function calcLoan(EMI, R, N){
  EMI = Number(EMI) || 0; R = Number(R) || 0; N = Number(N) || 0;
  if (N <= 0) return 0;
  const r = R/12/100;
  if (r === 0) return EMI * N;
  return EMI*(Math.pow(1+r,N)-1)/(r*Math.pow(1+r,N));
}
function calcROI(P, EMI, N){
  P = Number(P) || 0; EMI = Number(EMI) || 0; N = Number(N) || 0;
  if (P <= 0 || EMI <= 0 || N <= 0) return null;
  let low = 0, high = 1000, mid;
  for (let i=0;i<60;i++){
    mid = (low+high)/2;
    const g = calcEMI(P, mid, N);
    if (g > EMI) high = mid; else low = mid;
  }
  return Number(mid);
}

// ---------- load loans ----------
async function loadLoans(){
  try{
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetLCId}/values/${rangeLC}?key=${apiLCKey}`;
    const res = await fetch(url);
    const data = await res.json();
    if (!data || !data.values || data.values.length < 2){
      console.warn('No loan rows found in sheet or empty response');
      return;
    }
    loanData = data.values.slice(1);

    const dropdown = document.getElementById('loanDropdown');
    while (dropdown.options.length > 1) dropdown.remove(1);

    loanData.forEach((row, idx) => {
      const id = row[2] !== undefined ? String(row[2]) : `row-${idx}`;
      const label = (safeStr(row[10]) || (`${safeStr(row[0])} ${safeStr(row[1])} ${id}`)).trim();
      const opt = document.createElement('option');
      opt.value = id;
      opt.textContent = label;
      dropdown.appendChild(opt);
    });

  }catch(err){
    console.error('Error fetching sheet:', err);
  }
}

// ---------- show details ----------
function fillLoanDetails(){
  const selectedLoan = document.getElementById('loanDropdown').value;
  const LRSMRY = document.getElementById('LRSMRY');
  if (!selectedLoan){ 
    LRSMRY.style.display='none'; 
    document.getElementById('scheduleLR').style.display='none'; 
    currentLoan=null; 
    return; 
  }

  const row = loanData.find(r => (r[2] !== undefined) && String(r[2]) === selectedLoan);
  if (!row) { 
    LRSMRY.innerHTML = '<p class="muted">Selected loan not found in data.</p>'; 
    LRSMRY.style.display='block'; 
    return; 
  }

  const formattedDateISO = tryParseDateToISO(row[4]) || null;
  let loanAmount = parseNumber(row[5]);
  let roi = parseNumber(row[6]);
  let emi = parseNumber(row[7]);
  let months = (row[8] !== undefined && row[8] !== '') ? Number(row[8]) : null;
  if (!isFinite(months)) months = null;

  let available = {amount: loanAmount !== null, roi: roi !== null, emi: emi !== null, months: months !== null};
  let availableCount = Object.values(available).filter(v=>v).length;
  let autoCalculated = null;

  if (availableCount >= 3){
    if (!available.emi){ emi = calcEMI(loanAmount, roi, months); autoCalculated='emi'; }
    else if (!available.months){ months = calcMonths(loanAmount, roi, emi); autoCalculated='months'; }
    else if (!available.amount){ loanAmount = calcLoan(emi, roi, months); autoCalculated='amount'; }
    else if (!available.roi){ roi = calcROI(loanAmount, emi, months); autoCalculated='roi'; }
  }

  currentLoan = {
    firm: safeStr(row[0]), bank: safeStr(row[1]), loanNo: safeStr(row[2]), type: safeStr(row[3]), status: safeStr(row[9]),
    startDateISO: formattedDateISO, // keep ISO for calculations
    startDate: formatDateDisplay(formattedDateISO), // display format like 26-Sep-2025
    amount: loanAmount, roi: roi, emi: emi, months: months, autoCalculated: autoCalculated
  };

  function formatValue(value, key){
    if (value === null || value === undefined || isNaN(Number(value))) return '-';
    if (key === 'months') return value + ' months';
    if (key === 'roi') return formatNum(value) + ' %';
    return '‚Çπ' + formatNum(value);
  }

  let statusColor = '#374151';
  if (currentLoan.status){
    const s = currentLoan.status.toLowerCase();
    if (s === 'closed' || s === 'closed.') statusColor = 'red';
    else if (s === 'running' || s === 'active') statusColor = 'green';
  }

  let html = `
    <h3>üìå Loan Summary</h3>
    <div class="grid-row">
      <div><strong>Firm:</strong> ${currentLoan.firm || '-'}</div>
      <div><strong>Finance By:</strong> ${currentLoan.bank || '-'}</div>
      <div><strong>Loan No:</strong> ${currentLoan.loanNo || '-'}</div>
    </div>
    <div class="grid-row">
      <div><strong>Loan Type:</strong> ${currentLoan.type || '-'}</div>
      <div><strong>Start Date:</strong> ${currentLoan.startDate || '-'}</div>
      <div><strong>Status:</strong> <span style="color:${statusColor};font-weight:700">${currentLoan.status || '-'}</span></div>
    </div>
    <p><strong>Loan Amount:</strong> ${ currentLoan.autoCalculated === 'amount' ? `<span class="red-value">${formatValue(currentLoan.amount,'amount')}</span>` : formatValue(currentLoan.amount,'amount') }</p>
    <p><strong>Rate of Interest:</strong> ${ currentLoan.autoCalculated === 'roi' ? `<span class="red-value">${formatValue(currentLoan.roi,'roi')}</span>` : formatValue(currentLoan.roi,'roi') }</p>
    <p><strong>EMI:</strong> ${ currentLoan.autoCalculated === 'emi' ? `<span class="red-value">${formatValue(currentLoan.emi,'emi')}</span>` : formatValue(currentLoan.emi,'emi') }</p>
    <p><strong>Tenure:</strong> ${ currentLoan.autoCalculated === 'months' ? `<span class="red-value">${formatValue(currentLoan.months,'months')}</span>` : formatValue(currentLoan.months,'months') }</p>
  `;

  if (availableCount >= 3){
    html += `<button onclick="generatescheduleLR()">üìë Show Repayment schedule</button>`;
  } else {
    html += `<p style="color:var(--danger)">‚ö† Not enough data to calculate repayment schedule.</p>`;
  }

  LRSMRY.innerHTML = html;
  LRSMRY.style.display = 'block';
  document.getElementById('scheduleLR').style.display = 'none';
}

// ---------- generate amortization schedule ----------
function generatescheduleLR(){
  if (!currentLoan) return alert('No loan selected');
  const { amount, roi, emi, months, startDateISO } = currentLoan;
  if (!amount || !roi || !emi || !months) return alert('Missing loan details');

  const monthlyRate = roi/12/100;
  let balance = Number(amount);
  let cumInt = 0, cumPrin = 0;
  let html = `<table><thead><tr><th>Month</th><th>Date</th><th>Opening Balance (‚Çπ)</th><th>Interest (‚Çπ)</th><th>Principal (‚Çπ)</th><th>EMI (‚Çπ)</th><th>Closing Balance (‚Çπ)</th><th>Cum. Principal (‚Çπ)</th><th>Cum. Interest (‚Çπ)</th></tr></thead><tbody>`;

  let currentDate = startDateISO ? new Date(startDateISO) : new Date();
  if (isNaN(currentDate)) currentDate = new Date();

  for (let m=1; m<=months; m++){
    const opening = balance;
    let interest = opening * monthlyRate;
    if (!isFinite(interest)) interest = 0;
    let principal = emi - interest;
    if (principal < 0) principal = 0;
    if (principal > balance) principal = balance;
    const closing = Math.max(0, opening - principal);

    cumInt += interest;
    cumPrin += principal;

    const payDate = formatDateDisplay(currentDate);
    html += `<tr><td style="text-align:center">${m}</td><td>${payDate}</td><td>${formatNum(opening)}</td><td>${formatNum(interest)}</td><td>${formatNum(principal)}</td><td>${formatNum(emi)}</td><td>${formatNum(closing)}</td><td>${formatNum(cumPrin)}</td><td>${formatNum(cumInt)}</td></tr>`;

    balance = closing;
    currentDate.setMonth(currentDate.getMonth()+1);
    if (balance <= 0) break;
  }

  html += `</tbody><tfoot><tr><td colspan="3">TOTAL</td><td>${formatNum(cumInt)}</td><td>${formatNum(cumPrin)}</td><td>${formatNum(cumInt+cumPrin)}</td><td>0.00</td><td>${formatNum(cumPrin)}</td><td>${formatNum(cumInt)}</td></tr></tfoot></table>`;

  document.getElementById('scheduleLRTable').innerHTML = html;
  document.getElementById('scheduleLR').style.display = 'block';
}

// ---------- Running loans overview ----------
function showRunningLoans(){
  if (!loanData || loanData.length === 0) return;
  const today = new Date();
  let tableHTML = `<h3>üìã Running Loans Overview</h3><table><thead><tr><th>Firm</th><th>Bank</th><th>Loan No/Type</th><th>Loan Amt</th><th>EMI Amt</th><th>Start Date</th><th>Tenure</th><th>EMI END Date</th><th>Bal. Loan</th></tr></thead><tbody>`;

  loanData.forEach(row => {
    const status = safeStr(row[9]).toLowerCase();
    if (status !== 'running' && status !== 'active') return;

    const firm = safeStr(row[0]);
    const bank = safeStr(row[1]);
    const loanNo = safeStr(row[10]);
    const emiamt = safeStr(row[7]);
    const startDateStr = row[4];
    const loanAmount = parseNumber(row[5]) || 0;
    const roi = parseNumber(row[6]) || 0;
    const emi = parseNumber(row[7]) || 0;
    const months = (row[8] !== undefined && row[8] !== '') ? Number(row[8]) : 0;

    const isoStart = tryParseDateToISO(startDateStr);
    if (!isoStart || isNaN(new Date(isoStart))) return;
    const jsDate = new Date(isoStart);

    const lastDate = new Date(jsDate);
    lastDate.setMonth(lastDate.getMonth() + Math.max(0, months) - 1);

    let monthlyRate = roi/12/100;
    let balance = loanAmount;
    let cDate = new Date(jsDate);

    for (let m=1;m<=months;m++){
      if (cDate > today) break;
      let interest = balance * monthlyRate;
      if (!isFinite(interest)) interest = 0;
      let principal = emi - interest;
      if (principal < 0) principal = 0;
      if (principal > balance) principal = balance;
      let closing = Math.max(0, balance - principal);
      balance = closing;
      cDate.setMonth(cDate.getMonth()+1);
      if (balance <= 0) break;
    }

    tableHTML += `<tr><td>${firm}</td><td>${bank}</td><td>${loanNo}</td><td>‚Çπ${formatNum(loanAmount)}</td><td>‚Çπ${emiamt}</td><td>${formatDateDisplay(isoStart)}</td><td>${months}</td><td>${formatDateDisplay(lastDate)}</td><td>‚Çπ${formatNum(balance)}</td></tr>`;
  });

  tableHTML += `</tbody></table>`;
  document.getElementById('loanbalance').innerHTML = tableHTML;
}

// ---------- PRINT FUNCTIONS ----------
// ---------- PRINT FUNCTIONS ----------
function printLoanSummaryAndSchedule() {
  const content = document.getElementById('LRSMRY').innerHTML + document.getElementById('scheduleLRTable').innerHTML;
  openPrintWindow(content, 'Loan Summary & Schedule');
}

function printLoanBalance() {
  const content = document.getElementById('loanbalance').innerHTML;
  openPrintWindow(content, 'Running Loans Overview');
}

function openPrintWindow(content, title) {
  const mywindow = window.open('', 'PRINT', 'height=600,width=800');
  mywindow.document.write(`
    <html>
    <head>
      <title>${title}</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          margin: 20px;
          color: #333;
        }
        h2, h3 {
          text-align: center;
          margin-bottom: 20px;
          color: #222;
        }
        table {
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 20px;
        }
        th, td {
          border: 1px solid #555;
          padding: 8px 12px;
          text-align: center;
          font-size: 14px;
        }
        th {
          background-color: #f2f2f2;
          font-weight: bold;
        }
        tr:nth-child(even) {
          background-color: #fafafa;
        }
        tr:hover {
          background-color: #f1f1f1;
        }
        @media print {
          body {
            margin: 10mm;
          }
          table {
            page-break-inside: auto;
          }
          tr { page-break-inside: avoid; page-break-after: auto; }
          thead { display: table-header-group; }
          tfoot { display: table-footer-group; }
        }
      </style>
    </head>
    <body>
      <h2>${title}</h2>
      ${content}
    </body>
    </html>
  `);
  mywindow.document.close();
  mywindow.focus();
  mywindow.print();
  mywindow.close();
}


// ---------- initialise ----------
window.addEventListener('DOMContentLoaded', async () => {
  await loadLoans();
  showRunningLoans();
});
</script>


</body>
</html>

<!-- ------------------  MIPL Repayment Sedual script and code stop -------------------------------------- -->


<!-- ------------------ loan calculator script and code start -------------------------------------- -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Loan Calculator</title>
  <style>
    h2 { text-align:center; }
    .LRScontainer { max-width:1100px; margin:auto; background:white; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
   
    .btn-row { display:flex; gap:10px; flex-wrap:wrap; }
    .LRSSMLY { margin-top:20px; background:#e9f1ff; padding:12px; border-radius:8px; display:none; }
    .LRSSMLY h3 { margin:0 0 10px 0; }
    .LRSschedule { margin-top:25px; display:none; }
   
    tfoot td { font-weight:bold; background:#e9f1ff; }
    .error { color:red; font-weight:bold; margin-top:10px; }
    .printLRSbtn { background:#28a745; margin-top:10px; }
    .printLRSbtn:hover { background:#1e7e34; }
    .reset-btn { background:#dc3545; }
    .reset-btn:hover { background:#a71d2a; }

    /* üîπ Print settings */
    
    @media print {
      body { background:white; }
      .LRScontainer { box-shadow:none; border:none; }
      .LRScontainer > *:not(.LRSSMLY):not(.LRSschedule) { display:none !important; }
      .LRSSMLY, .LRSschedule { display:block !important; }
      .printLRSbtn, .reset-btn, .btn-row { display:none !important; }
    }
  </style>
</head>



<script>
  function formatLRSNum(num) {
    return Number(num).toFixed(2);
  }

  function resetFORM() {
    ["loan","rate","emi","months","loanName","loanType","startDate"].forEach(id => document.getElementById(id).value="");
    document.getElementById("error").textContent = "";
    document.getElementById("LRSSMLY").style.display = "none";
    document.getElementById("LRSschedule").style.display = "none";
  }

  function autoCalculate() {
    let P = parseFloat(document.getElementById("loan").value);
    let R = parseFloat(document.getElementById("rate").value);
    const rateType = document.getElementById("rateType").value;
    let E = parseFloat(document.getElementById("emi").value);
    let N = parseFloat(document.getElementById("months").value);
    const loanName = document.getElementById("loanName").value;
    const loanType = document.getElementById("loanType").value;
    const err = document.getElementById("error");
    const LRSSMLY = document.getElementById("LRSSMLY");
    err.textContent = "";
    LRSSMLY.style.display = "none";

    let filled = [!isNaN(P), !isNaN(R), !isNaN(E), !isNaN(N)].filter(Boolean).length;
    if (filled < 3) {
      err.textContent = "‚ö†Ô∏è Please enter any 3 values.";
      return;
    }
    if (filled > 3) {
      alert("‚ö†Ô∏è Only any 3 inputs allowed. Please clear one field.");
      return;
    }

    let monthlyRate = 0;
    try {
      if (isNaN(E)) { 
        monthlyRate = (rateType === "annual") ? R/12/100 : R/100;
        E = P * monthlyRate * Math.pow(1 + monthlyRate, N) / (Math.pow(1 + monthlyRate, N) - 1);
        document.getElementById("emi").value = formatLRSNum(E);

      } else if (isNaN(P)) {
        monthlyRate = (rateType === "annual") ? R/12/100 : R/100;
        P = E * ((Math.pow(1+monthlyRate, N) - 1) / (monthlyRate * Math.pow(1+monthlyRate, N)));
        document.getElementById("loan").value = formatLRSNum(P);

      } else if (isNaN(N)) {
        monthlyRate = (rateType === "annual") ? R/12/100 : R/100;
        N = Math.log(E / (E - P * monthlyRate)) / Math.log(1 + monthlyRate);
        document.getElementById("months").value = Math.round(N);

      } else if (isNaN(R)) {
        let low = 0.000001, high = 1, guess = 0;
        for (let i = 0; i < 100; i++) {
          guess = (low + high) / 2;
          let calcEMI = P * guess * Math.pow(1 + guess, N) / (Math.pow(1 + guess, N) - 1);
          if (calcEMI > E) high = guess;
          else low = guess;
        }
        monthlyRate = guess;
        R = (rateType === "annual") ? monthlyRate * 12 * 100 : monthlyRate * 100;
        document.getElementById("rate").value = formatLRSNum(R);
      }

      const totalPayment = E * N;
      const totalInterest = totalPayment - P;
      LRSSMLY.innerHTML = `
        <h3>üìå Loan LRSSMLY</h3>
        <p><b>Loan Name:</b> ${loanName || "-"}</p>
        <p><b>Loan Type:</b> ${loanType || "-"}</p>
        <span><b>Loan Amount:</b> ‚Çπ${formatLRSNum(P)}</span>
        <span><b>EMI:</b> ‚Çπ${formatLRSNum(E)}</span>
        <span><b>Tenure:</b> ${N} months</span>  <br/>
        <span><b>Total Interest:</b> ‚Çπ${formatLRSNum(totalInterest)}</span>
        <span><b>Total Payment:</b> ‚Çπ${formatLRSNum(totalPayment)}</span>
      `;
      LRSSMLY.style.display = "block";

    } catch (e) {
      err.textContent = "‚ö†Ô∏è Calculation error. Please check inputs.";
    }
  }

  function generateLRSschedule() {
    const P = parseFloat(document.getElementById("loan").value);
    let R = parseFloat(document.getElementById("rate").value);
    const rateType = document.getElementById("rateType").value;
    const E = parseFloat(document.getElementById("emi").value);
    const N = parseFloat(document.getElementById("months").value);
    const startDate = document.getElementById("startDate").value;
    const err = document.getElementById("error");
    err.textContent = "";

    if (isNaN(P) || isNaN(R) || isNaN(E) || isNaN(N) || !startDate) {
      err.textContent = "‚ö†Ô∏è Please calculate values and enter Start Date first.";
      return;
    }

    let monthlyRate = (rateType === "annual") ? R/12/100 : R/100;
    let balance = P, cumInt=0, cumPrin=0;
    let html = `<table><thead>
      <tr>
        <th>Month</th>
        <th>Date</th>
        <th>Opening Balance (‚Çπ)</th>
        <th>Interest (‚Çπ)</th>
        <th>Principal (‚Çπ)</th>
        <th>EMI (‚Çπ)</th>
        <th>Closing Balance (‚Çπ)</th>
        <th>Cum. Principal (‚Çπ)</th>
        <th>Cum. Interest (‚Çπ)</th>
      </tr></thead><tbody>`;

    let currentDate = new Date(startDate);

    for (let m=1; m<=N; m++) {
      let interest = balance * monthlyRate;
      let principal = E - interest;
      if (principal > balance) principal = balance; 
      let closing = balance - principal;
      cumInt += interest;
      cumPrin += principal;

      let payDate = currentDate.toLocaleDateString("en-GB");
      html += `<tr>
        <td>${m}</td>
        <td>${payDate}</td>
        <td>${formatLRSNum(balance)}</td>
        <td>${formatLRSNum(interest)}</td>
        <td>${formatLRSNum(principal)}</td>
        <td>${formatLRSNum(E)}</td>
        <td>${formatLRSNum(closing)}</td>
        <td>${formatLRSNum(cumPrin)}</td>
        <td>${formatLRSNum(cumInt)}</td>
      </tr>`;

      balance = closing;
      currentDate.setMonth(currentDate.getMonth()+1);
      if (balance <= 0) break;
    }

    html += `</tbody>
      <tfoot>
        <tr>
          <td colspan="3">TOTAL</td>
          <td>${formatLRSNum(cumInt)}</td>
          <td>${formatLRSNum(cumPrin)}</td>
          <td>${formatLRSNum(cumPrin+cumInt)}</td>
          <td>0.00</td>
          <td>${formatLRSNum(cumPrin)}</td>
          <td>${formatLRSNum(cumInt)}</td>
        </tr>
      </tfoot></table>`;

    document.getElementById("LRSscheduleTable").innerHTML = html;
    document.getElementById("LRSschedule").style.display="block";
  }


  function printLRSschedule() {
  // Sirf ye 2 div print karne hain
  const printContent = `
    <div style="font-family: Arial; padding: 20px;">
      ${document.getElementById("LRSSMLY").outerHTML}
      ${document.getElementById("LRSscheduleTable").outerHTML}
    </div>
  `;
  
  // Original page content save karo
  const originalContent = document.body.innerHTML;
  
  // Page me temporary sirf ye hi content show karo
  document.body.innerHTML = printContent;
  
  // Print karo
  window.print();
  
  // Original content restore karo
  document.body.innerHTML = originalContent;
}
</script>

</body>
</html>

<!-- ------------------ loan calculator script and code stop -------------------------------------- -->






<!-- 2011 table code and script start HARE ...................................... -->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Google Sheet Filter Table with Totals</title>
<style>

  .filter-container { position: relative; margin-bottom: 10px; display: none; }
  .dropdown { position: absolute; top: 50px; left: 0; right: 0; background: white; border: 4px solid #012228; max-height: 700px; width: 500px; overflow-y: auto; display: none; z-index: 100; }
  .dropdown div { padding: 6px; cursor: pointer; }
  .dropdown div.active { background: #0078d4; color: white; }
  .dropdown div:hover { background: #e8cd36; color: rgb(1, 3, 30); font-weight: bold;}
 #totals2011mipl { margin-top: 15px; font-size: 16px; font-weight: bold; background: #fafafa; border: 1px solid #ccc; padding: 8px; border-radius: 8px; display: none; }
  #totals2011mipl span { margin-right: 10px; }

    /* --- Clickable invoice style --- */
  #mipl2011Table td.clickable {
    color: #2B6AF3;
    cursor: pointer;
    text-decoration: underline;
  }
  #mipl2011Table td.clickable:hover {
    color: #1b4bd8;
  }
</style>
</head>
<body>
<!-- ================================================ Dishplay Report Script start hare ========================================================= -->
<script>
const api2011Key = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheet2011Id = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
const range2011 = "FORM!A:M";
const addressrange2011 = "ADDRESS!A:M"; //xxxxxxxxxxxxxxxxxx
const pswrange2011 = "M1000!A:F";
const atnrange2011 = "ATN!A:M";
const apiFileUrl = "https://script.google.com/macros/s/AKfycbyKeTGzkEsRd26seiog3jtfEXcLXNK4_fvt9b6D7kYtFXhInLr3J4PqCCgMxmsJ7rim/exec";

let sheetData = [];
let addressData = [];
let pswData = [];
let atnData = [];
let filteredData = [];
let currentFilterType = "";
let selectedLedger = "";
let selectedPO = ""; // sales btn ke poreff  ke lye po dropdown

// === HEADERS and COLUMN MAPS ===
const tableConfig = {
  search: { headers: ["Sr No","Type","Date","Ledger","Rcpt/Inv. No.","Tr./Ty","Reff. No.","Amount","Weight","Rate","Vehicle No.","V.Type"], cols:[0,1,2,3,4,11,5,6,7,8,9,10]},
  ledger: { headers: ["Sr No","Type","Date","Ledger","Rcpt/Inv. No.","Reff. No.","Amount","Weight","Rate","Vehicle No.","V.Type"], cols:[0,1,2,3,4,5,6,7,8,9,10]},
  poreff: { headers: ["Sr No","User","Order By","Clint Name","Project Name","Address","PO/Reff No.","Status","PO Amt.","PO Weight","V.Type"], cols:[0,1,2,3,4,5,6,7,8,9,10]},
  receipt: { headers:["Sr No","Type","Date","Ledger","Amount","V .Type"], cols:[0,1,2,3,4,10]},
  sale: { headers:["Sr No","Type","Date","Ledger","Inv. No.","Reff. No.","Amount","Weight","Rate","Vehicle No.","V.Type"], cols:[0,1,2,3,4,5,6,7,8,9,10]},
  address: { headers:["Clint","Address","State","Type","GSTIN","Contect Details"], cols:[0,1,2,3,4,5]},
  atn: { headers:["Sr No","Type","Date","Employee","P/A","Login Time","IP Details"], cols:[0,1,2,3,4,5,6]},
  psw: { headers:["Sr No","Type","Firm","User ID/ Password","Account Details","Other"], cols:[0,1,2,3,4,5]}
};

// === Load Sheet Data ===
async function load2011Data() {
  try {
    const resForm = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheet2011Id}/values/${range2011}?key=${api2011Key}`);
    const dataForm = await resForm.json();
    sheetData = dataForm.values || [];

    const resAddr = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheet2011Id}/values/${addressrange2011}?key=${api2011Key}`);
    const dataAddr = await resAddr.json();
    addressData = dataAddr.values || [];

     const respsw = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheet2011Id}/values/${pswrange2011}?key=${api2011Key}`);
    const datapsw = await respsw.json();
    pswData = datapsw.values || [];

     const resAtn = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheet2011Id}/values/${atnrange2011}?key=${api2011Key}`);
    const dataAtn = await resAtn.json();
    atnData = dataAtn.values || [];

    filteredData = sheetData;
    render2011Table([]);
    initledger2011Dropdown();
  } catch (e) {
    console.error("Load Error:", e);
  }
}

// === Ledger Dropdown Setup ===
// === Ledger Dropdown Setup ===
function initledger2011Dropdown() {
  // Filter only rows where column K = "SALE" or "RECEIPT"
  const validRows = sheetData.slice(1).filter(r => {
    const type = (r[10] || "").trim().toUpperCase();
    return type === "SALE" || type === "RECEIPT";
  });

  // Extract unique ledger names from column D (index 3)
  const ledgerOptions = [...new Set(validRows.map(r => r[3]).filter(v => v))]
    .sort((a, b) => a.localeCompare(b));

  // Initialize dropdown with filtered ledgers
  setupDropdown("ledger2011Input", "ledger2011Dropdown", ledgerOptions, (val) => {
    resetDates();
    selectedLedger = val;
    currentFilterType = "ledger";
    document.getElementById("totals2011mipl").style.display = "block";
    applySearch();
    showLedgerAddress(val);
  });
}



// === Show Ledger Address ===
function showLedgerAddress(ledgerName){
  const span = document.getElementById("address2011");
  if(!span) return;
  if(!ledgerName){ span.innerHTML=""; return; }

  const matchRow = addressData.find((r,i)=> i>0 && r[0]?.trim().toLowerCase() === ledgerName.trim().toLowerCase());
  if(matchRow){
    const address = matchRow[1] || "‚Äî";
    const state = matchRow[2] || "‚Äî";
    const gstin = matchRow[4] || "‚Äî";
    span.innerHTML = `<div style="margin-top:6px; padding:4px 6px; background:#f3f3f3; border-radius:4px; border:1px solid #ccc; width:fit-content;">
      <strong>Address:</strong> ${address} <strong>State:</strong> ${state} <strong>GSTIN:</strong> ${gstin}
    </div>`;
  }else{ span.innerHTML=`<em style="color:red;">No address found for "${ledgerName}"</em>`;}
}

// === Render Table ===
function render2011Table(rows){
  const tableHead = document.getElementById("tableHead");
  const table2011Body = document.getElementById("table2011Body");
  const totalsDiv = document.getElementById("totals2011mipl");
  const table = document.getElementById("mipl2011Table");

  tableHead.innerHTML="";
  table2011Body.innerHTML="";

  if(!rows || rows.length<=1){
    table.style.display="none";
    totalsDiv.style.display="none";
    return;
  }

  table.style.display="table";

  const config = tableConfig[currentFilterType] || tableConfig.search;
  const headers = config.headers;
  const cols = config.cols;

  const headerRow = document.createElement("tr");
  headers.forEach(h=>{const th=document.createElement("th"); th.textContent=h; headerRow.appendChild(th);});
  tableHead.appendChild(headerRow);

  let totalTds=0,totalReceipt=0,totalBill=0,totalCn=0,totalPEBWeight=0;

  const sortedRows = rows.slice(1).sort((a,b)=>Number(b[0])-Number(a[0]));

  sortedRows.forEach(r=>{
    const tr = document.createElement("tr");
    cols.forEach(colIndex=>{
      const cell = r[colIndex] || "";
      const td = document.createElement("td");
      if(cell && (cell.startsWith("http") || cell.startsWith("www"))){
        const a=document.createElement("a");
        a.href = cell.startsWith("http") ? cell : `https://${cell}`;
        a.innerHTML="&#128221;"; a.target="_blank"; td.appendChild(a);
      } else td.innerHTML = highlightText(cell);
      tr.appendChild(td);
    });

    const typeCell = r[1]?.toUpperCase().trim();
    if(typeCell==="BANK" || typeCell === "CASH") tr.style.color="red";
    else if(typeCell==="CREDIT NOTE") tr.style.color="grey";
    else if(typeCell==="CHALLAN") tr.style.color="green";

    table2011Body.appendChild(tr);

    if(currentFilterType==="ledger"){
      const type = r[1]?.trim().toUpperCase();
      const receipt = parseFloat(r[4]) || 0;
      const amount = parseFloat(r[6]) || 0;
      const weight = parseFloat(r[7]) || 0;
      if(type==="TDS") totalTds+=receipt;
      else if(type === "BANK" || type === "CASH") totalReceipt+=receipt;
      else if(type==="TAX INVOICE"   || type === "CHALLAN"){ totalBill+=amount; totalPEBWeight+=weight;}
      else if(type==="CREDIT NOTE") totalCn+=amount;
    }
  });

 // if(currentFilterType==="ledger"){ totalsDiv.style.display="block"; updateTotals(totalTds,totalReceipt,totalBill,totalCn,totalPEBWeight);}
 // else totalsDiv.style.display="none";



 //

 if(currentFilterType === "ledger") {
    
    // ‚úÖ Show Ledger Totals
    totalsDiv.style.display = "block";
    document.getElementById("poTotals2011mipl").style.display = "none";
    
    updateTotals(totalTds,totalReceipt,totalBill,totalCn,totalPEBWeight);
}

else if(currentFilterType === "sale") {

    // ‚úÖ Hide Ledger Totals, show PO totals
    totalsDiv.style.display = "none";
    document.getElementById("poTotals2011mipl").style.display = "block";

    // ‚úÖ Auto-update PO totals when table refresh
    updatePOTotals(rows);

} else {
    totalsDiv.style.display = "none";
    document.getElementById("poTotals2011mipl").style.display = "none";
}
//
  highlightInvoiceAndPOCells();
}

// === Highlight Text ===
function highlightText(text){
  const searchValue = document.getElementById("search2011Input")?.value.toLowerCase();
  if(!searchValue) return text;
  const regex = new RegExp(`(${searchValue})`,"gi");
  return text.replace(regex,'<span style="background:yellow;font-weight:bold;">$1</span>');
}

// === Highlight Invoice + PO clickable ===
function highlightInvoiceAndPOCells(){
  const table = document.getElementById("mipl2011Table");
  if(!table) return;
  const rows = table.getElementsByTagName("tr");
  for(let row of rows){
    const cells = row.cells;
    if(!cells || cells.length<11) continue;
    const typeText = cells[1].innerText.trim().toUpperCase();
    const invoiceCell = cells[4]; const invoiceNo = invoiceCell.innerText.trim();
    const poType = cells[10].innerText.trim().toUpperCase(); const poCell = cells[6]; const poName = poCell.innerText.trim();

    if(typeText==="TAX INVOICE" && invoiceNo){
      invoiceCell.classList.add("clickable");
      invoiceCell.onclick = ()=>{const key=invoiceNo.replace(/\//g,"_"); fetch(`${apiFileUrl}?invoice=${encodeURIComponent(key)}`).then(res=>res.text()).then(url=>url==="NOT_FOUND"?alert("Invoice not found"):window.open(url,"_blank")).catch(()=>alert("Error loading invoice"));};
    }

    if(poType==="JOB/REFF" && poName){
      poCell.classList.add("clickable");
      poCell.onclick = ()=>{const key=poName.replace(/\//g,"_"); fetch(`${apiFileUrl}?po=${encodeURIComponent(key)}`).then(res=>res.text()).then(url=>url==="NOT_FOUND"?alert("PO not found"):window.open(url,"_blank")).catch(()=>alert("Error loading PO"));};
    }
  }
}

// === Update Totals ===
function updateTotals(totalTds,totalReceipt,totalBill,totalCn,totalPEBWeight){
  document.getElementById("totalTds").textContent=totalTds.toFixed(0);
  document.getElementById("totalReceipt").textContent=totalReceipt.toFixed(0);
  document.getElementById("totalBill").textContent=totalBill.toFixed(0);
  document.getElementById("totalCn").textContent=totalCn.toFixed(0);
  document.getElementById("totalPEBWeight").textContent=totalPEBWeight.toFixed(0);
  const difference = totalBill-totalReceipt-totalTds+totalCn;         // BALANCE CALCULATION
  const diffElement=document.getElementById("totalDifference");
  diffElement.textContent=difference.toFixed(0);
  diffElement.style.color = difference<0 ? "red":"green";
}

// === Setup Dropdown ===
function setupDropdown(inputId,dropdownId,options,callback){
  const input = document.getElementById(inputId);
  const dropdown = document.getElementById(dropdownId);
  let currentIndex=-1;

  function showDropdown(list){ dropdown.innerHTML=""; if(list.length===0){dropdown.style.display="none"; return;} list.forEach(opt=>{const div=document.createElement("div"); div.textContent=opt; div.addEventListener("click",()=>selectOption(opt)); dropdown.appendChild(div);}); dropdown.style.display="block"; }
  function selectOption(value){ input.value=value; dropdown.style.display="none"; currentIndex=-1; callback(value);}
  input.addEventListener("click",()=>showDropdown(options));
  input.addEventListener("input",()=>{ const val=input.value.toLowerCase(); const filtered=options.filter(opt=>opt.toLowerCase().includes(val)); showDropdown(filtered); });
  document.addEventListener("click",(e)=>{if(!dropdown.contains(e.target) && e.target!==input) dropdown.style.display="none";});
}

// === Reset Dates ===
function resetDates(){ document.getElementById("start2011Date").value=""; document.getElementById("end2011Date").value=""; }




//  dropdown fuction in sales bttn for po reff no ke lye ============================== start
// ‚úÖ Initialize PO Dropdown only for SALE type rows
function init2011PoDropdown() {
  const saleRows = sheetData.slice(1).filter(r =>
    (r[10] || "").trim().toUpperCase() === "SALE"
  );

  const poOptions = [...new Set(saleRows.map(r => r[5]).filter(v => v))].sort();

  setupDropdown("po2011Input", "po2011Dropdown", poOptions, (val) => {
    selectedPO = val;
    applyPOFilter(val);
  });
}



// ‚úÖ Apply Filter based on selected PO
function applyPOFilter(poName) {
  if (!poName) {
    render2011Table([]);
    document.getElementById("poTotals2011mipl").style.display = "none";
    return;
  }

  const filtered = sheetData.filter((r, i) =>
    i === 0 ||
    ((r[10] || "").trim().toUpperCase() === "SALE" &&
     (r[5] || "").trim() === poName.trim())
  );

  updatePOTotals(filtered);
  render2011Table(filtered);
}



// ‚úÖ Correct totals calculation based on SALE columns
function updatePOTotals(rows) {
  let totalBill = 0;
  let totalWeight = 0;

  rows.slice(1).forEach(r => {
    totalBill += parseFloat(r[6]) || 0;  // ‚úÖ Bill Amount
    totalWeight += parseFloat(r[7]) || 0; // ‚úÖ PEB Weight
  });

  document.getElementById("poTotalAmount").textContent = totalBill.toFixed(0);
  document.getElementById("poTotalWeight").textContent = totalWeight.toFixed(0);

  document.getElementById("poTotals2011mipl").style.display = "block";
}

// =================//  dropdown fuction in sales bttn for po reff no ke lye ============================== stop



// === Apply Search / Ledger / Date Filter ===
function applySearch() {
  const val = document.getElementById("search2011Input")?.value.toLowerCase();
  const startDate = document.getElementById("start2011Date")?.value
    ? new Date(document.getElementById("start2011Date").value + "T00:00:00")
    : null;
  const endDate = document.getElementById("end2011Date")?.value
    ? new Date(document.getElementById("end2011Date").value + "T23:59:59")
    : null;

  let dataToSearch = sheetData;

  if (currentFilterType === "ledger") {
    // If ledger selected, filter by ledger + SALE/RECEIPT
    if (selectedLedger) {
      dataToSearch = sheetData.filter((r, i) =>
        i === 0 || 
        (r[3]?.trim() === selectedLedger && ["SALE", "RECEIPT"].includes((r[10] || "").trim().toUpperCase()))
      );
    } else {
      // No ledger selected, show all SALE/RECEIPT
      dataToSearch = sheetData.filter((r, i) =>
        i === 0 || ["SALE", "RECEIPT"].includes((r[10] || "").trim().toUpperCase())
      );
    }
 // } else if (["poreff", "receipt", "sale"].includes(currentFilterType)) {

 } else if (currentFilterType === "sale") {

  if (selectedPO) {
    dataToSearch = sheetData.filter((r, i) =>
      i === 0 || (
        (r[10] || "").trim().toUpperCase() === "SALE" &&
        r[5]?.trim() === selectedPO
      )
    );
  } else {
    dataToSearch = sheetData.filter((r, i) =>
      i === 0 || (r[10] || "").trim().toUpperCase() === "SALE"
    );
  }

} else if (currentFilterType === "receipt" || currentFilterType === "poreff") {
//


    const map = { poreff: "JOB/REFF", receipt: "RECEIPT", sale: "SALE" };
    dataToSearch = sheetData.filter((r, i) =>
      i === 0 || (r[10]?.trim().toUpperCase() === map[currentFilterType])
    );
  } else if (currentFilterType === "address") {
    dataToSearch = addressData;
  } else if (currentFilterType === "psw") {
    dataToSearch = pswData;
  }  else if (currentFilterType === "atn") {
    dataToSearch = atnData;
  }

  const filtered = dataToSearch.filter((row, i) => {
    if (i === 0) return true;
    const matchesSearch = !val || row.some(c => (c || "").toLowerCase().includes(val));
    const date = row[2] ? new Date(row[2]) : null;
    const matchDate = (!startDate || (date && date >= startDate)) && (!endDate || (date && date <= endDate));
    return matchesSearch && matchDate;
  });

  render2011Table(filtered);
}



// === Filter Button Click Handling ===
document.querySelectorAll("#mipl2011Buttons .filter-btn").forEach(btn => {
  btn.addEventListener("click", function() {
    // Remove active from all buttons
    document.querySelectorAll("#mipl2011Buttons .filter-btn").forEach(b => b.classList.remove("active"));
    // Set current active
    this.classList.add("active");

    currentFilterType = this.dataset.value;
    resetDates();
    document.getElementById("search2011Input").value = "";
    document.getElementById("ledger2011Select").style.display = "none";
    document.getElementById("totals2011mipl").style.display = "none";
    filteredData = sheetData;
    selectedLedger = "";

    if (currentFilterType === "ledger") {
      document.getElementById("ledger2011Select").style.display = "block";
    } 
    //
    if (currentFilterType === "sale") {
  document.getElementById("po2011Select").style.display = "block";
  init2011PoDropdown();
} else {
  document.getElementById("po2011Select").style.display = "none";
  selectedPO = "";
}
//

    applySearch();
  });
});

//++++++++++++++++++++++++++++++++++++++++++++++++++++  remove this function for voucher btn authontication


// === Filter Buttons Permission Control ===
function applyButtonPermissions() {
  const authText = document.getElementById("reportauth")?.innerText.trim() || "";
  const allowed = authText.split(",").map(a => a.trim());

  // ‚úÖ Map of data-value ‚Üí permission number
  const buttonMap = {
    "search": "1",
    "ledger": "2",
    "poreff": "3",
    "receipt": "4",
    "sale": "5",
    "address": "6",
    "atn": "7",
     "psw": "8",
    "exportBtn": "9",
    "export5792": "10",
    "export5793": "11",
    "url": "12"
  };

  // ‚úÖ Handle all buttons with a data-value attribute
  //  document.querySelectorAll("button[data-value]").forEach(btn => {    "is line lo add kro agar kewar hide unhide logic kewal buttan ke lye lagana ho aur niche wali line ko hide kro "

     document.querySelectorAll("[data-value]").forEach(btn => {
    const val = btn.dataset.value;

    // Show only if data-value exists in buttonMap and its mapped number is allowed
    if (buttonMap[val] && allowed.includes(buttonMap[val])) {
      btn.style.display = "inline-block";
    } else {
      btn.style.display = "none";
    }
  });
}

// ‚úÖ Wait for reportauth text to load/update before applying permissions
function waitForReportAuth() {
  const authSpan = document.getElementById("reportauth");
  if (!authSpan) return;

  const observer = new MutationObserver(() => {
    const text = authSpan.innerText.trim();
    if (text !== "") {
      applyButtonPermissions();
      observer.disconnect(); // stop observing once done
    }
  });

  observer.observe(authSpan, { characterData: true, subtree: true, childList: true });
}

// ‚úÖ Start observing for changes
applyButtonPermissions();
waitForReportAuth();

//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

// === Event Listeners ===
document.getElementById("search2011Input")?.addEventListener("input",applySearch);
document.getElementById("start2011Date")?.addEventListener("change",applySearch);
document.getElementById("end2011Date")?.addEventListener("change",applySearch);

load2011Data();
init2011PoDropdown(); 




//


// === PRINT FUNCTION ===
function print2011Report() {
  const table = document.getElementById("mipl2011Table");
  if (!table || table.style.display === "none") {
    alert("No table data to print!");
    return;
  }

  const printWindow = window.open("", "_blank");

  let totalsHTML = "";

  // ‚úÖ If Ledger Filter Active ‚Üí Print Ledger Totals
  if (currentFilterType === "ledger") {
    const totals = document.getElementById("totals2011mipl").cloneNode(true);

    // ‚úÖ Replace Input Box with selected Ledger Name text
    const ledgerInput = document.getElementById("ledger2011Input");
    const cloneInput = totals.querySelector("#ledger2011Input");
    if (ledgerInput && cloneInput) {
      const ledgerValue = ledgerInput.value.trim();
      cloneInput.outerHTML =
        `<strong style="padding:4px;color:#000;">Ledger: ${ledgerValue || "N/A"}</strong>`;
    }

    // ‚úÖ Hide Dropdown inside print
    let drp = totals.querySelector("#ledger2011Dropdown");
    if (drp) drp.remove();

    totalsHTML = totals.outerHTML;
  }

  // ‚úÖ If PO Filter Active ‚Üí Print PO Totals
  if (currentFilterType === "sale") {
    const poTotals = document.getElementById("poTotals2011mipl").cloneNode(true);
    const poInput = document.getElementById("po2011Input");

    // ‚úÖ Show selected PO above totals
    const selectedPOText = poInput?.value?.trim() || "(No PO Selected)";
    totalsHTML = `
      <div style="margin-bottom:10px;">
        <strong>PO Ref:</strong> ${selectedPOText}
      </div>
      ${poTotals.outerHTML}
    `;
  }

  printWindow.document.write(`
    <html>
      <head>
        <title>Print Preview - MIPL Report</title>
        <style>
          body { font-family:"Segoe UI", Arial, sans-serif; margin:20px; background:#fff; }
          h2 { text-align:center; margin-bottom:10px; margin-top:5px; }
          table { width:100%; border-collapse:collapse; margin-top:10px; }
          th, td { border:1px solid #555; padding:6px 8px; text-align:center; font-size:13px; }
          th { background-color:#efefef; }
          tr:nth-child(even){background-color:#f9f9f9;}
          tr:hover{background-color:#e6f0ff;}
          #printBtn { margin-top:20px; }
          .developer-tag { 
            text-align:left; 
            font-size:13px; 
            color:#444; 
            font-weight:bold;
          }
          @media print { 
            #printBtn{display:none;} 
            body{zoom:95%;}
          }
          strong { font-size:14px; }
        </style>
      </head>
      <body>
        <div class="developer-tag">
          Developed By - eS|MTally Kundeshwari Kashipur
        </div>
        <h2>MIPL Report Preview</h2>
        ${totalsHTML}
        ${table.outerHTML}
        <div style="text-align:center;">
          <button id="printBtn" onclick="window.print()">üñ®Ô∏è Print Now</button>
        </div>
      </body>
    </html>
  `);
  printWindow.document.close();
}


// === REFRESH FUNCTION ===
function refresh2011Data() {
  const btn = document.getElementById("refresh2011Btn");
  btn.disabled = true;
  btn.textContent = "‚è≥ Refreshing...";

  // Re-fetch data from Google Sheets
  load2011Data()
    .then(() => {
      applySearch();
      btn.textContent = "üîÑ Refresh";
      btn.disabled = false;
      alert("‚úÖ Data refreshed successfully!");
    })
    .catch((err) => {
      console.error("Refresh Error:", err);
      btn.textContent = "üîÑ Refresh";
      btn.disabled = false;
      alert("‚ùå Failed to refresh data. Check console for details.");
    });
}
document.getElementById("refresh2011Btn")?.addEventListener("click", refresh2011Data);
//

</script>

<!-- ================================================ Dishplay Report Script stop hare ========================================================= -->

</body>
</html>



<!-- ========= file export in excel & html script start ============ -->
   <style>
  .export-menu {
    position: absolute;
    background: white;
    border: 1px solid #ddd;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    border-radius: 6px;
    display: none;
    flex-direction: column;
    min-width: 100px;
    z-index: 100;
  }

  .export-menu button {
    padding: 8px 8px;
    background: none;
    border: none;
    text-align: left;
    cursor: pointer;
  }

  .export-menu button:hover {
    background: #f0f0f0;
    color: #0026ff;
  }

</style>

<!-- ====== Export Menu ====== -->
<div id="exportMenu" style="display:none; flex-direction:column; position:absolute; background:#fff; border:1px solid #ccc; padding:5px; z-index:999;">
  <button data-type="html">‚¨áÔ∏è Export HTML</button>
  <button data-type="excel">üìä Export Excel</button>
</div>


<!-- ====== Script Section ====== -->
<script>
// === Export Menu Toggle ===
const exportMenu = document.getElementById("exportMenu");
let currentTargetId = null;

// Handle all export buttons dynamically
document.querySelectorAll("[id^='export']").forEach(btn => {
  btn.addEventListener("click", (e) => {
    e.stopPropagation();
    const rect = btn.getBoundingClientRect();
    exportMenu.style.top = rect.bottom + "px";
    exportMenu.style.left = rect.left + "px";
    exportMenu.style.display = "flex";
    currentTargetId = btn.dataset.target;
  });
});

// Hide menu on outside click
document.addEventListener("click", (e) => {
  if (!exportMenu.contains(e.target)) {
    exportMenu.style.display = "none";
  }
});

// === Export Buttons Action ===
document.querySelectorAll("#exportMenu button").forEach(btn => {
  btn.addEventListener("click", () => {
    const type = btn.dataset.type;
    exportRenderedTable(currentTargetId, type);
    exportMenu.style.display = "none";
  });
});

// === Export Rendered Table Function ===
function exportRenderedTable(targetId, type) {
  const targetElement = document.getElementById(targetId);

  if (!targetElement) {
    alert("‚ö†Ô∏è No table data to export!");
    return;
  }

  // clone the table or div
  const cloned = targetElement.cloneNode(true);
  const wrapper = document.createElement("div");
  wrapper.appendChild(cloned);
  const htmlData = wrapper.innerHTML;

  let blob;
  let filename;

  if (type === "html") {
    blob = new Blob([htmlData], { type: "text/html" });
    filename = `${targetId}.html`;
  } else if (type === "excel") {
    blob = new Blob([htmlData], { type: "application/vnd.ms-excel" });
    filename = `${targetId}.xls`;
  }

  triggerDownload(blob, filename);
}

function triggerDownload(blob, filename) {
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
  URL.revokeObjectURL(link.href);
}
</script>
<!-- ========= file export in excel & html script stop ============ -->

<!-- 2011 table code and script stop HARE ...................................... -->









<!-- ================  Attendance  Confermation script and code start hare ===============================-->
<!-- ‚úÖ POPUP HTML -->
<div id="popupForm" style="
  display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:9999;">
  <div style="background:white; padding:20px; border-radius:10px; width:300px; text-align:center;">
    <h3>Daily Confirmation</h3>

   
    <!-- ‚úÖ FORM -->
    <form id="mainATNForm">
      <input type="hidden" name="SNo" id="sNo" />



      <input type="hidden" id="ipatnBox" name="cl3" readonly placeholder="IP Loading..." 
       style="padding:8px; width:250px; border:1px solid #aaa; border-radius:6px;">

<script>
// IP Fetch Function
fetch("https://api.ipify.org?format=json")
  .then(response => response.json())
  .then(data => {
     document.getElementById("ipatnBox").value = data.ip; // Input me IP set
  })
  .catch(() => {
     document.getElementById("ipatnBox").value = "Error fetching IP";
  });
</script>


      <label style="color:#fd0505;font-size:90%;font-family:Arial; font-weight: bold;">User Details</label>
      <input type="hidden" name="User" readonly value="ATN" style="width:100%; margin-bottom:8px; padding:6px;"><br>

      <input id="popup-username" name="Ledger" readonly style="width:100%; margin-bottom:8px; padding:6px;"><br>

      <input id="popup-date" type="date" name="Date" readonly style="width:100%; margin-bottom:8px; padding:6px;"><br>

      <input id="popup-status" type="hidden" name="cl1" readonly value="P" style="width:100%; margin-bottom:8px; padding:6px;"><br>

      <input type="hidden" name="cl2" id="timestampATN">
      <input type="submit" id="submitATNButton" value="Submit" style="padding:8px 16px; background:#035b67; color:white; border:none; border-radius:6px; cursor:pointer;">
 

      <div id="waitATNMessage" style="display:none; color:red; font-size:16px; font-weight:bold; margin-top:10px;"></div>
    </form>
  </div>
</div>




<script>
// ‚úÖ Google Sheet Config
const apiKey2 = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheetId2 = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
const range2 = "ATN!A:G";

// ‚úÖ Check condition after login
async function checkPopupCondition(username) {
  try {
    // ‚úÖ Time Check (9 AM - 6 PM)
    const now = new Date();
    const currentHour = now.getHours();

    if (currentHour < 9 || currentHour >= 18) {
      let greeting = "";
      if (currentHour < 12) greeting = "Good Morning, " + username + "!";
      else if (currentHour < 18) greeting = "Good Afternoon, " + username + "!";
      else greeting = "Good Evening, " + username + "!";

      showGreeting(greeting);
      console.log("‚õî Outside allowed popup time. Popup disabled.");
      return; // ‚úÖ Stop here ‚Äî no popup check
    }


// ‚úÖ Delay 5 seconds before checking popup condition
    setTimeout(async () => {
      console.log("‚è≥ Waiting 5 seconds before popup check...");
//

     // ‚úÖ If time is ok ‚Üí Check match from Sheet
     
    // ‚úÖ Fetch Sheet Data
    const response = await fetch(
      `https://sheets.googleapis.com/v4/spreadsheets/${sheetId2}/values/${range2}?key=${apiKey2}`
    );
    const data = await response.json();
    const rows = data.values || [];

    // ‚úÖ Format today's date as "6-Sep-2025" (without leading zero)
    const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    const today = new Date();
    const day = today.getDate(); // no leading zero
    const monthName = months[today.getMonth()];
    const year = today.getFullYear();
    const todayStr = `${day}-${monthName}-${year}`;

    console.log("üîç Checking for date:", todayStr, "and user:", username);

    // ‚úÖ Check if today's entry already exists
    let matchFound = false;
    for (let i = 1; i < rows.length; i++) {
      const row = rows[i];
      const sheetDate = (row[2] || "").trim(); // Column C
      const sheetUser = (row[3] || "").trim(); // Column D

      if (sheetDate === todayStr && sheetUser === username) {
        matchFound = true;
        break;
      }
    }

    if (!matchFound) {
      showATNPopup(username, today);
    }

    }, 4000); // ‚è∞ 5 second  // 5 SECOND BAAD OPEN POUP


  } catch (err) {
    console.error("Error checking popup condition:", err);
  }
}

// ‚úÖ Show Greeting Message
function showGreeting(msg) {
  const messageDiv = document.getElementById("greetingMessage");
  if (messageDiv) {
    messageDiv.textContent = msg;
    messageDiv.style.display = "block";
  } else {
    alert(msg);
  }
}

// ‚úÖ Show popup
function showATNPopup(username, today) {
  document.getElementById("popup-username").value = username;

  // ‚úÖ Date in "6-Sep-2025" format
  const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
  const day = today.getDate();
  const monthName = months[today.getMonth()];
  const year = today.getFullYear();
  const formattedDate = `${day}-${monthName}-${year}`;

  document.getElementById("popup-date").value = formattedDate;
  document.getElementById("popupForm").style.display = "flex";
}

// ‚úÖ Close popup
function closeATNPopup() {
  document.getElementById("popupForm").style.display = "none";
}
</script>


<script>
// ===================== Google Apps Script URL =====================
const scriptATNURL = 'https://script.google.com/macros/s/AKfycbxNCtOS7UZu2mw_Zuwkx-KHdORL1DATDoSp0Gv2Q5EQw6CKJOSPowawczVE_7uYHQw_/exec';


// ===================== Auto today's date =====================
function setTodayDate() {
  const t = new Date();
  const y = t.getFullYear();
  const m = String(t.getMonth() + 1).padStart(2,'0');
  const d = String(t.getDate()).padStart(2,'0');
  const f = `${y}-${m}-${d}`;
  const dateInput = document.getElementById("popup-date");
  if (dateInput) dateInput.value = f;
}


// ===================== Show Popup =====================
function showATNPopup(username) {
  document.getElementById("popup-username").value = username;
  setTodayDate();
  document.getElementById("popupForm").style.display = "flex";
}


// ===================== Close Popup =====================
function closeATNPopup() {
  document.getElementById("popupForm").style.display = "none";
}



// ********************************************************
// üî• OFC NETWORK BLOCKER ‚Äî IP FIRST TWO BLOCK CHECK
// ********************************************************

const officeIPList = ["152.59","152.58","49.36","106.205","103.93","117.99"];

function isOfficeNetwork(ip) {
  if (!ip) return false;

  // Extract first two blocks: "203.81" from "203.81.240.100"
  const parts = ip.split(".");
  if (parts.length < 2) return false;

  const firstTwo = parts[0] + "." + parts[1];

  return officeIPList.includes(firstTwo);   // true = office IP detected
}



// ===================== FORM SUBMIT =====================
document.addEventListener("submit", async function(e) {
  const form = e.target;
  if (form.id !== "mainATNForm") return;
  e.preventDefault();

  // üî• GET IP FROM HIDDEN INPUT
  const ip = document.getElementById("ipatnBox").value;

  // -------------------------------------------
  //  BLOCK SUBMIT IF IP MATCHES OFFICE NETWORK
  // -------------------------------------------
  if (isOfficeNetwork(ip)) {
      alert("You are Not Conect Office Natwork");
      return;   // STOP HERE
  }

  // -------------------------------------------
  //  IF IP NOT MATCH ‚Üí Allow Submit
  // -------------------------------------------
  const submitBtn = document.getElementById("submitATNButton");
  const waitMsg = document.getElementById("waitATNMessage");

  submitBtn.disabled = true;
  submitBtn.value = "Please wait...";
  waitMsg.innerText = "Conforming...";
  waitMsg.style.display = "block";

  // Add timestamp
  const now = new Date();
  document.getElementById('timestampATN').value =
    `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} `+
    `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;


  // *************** FORM SUBMIT ***************
  try {
    const formData = new FormData(form);
    const response = await fetch(scriptATNURL, {
      method: "POST",
      body: formData
    });

    const result = await response.json();

    if (result.result === "success") {
      alert("‚úÖ Success! Have a Nice Day!");
      form.reset();
      closeATNPopup();   // SUCCESS ‚Üí CLOSE POPUP
    } else {
      alert("‚ùå Error: " + (result.error || "Unknown Error"));
    }

  } catch (err) {
    alert("‚ùå Error submitting form: " + err.message);

  } finally {
    submitBtn.disabled = false;
    submitBtn.value = "Submit";
    setTimeout(() => waitMsg.style.display = "none", 2000);
  }

});


// Auto set date on load
document.addEventListener("DOMContentLoaded", setTodayDate);

</script>



<!-- ================  Attendance  Confermation script and code stop hare ===============================-->





<!-- ================  id unlock by admin (ULU) script and code start hare ===============================-->

<button class="filter-btn" id="openULUBtn" data-value="ULU">üè¢ Attendance</button>

<!-- üîπ Popup Form Container -->
<div id="ULUPopup" class="popupULU-overlay">
  <div class="popupULU-content slide-in">
    <span id="closeULUBtn" class="close-btn">&times;</span>





    <form id="mainULUForm" style="display:flex; align-items:center; gap:10px; flex-wrap:nowrap;">
      <input type="hidden" name="SNo" id="sNo" />
      <input type="hidden" name="User" readonly value="ATN">


      <input type="text"  name="cl3" readonly  value="UBU"
       style="padding:8px; width:100px; border:1px solid #aaa; border-radius:6px;">

      <!-- Date -->
      <label style="font-size:13px;font-weight:bold;">Date:</label>
      <input id="popupULU-date" type="date" name="Date" style="padding:4px 6px; border-radius:6px; border:1px solid #ccc;">

      <!-- Ledger -->
      <label style="font-size:13px;font-weight:bold;">User:</label>
      <select name="Ledger" required style="padding:4px 6px; border-radius:6px; border:1px solid #ccc;">
        <option value="">Select</option>
        <option>Rahul Kumar</option>
        <option>Anchal</option>
        <option>V.K Giri</option>
        <option>Harshit</option>
        <option>Prakhar</option>
        <option>Suryabhan</option>
        <option>Mukhtar (Admin)</option>
        <option>NITIN</option>
        <option>Divesh</option>
        <option>Vijender Kumar Sharma</option>
      </select>

      <!-- Status -->
      <label style="font-size:13px;font-weight:bold;">Status:</label>
      <select name="cl1" required style="padding:4px 6px; border-radius:6px; border:1px solid #ccc;">
        <option value="">Select</option>
        <option>P</option>
        <option>A</option>
        <option>O</option>
      </select>

      <!-- Hidden inputs -->
      <input type="hidden" id="timestampULU" name="timestampULU">
      <input type="hidden" name="cl2" id="cl2">

      <!-- Submit -->
      <input type="submit" id="submitULUButton" value="Submit"
        style="padding:6px 14px; background:#035b67; color:white; border:none; border-radius:6px; cursor:pointer;">
    </form>





  </div>
</div>

<!-- ‚úÖ CSS -->
<style>


/* Popup Overlay */
.popupULU-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.4);  /* 40% transparent background */
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

/* Popup Box */
.popupULU-content {
  background: rgba(255,255,255,0.7); /* light transparent white */
  padding: 10px 16px;
  border-radius: 12px;
  width: 12in;
  height: 0.3in;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  position: relative;
  transform: translateY(-100%);
  opacity: 0;
  transition: all 0.4s ease;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

/* Slide-in Animation */
.popupULU-overlay.active .popupULU-content {
  transform: translateY(0);
  opacity: 1;
}

.close-btn {
  position: absolute;
  top: 5px;
  right: 12px;
  cursor: pointer;
  font-size: 18px;
  font-weight: bold;
  color: #035b67;
}
</style>

<!-- ‚úÖ JavaScript -->
<script>

  // ------------- note :- jis button se ye open poup ope karna hai usme id="openULUBtn" ye add kro
const popup = document.getElementById("ULUPopup");
const openBtn = document.getElementById("openULUBtn");
const closeBtn = document.getElementById("closeULUBtn");
const scriptULUURL = 'https://script.google.com/macros/s/AKfycbxNCtOS7UZu2mw_Zuwkx-KHdORL1DATDoSp0Gv2Q5EQw6CKJOSPowawczVE_7uYHQw_/exec';

// üîπ Open Popup
openBtn.addEventListener("click", () => {
  popup.classList.add("active");
  popup.style.display = "flex";

  // Auto set today's date
  const today = new Date().toISOString().split('T')[0];
  document.getElementById("popupULU-date").value = today;

  // Set timestamp + cl2
  const now = new Date();
  const timestamp = now.toLocaleString("en-GB", { hour12: false });
  document.getElementById("timestampULU").value = timestamp;
  document.getElementById("cl2").value = `${timestamp}`; // agar time stamp "UBA-01/11/2025, 13:27:56" is fromat me chaye "UBA" - TYPE KRO
});

// üîπ Close Popup Function
function closeULUPopup() {
  popup.classList.remove("active");
  setTimeout(() => popup.style.display = "none", 400);
}

// üîπ Close Button
closeBtn.addEventListener("click", closeULUPopup);

// üîπ Click outside form closes popup
popup.addEventListener("click", (e) => {
  if (e.target.id === "ULUPopup") closeULUPopup();
});

// üîπ Submit Form
document.addEventListener("submit", async function (e) {
  const form = e.target;
  if (form.id !== "mainULUForm") return;
  e.preventDefault();

  const submitBtn = document.getElementById("submitULUButton");
  // const waitMsg = document.getElementById("waitULUMessage");

  submitBtn.disabled = true;
  submitBtn.value = "Please wait...";
 // waitMsg.innerText = "Submitting...";
// waitMsg.style.display = "block";

  try {
    const formData = new FormData(form);
    const response = await fetch(scriptULUURL, { method: 'POST', body: formData });
    const result = await response.json();

    if (result.result === 'success') {
      alert('‚úÖ Attendance Submitted Successfully!');
      form.reset();
      closeULUPopup(); // Auto close popup
    } else {
      alert(`‚ùå Error: ${result.error || 'Unknown error occurred.'}`);
    }
  } catch (err) {
    alert(`‚ùå Error submitting form: ${err.message}`);
  } finally {
    submitBtn.disabled = false;
    submitBtn.value = "Submit";
   // setTimeout(() => (waitMsg.style.display = 'none'), 2000);
  }
});
</script>
<!-- ================  id unlock by admin (ULU) script and code stop hare ===============================-->








<!-- ================  Payroll Attandse script start hare ===============================-->
<script>
/* --------------------- CONFIG --------------------- */
const apiPRLKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";   
const sheetPRLId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
const rangePRL = "ATN!A:M";

let sheetPRLData = [];

/* --------------------- LOAD SHEET DATA --------------------- */
async function loadPRLSheet() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetPRLId}/values/${rangePRL}?key=${apiPRLKey}`;
    const res = await fetch(url);
    const data = await res.json();

    const ignoreValues = [
        "152.59","152.58","49.36","106.205","103.93","117.99"
    ];

    // data.values ‚Üí filter rows where column H (index 7) does NOT contain any ignore value
    sheetPRLData = (data.values || []).filter(row => {
        const colH = row[7];   // H column
        if (!colH) return true; // if empty, keep row

        return !ignoreValues.some(v => colH.includes(v));
    });

    loadPRLMonths();
}


/* --------------------- LOAD MONTHS INTO DROPDOWN --------------------- */
function loadPRLMonths() {
    const monthPRLSelect = document.getElementById("monthPRLSelect");
    let months = new Set();

    for (let i = 1; i < sheetPRLData.length; i++) {
        let r = sheetPRLData[i];
        let dt = r[2]; // Column C
        if (!dt) continue;
        let d = new Date(dt);
        if (!isNaN(d)) months.add(`${d.getFullYear()}-${d.getMonth() + 1}`);
    }

    let sorted = [...months].sort((a,b)=>{
        let [ya, ma] = a.split("-").map(Number);
        let [yb, mb] = b.split("-").map(Number);
        return yb - ya || mb - ma;
    });

    const currentMonthKey = `${new Date().getFullYear()}-${new Date().getMonth()+1}`;

    monthPRLSelect.innerHTML = "";
    sorted.forEach(m=>{
        let [y, mo] = m.split("-");
        let dateObj = new Date(y, mo-1, 1);
        let opt = document.createElement("option");
        opt.value = m;
        opt.textContent = dateObj.toLocaleString("en-GB",{month:"long", year:"numeric"});
        if(m===currentMonthKey) opt.selected=true;
        monthPRLSelect.appendChild(opt);
    });

    showPayroll();
}

/* --------------------- SHOW ATTENDANCE TABLE --------------------- */
function showPayroll() {
    const m = document.getElementById("monthPRLSelect").value;
    const viewMode = document.getElementById("viewType").value;
    if(!m) return;

    let [year, month] = m.split("-").map(Number); month-=1;
    let first = new Date(year, month, 1);
    let last = new Date(year, month+1, 0);

    let dates=[];
    for(let d=new Date(first); d<=last; d.setDate(d.getDate()+1)) dates.push(new Date(d));

    let today=new Date(); today.setHours(0,0,0,0);

    // Employees list from row 2
    let employees=new Set();
    for(let i=1;i<sheetPRLData.length;i++) if(sheetPRLData[i][3]) employees.add(sheetPRLData[i][3]);
    employees=[...employees];

    // Map employee -> date -> {status, time}
    let map={}; employees.forEach(e=>map[e]={});
    for(let i=1;i<sheetPRLData.length;i++){
        let r=sheetPRLData[i];
        let name=r[3], dt=r[2]; if(!name || !dt) continue;
        let d=new Date(dt);
        if(d.getMonth()===month && d.getFullYear()===year){
            let dateStr=d.toISOString().split("T")[0];
            let rawTime=r[5]||"", onlyTime="";
            if(rawTime.includes(" ")){
                let parts=rawTime.split(" ");
                let timePart=parts.length>1?parts[1]:parts[0];
                let timeMatch=timePart.match(/^(\d{1,2}:\d{2})/);
                onlyTime = timeMatch ? timeMatch[1] : timePart;
            }
            map[name][dateStr]={status:r[4]||"P", time:onlyTime||""};
        }
    }

    // BUILD TABLE
    let html=`<table><tr><th>Employee</th>`;
    dates.forEach(d=>html+=`<th>${d.getDate()}</th>`);
    html+=`<th>Total P</th><th>Total A</th></tr>`;

    // Day names
    html+=`<tr><th></th>`;
    dates.forEach(d=>html+=`<th>${d.toLocaleDateString("en-US",{weekday:"short"})}</th>`);
    html+=`<th></th><th></th></tr>`;

    employees.forEach(name=>{
        let totalP=0, totalA=0;
        html+=`<tr><td>${name}</td>`;
        dates.forEach(d=>{
            let dateStr=d.toISOString().split("T")[0];
            let entry=map[name][dateStr];
            let showValue="-";

            if(d>today) showValue="-";
            else{
                if(viewMode==="pa"){
                    let st = entry?entry.status:"A";
                    if(d.getDay()===0) st="P";
                    showValue=st;
                } else if(viewMode==="time"){
                    if(d.getDay()===0) showValue="PWL";
                    else if(entry) showValue=entry.time?entry.time:"A";
                    else showValue="A";
                }
            }

            // TOTAL P/A
            if(viewMode==="time"){
                if(showValue==="PWL") totalP++;
                else if(/^\d{1,2}:\d{2}$/.test(showValue)) totalP++;
                else if(showValue==="A") totalA++;
            } else {
                if(showValue==="P") totalP++;
                else if(showValue==="A") totalA++;
            }

            // CLASS
            let cls="";
            if(showValue==="A") cls="absent";
            else if(showValue==="PWL") cls="pwl";

            html+=`<td class="${cls}">${showValue}</td>`;
        });

        html+=`<td>${totalP}</td><td>${totalA}</td></tr>`;
    });

    html+=`</table>`;
    document.getElementById("attendancePRLTable").innerHTML=html;
}

/* --------------------- PRINT FUNCTION --------------------- */
function printPayroll() {
    // Get the current selected month text from dropdown
    const monthSelect = document.getElementById("monthPRLSelect");
    const monthText = monthSelect.options[monthSelect.selectedIndex].text;

    // Get the attendance table content
    const content = document.getElementById("attendancePRLTable").innerHTML;

    const printWindow = window.open("", "", "width=1200,height=800");
    printWindow.document.write(`
        <html>
        <head>
            <title>Attendance Print</title>
            <style>
                body { font-family: Arial; padding: 20px; }
                table { border-collapse: collapse; width: 100%; }
                th, td { border: 1px solid #666; padding: 6px; text-align: center; }
                th { background: #eee; }
                .absent { color: red; font-weight: bold; }
                .pwl { color: rgb(67, 104, 0); font-weight: bold; }
            </style>
        </head>
        <body>
            <h2 style="text-align:center;">Attendance Sheet - ${monthText}</h2>
            ${content}
        </body>
        </html>
    `);

    printWindow.document.close();
    printWindow.focus();
    setTimeout(() => { printWindow.print(); }, 500);
}


/* --------------------- INIT --------------------- */
loadPRLSheet();

</script>

<!-- ================  Payroll Attandse script stop hare ===============================-->

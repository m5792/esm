
  <!-- üîπ Footer -->

  <style>
  body {
    margin: 0;
    padding-bottom: 60px; /* Footer ke liye space */
    font-family: Arial, sans-serif;
  }

  /* üîπ Fixed Footer */
  .fixed-footer {
      position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: #a7a8a8;
    color: rgb(1, 49, 77);

    text-align: center;
    padding: 2px 2px; /* Top-Bottom = 0, Left-Right = 10px gap */
    font-size: 14px;
    z-index: 1000;
    box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.3);
  }
</style>

<!-- footer start hare) -->
  <div class="fixed-footer">

    
<!-- ============ website open navgation buttan code start hare  ========= -->
<style>
    :root{ --gap:5px; --btn-bg:#1e1d1d; --btn-border:#6a6a6a; --radius:10px; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; }
  
    .rownav{ display:flex; gap:var(--gap); align-items:center; flex-wrap:wrap; justify-content: center;}

    .item{ display:flex; align-items:center; gap:10px; padding:4px 12px; background:var(--btn-bg); border:1px solid var(--btn-border); border-radius:var(--radius); box-shadow:0 6px 18px rgba(0,0,0,0.05); text-decoration:none; color:#111; }
    .item img{ width:25px; height:25px; object-fit:cover; border-radius:8px; }
    .name{ font-weight:700; font-size:14px; color: white;}

    @media (max-width:560px){ .rownav{ width:100%; flex-direction:column; align-items:stretch; } .item{ width:100%; } }
  </style>
</head>
<body>
  <nav class="rownav" aria-label="Quick image links" style=" border: 3px solid #03495a; padding: 5px 10px;background-color: black;">


     <!-- Google (favicon used as image) -->
    <a class="item" href="https://www.google.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://cdn.dribbble.com/users/1717214/screenshots/4124610/g-logo.gif" alt="Google" width="50" height="50" />
      <span class="name">Google</span>
    </a>

     <!-- Gmail (favicon used as image) -->
    <a class="item" href="https://mail.google.com/mail/u/0/" target="_blank" rel="noopener noreferrer">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSjpEIz6vZxfKx_cLh8Y6tDWalIuwi08MCggUEXk8cXLAy8NUilIHwNgrsjtFIxgEWCWAE&usqp=CAU" alt="Google" width="50" height="50" />
      <span class="name">Gmail</span>
    </a>

      <!-- youtube (favicon used as image) -->
    <a class="item" href="https://www.youtube.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://cliply.co/wp-content/uploads/2019/07/371907120_YOUTUBE_ICON_TRANSPARENT_400.gif" alt="Google" width="50" height="50" />
      <span class="name">You Tube</span>
    </a>

       <!-- pnb natbanking (favicon used as image) -->
    <a class="item" href="https://ibanking.pnb.bank.in/" target="_blank" rel="noopener noreferrer">
      <img src="https://i0.wp.com/www.logotaglines.com/wp-content/uploads/2016/08/Punjab-National-Bank-Logo.jpg?resize=400%2C391" alt="Google" width="50" height="50" />
      <span class="name">PNB Natbanking</span>
    </a>

    <!-- WhatsApp (user-provided gif) -->
    <a class="item" href="https://web.whatsapp.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://cliply.co/wp-content/uploads/2021/08/372108180_WHATSAPP_ICON_400.gif" alt="WhatsApp" width="50" height="50" />
      <span class="name">WhatsApp</span>
    </a>

    <!-- Facebook (user-provided gif) -->
    <a class="item" href="https://www.facebook.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExNTZuaHQ1ZjdnajNwMWtrZHVhN3Q4djdwMDZmYWZuYzRoYTA0Ymx4MiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/IeRI0TleieCJ6ytPUr/giphy.gif" alt="Facebook" width="50" height="50" />
      <span class="name">Facebook</span>
    </a>

   

    <!-- Chat GPT (favicon) -->
    <a class="item" href="https://chatgpt.com/" target="_blank" rel="noopener noreferrer">
      <img src="https://static.vecteezy.com/system/resources/previews/022/841/114/original/chatgpt-logo-transparent-background-free-png.png" alt="Gmail" width="50" height="50" />
      <span class="name">Chat GPT</span>
    </a>

    <!-- html mipl (PNB favicon) -->
    <a class="item" href="https://m5792.github.io/esmTally/AFI.html" target="_blank" rel="noopener noreferrer">
      <img src="https://cdn-icons-png.flaticon.com/512/1197/1197396.png" alt="AFI" width="50" height="50" />
      <span class="name">A.F.I Dashboard</span>
    </a>

      <!-- html mipl (PNB favicon) -->
    <a class="item" href="https://www.netflix.com/browse" target="_blank" rel="noopener noreferrer">
      <img src="https://media.tenor.com/miBRlkp03LkAAAAj/netflix.gif" alt="Netflix" width="50" height="50" />
      <span class="name">Netflix</span>
    </a>


  <!-- small script: open links with Enter when focused for accessibility -->
  <script>
    document.querySelectorAll('.item').forEach(el=>{
      el.addEventListener('keydown', e=>{ if(e.key === 'Enter' || e.key === ' ') el.click(); });
    });
  </script>


<!-- ============ website open navgation buttan code start stop  ========= -->


  </nav>
  </div>  <!-- footer stop hare -->


























<!-- ==========  ------------------------------------------xxxxxxxxxxxxxxxxxxxxx-----------------------------------------======================= -->




<style>
 .filter-btn {
  background: rgb(0, 47, 74);
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
 
  transition: background 0.2s ease;
  min-width: 90px;            /* optional: makes buttons uniform width */
  text-align: center;
}
.filter-btn:hover {
  background: rgb(1, 76, 119);
}
.filter-btn.active {
  background: #932001;
  color: rgb(252, 250, 250);
  font-weight: bold;
}




/* Table Styling */
/* Container to control table width and responsiveness */
.table-container {
  width: 100%;
  overflow-x: auto;
}

 
 /* Table container ************/
table{
    width: 100%;
  border-collapse: collapse;
  table-layout: auto;
  font-family: Arial, sans-serif;
  font-size: 14px;
  background: #ffffff;
  border: 1px solid #d0d0d0;

  }

/* Optional heder alwayas fix on top and table scrolling  */
  table{
  overflow-x: auto;
  display: block;
  max-height: 1200px; /* Optional scrolling */
  }

  /* Table border & cell style */
th {
   background: #01305c;
  color: #ffffff;
  padding: 10px;
  border: 1px solid #b5b5b5;
  text-align: left;
  font-weight: 600;
  position: sticky;
  top: 0;
  z-index: 1;
  white-space: nowrap;
  border-bottom:5px solid #dfc206;
  }


 td {
   padding: 8px 10px;
  border: 1px solid #e0e0e0;
  vertical-align: top;
  word-wrap: break-word; /* Wrap long text */
  white-space: normal;
  }

  /* Header design */


  tr:nth-child(even) {
  background-color: #f9f9f9;
}

  /* Row hover effect */
  tr:hover td {
   background: #fccc49;
 color: rgb(0, 15, 15);
  transition: background-color 1s ease, color 1s ease;
  }
    
</style>

<div style="text-align:center; background-color: #013b42; color: #f8f8f8; font-weight: bold;"> <strong>Multitech Infracon Pvt. Ltd. Accounting System</strong></div> <br/>


 <!--  mipl2011Buttons div start  -->
<div id="mipl2011Buttons" style="display: flex; gap: 8px;  border-bottom:5px solid #822501;  flex-wrap: wrap; justify-content: center; margin-bottom: 10px; background-color: rgb(0, 47, 74); padding: 2px 2px; ">
  
   <strong style="color: rgb(2, 98, 153); font-size: 25px; font-weight: bold;">|</strong>

  <button class="filter-btn" data-value="search">&#128269 Searchbar</button>
  <button class="filter-btn" data-value="ledger">&#128211 Ledger</button>
  <button class="filter-btn" data-value="poreff">&#128179 PO/REFF</button>
  <button class="filter-btn" data-value="receipt">&#128176 Receipt</button>
  <button class="filter-btn" data-value="sale">&#128184 Sale</button>
  <button class="filter-btn" data-value="address">&#128205 Address</button>
  <button class="filter-btn" id="openULUBtn" data-value="atn">&#128197 Attendance</button>
  <button class="filter-btn" data-value="psw">&#128273 ID/Password</button>

<button onclick="print2011Report()" style="border: none; color: rgb(251, 197, 197); font-weight: bold;  cursor: pointer; background-color: rgb(0, 47, 74);;">&#128424 Print Report</button>
<button id="refresh2011Btn" style="border: none; color: rgb(196, 248, 181); font-weight: bold;  cursor: pointer; background-color: rgb(0, 47, 74);;"> &#128260 Refresh</button>

   <strong style="color: rgb(2, 98, 153); font-size: 25px; font-weight: bold;">|</strong>





<!-- DROPDOWN -->
<select id="navDropdown"style="background-color: rgb(0, 47, 74);color: white; font-size: 16px;  border-radius: 8px; border: none;">
    <option value="" style="text-align: center; font-weight: bold; ">More Options</option>

	<option value="https://drive.google.com/drive/folders/1Dc4In3NfpKdFdOLqcgyTFNC2tch7b6q2?usp=sharing"   style="color: rgb(239, 246, 175);">AFI Drive</option>

      <option data-target="home">Home</option>
      <option data-target="btn2">Cash Ledger</option>
      <option data-target="btn3">Payroll</option>
       <option data-target="btn4">Ration Card</option>

<option value="https://www.google.com/android/find/">	Find My Device</option>
	<option value="https://docs.google.com/spreadsheets/d/1wvsPdAQA57HxhTxA3cCcQvUEz93IWkBre_Ix-qvzwss/edit?gid=627393391#gid=627393391">	Store Database Sheet*</option>
	<option value="https://docs.google.com/spreadsheets/d/1U_jwvZNtFuP91Gljjrbz_cpmb1OIkeDHnKa7aDe7F20/edit?gid=1511450281#gid=1511450281">	Clint List Sheet*</option>
	<option value="https://docs.google.com/spreadsheets/d/17GZv2O6uupdA5r6p7-zqKZ8AQgZozbGQf2aXPlUzhDA/edit?gid=1122888223#gid=1122888223">	Mipl Office</option>
	<option value="https://docs.google.com/spreadsheets/d/13N0HBuorZJM-ARnlTh36EUaD1-uQckaC6sLLzMnWAks/edit?gid=696561165#gid=696561165">	Office Noida</option>
	<option value="https://docs.google.com/spreadsheets/d/1Rw_6cDYP-ETicn9YhHkdF_Sgmi8ps5JhjhlrkWvtwRQ/edit?gid=2123243236#gid=2123243236">	GUPTA CAMUNICATION Sheet*</option>
    <option value="https://docs.google.com/spreadsheets/d/1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4/edit?gid=0#gid=0">	INDEX SHEET MIPL Sheet*</option>
    <option value="https://docs.google.com/spreadsheets/d/1B6dyXPay3Tyl_7RzGuL9Rg8AhkzdBNhJNRu-T-3kmvI/edit?gid=147958071#gid=147958071">	MIPL Clint Cash Ledger Sheet*</option>
     <option value="https://docs.google.com/spreadsheets/d/1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0/edit?gid=0#gid=0">	Cash Management Sheet*</option>
     <option value="https://docs.google.com/spreadsheets/d/1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA/edit?gid=0#gid=0">	Imprest Voucher Sheet*</option>
      <option value="https://docs.google.com/spreadsheets/d/1B6dyXPay3Tyl_7RzGuL9Rg8AhkzdBNhJNRu-T-3kmvI/edit?pli=1&gid=207048997#gid=207048997">	MIPL Party Weight REport*</option>
     <option value="https://docs.google.com/spreadsheets/d/1C4EeSbCDaVGmJjU3QY2VNfI_IEZn0tZsqXw0ss3G58k/edit?gid=809921823#gid=809921823" style="color: rgb(175, 219, 246);">	ESS Google Index Sheet*</option>
       <option value="https://docs.google.com/spreadsheets/d/1EOO0QzwNaPhwIfZN_DCLlhQB9yeC-j-GpmtM_6JMRmw/edit?gid=2031012173#gid=2031012173" style="color: rgb(246, 175, 175);">	Password  Google  Sheet*</option> 
     <option value="https://docs.google.com/spreadsheets/d/1g_hAVEIFZRnRNFFQWF275Y_AXKBTw0UIP0xiH4_C2V0/edit?gid=0#gid=0" style="color: rgb(239, 246, 175);">	A.F.I Google Index Sheet*</option> 
     <option value="https://m5792.github.io/esm/">	MIPL DASHBOARD</option>
     <option value="https://m5792.github.io/esm/MULTITECH2023.html">MIPL Old Dashboard</option>
     <option value="https://github.com/">	github (mukhtarahamadksp@gmail.com)</option>
     <option value="https://m5792.github.io/esm/eTally.html">	eTally Dashboard</option>
</select>




<style>



/* Sections */
.section {
    display: none;
    padding: 15px;
    border: 1px solid #012e61;
    margin-top: 15px;
    background: #ffffff;
}

/* Default visible: HOME */
#home {
    display: block;
}




</style>

<script>
// -----------------------------------------
// FUNCTION: SHOW ONLY THE TARGETED SECTION
// -----------------------------------------
function showSection(targetId) {
    document.querySelectorAll('.section').forEach(sec => sec.style.display = 'none');
    document.getElementById(targetId).style.display = 'block';
}

// ----- BUTTON CLICK -----
document.querySelectorAll('.menu-btn').forEach(btn => {
    btn.addEventListener('click', function () {
        showSection(this.getAttribute('data-target'));
    });
});

// ----- DROPDOWN CHANGE -----
document.getElementById('navDropdown').addEventListener('change', function () {
    let selected = this.options[this.selectedIndex];
    let target = selected.getAttribute('data-target');
    let url = selected.value;

    if (target) {
        showSection(target);
    }
    else if (url !== "") {
        window.open(url, "_blank");
    }

    this.value = "";  // dropdown reset
});
</script>


</div>   <!--  mipl2011Buttons div stop  -->









<!-- =================== home buttan start hare =============================== -->
<div class="section" id="home">
    <div class="divA">    <!-- BTN Home Div A Start hare -->


<div style="text-align:center; background-color: #c1f1f3; color: #002630; font-weight: bold;"> <strong>Dishplay Ledger Report</strong></div> <br/>


<div id="search2011Bar">
  <input type="text" id="search2011Input" placeholder="&#128269 Search in Dishplay Report table...">
  <label>From:</label>
  <input type="date" id="start2011Date">
  <label>To:</label>
  <input type="date" id="end2011Date">

   
   <button id="exportBtn" data-value="exportBtn" data-target="mipl2011Table" style="border: none; font-weight: bold; cursor: pointer; background-color: #027175; color: rgb(245, 242, 163);">&#128228 Export</button>

</div>   <!-- <div id="search2011Bar"> stop  -->

<style>
  #search2011Bar {
    background-color: #027175; /* blue */
    width: 100%;
    height: 20px;
    display: flex;
    align-items: center;
    padding: 20px;
    gap: 10px;
    box-sizing: border-box;
  }

  #search2011Input {
    flex: 1;
    background-color: #fdfdf6; /* grey */
    border: none;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 14px;
    outline: none;
  }

  #search2011Bar label {
    font-weight: bold;
    color: rgb(247, 244, 244);
    margin-left: 10px;
  }

  #search2011Bar input[type="date"] {
    padding: 4px 6px;
    border-radius: 4px;
    border: 1px solid #ccc;
    font-size: 14px;
  }
</style>


        
    <!-- Totals (Only for Ledger) -->
<div id="totals2011mipl">

  <!-- Ledger Filter -->
<div id="ledger2011Select" class="filter-container">
 <span style="color: black;">Ledger Name:</span>
  <input type="text" id="ledger2011Input" style="padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; margin-bottom:10px; width:200px; width: 4in; background-color: rgb(241, 212, 212); font-size: 14px;" placeholder="üîç Type to search ledger...">
  <div id="ledger2011Dropdown" class="dropdown"></div>

  <span id="address2011"></span>
</div>

  <span>Total Receipt:</span> <span id="totalReceipt">0</span> |
  <span>Total TDS:</span> <span id="totalTds">0</span> |
  <span>Total Bill:</span> <span id="totalBill">0</span> |
  <span>Total Credit Note:</span> <span id="totalCn">0</span> |
  <span>Total Weight:</span> <span id="totalPEBWeight">0</span> |
  <span>Balance:</span> <span id="totalDifference">0</span>
</div>       


<!-- PO Filter -->
<div id="po2011Select" class="filter-container" style="display:none;">
  <br/> <strong style="color: black;">PO / Reff No.:</strong>
  <input type="text" id="po2011Input" style="padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; margin-bottom:10px; width:200px; width: 4in; background-color: rgb(228, 241, 212); font-size: 14px;" placeholder="üîç Type PO No..."
    style="padding:4px 8px;border-radius:4px;border:1px solid #ccc;
    margin-bottom:10px;width:4in;background:#f7f7f7;font-size:14px;">
  <div id="po2011Dropdown" class="dropdown"></div>

  <!-- ‚úÖ Totals For PO -->
  <div id="poTotals2011mipl" style="display:none;margin-top:10px;
    padding:8px;background:#f8f0ff;border:1px solid #ccc;border-radius:4px;">
    <strong>Total Bill:</strong> ‚Çπ<span id="poTotalAmount">0</span> &nbsp;&nbsp;
    <strong>Total Weight:</strong> <span id="poTotalWeight">0</span> Kg
  </div>
</div>







<style>

#mipl2011Table {
  width: 100%;
  border-collapse: collapse;
  table-layout: auto;
  font-family: Arial, sans-serif;
  font-size: 14px;
  background: #ffffff;
  border: 1px solid #d0d0d0;


   
}

#mipl2011Table thead th {
  background: #01305c;
  color: #ffffff;
  padding: 8px 5px;
  border: 1px solid #013a70;
  text-align: left;
  font-weight: bold;
  position: sticky;
  top: 0;
  z-index: 1;
  white-space: nowrap;
  border-bottom:5px solid #4a4a4a;
}

#mipl2011Table tbody td {
  padding: 8px 10px;
  border: 1px solid #e0e0e0;
  vertical-align: top;
  word-wrap: break-word; /* Wrap long text */
  white-space: normal;
}

#mipl2011Table tbody tr:nth-child(even) {
  background: #f7faff;
}

#mipl2011Table tbody tr:hover {
  background: #e2f0ff;
  
}

#mipl2011Table {
  overflow-x: auto;
  display: block;
  max-height: 1200px; /* Optional scrolling */
}


</style>


 <div   style="max-height: 1200px;color: black;overflow-y: auto;"> <table id="mipl2011Table"><thead id="tableHead"></thead> <tbody id="table2011Body"></tbody></table> </div> <br/>



</div>  <!-- home btn Div A stop hare -->
</div> <!-- =================== home button stop =============================== -->













<!-- =================== btn2  start hare =============================== -->
<div class="section" id="btn2">
    <div class="divA">     <!-- btn2 Div A Start hare -->

  <div style="text-align:center; background-color: #dcdddd; color: #002630; font-weight: bold;"> <strong>Cash Ledger Report</strong></div> <br/>


  <!-- Ledger Filter -->
  <div id="ledger5792Select" >
    <span style="color: black;">Ledger Name:</span>
    <input type="text" id="ledger5792Input"
      style="padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; margin-bottom:10px; width: 4in; background-color: rgb(236, 241, 212); font-size: 14px;"
      placeholder="&#128269 Type to search ledger...">
    <div id="ledger5792Dropdown" class="dp5792"></div>

    <button onclick="print5792Table()" style="background-color: white;  color: #00254d;border: none; cursor: pointer;">&#128424 Print Table</button>
<button onclick="refresh5792Table()"  style="background-color: white;  color: #00254d; border: none; cursor: pointer;">&#128260 Refresh Table</button>
  </div>


    <div id="search5792Bar" style="padding: 5px 10px;">
  <input type="text" id="search5792Input" placeholder="&#128269 Search in Cash Ledger  table...">

  <strong style="color: white;"> Select User:</strong>
    <select id="user5792" style="border-radius: 4px; ">
    <option value="">--Select Type--</option>
    <option value="MA">MUKHTIYAR (MA)</option>
    <option value="TA">TUSHAR (TA)</option>
    <option value="BANK">BANK</option>
    <option value="JLN">JOURNAL</option>
    <option value="DB">DAYBOOK</option>
  </select>

  <label>From:</label>
  <input type="date" id="start5792Date">
  <label>To:</label>
  <input type="date" id="end5792Date">

  <button id="export5792" data-value="export5792" data-target="table5792Container" style="border: none; font-weight: bold; cursor: pointer; background-color: #424242; color: rgb(245, 242, 163);">&#128228 Export</button>

  </div>

</div>   <!-- btn2 Div A Stop hare -->

 <div class="divB">     <!-- btn2 Div B Start hare -->
 <div id="table5792Container"></div> <br/><br/><br/><br/><br/>
</div>   <!-- btn2 Div B stop hare -->

</div>  <!-- =================== btn2  stop hare =============================== -->



<!-- =================== btn3  start hare =============================== -->
<div class="section" id="btn3">
    <div class="divA">     <!-- btn3 Div A Start hare -->

  <div style="text-align:center; background-color: #dcdddd; color: #002630; font-weight: bold;"> <strong>Employees Attendance - Payroll</strong></div> <br/>

   <style>
     
        .absent { color: red; font-weight: bold; }
        .pwl { color: rgb(0, 122, 131);  }
        select { padding: 8px; margin-right: 10px; }
    </style>
</head>
<body>


<div  style="display: flex; gap: 8px;  border-bottom:5px solid #00462e;  flex-wrap: wrap; justify-content: center; margin-bottom: 10px; background-color: rgb(8, 161, 128); padding: 1px 1px; ">


<select id="monthPRLSelect" onchange="showPayroll()" style="background-color: rgb(8, 161, 128);color: white; font-size: 16px;  border-radius: 8px; border: none;"></select>


<select id="viewType" onchange="showPayroll()" style="background-color: rgb(8, 161, 128);color: white; font-size: 16px;  border-radius: 8px; border: none;">
    <option value="pa">P/A Wise</option>
    <option value="time">In Time Wise</option>
</select>

<button onclick="printPayroll()" style="background-color: rgb(8, 161, 128) ; color: rgb(248, 224, 224); border: none; font-weight: bold;"> Print</button>

</div>
 

</div>   <!-- btn2 Div A Stop hare -->

 <div class="divB">     <!-- btn3 Div B Start hare -->
 <div id="attendancePRLTable"></div>
</div>   <!-- btn3 Div B stop hare -->

</div>  <!-- =================== btn3  stop hare =============================== -->







<!-- =================== btn4  start hare =============================== -->
<div class="section" id="btn4">
    <div class="divA">     <!-- btn4 Div A Start hare -->

<div style="text-align:center; background-color: #dcdddd; color: #002630; font-weight: bold;"> <strong>Ration Card</strong></div> <br/>

      

<div  style="display: flex; gap: 8px;  border-bottom:5px solid #00462e;  flex-wrap: wrap; justify-content: center; margin-bottom: 10px; background-color: rgb(8, 161, 128); padding: 1px 1px; ">

         <input type="text" id="searchInput" placeholder="Search By Ration Card No. Name, Last 4 Digit Adhar & Mobail...." onkeyup="rationcardsearch()" style="font-size:18px; padding:5px; width:750px; background-color: #fefaf6;">

</div>
</div>   <!-- btn4 Div A Stop hare -->

 <div class="divB">     <!-- btn4 Div B Start hare -->
<div id="results"></div>
</div>   <!-- btn4 Div B stop hare -->

</div>  <!-- =================== btn4  stop hare =============================== -->













<!-- ==========  ------------------------------------------xxxxxxxxxxxxxxxxxxxxx-----------------------------------------======================= -->
 
<!-- ===================================  2011 table code and script start HARE ================================== -->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MIPL MDASHBOARD</title>
<style>

  .filter-container { position: relative; margin-bottom: 10px; display: none; }
  .dropdown { position: absolute; top: 50px; left: 0; right: 0; background: white; border: 4px solid #012228; max-height: 700px; width: 500px; overflow-y: auto; display: none; z-index: 100; }
  .dropdown div { padding: 6px; cursor: pointer; }
  .dropdown div.active { background: #0078d4; color: white; }
  .dropdown div:hover { background: #e8cd36; color: rgb(1, 3, 30); font-weight: bold;}
 #totals2011mipl { margin-top: 15px; font-size: 16px; font-weight: bold; background: #fafafa; border: 1px solid #ccc; padding: 8px; border-radius: 8px; display: none; }
  #totals2011mipl span { margin-right: 10px; }

    /* --- Clickable invoice style --- */
  #mipl2011Table td.clickable {
    color: #2B6AF3;
    cursor: pointer;
    text-decoration: underline;
  }
  #mipl2011Table td.clickable:hover {
    color: #1b4bd8;
  }
</style>
</head>
<body>
<!-- ================================================ Dishplay Report Script start hare ========================================================= -->
<script>
const api2011Key = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheet2011Id = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
const range2011 = "FORM!A:M";
const addressrange2011 = "ADDRESS!A:M"; //xxxxxxxxxxxxxxxxxx
const pswrange2011 = "M1000!A:F";
const atnrange2011 = "ATN!A:M";
const apiFileUrl = "https://script.google.com/macros/s/AKfycbyKeTGzkEsRd26seiog3jtfEXcLXNK4_fvt9b6D7kYtFXhInLr3J4PqCCgMxmsJ7rim/exec";

let sheetData = [];
let addressData = [];
let pswData = [];
let atnData = [];
let filteredData = [];
let currentFilterType = "";
let selectedLedger = "";
let selectedPO = ""; // sales btn ke poreff  ke lye po dropdown

// === HEADERS and COLUMN MAPS ===
const tableConfig = {
  search: { headers: ["Sr No","Type","Date","Ledger","Rcpt/Inv. No.","Tr./Ty","Reff. No.","Amount","Weight","Rate","Vehicle No.","V.Type"], cols:[0,1,2,3,4,11,5,6,7,8,9,10]},
  ledger: { headers: ["Sr No","Type","Date","Ledger","Rcpt/Inv. No.","Reff. No.","Amount","Weight","Rate","Vehicle No.","V.Type"], cols:[0,1,2,3,4,5,6,7,8,9,10]},
  poreff: { headers: ["Sr No","User","Order By","Clint Name","Project Name","Address","PO/Reff No.","Status","PO Amt.","PO Weight","V.Type"], cols:[0,1,2,3,4,5,6,7,8,9,10]},
  receipt: { headers:["Sr No","Type","Date","Ledger","Amount","V .Type"], cols:[0,1,2,3,4,10]},
  sale: { headers:["Sr No","Type","Date","Ledger","Inv. No.","Reff. No.","Amount","Weight","Rate","Vehicle No.","V.Type"], cols:[0,1,2,3,4,5,6,7,8,9,10]},
  address: { headers:["Clint","Address","State","Type","GSTIN","Contect Details"], cols:[0,1,2,3,4,5]},
  atn: { headers:["Sr No","Type","Date","Employee","P/A","Login Time","IP Details"], cols:[0,1,2,3,4,5,6]},
  psw: { headers:["Sr No","Type","Firm","User ID/ Password","Account Details","Other"], cols:[0,1,2,3,4,5]}
};

// === Load Sheet Data ===
async function load2011Data() {
  try {
    const resForm = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheet2011Id}/values/${range2011}?key=${api2011Key}`);
    const dataForm = await resForm.json();
    sheetData = dataForm.values || [];

    const resAddr = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheet2011Id}/values/${addressrange2011}?key=${api2011Key}`);
    const dataAddr = await resAddr.json();
    addressData = dataAddr.values || [];

     const respsw = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheet2011Id}/values/${pswrange2011}?key=${api2011Key}`);
    const datapsw = await respsw.json();
    pswData = datapsw.values || [];

     const resAtn = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheet2011Id}/values/${atnrange2011}?key=${api2011Key}`);
    const dataAtn = await resAtn.json();
    atnData = dataAtn.values || [];

    filteredData = sheetData;
    render2011Table([]);
    initledger2011Dropdown();
  } catch (e) {
    console.error("Load Error:", e);
  }
}

// === Ledger Dropdown Setup ===
// === Ledger Dropdown Setup ===
function initledger2011Dropdown() {
  // Filter only rows where column K = "SALE" or "RECEIPT"
  const validRows = sheetData.slice(1).filter(r => {
    const type = (r[10] || "").trim().toUpperCase();
    return type === "SALE" || type === "RECEIPT";
  });

  // Extract unique ledger names from column D (index 3)
  const ledgerOptions = [...new Set(validRows.map(r => r[3]).filter(v => v))]
    .sort((a, b) => a.localeCompare(b));

  // Initialize dropdown with filtered ledgers
  setupDropdown("ledger2011Input", "ledger2011Dropdown", ledgerOptions, (val) => {
    resetDates();
    selectedLedger = val;
    currentFilterType = "ledger";
    document.getElementById("totals2011mipl").style.display = "block";
    applySearch();
    showLedgerAddress(val);
  });
}



// === Show Ledger Address ===
function showLedgerAddress(ledgerName){
  const span = document.getElementById("address2011");
  if(!span) return;
  if(!ledgerName){ span.innerHTML=""; return; }

  const matchRow = addressData.find((r,i)=> i>0 && r[0]?.trim().toLowerCase() === ledgerName.trim().toLowerCase());
  if(matchRow){
    const address = matchRow[1] || "‚Äî";
    const state = matchRow[2] || "‚Äî";
    const gstin = matchRow[4] || "‚Äî";
    span.innerHTML = `<div style="margin-top:6px; padding:4px 6px; background:#f3f3f3; border-radius:4px; border:1px solid #ccc; width:fit-content;">
      <strong>Address:</strong> ${address} <strong>State:</strong> ${state} <strong>GSTIN:</strong> ${gstin}
    </div>`;
  }else{ span.innerHTML=`<em style="color:red;">No address found for "${ledgerName}"</em>`;}
}

// === Render Table ===
function render2011Table(rows){
  const tableHead = document.getElementById("tableHead");
  const table2011Body = document.getElementById("table2011Body");
  const totalsDiv = document.getElementById("totals2011mipl");
  const table = document.getElementById("mipl2011Table");

  tableHead.innerHTML="";
  table2011Body.innerHTML="";

  if(!rows || rows.length<=1){
    table.style.display="none";
    totalsDiv.style.display="none";
    return;
  }

  table.style.display="table";

  const config = tableConfig[currentFilterType] || tableConfig.search;
  const headers = config.headers;
  const cols = config.cols;

  const headerRow = document.createElement("tr");
  headers.forEach(h=>{const th=document.createElement("th"); th.textContent=h; headerRow.appendChild(th);});
  tableHead.appendChild(headerRow);

  let totalTds=0,totalReceipt=0,totalBill=0,totalCn=0,totalPEBWeight=0;

  const sortedRows = rows.slice(1).sort((a,b)=>Number(b[0])-Number(a[0]));

  sortedRows.forEach(r=>{
    const tr = document.createElement("tr");
    cols.forEach(colIndex=>{
      const cell = r[colIndex] || "";
      const td = document.createElement("td");
      if(cell && (cell.startsWith("http") || cell.startsWith("www"))){
        const a=document.createElement("a");
        a.href = cell.startsWith("http") ? cell : `https://${cell}`;
        a.innerHTML="&#128221;"; a.target="_blank"; td.appendChild(a);
      } else td.innerHTML = highlightText(cell);
      tr.appendChild(td);
    });

    const typeCell = r[1]?.toUpperCase().trim();
    if(typeCell==="BANK" || typeCell === "CASH") tr.style.color="red";
    else if(typeCell==="CREDIT NOTE") tr.style.color="grey";
    else if(typeCell==="CHALLAN") tr.style.color="green";

    table2011Body.appendChild(tr);

    if(currentFilterType==="ledger"){
      const type = r[1]?.trim().toUpperCase();
      const receipt = parseFloat(r[4]) || 0;
      const amount = parseFloat(r[6]) || 0;
      const weight = parseFloat(r[7]) || 0;
      if(type==="TDS") totalTds+=receipt;
      else if(type === "BANK" || type === "CASH") totalReceipt+=receipt;
      else if(type==="TAX INVOICE"   || type === "CHALLAN"){ totalBill+=amount; totalPEBWeight+=weight;}
      else if(type==="CREDIT NOTE") totalCn+=amount;
    }
  });

 // if(currentFilterType==="ledger"){ totalsDiv.style.display="block"; updateTotals(totalTds,totalReceipt,totalBill,totalCn,totalPEBWeight);}
 // else totalsDiv.style.display="none";



 //

 if(currentFilterType === "ledger") {
    
    // ‚úÖ Show Ledger Totals
    totalsDiv.style.display = "block";
    document.getElementById("poTotals2011mipl").style.display = "none";
    
    updateTotals(totalTds,totalReceipt,totalBill,totalCn,totalPEBWeight);
}

else if(currentFilterType === "sale") {

    // ‚úÖ Hide Ledger Totals, show PO totals
    totalsDiv.style.display = "none";
    document.getElementById("poTotals2011mipl").style.display = "block";

    // ‚úÖ Auto-update PO totals when table refresh
    updatePOTotals(rows);

} else {
    totalsDiv.style.display = "none";
    document.getElementById("poTotals2011mipl").style.display = "none";
}
//
  highlightInvoiceAndPOCells();
}

// === Highlight Text ===
function highlightText(text){
  const searchValue = document.getElementById("search2011Input")?.value.toLowerCase();
  if(!searchValue) return text;
  const regex = new RegExp(`(${searchValue})`,"gi");
  return text.replace(regex,'<span style="background:yellow;font-weight:bold;">$1</span>');
}

// === Highlight Invoice + PO clickable ===
function highlightInvoiceAndPOCells(){
  const table = document.getElementById("mipl2011Table");
  if(!table) return;
  const rows = table.getElementsByTagName("tr");
  for(let row of rows){
    const cells = row.cells;
    if(!cells || cells.length<11) continue;
    const typeText = cells[1].innerText.trim().toUpperCase();
    const invoiceCell = cells[4]; const invoiceNo = invoiceCell.innerText.trim();
    const poType = cells[10].innerText.trim().toUpperCase(); const poCell = cells[6]; const poName = poCell.innerText.trim();

    if(typeText==="TAX INVOICE" && invoiceNo){
      invoiceCell.classList.add("clickable");
      invoiceCell.onclick = ()=>{const key=invoiceNo.replace(/\//g,"_"); fetch(`${apiFileUrl}?invoice=${encodeURIComponent(key)}`).then(res=>res.text()).then(url=>url==="NOT_FOUND"?alert("Invoice not found"):window.open(url,"_blank")).catch(()=>alert("Error loading invoice"));};
    }

    if(poType==="JOB/REFF" && poName){
      poCell.classList.add("clickable");
      poCell.onclick = ()=>{const key=poName.replace(/\//g,"_"); fetch(`${apiFileUrl}?po=${encodeURIComponent(key)}`).then(res=>res.text()).then(url=>url==="NOT_FOUND"?alert("PO not found"):window.open(url,"_blank")).catch(()=>alert("Error loading PO"));};
    }
  }
}

// === Update Totals ===
function updateTotals(totalTds,totalReceipt,totalBill,totalCn,totalPEBWeight){
  document.getElementById("totalTds").textContent=totalTds.toFixed(0);
  document.getElementById("totalReceipt").textContent=totalReceipt.toFixed(0);
  document.getElementById("totalBill").textContent=totalBill.toFixed(0);
  document.getElementById("totalCn").textContent=totalCn.toFixed(0);
  document.getElementById("totalPEBWeight").textContent=totalPEBWeight.toFixed(0);
  const difference = totalBill-totalReceipt-totalTds+totalCn;         // BALANCE CALCULATION
  const diffElement=document.getElementById("totalDifference");
  diffElement.textContent=difference.toFixed(0);
  diffElement.style.color = difference<0 ? "red":"green";
}

// === Setup Dropdown ===
function setupDropdown(inputId,dropdownId,options,callback){
  const input = document.getElementById(inputId);
  const dropdown = document.getElementById(dropdownId);
  let currentIndex=-1;

  function showDropdown(list){ dropdown.innerHTML=""; if(list.length===0){dropdown.style.display="none"; return;} list.forEach(opt=>{const div=document.createElement("div"); div.textContent=opt; div.addEventListener("click",()=>selectOption(opt)); dropdown.appendChild(div);}); dropdown.style.display="block"; }
  function selectOption(value){ input.value=value; dropdown.style.display="none"; currentIndex=-1; callback(value);}
  input.addEventListener("click",()=>showDropdown(options));
  input.addEventListener("input",()=>{ const val=input.value.toLowerCase(); const filtered=options.filter(opt=>opt.toLowerCase().includes(val)); showDropdown(filtered); });
  document.addEventListener("click",(e)=>{if(!dropdown.contains(e.target) && e.target!==input) dropdown.style.display="none";});
}

// === Reset Dates ===
function resetDates(){ document.getElementById("start2011Date").value=""; document.getElementById("end2011Date").value=""; }




//  dropdown fuction in sales bttn for po reff no ke lye ============================== start
// ‚úÖ Initialize PO Dropdown only for SALE type rows
function init2011PoDropdown() {
  const saleRows = sheetData.slice(1).filter(r =>
    (r[10] || "").trim().toUpperCase() === "SALE"
  );

  const poOptions = [...new Set(saleRows.map(r => r[5]).filter(v => v))].sort();

  setupDropdown("po2011Input", "po2011Dropdown", poOptions, (val) => {
    selectedPO = val;
    applyPOFilter(val);
  });
}



// ‚úÖ Apply Filter based on selected PO
function applyPOFilter(poName) {
  if (!poName) {
    render2011Table([]);
    document.getElementById("poTotals2011mipl").style.display = "none";
    return;
  }

  const filtered = sheetData.filter((r, i) =>
    i === 0 ||
    ((r[10] || "").trim().toUpperCase() === "SALE" &&
     (r[5] || "").trim() === poName.trim())
  );

  updatePOTotals(filtered);
  render2011Table(filtered);
}



// ‚úÖ Correct totals calculation based on SALE columns
function updatePOTotals(rows) {
  let totalBill = 0;
  let totalWeight = 0;

  rows.slice(1).forEach(r => {
    totalBill += parseFloat(r[6]) || 0;  // ‚úÖ Bill Amount
    totalWeight += parseFloat(r[7]) || 0; // ‚úÖ PEB Weight
  });

  document.getElementById("poTotalAmount").textContent = totalBill.toFixed(0);
  document.getElementById("poTotalWeight").textContent = totalWeight.toFixed(0);

  document.getElementById("poTotals2011mipl").style.display = "block";
}

// =================//  dropdown fuction in sales bttn for po reff no ke lye ============================== stop



// === Apply Search / Ledger / Date Filter ===
function applySearch() {
  const val = document.getElementById("search2011Input")?.value.toLowerCase();
  const startDate = document.getElementById("start2011Date")?.value
    ? new Date(document.getElementById("start2011Date").value + "T00:00:00")
    : null;
  const endDate = document.getElementById("end2011Date")?.value
    ? new Date(document.getElementById("end2011Date").value + "T23:59:59")
    : null;

  let dataToSearch = sheetData;

  if (currentFilterType === "ledger") {
    // If ledger selected, filter by ledger + SALE/RECEIPT
    if (selectedLedger) {
      dataToSearch = sheetData.filter((r, i) =>
        i === 0 || 
        (r[3]?.trim() === selectedLedger && ["SALE", "RECEIPT"].includes((r[10] || "").trim().toUpperCase()))
      );
    } else {
      // No ledger selected, show all SALE/RECEIPT
      dataToSearch = sheetData.filter((r, i) =>
        i === 0 || ["SALE", "RECEIPT"].includes((r[10] || "").trim().toUpperCase())
      );
    }
 // } else if (["poreff", "receipt", "sale"].includes(currentFilterType)) {

 } else if (currentFilterType === "sale") {

  if (selectedPO) {
    dataToSearch = sheetData.filter((r, i) =>
      i === 0 || (
        (r[10] || "").trim().toUpperCase() === "SALE" &&
        r[5]?.trim() === selectedPO
      )
    );
  } else {
    dataToSearch = sheetData.filter((r, i) =>
      i === 0 || (r[10] || "").trim().toUpperCase() === "SALE"
    );
  }

} else if (currentFilterType === "receipt" || currentFilterType === "poreff") {
//


    const map = { poreff: "JOB/REFF", receipt: "RECEIPT", sale: "SALE" };
    dataToSearch = sheetData.filter((r, i) =>
      i === 0 || (r[10]?.trim().toUpperCase() === map[currentFilterType])
    );
  } else if (currentFilterType === "address") {
    dataToSearch = addressData;
  } else if (currentFilterType === "psw") {
    dataToSearch = pswData;
  }  else if (currentFilterType === "atn") {
    dataToSearch = atnData;
  }

  const filtered = dataToSearch.filter((row, i) => {
    if (i === 0) return true;
    const matchesSearch = !val || row.some(c => (c || "").toLowerCase().includes(val));
    const date = row[2] ? new Date(row[2]) : null;
    const matchDate = (!startDate || (date && date >= startDate)) && (!endDate || (date && date <= endDate));
    return matchesSearch && matchDate;
  });

  render2011Table(filtered);
}



// === Filter Button Click Handling ===
document.querySelectorAll("#mipl2011Buttons .filter-btn").forEach(btn => {
  btn.addEventListener("click", function() {
    // Remove active from all buttons
    document.querySelectorAll("#mipl2011Buttons .filter-btn").forEach(b => b.classList.remove("active"));
    // Set current active
    this.classList.add("active");

    currentFilterType = this.dataset.value;
    resetDates();
    document.getElementById("search2011Input").value = "";
    document.getElementById("ledger2011Select").style.display = "none";
    document.getElementById("totals2011mipl").style.display = "none";
    filteredData = sheetData;
    selectedLedger = "";

    if (currentFilterType === "ledger") {
      document.getElementById("ledger2011Select").style.display = "block";
    } 
    //
    if (currentFilterType === "sale") {
  document.getElementById("po2011Select").style.display = "block";
  init2011PoDropdown();
} else {
  document.getElementById("po2011Select").style.display = "none";
  selectedPO = "";
}
//

    applySearch();
  });
});



// === Event Listeners ===
document.getElementById("search2011Input")?.addEventListener("input",applySearch);
document.getElementById("start2011Date")?.addEventListener("change",applySearch);
document.getElementById("end2011Date")?.addEventListener("change",applySearch);

load2011Data();
init2011PoDropdown(); 




//


// === PRINT FUNCTION ===
function print2011Report() {
  const table = document.getElementById("mipl2011Table");
  if (!table || table.style.display === "none") {
    alert("No table data to print!");
    return;
  }

  const printWindow = window.open("", "_blank");

  let totalsHTML = "";

  // ‚úÖ If Ledger Filter Active ‚Üí Print Ledger Totals
  if (currentFilterType === "ledger") {
    const totals = document.getElementById("totals2011mipl").cloneNode(true);

    // ‚úÖ Replace Input Box with selected Ledger Name text
    const ledgerInput = document.getElementById("ledger2011Input");
    const cloneInput = totals.querySelector("#ledger2011Input");
    if (ledgerInput && cloneInput) {
      const ledgerValue = ledgerInput.value.trim();
      cloneInput.outerHTML =
        `<strong style="padding:4px;color:#000;">Ledger: ${ledgerValue || "N/A"}</strong>`;
    }

    // ‚úÖ Hide Dropdown inside print
    let drp = totals.querySelector("#ledger2011Dropdown");
    if (drp) drp.remove();

    totalsHTML = totals.outerHTML;
  }

  // ‚úÖ If PO Filter Active ‚Üí Print PO Totals
  if (currentFilterType === "sale") {
    const poTotals = document.getElementById("poTotals2011mipl").cloneNode(true);
    const poInput = document.getElementById("po2011Input");

    // ‚úÖ Show selected PO above totals
    const selectedPOText = poInput?.value?.trim() || "(No PO Selected)";
    totalsHTML = `
      <div style="margin-bottom:10px;">
        <strong>PO Ref:</strong> ${selectedPOText}
      </div>
      ${poTotals.outerHTML}
    `;
  }

  printWindow.document.write(`
    <html>
      <head>
        <title>Print Preview - MIPL Report</title>
        <style>
          body { font-family:"Segoe UI", Arial, sans-serif; margin:20px; background:#fff; }
          h2 { text-align:center; margin-bottom:10px; margin-top:5px; }
          table { width:100%; border-collapse:collapse; margin-top:10px; }
          th, td { border:1px solid #555; padding:6px 8px; text-align:center; font-size:13px; }
          th { background-color:#efefef; }
          tr:nth-child(even){background-color:#f9f9f9;}
          tr:hover{background-color:#e6f0ff;}
          #printBtn { margin-top:20px; }
          .developer-tag { 
            text-align:left; 
            font-size:13px; 
            color:#444; 
            font-weight:bold;
          }
          @media print { 
            #printBtn{display:none;} 
            body{zoom:95%;}
          }
          strong { font-size:14px; }
        </style>
      </head>
      <body>
        <div class="developer-tag">
          Developed By - eS|MTally Kundeshwari Kashipur
        </div>
        <h2>MIPL Report Preview</h2>
        ${totalsHTML}
        ${table.outerHTML}
        <div style="text-align:center;">
          <button id="printBtn" onclick="window.print()">üñ®Ô∏è Print Now</button>
        </div>
      </body>
    </html>
  `);
  printWindow.document.close();
}


// === REFRESH FUNCTION ===
function refresh2011Data() {
  const btn = document.getElementById("refresh2011Btn");
  btn.disabled = true;
  btn.textContent = "‚è≥ Refreshing...";

  // Re-fetch data from Google Sheets
  load2011Data()
    .then(() => {
      applySearch();
      btn.textContent = "üîÑ Refresh";
      btn.disabled = false;
      alert("‚úÖ Data refreshed successfully!");
    })
    .catch((err) => {
      console.error("Refresh Error:", err);
      btn.textContent = "üîÑ Refresh";
      btn.disabled = false;
      alert("‚ùå Failed to refresh data. Check console for details.");
    });
}
document.getElementById("refresh2011Btn")?.addEventListener("click", refresh2011Data);
//

</script>


 
<!-- ===================================  2011 table code and script stop HARE ================================== -->

</body>
</html>



<!-- ========= file export in excel & html script start ============ -->
   <style>
  .export-menu {
    position: absolute;
    background: white;
    border: 1px solid #ddd;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    border-radius: 6px;
    display: none;
    flex-direction: column;
    min-width: 100px;
    z-index: 100;
  }

  .export-menu button {
    padding: 8px 8px;
    background: none;
    border: none;
    text-align: left;
    cursor: pointer;
  }

  .export-menu button:hover {
    background: #f0f0f0;
    color: #0026ff;
  }

</style>

<!-- ====== Export Menu ====== -->
<div id="exportMenu" style="display:none; flex-direction:column; position:absolute; background:#fff; border:1px solid #ccc; padding:5px; z-index:999;">
  <button data-type="html">‚¨áÔ∏è Export HTML</button>
  <button data-type="excel">üìä Export Excel</button>
</div>


<!-- ====== Script Section ====== -->
<script>
// === Export Menu Toggle ===
const exportMenu = document.getElementById("exportMenu");
let currentTargetId = null;

// Handle all export buttons dynamically
document.querySelectorAll("[id^='export']").forEach(btn => {
  btn.addEventListener("click", (e) => {
    e.stopPropagation();
    const rect = btn.getBoundingClientRect();
    exportMenu.style.top = rect.bottom + "px";
    exportMenu.style.left = rect.left + "px";
    exportMenu.style.display = "flex";
    currentTargetId = btn.dataset.target;
  });
});

// Hide menu on outside click
document.addEventListener("click", (e) => {
  if (!exportMenu.contains(e.target)) {
    exportMenu.style.display = "none";
  }
});

// === Export Buttons Action ===
document.querySelectorAll("#exportMenu button").forEach(btn => {
  btn.addEventListener("click", () => {
    const type = btn.dataset.type;
    exportRenderedTable(currentTargetId, type);
    exportMenu.style.display = "none";
  });
});

// === Export Rendered Table Function ===
function exportRenderedTable(targetId, type) {
  const targetElement = document.getElementById(targetId);

  if (!targetElement) {
    alert("‚ö†Ô∏è No table data to export!");
    return;
  }

  // clone the table or div
  const cloned = targetElement.cloneNode(true);
  const wrapper = document.createElement("div");
  wrapper.appendChild(cloned);
  const htmlData = wrapper.innerHTML;

  let blob;
  let filename;

  if (type === "html") {
    blob = new Blob([htmlData], { type: "text/html" });
    filename = `${targetId}.html`;
  } else if (type === "excel") {
    blob = new Blob([htmlData], { type: "application/vnd.ms-excel" });
    filename = `${targetId}.xls`;
  }

  triggerDownload(blob, filename);
}

function triggerDownload(blob, filename) {
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
  URL.revokeObjectURL(link.href);
}
</script>
<!-- ========= file export in excel & html script stop ============ -->



<!-- ================================================ Dishplay Report Script stop hare ========================================================= -->


<!-- ==========  ------------------------------------------xxxxxxxxxxxxxxxxxxxxx-----------------------------------------======================= -->









<!-- ================  id unlock by admin (ULU) script and code start hare ===============================-->

<!-- üîπ Popup Form Container -->
<div id="ULUPopup" class="popupULU-overlay">
  <div class="popupULU-content slide-in">
    <span id="closeULUBtn" class="close-btn">&times;</span>

    <form id="mainULUForm" style="display:flex; align-items:center; gap:10px; flex-wrap:nowrap;">
      <input type="hidden" name="SNo" id="sNo" />
      <input type="hidden" name="User" readonly value="ATN">

<input type="text"  name="cl3" readonly  value="UBU"
       style="padding:8px; width:100px; border:1px solid #aaa; border-radius:6px;">

      <!-- Date -->
      <label style="font-size:13px;font-weight:bold;">Date:</label>
      <input id="popupULU-date" type="date" name="Date" style="padding:4px 6px; border-radius:6px; border:1px solid #ccc;">

      <!-- Ledger -->
      <label style="font-size:13px;font-weight:bold;">User:</label>
      <select name="Ledger" required style="padding:4px 6px; border-radius:6px; border:1px solid #ccc;">
        <option value="">Select</option>
        <option>Rahul Kumar</option>
        <option>Anchal</option>
        <option>V.K Giri</option>
        <option>Harshit</option>
        <option>Prakhar</option>
        <option>Suryabhan</option>
        <option>Mukhtar (Admin)</option>
        <option>NITIN</option>
        <option>Divesh</option>
        <option>Vijender Kumar Sharma</option>
      </select>

      <!-- Status -->
      <label style="font-size:13px;font-weight:bold;">Status:</label>
      <select name="cl1" required style="padding:4px 6px; border-radius:6px; border:1px solid #ccc;">
        <option value="">Select</option>
        <option>P</option>
        <option>A</option>
        <option>O</option>
      </select>

      <!-- Hidden inputs -->
      <input type="hidden" id="timestampULU" name="timestampULU">
      <input type="hidden" name="cl2" id="cl2">

      <!-- Submit -->
      <input type="submit" id="submitULUButton" value="Submit"
        style="padding:6px 14px; background:#035b67; color:white; border:none; border-radius:6px; cursor:pointer;">
    </form>

  </div>
</div>

<!-- ‚úÖ CSS -->
<style>


/* Popup Overlay */
.popupULU-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.4);  /* 40% transparent background */
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

/* Popup Box */
.popupULU-content {
  background: rgba(255,255,255,0.7); /* light transparent white */
  padding: 10px 16px;
  border-radius: 12px;
  width: 12in;
  height: 0.3in;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  position: relative;
  transform: translateY(-100%);
  opacity: 0;
  transition: all 0.4s ease;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

/* Slide-in Animation */
.popupULU-overlay.active .popupULU-content {
  transform: translateY(0);
  opacity: 1;
}

.close-btn {
  position: absolute;
  top: 5px;
  right: 12px;
  cursor: pointer;
  font-size: 18px;
  font-weight: bold;
  color: #035b67;
}
</style>

<!-- ‚úÖ JavaScript -->
<script>

  // ------------- note :- jis button se ye open poup ope karna hai usme id="openULUBtn" ye add kro
const popup = document.getElementById("ULUPopup");
const openBtn = document.getElementById("openULUBtn");
const closeBtn = document.getElementById("closeULUBtn");
const scriptULUURL = 'https://script.google.com/macros/s/AKfycbxNCtOS7UZu2mw_Zuwkx-KHdORL1DATDoSp0Gv2Q5EQw6CKJOSPowawczVE_7uYHQw_/exec';

// üîπ Open Popup
openBtn.addEventListener("click", () => {
  popup.classList.add("active");
  popup.style.display = "flex";

  // Auto set today's date
  const today = new Date().toISOString().split('T')[0];
  document.getElementById("popupULU-date").value = today;

  // Set timestamp + cl2
  const now = new Date();
  const timestamp = now.toLocaleString("en-GB", { hour12: false });
  document.getElementById("timestampULU").value = timestamp;
   document.getElementById("cl2").value = `${timestamp}`; // agar time stamp "UBA-01/11/2025, 13:27:56" is fromat me chaye "UBA" - TYPE KRO
});

// üîπ Close Popup Function
function closeULUPopup() {
  popup.classList.remove("active");
  setTimeout(() => popup.style.display = "none", 400);
}

// üîπ Close Button
closeBtn.addEventListener("click", closeULUPopup);

// üîπ Click outside form closes popup
popup.addEventListener("click", (e) => {
  if (e.target.id === "ULUPopup") closeULUPopup();
});

// üîπ Submit Form
document.addEventListener("submit", async function (e) {
  const form = e.target;
  if (form.id !== "mainULUForm") return;
  e.preventDefault();

  const submitBtn = document.getElementById("submitULUButton");
  // const waitMsg = document.getElementById("waitULUMessage");

  submitBtn.disabled = true;
  submitBtn.value = "Please wait...";
 // waitMsg.innerText = "Submitting...";
// waitMsg.style.display = "block";

  try {
    const formData = new FormData(form);
    const response = await fetch(scriptULUURL, { method: 'POST', body: formData });
    const result = await response.json();

    if (result.result === 'success') {
      alert('‚úÖ Attendance Submitted Successfully!');
      form.reset();
      closeULUPopup(); // Auto close popup
    } else {
      alert(`‚ùå Error: ${result.error || 'Unknown error occurred.'}`);
    }
  } catch (err) {
    alert(`‚ùå Error submitting form: ${err.message}`);
  } finally {
    submitBtn.disabled = false;
    submitBtn.value = "Submit";
   // setTimeout(() => (waitMsg.style.display = 'none'), 2000);
  }
});
</script>
<!-- ================  id unlock by admin (ULU) script and code stop hare ===============================-->


















<!-- ============== CASH LEDGER REPORT (5792) SCRIPT START HARE ================= -->
<style>
  #search5792Bar {
    background-color: #424242;
    width: 100%;
    display: flex;
    align-items: center;
    padding: 10px;
    flex-wrap: wrap;
    gap: 10px;
    box-sizing: border-box;
  }

  #search5792Input {
    flex: 1;
    background-color: #fdfdf6;
    border: none;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 14px;
    outline: none;
  }

  #search5792Bar label { font-weight: bold; color: rgb(247, 244, 244); margin-left: 10px;}
  #search5792Bar input[type="date"] { padding: 4px 6px; border-radius: 4px;border: 1px solid #ccc; font-size: 14px;}


.dp5792 { position: absolute;top: 80px;left: 0; right: 0;background: white; border: 6px solid #280101;height: 700px; width: 500px;overflow-y: auto; display: none; z-index: 100;background-color: #e4e4e6;}
.dp5792 div { padding: 6px; cursor: pointer;}
.dp5792 div:hover { background: #e8cd36; color: rgb(1, 3, 30);font-weight: bold;}

</style>



<script>
const api5792Key = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheet5792Id = "1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0";
const range5792 = "FORM!A:G";

let all5792Data = [];
let filtered5792Data = [];

// ‚úÖ Convert "7-Oct-2025" ‚Üí Date object
function parseCustomDate(dateStr) {
  if (!dateStr) return null;
  const parts = dateStr.split("-");
  if (parts.length !== 3) return null;
  const day = parseInt(parts[0]);
  const monthStr = parts[1].toLowerCase().substring(0, 3);
  const year = parseInt(parts[2]);
  const months = {
    jan: 0, feb: 1, mar: 2, apr: 3, may: 4, jun: 5,
    jul: 6, aug: 7, sep: 8, oct: 9, nov: 10, dec: 11
  };
  const month = months[monthStr];
  if (isNaN(day) || isNaN(year) || month === undefined) return null;
  return new Date(year, month, day);
}

// ‚úÖ Fetch Google Sheet Data
// ‚úÖ Fetch Google Sheet Data (skip rows where column B == "DLT")
async function fetch5792Data() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet5792Id}/values/${range5792}?key=${api5792Key}`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    let rows = data.values || [];

    // üîπ Skip header row (first row)
    const header = rows[0];
    const filtered = rows.slice(1).filter(row => (row[1] || "").trim().toUpperCase() !== "DLT");

    // üîπ Combine header + filtered rows
    const finalData = [header, ...filtered];
    return finalData;
  } catch (err) {
    console.error("Error fetching data:", err);
    return [];
  }
}

// ‚úÖ Process Rows (convert only JNP ‚Üí MA)
function processRows(rows) {
  if (!rows || rows.length < 2) return [];
  const headers = rows[0];

  let data = rows.slice(1).map(r => {
    let obj = {};
    headers.forEach((h, i) => obj[h] = r[i] || "");
    obj._serial = parseFloat(r[0]) || 0;
    obj._user = (r[1] || "").trim().toUpperCase();
    obj._type = (r[2] || "").trim().toLowerCase();
    obj._dateStr = r[3] || "";
    obj._date = parseCustomDate(r[3]);
    obj._ledger = r[4] || "";
    obj._amount = parseFloat(r[5]) || 0;

    // ‚úÖ Only JNP ‚Üí MA (JNR unaffected)
      if (obj._user === "JNP") obj._user = "MA";

    // ‚úÖ Convert JNP & JNR ‚Üí MA
//  if (obj._user === "JNP" || obj._user === "JNR") {
  //  obj._user = "MA";
//    }


    return obj;
  });

  data.sort((a, b) => b._serial - a._serial);
  return data;
}

// ‚úÖ Render Table + Color Formatting
function render5792Table(data) {
  const container = document.getElementById("table5792Container");
  if (!data.length) {
    container.innerHTML = "<p>No records found.</p>";
    return;
  }

  // ‚úÖ Ensure each record has parsed date before sorting  ---------------
  data.forEach(r => {
    if (!r._date && r["Date"]) {
      const d = r["Date"].trim();
      const parts = d.split("-");
      if (parts.length === 3) {
        const day = parseInt(parts[0]);
        const mon = parts[1].substring(0, 3).toLowerCase();
        const yr = parseInt(parts[2]);
        const months = {
          jan: 0, feb: 1, mar: 2, apr: 3, may: 4, jun: 5,
          jul: 6, aug: 7, sep: 8, oct: 9, nov: 10, dec: 11
        };
        r._date = new Date(yr, months[mon], day);
      } else {
        r._date = null;
      }
    }
  });

  // ‚úÖ Sort by date descending (latest ‚Üí oldest)
  data.sort((a, b) => {
    const da = a._date ? a._date.getTime() : 0;
    const db = b._date ? b._date.getTime() : 0;
    return db - da;
  });
//----- DATE WISE TABLE SHORT ----------------


  const headers = Object.keys(data[0]).filter(h => !h.startsWith("_"));
  const html = `
    <table id="my5792Table" border="1" style="border-collapse:collapse;width:100%;font-size:14px;">
      <thead style="background:#004d80;color:white;">
        <tr>${headers.map(h => `<th>${h}</th>`).join("")}<th>Running Balance</th></tr>
      </thead>
      <tbody>
        ${data.map(r => {
          let color = "";
          const type = r._type.toLowerCase();
          if (type === "receipt") color = "red";
          else if (type === "salary") color = "blue";
          else if (type === "billdr") color = "green";

          return `
            <tr style="color:${color};">
              ${headers.map(h => `<td>${r[h]}</td>`).join("")}
              <td class="runningBalance"></td>
            </tr>`;
        }).join("")}
      </tbody>
    </table>
  `;
  container.innerHTML = html;

  // ‚úÖ Ensure "JNP" converted to "MA" even after render
  const rows = container.querySelectorAll("#my5792Table tbody tr");
  rows.forEach(row => {
    const userCell = row.cells[1];
    if (!userCell) return;
    const val = userCell.textContent.trim().toUpperCase();
  //  if (val === "JNP") userCell.textContent = "MA"; // Only JNP ‚Üí MA

if (val === "JNP" || val === "JNR") {
    userCell.textContent = "MA";
}


  });
  //------------------
  calculate5792RunningBalance();
}

// ‚úÖ Calculate Running Balance
function calculate5792RunningBalance() {
  const rows = Array.from(document.querySelectorAll('#my5792Table tbody tr'));
  if (rows.length === 0) return;

  const lastRow = rows[rows.length - 1];
  const lastCells = lastRow.querySelectorAll('td');
  const lastType = lastCells[2]?.textContent.trim().toLowerCase();
  const lastAmount = parseFloat(lastCells[5]?.textContent || 0);

  const creditTypes = ["receipt", "salary", "billcr"];
  let runningBalance = creditTypes.includes(lastType) ? lastAmount : -lastAmount;

  lastRow.querySelector('.runningBalance').textContent = runningBalance.toFixed(2);

  for (let i = rows.length - 2; i >= 0; i--) {
    const cells = rows[i].querySelectorAll('td');
    const type = cells[2]?.textContent.trim().toLowerCase();
    const amount = parseFloat(cells[5]?.textContent || 0);

    if (!isNaN(amount)) {
      if (creditTypes.includes(type)) {
        runningBalance += amount;
      } else if (["payment", "billdr"].includes(type)) {
        runningBalance -= amount;
      }
    }
    rows[i].querySelector('.runningBalance').textContent = runningBalance.toFixed();
  }
}

// ‚úÖ Apply Filters (Search + Ledger + User + Date)
function apply5792Filters() {
  const searchVal = document.getElementById("search5792Input")?.value.toLowerCase() || "";
  const ledgerVal = document.getElementById("ledger5792Input")?.value.toLowerCase() || "";
  const userVal = document.getElementById("user5792")?.value || "";
  const startDateStr = document.getElementById("start5792Date")?.value;
  const endDateStr = document.getElementById("end5792Date")?.value;

  const startDate = startDateStr ? new Date(startDateStr) : null;
  const endDate = endDateStr ? new Date(endDateStr) : null;

  filtered5792Data = all5792Data.filter(row => {
    const rowDate = row._date;
    if (!rowDate) return false;

    const rowTime = rowDate.setHours(0, 0, 0, 0);
    const startTime = startDate ? startDate.setHours(0, 0, 0, 0) : null;
    const endTime = endDate ? endDate.setHours(0, 0, 0, 0) : null;

    // ‚úÖ Start date inclusive
    const inDateRange =
      (!startTime || rowTime >= startTime) &&
      (!endTime || rowTime <= endTime);

    const matchesUser = !userVal || row._user === userVal;
    const matchesLedger = !ledgerVal || (row._ledger || "").toLowerCase().includes(ledgerVal);
    const matchesSearch = !searchVal || Object.values(row)
      .some(v => String(v).toLowerCase().includes(searchVal));

    return inDateRange && matchesUser && matchesLedger && matchesSearch;
  });

  filtered5792Data.sort((a, b) => b._serial - a._serial);
  render5792Table(filtered5792Data);
}

// ‚úÖ Ledger Dropdown Setup
function setupLedger5792Dropdown() {
  const ledgerInput = document.getElementById("ledger5792Input");
  const dropdown = document.getElementById("ledger5792Dropdown");
  if (!ledgerInput || !dropdown) return;

  // ‚úÖ Create sorted ledger list
  const ledgers = [...new Set(all5792Data.map(r => r._ledger).filter(Boolean))].sort((a, b) =>
    a.localeCompare(b)
  );

  // ‚úÖ On input ‚Üí filter dropdown
  ledgerInput.addEventListener("input", () => {
    const value = ledgerInput.value.trim().toLowerCase();
    dropdown.innerHTML = "";

    const matches = value
      ? ledgers.filter(l => l.toLowerCase().includes(value))
      : ledgers; // if no input, show all

    matches.forEach(item => {
      const div = document.createElement("div");
      div.textContent = item;
      div.style.padding = "4px";
      div.style.cursor = "pointer";
      div.onclick = () => {
        ledgerInput.value = item;
        dropdown.style.display = "none";
        apply5792Filters();
      };
      dropdown.appendChild(div);
    });

    dropdown.style.display = matches.length ? "block" : "none";
  });

  // ‚úÖ On focus (click on input) ‚Üí show full dropdown
  ledgerInput.addEventListener("focus", () => {
    dropdown.innerHTML = "";
    ledgers.forEach(item => {
      const div = document.createElement("div");
      div.textContent = item;
      div.style.padding = "4px";
      div.style.cursor = "pointer";
      div.onclick = () => {
        ledgerInput.value = item;
        dropdown.style.display = "none";
        apply5792Filters();
      };
      dropdown.appendChild(div);
    });
    dropdown.style.display = ledgers.length ? "block" : "none";
  });

  // ‚úÖ Hide dropdown when clicked outside
  document.addEventListener("click", e => {
    if (!ledgerInput.contains(e.target) && !dropdown.contains(e.target)) {
      dropdown.style.display = "none";
    }
  });
}
//-------------------------------------------------------


// ‚úÖ Setup Event Listeners
function setup5792Events() {
  document.getElementById("search5792Input")?.addEventListener("input", apply5792Filters);
  document.getElementById("user5792")?.addEventListener("change", apply5792Filters);
  document.getElementById("start5792Date")?.addEventListener("change", apply5792Filters);
  document.getElementById("end5792Date")?.addEventListener("change", apply5792Filters);
}

// ‚úÖ Refresh Function (Reload All)
async function refresh5792Table() {
  document.getElementById("search5792Input").value = "";
  document.getElementById("ledger5792Input").value = "";
  document.getElementById("user5792").value = "";
  document.getElementById("start5792Date").value = "";
  document.getElementById("end5792Date").value = "";
  const rows = await fetch5792Data();
  all5792Data = processRows(rows);
  filtered5792Data = [...all5792Data];
  render5792Table(all5792Data);
  setupLedger5792Dropdown();
}

// ‚úÖ Print Function
// ‚úÖ Print Function (with Ledger Name condition)
function print5792Table() {
  const table = document.getElementById("my5792Table");
  if (!table) {
    alert("No table data to print!");
    return;
  }

  // üîπ Ledger name fetch karo
  const ledgerName = document.getElementById("ledger5792Input")?.value.trim() || "";
  let ledgerHTML = "";
  if (ledgerName) {
    ledgerHTML = `<h4 style="text-align:center; margin-top:-10px;">Ledger: ${ledgerName}</h4>`;
  }

  const printWindow = window.open("", "_blank");
  printWindow.document.write(`
    <html>
      <head>
        <title>Print Table</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          table { width:100%; border-collapse:collapse; font-size:14px; }
          th, td { border:1px solid #444; padding:6px; text-align:left; }
          th { background:#004d80; color:white; }
          h3, h4 { text-align:center; }
        </style>
      </head>
      <body>
        <h3>Cash Ledger Report</h3>
        ${ledgerHTML}
        ${table.outerHTML}
      </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.print();
}


// ‚úÖ Initialize
document.addEventListener("DOMContentLoaded", async () => {
  const rows = await fetch5792Data();
  all5792Data = processRows(rows);
  filtered5792Data = [...all5792Data];
  render5792Table(all5792Data);
  setupLedger5792Dropdown();
  setup5792Events();
});
</script>




<!-- ============== CASH LEDGER REPORT (5792) SCRIPT STOP HARE ================= -->






<!-- ================  Payroll Attandse script start hare ===============================-->
<script>
/* --------------------- CONFIG --------------------- */
const apiPRLKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";   
const sheetPRLId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
const rangePRL = "ATN!A:M";

let sheetPRLData = [];

/* --------------------- LOAD SHEET DATA --------------------- */
async function loadPRLSheet() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetPRLId}/values/${rangePRL}?key=${apiPRLKey}`;
    const res = await fetch(url);
    const data = await res.json();

    const ignoreValues = [
        "152.59","152.58","49.36","106.205","103.93","117.99"
    ];

    // data.values ‚Üí filter rows where column H (index 7) does NOT contain any ignore value
    sheetPRLData = (data.values || []).filter(row => {
        const colH = row[7];   // H column
        if (!colH) return true; // if empty, keep row

        return !ignoreValues.some(v => colH.includes(v));
    });

    loadPRLMonths();
}


/* --------------------- LOAD MONTHS INTO DROPDOWN --------------------- */
function loadPRLMonths() {
    const monthPRLSelect = document.getElementById("monthPRLSelect");
    let months = new Set();

    for (let i = 1; i < sheetPRLData.length; i++) {
        let r = sheetPRLData[i];
        let dt = r[2]; // Column C
        if (!dt) continue;
        let d = new Date(dt);
        if (!isNaN(d)) months.add(`${d.getFullYear()}-${d.getMonth() + 1}`);
    }

    let sorted = [...months].sort((a,b)=>{
        let [ya, ma] = a.split("-").map(Number);
        let [yb, mb] = b.split("-").map(Number);
        return yb - ya || mb - ma;
    });

    const currentMonthKey = `${new Date().getFullYear()}-${new Date().getMonth()+1}`;

    monthPRLSelect.innerHTML = "";
    sorted.forEach(m=>{
        let [y, mo] = m.split("-");
        let dateObj = new Date(y, mo-1, 1);
        let opt = document.createElement("option");
        opt.value = m;
        opt.textContent = dateObj.toLocaleString("en-GB",{month:"long", year:"numeric"});
        if(m===currentMonthKey) opt.selected=true;
        monthPRLSelect.appendChild(opt);
    });

    showPayroll();
}

/* --------------------- SHOW ATTENDANCE TABLE --------------------- */
function showPayroll() {
    const m = document.getElementById("monthPRLSelect").value;
    const viewMode = document.getElementById("viewType").value;
    if(!m) return;

    let [year, month] = m.split("-").map(Number); month-=1;
    let first = new Date(year, month, 1);
    let last = new Date(year, month+1, 0);

    let dates=[];
    for(let d=new Date(first); d<=last; d.setDate(d.getDate()+1)) dates.push(new Date(d));

    let today=new Date(); today.setHours(0,0,0,0);

    // Employees list from row 2
    let employees=new Set();
    for(let i=1;i<sheetPRLData.length;i++) if(sheetPRLData[i][3]) employees.add(sheetPRLData[i][3]);
    employees=[...employees];

    // Map employee -> date -> {status, time}
    let map={}; employees.forEach(e=>map[e]={});
    for(let i=1;i<sheetPRLData.length;i++){
        let r=sheetPRLData[i];
        let name=r[3], dt=r[2]; if(!name || !dt) continue;
        let d=new Date(dt);
        if(d.getMonth()===month && d.getFullYear()===year){
            let dateStr=d.toISOString().split("T")[0];
            let rawTime=r[5]||"", onlyTime="";
            if(rawTime.includes(" ")){
                let parts=rawTime.split(" ");
                let timePart=parts.length>1?parts[1]:parts[0];
                let timeMatch=timePart.match(/^(\d{1,2}:\d{2})/);
                onlyTime = timeMatch ? timeMatch[1] : timePart;
            }
            map[name][dateStr]={status:r[4]||"P", time:onlyTime||""};
        }
    }

    // BUILD TABLE
    let html=`<table><tr><th>Employee</th>`;
    dates.forEach(d=>html+=`<th>${d.getDate()}</th>`);
    html+=`<th>Total P</th><th>Total A</th></tr>`;

    // Day names
    html+=`<tr><th></th>`;
    dates.forEach(d=>html+=`<th>${d.toLocaleDateString("en-US",{weekday:"short"})}</th>`);
    html+=`<th></th><th></th></tr>`;

    employees.forEach(name=>{
        let totalP=0, totalA=0;
        html+=`<tr><td>${name}</td>`;
        dates.forEach(d=>{
            let dateStr=d.toISOString().split("T")[0];
            let entry=map[name][dateStr];
            let showValue="-";

            if(d>today) showValue="-";
            else{
                if(viewMode==="pa"){
                    let st = entry?entry.status:"A";
                    if(d.getDay()===0) st="P";
                    showValue=st;
                } else if(viewMode==="time"){
                    if(d.getDay()===0) showValue="PWL";
                    else if(entry) showValue=entry.time?entry.time:"A";
                    else showValue="A";
                }
            }

            // TOTAL P/A
            if(viewMode==="time"){
                if(showValue==="PWL") totalP++;
                else if(/^\d{1,2}:\d{2}$/.test(showValue)) totalP++;
                else if(showValue==="A") totalA++;
            } else {
                if(showValue==="P") totalP++;
                else if(showValue==="A") totalA++;
            }

            // CLASS
            let cls="";
            if(showValue==="A") cls="absent";
            else if(showValue==="PWL") cls="pwl";

            html+=`<td class="${cls}">${showValue}</td>`;
        });

        html+=`<td>${totalP}</td><td>${totalA}</td></tr>`;
    });

    html+=`</table>`;
    document.getElementById("attendancePRLTable").innerHTML=html;
}

/* --------------------- PRINT FUNCTION --------------------- */
function printPayroll() {
    // Get the current selected month text from dropdown
    const monthSelect = document.getElementById("monthPRLSelect");
    const monthText = monthSelect.options[monthSelect.selectedIndex].text;

    // Get the attendance table content
    const content = document.getElementById("attendancePRLTable").innerHTML;

    const printWindow = window.open("", "", "width=1200,height=800");
    printWindow.document.write(`
        <html>
        <head>
            <title>Attendance Print</title>
            <style>
                body { font-family: Arial; padding: 20px; }
                table { border-collapse: collapse; width: 100%; }
                th, td { border: 1px solid #666; padding: 6px; text-align: center; }
                th { background: #eee; }
                .absent { color: red; font-weight: bold; }
                .pwl { color: rgb(67, 104, 0); font-weight: bold; }
            </style>
        </head>
        <body>
            <h2 style="text-align:center;">Attendance Sheet - ${monthText}</h2>
            ${content}
        </body>
        </html>
    `);

    printWindow.document.close();
    printWindow.focus();
    setTimeout(() => { printWindow.print(); }, 500);
}


/* --------------------- INIT --------------------- */
loadPRLSheet();

</script>

<!-- ================  Payroll Attandse script stop hare ===============================-->




<!-- ------------------  ration card script and code start -------------------------------------- -->
<script>
const apiRCKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheetRCId = "1E9bwBJjHRo1DhUSNayuJ2j62ilqILvMzBvf3TrQGA9s";

let allData = [];  // { sheet, header, row }

// ‚úÖ Step 1: Get all sheet names
async function rationcardsheets() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetRCId}?key=${apiRCKey}`;
    const res = await fetch(url);
    const data = await res.json();
    return data.sheets.map(s => s.properties.title);
}

// ‚úÖ Step 2: Load all sheets data (header + rows)
async function loadRationCardData() {
    const sheetNames = await rationcardsheets();
    for (let name of sheetNames) {
        // Get header (Row 1)
        const headerUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetRCId}/values/${encodeURIComponent(name + "!A1:Z1")}?key=${apiRCKey}`;
        const headerRes = await fetch(headerUrl);
        const headerData = await headerRes.json();
        const headerRow = headerData.values ? headerData.values[0] : [];

        // Get data rows (From A2)
        const range = `${name}!A2:Z`;
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetRCId}/values/${encodeURIComponent(range)}?key=${apiRCKey}`;
        const res = await fetch(url);
        const data = await res.json();

        if (data.values) {
            data.values.forEach(row => {
                allData.push({ sheet: name, header: headerRow, row });
            });
        }
    }
    console.log("All data loaded:", allData);
}

// ‚úÖ Step 3: Search with Highlight + Show Header Once
function rationcardsearch() {
    const query = document.getElementById("searchInput").value.toLowerCase();
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    if (query.trim() === "") return;

    const filtered = allData.filter(item =>
        item.row.some(cell => cell.toLowerCase().includes(query))
    );

    if (filtered.length === 0) {
        resultsDiv.innerHTML = "<p>No results found</p>";
        return;
    }

    let lastSheet = "";

    filtered.forEach(item => {
        // Show header if sheet changes
        if (lastSheet !== item.sheet) {
            const headerDiv = document.createElement("div");
            headerDiv.style.backgroundColor = "#f0f0f0";
            headerDiv.style.fontWeight = "bold";
            headerDiv.style.padding = "5px";
            headerDiv.innerHTML = `<b>${item.sheet}</b> ‚Üí ${item.header.join(" | ")}`;
            resultsDiv.appendChild(headerDiv);
            lastSheet = item.sheet;
        }

        // Highlight match
        const highlightedRow = item.row.map(cell => {
            if (cell.toLowerCase().includes(query)) {
                const regex = new RegExp(`(${query})`, "gi");
                return cell.replace(regex, `<span style="background-color:blue; color:white;">$1</span>`);
            }
            return cell;
        });

        // Add result row
        const div = document.createElement("div");
        div.style.padding = "5px";
        div.style.borderBottom = "1px solid #ccc";
        div.innerHTML = highlightedRow.join(" | ");
        resultsDiv.appendChild(div);
    });
}

// ‚úÖ Start
loadRationCardData();
</script>

<!-- ------------------  ration card script and code stop -------------------------------------- -->














<!-- loading summry poup box start  script start hare +++++++++++++++++++++++++++++++++++++++++++++-->

<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>4x6 inch popupLoadStatus</title>
  <style>
    :root{
      --popupLoadStatus-bg:#ffffff;
      --popupLoadStatus-text:#111827;
      --popupLoadStatus-border:#e5e7eb;
      --popupLoadStatus-shadow:0 12px 30px rgba(0,0,0,.15);
      --popupLoadStatus-radius:14px;
    }

    .popupLoadStatus {
      position: fixed;
      left: 16px;
      bottom: 60px;
      width: 900px;   /* 6 inch */
      height: 450px;  /* 4 inch */
      background: var(--popupLoadStatus-bg);
      color: var(--popupLoadStatus-text);
      border: 1px solid var(--popupLoadStatus-border);
      border-radius: var(--popupLoadStatus-radius);
      box-shadow: var(--popupLoadStatus-shadow);
      overflow: hidden;
      opacity: 0;
      transform: translateY(20px);
      pointer-events: none;
      transition: opacity .25s ease, transform .25s ease;
      z-index: 9999;
    }

    .popupLoadStatus.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .popupLoadStatus__header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 12px;
      background: #d2d2d2;
      border-bottom:1px solid var(--popupLoadStatus-border);
    }
    .popupLoadStatus__title{
      margin:0;
      font-size: 15px;
      font-weight: 600;
    }
    .popupLoadStatus__close{
      border:1px solid var(--popupLoadStatus-border);
      background:#fff;
      border-radius:10px;
      width:30px;
      height:30px;
      cursor:pointer;
      font-size:18px;
    }
    .popupLoadStatus__close:hover{ background:#f3f4f6; }

    .popupLoadStatus__body{
      padding:12px;
      font-size:14px;
      height: calc(100% - 52px); /* header ke niche bacha hua area */
      overflow:auto; /* scroll agar zyada content ho */
      background-color: #f8ebe0;
    }
  </style>
</head>
<body>

  <div id="bottomLeftpopupLoadStatus" class="popupLoadStatus">
    <div class="popupLoadStatus__header">
      <h3 class="popupLoadStatus__title">Loading Status</h3>
      <button class="popupLoadStatus__close" id="popupLoadStatuscloseLSBtn">&times;</button>
    </div>
    <div class="popupLoadStatus__body">
   
     
      
     
<table id="noticeBoard">  <thead ><tr> <th>Type</th><th>Date</th> <th>Name</th><th>Vehicle No.</th><th>Job No.</th> <th>Status</th> <th>Inv. No.</th></tr></thead><tbody></tbody></table>


    </div>
  </div>

  <script>
    const popupLoadStatus = document.getElementById('bottomLeftpopupLoadStatus');
    const closeLSBtn = document.getElementById('popupLoadStatuscloseLSBtn');

    window.addEventListener('load', ()=> popupLoadStatus.classList.add('show'));
    closeLSBtn.addEventListener('click', ()=> popupLoadStatus.classList.remove('show'));
  </script>
</body>
</html>

<!-- loading summry poup box start  script stop hare +++++++++++++++++++++++++++++++++++++++++++++-->







<!-- loading summry  script start hare -->

<script>
// ===== CSS injected via JS (no <style> tag used) =====
const css = `
   /* Status Colors */
  .status-loading    { background-color: #ff4d4d; color: #fff; font-weight: bold; }
  .status-processing { background-color: #fd2222; color: #fff; font-weight: bold; }
  .status-processed  { background-color: #28a745; color: #fff; font-weight: bold; }
  .status-complete   { background-color: #28a745; color: #fff; font-weight: bold; }
  .status-unloading  { background-color: #39b3d8; color: #fff; font-weight: bold; }
`;
(function applyCSS(c){
  const s = document.createElement('style');
  s.textContent = c;
  document.head.appendChild(s);
})(css);

// ===== Notice Board Script =====
const apiNBKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheetNBId = "1Bx0FqnXHadVATN9DGhUtRZr2EDgz10hfDEgIlwtSC_4";
const rangeNB = "DATABASE!K:R";

async function loadNoticeBoard() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetNBId}/values/${rangeNB}?key=${apiNBKey}`;
  const response = await fetch(url);
  const data = await response.json();
  
  const rows = data.values;
  const tbody = document.querySelector("#noticeBoard tbody");
  tbody.innerHTML = "";

  if (!rows || rows.length <= 1) {
    tbody.innerHTML = `<tr><td colspan="7">No Data Found</td></tr>`;
    return;
  }

  // Last 3 days range
  const today = new Date();
  let allowedDates = [];
  for (let i = 0; i < 3; i++) {
    let d = new Date();
    d.setDate(today.getDate() - i);
    allowedDates.push(formatDateToYYYYMMDD(d));
  }

  rows.forEach((row, index) => {
    if (index === 0) return; // skip header

    const dateInL = row[1]; // Column L
    const formattedDate = dateInL ? formatCustomDate(dateInL) : "";

    if (allowedDates.includes(formattedDate)) {
      const tr = document.createElement("tr");

      for (let i = 0; i <= 6; i++) {
        const td = document.createElement("td");
        td.textContent = row[i] || "";

        // Status color coding
        if (i === 5) {
          const status = (row[i] || "").toUpperCase();
          if (status === "LOADING") td.classList.add("status-loading");
          else if (status === "PROCESSING") td.classList.add("status-processing");
          else if (status === "PROCESSED") td.classList.add("status-processed");
          else if (status === "UNLOADING") td.classList.add("status-unloading");
          else if (status === "COMPLETE") td.classList.add("status-complete");
        }
        tr.appendChild(td);
      }

      tbody.appendChild(tr);
    }
  });
}

// Format date to YYYY-MM-DD
function formatDateToYYYYMMDD(dateObj) {
  const y = dateObj.getFullYear();
  const m = String(dateObj.getMonth() + 1).padStart(2, "0");
  const d = String(dateObj.getDate()).padStart(2, "0");
  return `${y}-${m}-${d}`;
}

// Convert "13-Aug-2025" to YYYY-MM-DD
function formatCustomDate(dateStr) {
  const months = {
    Jan: "01", Feb: "02", Mar: "03", Apr: "04", May: "05", Jun: "06",
    Jul: "07", Aug: "08", Sep: "09", Oct: "10", Nov: "11", Dec: "12"
  };
  const parts = dateStr.split("-");
  if (parts.length === 3) {
    const day = parts[0].padStart(2, "0");
    const month = months[parts[1]];
    const year = parts[2];
    return `${year}-${month}-${day}`;
  }
  return "";
}

loadNoticeBoard();
</script>
<!-- loading summry  script stop hare -->



<!-- ==============================================dashboard start================================================================================ -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MIPL e|SmTally</title>
 <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
      
     
    }

    /* Login section with full screen and positioned at top */
    #login-section {
      display: flex;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 10;
      background-color: #fff;
    }

    .left-panel {
      flex: 1;
      background-color: #026186;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 40px;

      overflow: hidden;
  z-index: 1;
  position: relative; /* if only image show in right panal "position: relative;" */
    }

    .left-panel h1 {
      font-size: 32px;
      margin-bottom: 20px;
    }

    .right-panel {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #ffffff;

       
    }

    .left-panel::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: url('https://i.gifer.com/OFAF.gif'); /* Replace with your image URL */
  background-size: cover;
  background-position: center;
  opacity: 0.4; /* Change opacity here */
  z-index: -1; /* Keep it behind the login box */
}


    .login-box {
      width: 300px;
    }

    .login-box h2 {
      margin-bottom: 20px;
      text-align: center;
    }

    .login-box input {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

   
    .login-box button {
      width: 100%;
      padding: 10px;
      background-color: #026186;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      border-radius: 4px;
    }

    .login-box button:hover {
      background-color: #026186;
    }

    #login-msg {
      color: red;
      margin-top: 10px;
      text-align: center;
    }

    /* Dashboard styles */
    #dashboard {
      top: 20px;
      display: none;
      padding: 10px;
      min-height: 100vh;
      background-color: rgb(255, 255, 255);
    }

   
    .section {
      border: 1px solid #ccc;
      padding: 2px;
      background-color: #f8f9fa;
      border-radius: 1px;
    }

#sections {
  position: fixed;
  top: 50px; /* 1 inch from top */
  left: 0;
  right: 0;
  bottom: 0; /* allows full height scrolling inside */
  overflow-y: auto; /* only inner content scrolls */
  padding: 1px;
  background-color: #e9f7fc;
}
  .message {
    display: none;
  }

    .hidden {
      display: none;
    }



   header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: #f9fafa;
      color: white;
      padding: 5px 10px;
      text-align: center;
      z-index: 1000;
    }

    #top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 2px;
  background-color: #026186;
  color: white;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 999;
}

.button-div {
  display: flex;
  flex-wrap: nowrap;              /* ❌ wrapping band */
  overflow-x: auto;               /* ✅ horizontal scroll */
  white-space: nowrap;            /* ✅ content ek line me */
  gap: 1px;
}

.button-div button {
  flex: 0 0 auto;                 /* ✅ fixed width, no shrink/wrap */
  min-width: 200px;
  padding: 10px 10px;
  background-color: #026186;
  color: white;
  border: none;
  border-radius: 0px;
  cursor: pointer;
  font-size: 18px;
}


.button-div button:hover {
  background-color: #01384e;
  color: rgb(233, 248, 26);
}


#logout-btn {
  background-color: #f44336;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
}

#logout-btn:hover {
  background-color: #e53935;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 16px;
  background-color: rgb(8, 8, 8);
  color: white;
  border: 1px solid rgb(1, 45, 75);       /* "border: yes;" ko correct kiya */
  border-radius: 4px;
  padding-left: 5px;              /* Left se 5px space */
  padding-right: 5px;             /* Right se 5px space */
}

#username {
  font-size: 20px;
  font-weight: bold;
  color: rgb(243, 243, 242);
  text-align: center;
}


  .multidivbar {
            margin-bottom: 10px;
            padding: 5px 2px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }


/* Table Styling */
/* Container to control table width and responsiveness */
.table-container {
  width: 100%;
  overflow-x: auto;
}

/* Base table style */
  table {
      width: 100%;
   
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #090909;
      padding: 6px;
      text-align: left;
    }
    th {
      background-color: #333;
      color: white;
    }
     table tr:hover {
            background-color: #011d30 ; color: white;
        }

/* Form Styling Scoped to .form-container */
.form-container input,
.form-container select {
    width: 100%;
    padding: 6px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 16px;
    box-sizing: border-box;
}

.form-container input[type="text"],
.form-container input[type="number"],
.form-container input[type="date"],
.form-container select {
    background-color: #f9f9f9;
}

.form-container input[type="submit"],
.form-container button {
    background-color: #080808;
    color: #f6f6f8;
    font-weight: bold;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.form-container input[type="submit"]:hover,
.form-container button:hover {
    background-color: #575555;
    transform: translateY(-2px);
}


.fetchbtn {
  background-color: #b9e0f9;
  color: rgb(44, 3, 0);
  border: none;
  font-size: 16px;
  font-weight: bold;
  font-family: 'Eras Bold ITC', sans-serif;
  width: 1.5in;
  padding: 5px;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.fetchbtn:hover {
  background-color: #a5d4f0;
}

  </style>
</head>
<body>

  <!-- Login Section -->
  <div id="login-section">
    <div class="left-panel">
     
<br/><br/><br/><br/><br/>
<h1 style="color:#2F4F4F;text-align:center;font-size:150%">
<span style="color:#f8f9fa;font-size: 150%;">Multitech Infracon Pvt. Ltd.</span>
</h1>

 <h1 style="color:rgb(251, 249, 249); text-align: center; font-size: 100%;">Nh 74 12th Km Stone <br/> Vill Dabhora Mustakam Bazpur Road Kashipur <br/>U.S Nagar Uttarakhand 244713</h1>
<h1 style="color:#2F4F4F;text-align:center;font-size:100%">
<span style="color:#def8f8;font-size: 100%;">#9719012011,9639012011</span>
<span style="color:#f8e1e1;font-size: 100%;">(mail:-multitechsolutions@yahoo.com)</span>
</h1>



<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<h3>
        <span style="color:rgb(250, 218, 218);font-size:130%;font-family:Magneto;">eS | <span style="color:#e0f5f5;font-size:130%;font-family:Magneto;">MTally</span></span> 
       </h3> 

    </div>
    <div class="right-panel">
    
      <div class="login-box">
        <h2>Login</h2>
        <input type="text" id="user-id" placeholder="User ID" />
        <input type="password" id="password" placeholder="Password" />
        <button onclick="login()">Login</button>
        <div id="login-msg"></div>
      </div>
    </div>
  </div>

  <!-- Dashboard div start !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
  <div id="dashboard">  <!-- Dashboard div open -->
    <header>
    <div id="top-bar">
  <div class="button-div">
    <button onclick="showSection(1)" style="color: rgb(245, 245, 247); font-weight: bold;">HOME</button>
    <button onclick="showSection(2)">Cash Ledger Report</button>
    <button onclick="showSection(3)">MIPL Ledger Report</button>
    <button onclick="showSection(4)">Imprest Voucher Report</button>
    <!-- <button onclick="showSection(5)">Store Ragister</button> -->
    
    <button onclick="showSection(6)">Job/Reff</button>
    <button onclick="showSection(7)" style="color: rgb(250, 184, 184);">Admin*</button>
 
      
  
  </div>
  <div class="user-info">
    <span id="username"></span>
    <button id="logout-btn" onclick="logout()">Logout</button>
  </div>
</div>

  </header>



  

  
  <script>
  const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
  const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
  const range = 'USER!A:G';

  let users = {};
  let currentUser = "";

  async function fetchUserData() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;

    try {
      const response = await fetch(url);
      const data = await response.json();

      const rows = data.values;
      users = {};

      for (let i = 1; i < rows.length; i++) {
        const [enabled, userId, password, status, displayName, perms] = rows[i];

        if (enabled === "1") {
          users[userId] = {
            password: password,
            displayName: displayName,
            status: status?.toLowerCase() || "unlocked",
            permissions: perms?.split(',').map(p => parseInt(p.trim()))
          };
        }
      }
    } catch (error) {
      console.error("Error fetching user data:", error);
      document.getElementById('login-msg').innerText = "Failed to load user data.";
    }
  }

  async function login() {
    const userId = document.getElementById('user-id').value.trim();
    const password = document.getElementById('password').value;

    if (!users[userId]) {
      document.getElementById('login-msg').innerText = "Invalid User ID or Password!";
      return;
    }

    const user = users[userId];

    if (user.status === "locked") {
      document.getElementById('login-msg').innerText = "Your account is locked!";
      return;
    }

    if (user.password === password) {
      currentUser = userId;

      document.getElementById('login-section').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
      document.getElementById('username').innerText = user.displayName;
      document.getElementById('login-msg').innerText = "";
      document.getElementById('user-id').value = "";
      document.getElementById('password').value = "";
      document.querySelector('.button-div').style.display = 'flex';

      window.scrollTo(0, 0);

      // 👇 Add this line to show section1 by default
    showSection(1);
     fetchGlobalMessage(); // <-- ✅ fetchGlobalMessage function
     speakOnce(); // welcome massage ru after login
    } else {
      document.getElementById('login-msg').innerText = "Invalid User ID or Password!";
    }
  }

function showSection(buttonNum) {
  document.querySelectorAll('.section').forEach(div => div.classList.add('hidden'));
  //*** document.getElementById('message').innerText = "";

  const permissions = users[currentUser]?.permissions || [];
  if (permissions.includes(buttonNum)) {
    document.getElementById(`section${buttonNum}`).classList.remove('hidden');
    document.getElementById(`section${buttonNum}b`).classList.remove('hidden');
  } else {
    alert("You are not authorized for this Tab.\n\nMore Details Contact Admin:\nMukhtar Ahamad\n+91-9756735792");

    // Automatically redirect to Section 1 after alert
    document.getElementById(`section1`).classList.remove('hidden');
    document.getElementById(`section1b`).classList.remove('hidden');
  }
}

async function fetchGlobalMessage() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/USER!G2?key=${apiKey}`;

  try {
    const response = await fetch(url);
    const data = await response.json();

    const message = data?.values?.[0]?.[0] || ""; // Safely get cell value

    const globalMessageDiv = document.getElementById('globalMessage');
    if (message.trim() !== "") {
      globalMessageDiv.innerText = message;
      globalMessageDiv.style.display = "block";
    } else {
      globalMessageDiv.style.display = "none";
    }
  } catch (error) {
    console.error("Error fetching global message:", error);
  }
}


  function logout() {
    currentUser = "";
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('login-section').style.display = 'flex';
    document.querySelectorAll('.section').forEach(div => div.classList.add('hidden'));
    document.getElementById('message').innerText = "";
    document.getElementById('username').innerText = "";
    document.querySelector('.button-div').style.display = 'none';

    window.scrollTo(0, 0);
  }



  // Call this function on page load to fetch user data
 //  window.onload = fetchUserData;
</script>

<!-- Welcome Massage start-->
 <script>
    let hasSpoken = false;
    function speakOnce() {
      if (hasSpoken) return;
      hasSpoken = true;
      const msg = new SpeechSynthesisUtterance("Welcome");
      window.speechSynthesis.speak(msg);
    }
  </script>
   <!-- Welcome Massage Stop-->
</body>
</html>



<!-- ============================================== sections start =============================================================== -->

  <div id="sections">  <!-- sections Div open-->

 <div id="section1" class="section hidden"> <!--  sections1 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
   
      
<!-- यह एक नोट है, vertical Two Part Div (30-70) container content start  Heare ((CODE501)) -->
    <div class="container">  <div class="left">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start -->


        <blink> <span style="color:#131c3b;font-size:120%;font-family:Arial Black;">Home</span> </blink> <br/>   

        <!-- यह एक नोट है, events Event script Start Heare -->


        <div id="eventsDiv">
            <span style="color:#011d2c;font-size:120%;font-family:Arial Black;">Today's Events</span><br/>
   
    <ul id="eventsList" style="color:#013030;font-size:100%;">
        <!-- Names of students with today's events will be displayed here -->
    </ul>
</div>


<table id="eventsTable" style="display: none;">
    <tbody>
        <!-- Data from Google Sheets will be populated here -->
    </tbody>
</table>

<script>
    const apiEVENTKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
        const sheetEVENTId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
        const rangeEVENT = 'HOLIDAY!A:J';

    // Fetch data from Google Sheets
    async function eventSheet() {
        try {
            const response = await fetch(
                `https://sheets.googleapis.com/v4/spreadsheets/${sheetEVENTId}/values/${rangeEVENT}?key=${apiEVENTKey}`
            );
            const data = await response.json();

            if (data.values) {
                populatebirthTable(data.values);
                showTodayevents();
            } else {
                console.error("No data found in the specified range.");
            }
        } catch (error) {
            console.error("Error fetching data from Google Sheets:", error);
        }
    }

    // Populate hidden table with Google Sheets data
    function populatebirthTable(values) {
        const tableBody = document.querySelector("#eventsTable tbody");
        tableBody.innerHTML = ""; // Clear previous data

        values.forEach(row => {
            const tableRow = document.createElement("tr");
            row.forEach(cell => {
                const tableCell = document.createElement("td");
                tableCell.textContent = cell;
                tableRow.appendChild(tableCell);
            });
            tableBody.appendChild(tableRow);
        });
    }

    // Display today's events
    function showTodayevents() {
        const today = new Date();
        const todayDate = today.getDate(); // Get today's day (6 for "6-Feb")
        const todayMonth = today.toLocaleString("en", { month: "short" }); // Get today's month abbreviation (Feb)
        
        const rows = document.querySelectorAll("#eventsTable tbody tr");
        const eventsList = document.getElementById("eventsList");
        eventsList.innerHTML = ""; // Clear previous entries

        rows.forEach(row => {
            const dob = row.querySelectorAll("td")[2]?.textContent; // Ensure column 10 exists (DOB)
            if (dob) {
                // Parse DOB to match the format "6-Feb"
                const [dobDay, dobMonth] = dob.split("-").slice(0, 2); // Extract day and month
                const dobDayNumber = parseInt(dobDay); // Convert day to a number for comparison

                if (dobDayNumber === todayDate && dobMonth === todayMonth) {
                    const eventName = row.querySelectorAll("td")[1]?.textContent || "Unknown"; // Column 4: Name
                    const date = row.querySelectorAll("td")[3]?.textContent || ""; // Column 2: Class

                    const listItem = document.createElement("li");
                    listItem.textContent = `${eventName}  ${date}`;
                    eventsList.appendChild(listItem);
                }
            }
        });
    }

    // Load the data on page load
  //  window.onload = eventSheet;
</script>


<!-- यह एक नोट है,  Event script stop Here -->


<br/>

<style>
  .voucher-button-panel {
    background-color: #e3f3fc;
    border: 2px solid #b0d4ec;
    border-radius: 10px;
    padding: 20px;
    width: 300px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    font-family: 'Eras Bold ITC', sans-serif;
    margin: 20px auto;
  }

  .voucher-button-panel button {
    background-color: #035e97;
    color: rgb(248, 249, 250);
    border: none;
    font-size: 18px;
    font-weight: bold;
    margin: 8px 0;
    width: 100%;
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .voucher-button-panel button:hover {
    background-color: #a5d4f0;
  }
</style>




<div class="voucher-button-panel">
 
  <button onclick="showSection(8)">Cash Voucher</button><br/>
  <button onclick="showSection(9)">Store Register Voucher</button><br/>
  <button onclick="showSection(10)">Sales Voucher</button><br/>
  <button onclick="showSection(11)">Banking Voucher</button><br/>
  <button onclick="showSection(12)">Imprest Voucher</button><br/>
  <button onclick="showSection(13)">Job/Ref Voucher</button><br/>
   <button onclick="showSection(14)">Chander Shekher Voucher</button><br/>
</div>



<!-- यह एक नोट है, ADDRESS BAR SERCH BAR OPTION START  -->
 <blink><span style="color:#011136;font-size:120%;font-family:Arial Black;">Address & Purchase Order</span> </blink><br/>
           <div id="searchCon">
          <input type="text" id="searchtab" placeholder="🔍 Search Party Name, Purchase Order, Address, GSTIN ..." />
          </div>
   <!-- यह एक नोट है, ADDRESS BAR SERCH BAR OPTION STOP  --> 
    
   
      
        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->



  <style>
    #monthDropdown {
        width: 1in; /* 1 inch width */
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        background-color: white;
        appearance: none; /* for custom styling on some browsers */
        -webkit-appearance: none;
        -moz-appearance: none;
    }
  </style> 
 <div style="display: flex; align-items: center; gap: 10px;">
    <select id="monthDropdown"></select>
    <div id="monthlyTotals">Please Wait!</div>
</div>

  <!-- daybook filter and serchbar code start hare -->
 
<body>
    <div id="difference">
        <span style="color: #008080;font-size:100%;">Welcome To Multitech Infracon Pvt. Ltd.</span> (
	<span style="color: #a70404;font-size:100%;">Please Wait! ...</span> )
    </div>

    <div id="searchContainer">
        <input type="text" id="searchBar" placeholder="🔍 Search for Ledger, Job No., Vehicle No.,Narration.." />
        <input type="date" id="dateFilter" />

        <button onclick="loadSheet()" style="background: #475996;color: white; border: none;">Refresh</button>
        <button id="printButton">Print</button>
       
        <div id="totals">
           <span style="color: #680268 ;font-size:90%;">Total Invoice Amt:</span>  	Rs.	<span id="totalInvoice">0.00</span> |
           <span style="color: #037e71 ;font-size:90%;">Total Weight:</span>  		Kg. 	<span id="totalWeight">0.00</span>  |
           <span style="color: #8f3f02 ;font-size:90%;">Total Receipt:</span> 		Rs. 	<span id="totalBankInvoice">0.00</span> |
           <span style="color: blue ;font-size:90%;">Total TDS:</span>  		Rs.	<span id="totalTdsInvoice">0.00</span>
            
      
        </div>

    </div>
 <!-- daybook filter and serchbar code stop hare -->


 <table id="miplTable" class="hidden" style="background-color: #fdfef9;"></table>   <!-- daybook table -->

 <div class="multidivbar" style="background-color: #f8fafa;">
  <table id="myTable" style="background-color: rgb(245, 243, 243);"> </table>  <!-- Address bar Table -->
  </div>
 
  <br/><br/><br/><br/><br/><br/><br/><br/>
        <!-- Table will be dynamically populated -->

 


 <!-- daybook serchbar body stop -->



<!-- यह एक नोट है, vertical Two Part Div (30-70) right content stop -->
</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->

</div>  <!--  sections1 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->

   
      <div id="section2" class="section hidden"><table id="myuserTable"></table> <br/><br/><br/><br/><br/><br/><br/><br/></div>  <!--  sections2 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
      <div id="section3" class="section hidden"> <table id="myPEBTable"></table><br/><br/><br/><br/><br/><br/><br/><br/></div>  <!--  sections3 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
     
      <div id="section4" class="section hidden"><table id="myIVTable"></table><br/><br/><br/><br/><br/><br/><br/><br/></div>    <!--  sections4 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
      
      <div id="section5" class="section hidden">   Button 5 - Div 1</div>
      <div id="section5b" class="section hidden">Button 5 - Div 2</div>

<!--  sections6 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
      <div id="section6" class="section hidden">
        
        
<body>
  <!-- Filter Bar -->
  <div class="filterJBcontainer">
    <label for="userFilter">User:</label>
    <select id="userFilter" onchange="filterJBData()">
      <option value="">All</option>
    </select>

    <label for="orderByFilter">Order By:</label>
    <select id="orderByFilter" onchange="filterJBData()">
      <option value="">All</option>
    </select>

    <label for="typeFilter">By Status:</label>
    <select id="typeFilter" onchange="filterJBData()">
      <option value="">All</option>
    </select>

    <input type="text" id="searchBox" placeholder="🔍 Search..." oninput="filterJBData()" />

    <button class="print-btn" onclick="printJBTable()">🖨️ Print Table</button>
  </div>

  

  <!-- Main Content -->
  <div class="contentJB">
    <div id="resultsJB"></div>
  </div>

 </div>    <!--  sections6 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->




<div id="section7" class="section hidden">   <!--  sections7 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
  
<div class="container">  <div class="left" style="background-color: rgb(200, 249, 234);color:#004d80;font-weight: bold;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->

<!-- यह एक नोट है, Admin Table div body start Heare -->
<style>
  .adminGrid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-gap: 12px;
    max-width: 700px;
    margin-top: 10px;
  }

  .adminGrid label {
    align-self: center;
    font-weight: bold;
  }

  .adminGrid select,
  .adminGrid input[type="date"],
  .adminGrid input[type="text"] {
    width: 100%;
    padding: 4px 6px;
    box-sizing: border-box;
  }

  .adminDiv {
    padding: 20px;
    border: 1px solid #ddd;
    margin: 20px;
    background-color: #f9f9f9;
    border-radius: 8px;
  }

  button {
    margin-right: 8px;
  }

 
</style>

<div class="adminDiv">
  <h4>📋 Select Sheet to Load</h4>

  <div class="adminGrid">
    

    <label for="adminColumn1">User:</label>
    <select id="adminColumn1"></select>

    <label for="adminColumn2">Voucher:</label>
    <select id="adminColumn2"></select>

    <label for="adminColumn4">Ledger:</label>
    <select id="adminColumn4" style="width:200px;"></select>

    <label for="startAdmintDate">From:</label>
    <input type="date" id="startAdmintDate" />

    <label for="endAdminDate">To:</label>
    <input type="date" id="endAdminDate" />

    

    <div></div> <!-- empty for spacing -->
    <div>
      <h3>📤 Export</h3>
      <button onclick="downloadAdminHTML()">Download as HTML</button>
      <button onclick="downloadAsExcel()">Download as Excel (.xls)</button>
    </div>
  </div>

  <div id="resultDiv"></div>
</div>

<!-- यह एक नोट है, Admin Table div body stop Heare -->


<BR/>
<!-- यह एक नोट है, Dropdown URL  Script Start Heare -->
<!DOCTYPE html>
<html>
<head>

    <script>
        // Function to handle dropdown selection
        function handleDropdownChange() {
            const dropdown = document.getElementById('linkDropdown');
            const selectedOption = dropdown.options[dropdown.selectedIndex];

            if (selectedOption.value) {
                // Open the link in a new tab
                window.open(selectedOption.value, '_blank');
            }
        }
    </script>
    <style>
        select {
            padding:5px;
            font-size: 14px;
            margin: 2px 0;
        }
    </style>
</head>
<body>

 <label style="color: #000;"> Google Sheet Links</label>
    <select id="linkDropdown" onchange="handleDropdownChange()">
        <option value="">--Google Sheet Links --</option>
        <option value="https://docs.google.com/spreadsheets/d/1FXdbotep3MTk34gUdSF0e0h_hN_Uz66AL0Gnvc-pt_s/edit?gid=475142657#gid=475142657">	Party Weight Sheet</option>
        <option value="https://docs.google.com/spreadsheets/d/1EMIe8Y50_vMXg7y9zT7lXV0vgLyOZuSKdthf8C5XUXc/edit?gid=1752231070#gid=1752231070">	Mukhtiyar</option>
        <option value="https://docs.google.com/spreadsheets/d/1F3Wf5V8sLxENPJFtHij-0GDGBXfeYByGx0DSafDucgM/edit?gid=90095763#gid=90095763">	Tushar</option>
	<option value="https://www.google.com/android/find/">	Find My Device</option>
	<option value="https://docs.google.com/spreadsheets/d/1wvsPdAQA57HxhTxA3cCcQvUEz93IWkBre_Ix-qvzwss/edit?gid=627393391#gid=627393391">	Store Database SHeet*</option>
	<option value="https://docs.google.com/spreadsheets/d/1U_jwvZNtFuP91Gljjrbz_cpmb1OIkeDHnKa7aDe7F20/edit?gid=1511450281#gid=1511450281">	Clint List Sheet*</option>
	<option value="https://docs.google.com/spreadsheets/d/17GZv2O6uupdA5r6p7-zqKZ8AQgZozbGQf2aXPlUzhDA/edit?gid=1122888223#gid=1122888223">	Mipl Office</option>
	<option value="https://docs.google.com/spreadsheets/d/13N0HBuorZJM-ARnlTh36EUaD1-uQckaC6sLLzMnWAks/edit?gid=696561165#gid=696561165">	Office Noida</option>
	<option value="https://docs.google.com/spreadsheets/d/1Rw_6cDYP-ETicn9YhHkdF_Sgmi8ps5JhjhlrkWvtwRQ/edit?gid=2123243236#gid=2123243236">	GUPTA CAMUNICATION Sheet*</option>
    <option value="https://docs.google.com/spreadsheets/d/1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4/edit?gid=0#gid=0">	INDEX SHEET MIPL Sheet*</option>
    <option value="https://docs.google.com/spreadsheets/d/1B6dyXPay3Tyl_7RzGuL9Rg8AhkzdBNhJNRu-T-3kmvI/edit?gid=147958071#gid=147958071">	MIPL Clint Cash Ledger Sheet*</option>
     <option value="https://docs.google.com/spreadsheets/d/1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0/edit?gid=0#gid=0">	Cash Management Sheet*</option>
     <option value="https://docs.google.com/spreadsheets/d/1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA/edit?gid=0#gid=0">	Imprest Voucher Sheet*</option>
      <option value="https://docs.google.com/spreadsheets/d/1B6dyXPay3Tyl_7RzGuL9Rg8AhkzdBNhJNRu-T-3kmvI/edit?pli=1&gid=207048997#gid=207048997">	MIPL Party Weight REport*</option>
     <option value="MULTITECH V.2023.html">	MIPL DASHBOARD OLD</option>
     <option value="IVVOUCHER/IVINDEX.HTML">	Imprest Voucher Dashboard</option>
     <option value="https://github.com/">	github (mukhtarahamadksp@gmail.com)</option>
    </select>
</body>
</html>

<!-- यह एक नोट है, Dropdown URL  Script Stop Heare -->



        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->




<!-- Admin Table Section -->
<h3>📊 Admin Data Table</h3>
<table id="userTable">
  <thead id="userTableHead"></thead>
  <tbody id="userTableBody"></tbody>
</table>



</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->



</div>  <!--  sections7 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->









<!--  sections8 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA   -->
      <div id="section8" class="section hidden">

    <div class="container">  <div class="left" style="background-color: rgb(247, 249, 249);color:#004d80;font-weight: bold;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->


        
    <div class="form-container">
<form id="mainIVMAForm">
        <input type="hidden" name="SNo" id="sNo">
      

<label style="color: red;font-weight: bold;" >User*</label>
          <!-- User selection dropdown -->
<select class="userDropdown" id="msaf51" name="Voucher" required>
 
</select>



          <label  >Select Voucher</label>
          <select id="msaf52" name="Type" required>
            <option value="PAYMENT" style="color: green;">Payment</option>
            <option value="RECEIPT" style="color: red;">Receipt</option>
            <option value="BILL">Bill</option>
            <option value="SALARY">Salary</option>
          </select>
          
          <label >Select Date</label>
          <input type="date" id="msaf53" name="Date" required>

<!-- Searchable Ledger Dropdown -->
  <div class="dropdownWrapper">
    <label">Search & Select Ledger</label>
    <input type="text" id="msaf54" name="Ledger" class="dropdownCLSearch" placeholder="🔍 Search Ledger..." />
    <ul id="ledgerDropdown" class="dropdownList"></ul>
  </div>


         
        <label  >Enter Amount</label>
          <input type="number" id="msaf55" name="Amount" required placeholder="Amount" > 

          <label >Enter Narration</label>
          <input type="text" id="msaf56" name="Narration" placeholder="Narration"style="text-transform: uppercase;">
   
          <input type="hidden" name="Timestamp" id="timestampIVMA">

        <input type="submit" id="submitIVMAButton" value="Submit">

        <H3 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Entry Modify</H3>

         <!-- Form for Fetching and Modifying Entries -->
    <form id="modifyIVMAForm">
       <input type="hidden" id="formModeIVMA" name="formModeIVMA" value="new">
        <input type="number" id="searchIVMASNo" placeholder="Enter S.No. to Modify Entry" >
        <button type="button" class="fetchbtn" onclick="fetchIVMADetails()">Fetch Details</button>
        <button type="button" class="fetchbtn" id="modifyIVMAButton" onclick="modifyIVMAEntry()" style="display:none;">Modify Entry</button>
        <!-- Wait message div -->
<div id="waitIVMAMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
    </form>

    </form>

     
     <br/> <br/> <br/>
      <label style="color: #014060; font-weight: bold;font-size: 20px;">Searchbar Cash User</label>
    <input type="text" id="searchCLedger" placeholder="🔍 Search in Table..." />
    </div>


  

        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->




<!-- First dropdown populated based on username -->
 <label style="font-size: 20px; font-weight: bold;">Select User Name:</label>
<select id="cu123" required style="width: 3in; font-size: 16px; text-align: center; background-color: #014060;color: white;"></select>

<script>
// 1. All dropdown options
const allOptions = [
{ value: "", text: "Select a User" },
  { value: "MA", text: "MUKHTAR" },
  { value: "TA", text: "TUSHAR" },
  { value: "JLN", text: "JOURNAL" },
  { value: "BANK", text: "BANK" }
];

// 2. Which user sees which options
const userOptionsMap = {
  "Anchal": [0,2, 3,4],              // TUSHAR, JOURNAL, BANK
  "Mukhtar (Admin)": [0, 1, 2, 3,4]   // All options
};

// 3. Populate cu123 dropdown based on username
function updateDropdown(username) {
  const cu123 = document.getElementById("cu123");
  cu123.innerHTML = ""; // Clear existing options

  const allowedIndexes = userOptionsMap[username] || [];

  allowedIndexes.forEach(index => {
    const option = document.createElement("option");
    option.value = allOptions[index].value;
    option.textContent = allOptions[index].text;
    cu123.appendChild(option);
  });

  // Trigger sync after populating cu123
  syncledgerOption();
}

// 4. Sync selected cu123 option to msaf51
function syncledgerOption() {
  const cu123Select = document.getElementById("cu123");
  const ledgerSelect = document.getElementById("msaf51");

  const selectedValue = cu123Select.value;
  const selectedText = cu123Select.options[cu123Select.selectedIndex]?.text || "";

  // Clear and set new option
  ledgerSelect.innerHTML = "";
  if (selectedValue && selectedText) {
    const newOption = document.createElement("option");
    newOption.value = selectedValue;
    newOption.textContent = selectedText;
    ledgerSelect.appendChild(newOption);
  }
}

// 5. Wait until username appears, then update dropdown
const checkUsername = setInterval(() => {
  const username = document.getElementById("username").textContent.trim();
  if (username) {
    updateDropdown(username);
    clearInterval(checkUsername); // Stop checking
  }
}, 300);

// 6. Attach sync on change event after DOM is ready
document.addEventListener("DOMContentLoaded", function () {
  const cu123Select = document.getElementById("cu123");
  cu123Select.addEventListener("change", syncledgerOption);
});
</script>






<!-- Table Output -->
  <div id="tableContainer" style="background-color: #fef8f6;"></div>

</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections8 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->


<!--  sections9 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section9" class="section hidden">

    <div class="container">  <div class="left" style="background-color: #e3ecf2;color: white;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->


       <div class="form-container">
 <form id="mainSRRForm">
              <input type="hidden" name="SNo" id="sNo" />

             <label  style="color:#fd0505;font-size:90%;font-family:Arial; font-weight: bold;">User*</label>
             <input type="text" id="msaf91" name="User" value="STORE" readonly>


              <label  style="color:#0a0a0a;font-size:90%;font-family:Arial;">Select Date*</label>
  <input type="date" id="msaf92" name="Date" required>
<!-- (VCN-111) dropdown div start -->
<div class="dropdown-container">
    <label for="dropdownSRRSearch" style="color:#0c0c0c;font-size:90%;font-family:Arial;">Search SRR Ledger*</label><br/>
    <input type="text" id="dropdownSRRSearch" placeholder="🔍 Search Ledger..." oninput="filterDropdown()" name="Ledger" required autocomplete="off">
    <ul id="dropdownList" class="dropdown-list">
        <!-- The dropdown options will be populated here -->
    </ul>
</div>
<!-- (VCN-111) dropdown div stop -->

<label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Select Entry Type</label><br/>
  <select id="msaf93" name="cl1" required>
              <option value="">--Select Type--</option>
                <option value="IN">IN</option>
                <option value="OUT">OUT</option>
                <option value="OTHER">OTHER</option>
              </select>
<label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Select Tr. Type</label><br/>
              <select id="msaf94" name="cl2" required>
                <option value="">--Select Type--</option>
                <option value="P">PURCHASE</option>
                <option value="S">SALE</option>
                <option value="RGP">RGP</option>
                 <option value="NRGP">NRGP</option>
                  <option value="C">CHALLAN</option>
                   <option value="O">OTHER</option>
              </select>

               <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Enter Document No.</label><br/>
          <input type="text" id="msaf95" name="cl3" placeholder="Enter Document No." >

                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Enter Weight*</label><br/>
                <input type="number" id="msaf96" name="cl4" placeholder="Enter Weight" required>
                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Item Discription</label><br/>
                <input type="text" id="msaf97" name="cl5" placeholder="Enter Item Discription" required>
                 <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Vehicle No.</label><br/>
                <input type="text" id="msaf98" name="cl6" placeholder="Enter Vehicle No." >

<!-- STATUS WITH INIQU DROPDOWN START here -----------------------------------> 
<label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Select Status</label><br/>
<select id="msaf99" name="cl7" required></select>

<script>
// 1. All dropdown options
const allmsaf99Options = [
  { value: "", text: "Select a Status" },
  { value: "LOAD", text: "LOADING" },
  { value: "UNLOAD", text: "UNLOADING" },
  { value: "---", text: "COMPLETE" },
  { value: "O", text: "OTHER" },
  { value: "✔", text: "VERIFIED" },
  { value: "X", text: "UNVERIFIED" }
];

// 2. User-specific options by index
const userOptionsmsaf99Map = {
  "Anchal": [0,5,6],
  "Mukhtar (Admin)": [0, 1, 2, 3, 4,5,6],
  "Chanderbhaan": [0, 1,2,3,4]
};

// 3. Populate dropdown based on username
function updateMsaf99Dropdown(username) {
  const msaf99 = document.getElementById("msaf99");
  msaf99.innerHTML = ""; // Clear existing options

  const allowedIndexes = userOptionsmsaf99Map[username] || [];

  allowedIndexes.forEach(index => {
    const optionData = allmsaf99Options[index];
    const option = document.createElement("option");
    option.value = optionData.value;
    option.textContent = optionData.text;
    msaf99.appendChild(option);
  });

  // Optional: handle syncing after change
  syncLedgerMsaf99Option();
}

// 4. Wait until username appears, then update dropdown
const checkMsaf99Username = setInterval(() => {
  const usernameEl = document.getElementById("username");
  if (usernameEl && usernameEl.textContent.trim()) {
    updateMsaf99Dropdown(usernameEl.textContent.trim());
    clearInterval(checkMsaf99Username);
  }
}, 300);

// 5. Attach event listener after DOM is ready
document.addEventListener("DOMContentLoaded", () => {
  const msaf99Select = document.getElementById("msaf99");
  msaf99Select.addEventListener("change", syncLedgerMsaf99Option);
});

// 6. Dummy function for sync (implement as needed)
function syncLedgerMsaf99Option() {
  console.log("Dropdown changed. Implement sync logic here.");
}
</script>
<!-- STATUS WITH INIQU DROPDOWN STOP here -----------------------------------> 

              
              <input type="hidden" name="Timestamp" id="timestampSRR">
              <input type="submit" id="submitSRRButton" value="Submit">
     
        
              <H2 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Entry Modify</H2>
    <!-- Wait message div -->
    <div id="waitSRRMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
   </form>


            <form id="modifySRRForm">
               <input type="hidden" id="formModeSRR" name="formModeSRR" value="new">
              <input type="number" id="searchSRRSNo" placeholder="Enter S.No. to Modify Entry"  />
              <button type="button" class="fetchbtn" onclick="fetchSRRDetails()">Fetch Details</button>
              <button type="button" class="fetchbtn" id="modifySRRButton" onclick="modifySRREntry()" style="display:none;">Modify Entry</button>
    </form>  
    </div>



        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->

  <div id="tableDiv"></div>


</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections9 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->


<!--  sections10 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section10" class="section hidden">

    <div class="container">  <div class="left" style="background-color: rgb(1, 91, 114);color:#f2f2f3;font-weight: bold;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->

    <div class="form-container">

<form id="mainVCRForm">
        <input type="hidden" name="SNo" id="sNo">
        
        <select id="msaf21"  name="Voucher" style="color: #6803a2 ;font-size:100%;" required>
            <option value="SALE">SALE</option>
        </select>

          <label > Date</label>
         <input type="date" id="msaf11" name="Date" required>
        
        <label > Tr. Type</label>
        <select id="msaf12" name="Type" style="color: #6803a2 ;font-size:100%;" required>
           <option value="TAX INVOICE">Tax Invoice</option>
           <option value="CREDIT NOTE">Credit Note</option>
           <option value="CANCEL">Cancel Invoice</option>
            <option value="CHALLAN">CHALLAN</option>
        </select>

         

        
<!-- Form Section 1: Ledger + Reff -->

    <label for="msaf13">Select VCR Ledger:</label>
    <select class="ledger-dropdown" id="msaf13" required name="Ledger"></select>

    <label for="msaf15">Job/Reff:</label>
    <select class="Reff-dropdown" id="msaf15" required name="Reff"></select>




        <input type="text" id="msaf14" name="VNo" placeholder="Enter Invoice No. (25-26/xxxx)" required >
        

        <input type="text" id="msaf16" name="Amount" placeholder="Enter Amount" required >
        <input type="text" id="msaf17" name="Weight" placeholder="Enter Weight" required >
        <input type="text" id="msaf18" name="Rate" placeholder="Enter Rate" required >

            <input type="text" id="msaf19" name="Narration" placeholder="Narration if any">

         <input type="hidden" name="Timestamp" id="timestampVCR">

        <input type="submit" id="submitVCRButton" value="Submit">

        <H3 style="background-color: #d1f4f7;color: rgb(2, 45, 70);font-size: 120%; text-align: center;font-weight: bold;">Entry Modify</H3>

        <form id="modifyVCRForm">
           <input type="hidden" id="formModeVCR" name="formModeVCR" value="new">
            <input type="number" id="searchVCRSNo" placeholder="Enter S.No. to Modify Entry" >
            <button type="button" class="fetchbtn" onclick="fetchVCRDetails()">Fetch Details</button>
            <button type="button" class="fetchbtn"  id="modifyVCRButton" onclick="modifyVCREntry()" style="display:none;">Modify Entry</button>
             <!-- Wait message div -->
<div id="waitVCRMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
        </form>
    </form>
    

   
</div>   

        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->
  <div id="saleContainer" class="entry-box"></div>
<BR/><BR/>
  <BR/><a href="https://docs.google.com/spreadsheets/d/1Bx0FqnXHadVATN9DGhUtRZr2EDgz10hfDEgIlwtSC_4/edit?gid=2081509697#gid=2081509697" target="_blank" style="color:rgb(1, 41, 1); text-align: center; font-size: 100%;">Click to Open Packing List</a>

 


</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections10stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->


<!--  sections11 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section11" class="section hidden">

    <div class="container">  <div class="left" style="background-color: rgb(248, 238, 238);color: rgb(0, 2, 27);font-weight: bold;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->

    <div class="form-container">

  
<form id="mainBANKForm">
        <input type="hidden" name="SNo" id="sNo">
        <select id="msaf7"  name="Voucher" style="color: #6803a2 ;font-size:100%;" required>
            <option value="RECEIPT">RECEIPT</option>
        </select>

         <label >Date</label>
         <input type="date" id="msaf1" name="Date" required>
        

        <label >Type</label>
        <select id="msaf2" name="Type" style="color: #6803a2 ;font-size:100%;" required>
            <option value="BANK">Receipt (87-1723)</option>
            <option value="CASH">CASH</option>
            <option value="TDS">TDS</option>
        </select>

         
   <!-- Form Section 2: Ledger Only (No Reff dropdown update) -->
  <div class="form-section">
    <label for="msaf3">Select Bank Ledger:</label>
    <select class="ledgerVCRdropdown" id="msaf3" required name="Ledger"></select>
  </div>


   <label >Sekect Dr./Cr.</label>
             <select id="msaf4" name="VType" style="color: #6803a2 ;font-size:100%;" required>
                    <option value="CR">CR</option>
                    <option value="DR">DR</option>
                </select>
         <label >Amount</label>   
         <input type="text" id="msaf5" name="VNo" placeholder="Enter Amount" required >
        <label >Narration</label>
        <input type="text" id="msaf6" name="Narration" placeholder="Narration if any">

        <input type="hidden" name="Timestamp" id="timestampBANK">

        <input type="submit" id="submitBANKButton" value="Submit">
 </form>

 <H3 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Entry Modify</H3>

          <!-- Form for Fetching and Modifying Entries -->
    <form id="modifyBANKForm">
       <input type="hidden" id="formModeBANK" name="formModeBANK" value="new">
        <input type="number" id="searchBANKSNo" placeholder="Enter S.No. to Modify Entry" >
        <button type="button" class="fetchbtn"  onclick="fetchBANKDetails()">Fetch Details</button>
        <button type="button"  class="fetchbtn" id="modifyBANKButton" onclick="modifyBANKEntry()" style="display:none;">Modify Entry</button>
        <div id="waitBANKMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
    </form>

    

    <br/>
        <span style="color:rgb(129, 1, 1);font-size:130%;font-family:Magneto;">eS |</span> 
        <span style="color:#004d80;font-size:130%;font-family:Magneto;">MTally</span>
</div>   

        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->
 <div id="receiptContainer" class="entry-box"></div>

</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections11stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->

<!--  sections12 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section12" class="section hidden">

    <div class="container">  <div class="left" style="background-color: white;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->

    <div class="form-container">

  
<form id="mainIVCRForm">
  <input type="hidden" name="SNo" id="sNo" />

   <label style="color: red;font-weight: bold;">User</label>
  <select id="voucherType" name="Voucher" required style="font-size: 20px; text-align: center;">
  <!-- Populated dynamically -->
</select>



          <label >Select Tr. Type</label>
         <select id="ivcr0" name="Type" required>
           <option value="PAYMENT" style="color: green;">Payment</option>
           <option value="RECEIPT" style="color: red;">Receipt</option>
          
         </select>
           <label >Date</label>
         <input type="date" id="ivcr1" name="Date" required>


          <!-- (VCN- 111) dropdown div start -->
         <div class="dropdown-container" >
            <label >Serch IV Ledger</label>
            <input type="text" id="dropdownIVCRSearch" placeholder="🔍 Search..." oninput="filterIVCRDropdown()" name="Ledger" required>
            <ul id="dropdownIVCRList" class="dropdownCSSlist">
                <!-- The dropdown options will be populated here -->
            </ul>
        </div>
 <!-- (VCN- 111) dropdown div stop -->
        

         <label >Amount</label>
         <input type="number" id="ivcr2" name="Amount" required placeholder="Amount">
          <label >Narration</label>
         <input type="text" id="ivcr3" name="Narration" placeholder="Narration"style="text-transform: uppercase;">

         <input type="hidden" name="Timestamp" id="timestampIVCR">
         <input type="submit" id="submitIVCRButton" value="Submit">
       </form>
   
     <!-- Form for Fetching and Modifying Entries -->
    <form id="modifyIVCRForm">
      <input type="hidden" id="formModeIVCR" name="formModeIVCR" value="new">
        <input type="number" id="searchIVCRSNo" placeholder="Enter S.No. to Modify Entry" >
        <button type="button" class="fetchbtn" onclick="fetchIVCRDetails()">Fetch Details</button>
        <button type="button" class="fetchbtn" id="modifyIVCRButton" onclick="modifyIVCREntry()" style="display:none;">Modify Entry</button>
        <!-- Wait message div -->
<div id="waitIVCRMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
       </form>

    <br/>
        <span style="color:rgb(129, 1, 1);font-size:130%;font-family:Magneto;">eS |</span> 
        <span style="color:#004d80;font-size:130%;font-family:Magneto;">MTally</span>
</div>   

        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->

    <!-- IV User Selection -->
     
 <!-- IV User Selection -->
<label style="font-size: 20px; font-weight: bold;">Select IV User:</label>
<select id="ivuser" style="width: 3in; font-size: 16px; text-align: center; background-color: #014060;color: white;">

</select>


<script>
// 1. All dropdown options
const allivuserOptions = [
{ value: "", text: "Select a User" },
  { value: "IV03", text: "RAHUL KUMAR" },
  { value: "IV08", text: "NITIN KUMAR" },
  { value: "IV09", text: "SUNIL KUMAR" },
  { value: "IV04", text: "RAJU-UK18CA3770" },
  { value: "IV05", text: "MANNU-UK18CA4819" },
   { value: "IV06", text: "AAKASH-UK04CC1458" },
  { value: "IV07", text: "MANJEET-UK18CA4818" },
  { value: "IV10", text: "AJAY KUMAR-UK18CA4819" }
];

// 2. Which user sees which options
const userOptionsivuserMap = {
   "NITIN": [0,2],          // 
  "Anchal": [0,2, 3,4,5,6,7,8],              // 
  "Mukhtar (Admin)": [0, 1, 2, 3,4,5,6,7,8],   // All options
   "Rahul Kumar": [0,1]   // All options
};

// 3. Populate ivuser dropdown based on username
function updateivuserDropdown(username) {
  const ivuser = document.getElementById("ivuser");
  ivuser.innerHTML = ""; // Clear existing options

  const allowedIndexes = userOptionsivuserMap[username] || [];

  allowedIndexes.forEach(index => {
    const option = document.createElement("option");
    option.value = allivuserOptions[index].value;
    option.textContent = allivuserOptions[index].text;
    ivuser.appendChild(option);
  });

  // Trigger sync after populating ivuser
  syncledgerivuserOption();
}

// 4. Sync selected ivuser option to voucherType
function syncledgerivuserOption() {
  const ivuserSelect = document.getElementById("ivuser");
  const ledgerSelect = document.getElementById("voucherType");

  const selectedValue = ivuserSelect.value;
  const selectedText = ivuserSelect.options[ivuserSelect.selectedIndex]?.text || "";

  // Clear and set new option
  ledgerSelect.innerHTML = "";
  if (selectedValue && selectedText) {
    const newOption = document.createElement("option");
    newOption.value = selectedValue;
    newOption.textContent = selectedText;
    ledgerSelect.appendChild(newOption);
  }
}

// 5. Wait until username appears, then update dropdown
const checkivuserUsername = setInterval(() => {
  const username = document.getElementById("username").textContent.trim();
  if (username) {
    updateivuserDropdown(username);
    clearInterval(checkivuserUsername); // Stop checking
  }
}, 300);

// 6. Attach sync on change event after DOM is ready
document.addEventListener("DOMContentLoaded", function () {
  const ivuserSelect = document.getElementById("ivuser");
  ivuserSelect.addEventListener("change", syncledgerivuserOption);
});
</script>




  <table id="myIVCRTable" style="background-color: rgb(239, 249, 246);"></table>

</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections12stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->



<!--  sections13 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section13" class="section hidden">

    <div class="container">  <div class="left" style="background-color: #007685;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->

    <div class="form-container">

       <form id="mainREFFNOForm">
          <input type="hidden" name="SNo" id="sNo" />

          <label  style="font-size:100%;font-family:Arial;color: red;font-weight: bold;">User*</label>
          <select id="msaf70" name="Voucher" required>
            <option value="JOB/REFF">Job Details</option>
           </select>

<label  style="color:black;font-size:100%;font-family:Arial;color: rgb(234, 248, 234);font-weight: bold;">Select Job/Reff. User*</label>
<select id="msaf71" name="Type" required></select> 



           <label  style="color:rgb(234, 248, 234);font-size:100%;font-family:Arial;">Order By</label>
          <select id="msaf72" name="Date" required>
            <option value="RAHUL">RAHUL</option>
            <option value="TUSHAR AGARWAR (MD)">TUSHAR AGARWAL (MD)</option>
            <option value="LESHANT">LESHANT</option>
            <option value="OTHER">OTHER</option>
           </select>

           <label  style="color:rgb(234, 248, 234);font-size:100%;font-family:Arial;">Clint Name*</label>
            <input type="text" id="msaf73" name="Ledger" required placeholder="Enter Cline Name"> 

            <label  style="color:rgb(234, 248, 234);font-size:100%;font-family:Arial;">Firm Name/ Order Details*</label>
            <input type="text" id="msaf74" name="VNo" required placeholder="Enter Firm Name/ Order Details"> 

            <label  style="color:rgb(234, 248, 234);font-size:100%;font-family:Arial;">Address*</label>
            <input type="text" id="msaf75" name="Reff" placeholder="Enter Address"style="text-transform: uppercase;">
         
       

          <label  style="color:rgb(234, 248, 234);font-size:100%;font-family:Arial;">Job/Reff No.*</label>
          <input type="text" id="msaf76" name="Amount" placeholder="Enter Job/Reff No."style="text-transform: uppercase;">

          <label  style="color:rgb(234, 248, 234);font-size:90%;font-family:Arial;">Status</label>
          <select id="msaf77" name="Weight" required>
            <option value="RUNNING">Running</option>
            <option value="COMPLETED">Completed</option>
            <option value="CANCELED">Canceled</option>
            <option value="PENDING">Pending</option>
           </select>

          <input type="hidden" name="Timestamp" id="timestampREFFNO">
          <input type="submit" id="submitREFFNOButton" value="Submit">
        </form>
    

         <H3 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Entry Modify</H3>

        <form id="modifyREFFNOForm">
          <input type="hidden" id="formModeREFFNO" name="formModeREFFNO" value="new">
            <input type="number" id="searchREFFNOSNo" placeholder="Enter S.No. to Modify Entry" >
            <button type="button" class="fetchbtn" onclick="fetchREFFNODetails()">Fetch Details</button>
            <button type="button" class="fetchbtn" id="modifyREFFNOButton" onclick="modifyREFFNOEntry()" style="display:none;">Modify Entry</button>
             <!-- Wait message div -->
<div id="waitREFFNOMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
        </form>  

    <br/>
        <span style="color:rgb(248, 163, 163);font-size:130%;font-family:Magneto;">eS |</span> 
        <span style="color:#88c5ee;font-size:130%;font-family:Magneto;">MTally</span>
</div>   

        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->

  <!-- यह एक नोट है, uniq option selectio id msaf71 start -->
   <label style="font-size: 20px; font-weight: bold;">Select Job/Reff User:</label>
 <select id="jobreffuser" name="Type" required style="width: 3in; font-size: 16px; text-align: center; background-color: #014060;color: white;"></select> 
<script>
// 1. All dropdown options
const alljobreffuserOptions = [
{ value: "", text: "Select a User" },
  { value: "PRAKHAR", text: "PRAKHAR" },
  { value: "HARSHIT", text: "HARSHIT" }
];

// 2. Which user sees which options
const userOptionsjobreffuserMap = {
  "Prakhar": [0,1],              // TUSHAR, JOURNAL, BANK
  "Mukhtar (Admin)": [0, 1, 2],   // All options
   "Harshit": [0,2]   // All options
};

// 3. Populate jobreffuser dropdown based on username
function updatejobreffuserDropdown(username) {
  const jobreffuser = document.getElementById("jobreffuser");
  jobreffuser.innerHTML = ""; // Clear existing options

  const allowedIndexes = userOptionsjobreffuserMap[username] || [];

  allowedIndexes.forEach(index => {
    const option = document.createElement("option");
    option.value = alljobreffuserOptions[index].value;
    option.textContent = alljobreffuserOptions[index].text;
    jobreffuser.appendChild(option);
  });

  // Trigger sync after populating jobreffuser
  syncledgerjobreffuserOption();
}

// 4. Sync selected jobreffuser option to msaf71
function syncledgerjobreffuserOption() {
  const jobreffuserSelect = document.getElementById("jobreffuser");
  const ledgerSelect = document.getElementById("msaf71");

  const selectedValue = jobreffuserSelect.value;
  const selectedText = jobreffuserSelect.options[jobreffuserSelect.selectedIndex]?.text || "";

  // Clear and set new option
  ledgerSelect.innerHTML = "";
  if (selectedValue && selectedText) {
    const newOption = document.createElement("option");
    newOption.value = selectedValue;
    newOption.textContent = selectedText;
    ledgerSelect.appendChild(newOption);
  }
}

// 5. Wait until username appears, then update dropdown
const checkjobreffuserUsername = setInterval(() => {
  const username = document.getElementById("username").textContent.trim();
  if (username) {
    updatejobreffuserDropdown(username);
    clearInterval(checkjobreffuserUsername); // Stop checking
  }
}, 300);

// 6. Attach sync on change event after DOM is ready
document.addEventListener("DOMContentLoaded", function () {
  const jobreffuserSelect = document.getElementById("jobreffuser");
  jobreffuserSelect.addEventListener("change", syncledgerjobreffuserOption);
});
</script>

<!-- यह एक नोट है, uniq option selectio id stop start -->




<div id="results"></div> <!-- For displayJOBNOResults function -->


<div style="display: flex; align-items: center; gap: 10px;">
    <select id="filterType" onchange="jobPOreffDropdown()" style="background-color: #0026ff; color: white;">
        <option value="latestEntry">Latest 10 Entries</option>
        <option value="allJobreff">All JOB/REFF Entries</option>
        <option value="userHarshit">Harshit's Entries</option>
        <option value="userPrakhar">Prakhar's Entries</option>
    </select>
    
    <div id="summary"></div>
    <div id="jobRefResults" style="color: red;"></div>
</div>


  <BR/><a href="https://docs.google.com/spreadsheets/d/1Bx0FqnXHadVATN9DGhUtRZr2EDgz10hfDEgIlwtSC_4/edit?gid=2081509697#gid=2081509697" target="_blank" style="color:blue; text-align: center; font-size: 100%;">Click to Open Packing List</a>



   <div id="jobReffContainer" class="entry-box"></div>   <!-- top 10 job/reff no by function fetchData(); (close) script --> 
 
 

</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections13stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->




<!--  sections14 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section14" class="section hidden">

    <div class="container">  <div class="left" >   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->

    <div class="form-container">

      
            <form id="mainSKHRForm">
              <input type="hidden" name="SNo" id="sNo" />

              <label for="dropdownskhrSearch" style="color:#f90404;font-size:90%;font-family:Arial;font-weight: bold;" >User*</label><br/>
              <select id="msaf101" name="User" required>
                <option value="SHEKHER">SHEKHER</option>
              </select>

              <label  style="color:#0a0a0a;font-size:90%;font-family:Arial;">Select Date*</label>
  <input type="date" id="msaf102" name="Date" required>

  <!-- (VCN- 112) dropdown div start -->
<div class="dropdown-container">
<label for="dropdownskhrSearch" style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Search SKHR Ledger*</label><br/>
<input type="text" id="dropdownskhrSearch" placeholder="🔍 Search .." oninput="filterSKHRDropdown()" name="Ledger" required autocomplete="off">
<ul id="dropdownSKHRList" class="dp-list">
<!-- The dropdown options will be populated here -->
</ul>
</div>
<!-- (VCN- 112) dropdown div stop -->
                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Enter Weight*</label><br/>
                <input type="text" id="msaf103" name="cl1" placeholder="Enter Weight" required>
                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Rate</label><br/>
                <input type="text" id="msaf104" name="cl2" value="3.9" readonly>
                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Amount</label><br/>
                <input type="text" id="msaf105" name="cl3" placeholder="Enter Amount" required readonly>
                
                <script>
                function calculateAmount() {
                  const weight = parseFloat(document.getElementById('msaf103').value) || 0;
                //  const rate = parseFloat(document.getElementById('msaf104').value) || 0;    if rate manual type than use this code
                const rate = 3.9; // Fixed rate
                  const amount = weight * rate;
                
                  document.getElementById('msaf105').value = amount.toFixed(); // two decimal places
                }
                
                // Attach the event listeners to both input fields
                document.getElementById('msaf103').addEventListener('input', calculateAmount);
              //  document.getElementById('msaf104').addEventListener('input', calculateAmount);   if rate manual type than use this code
                </script>
           <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Enter Narration If Any</label><br/>
          <input type="text" id="msaf106" name="cl4" placeholder="Enter Narration" >
              
              <input type="hidden" name="Timestamp" id="timestampSKHR">
              <input type="submit" id="submitSKHRButton" value="Submit">
            </form>
        
    
            <form id="modifySKHRForm">
               <input type="hidden" id="formModeSKHR" name="formModeSKHR" value="new">
              <input type="number" id="searchSKHRSNo" placeholder="Enter S.No. to Modify Entry" required />
              <button type="button" class="fetchbtn" onclick="fetchSKHRDetails()">Fetch Details</button>
              <button type="button" class="fetchbtn" id="modifySKHRButton" onclick="modifySKHREntry()" style="display:none;">Modify Entry</button>
    
              <!-- Wait message div -->
    <div id="waitSKHRMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
            </form>
      
    <br/>
        <span style="color:rgb(129, 1, 1);font-size:130%;font-family:Magneto;">eS |</span> 
        <span style="color:#004d80;font-size:130%;font-family:Magneto;">MTally</span>
</div>   

        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->

  

 <style>
        .date-filter-row {
          display: flex;
          align-items: center;
          gap: 10px;
          margin-bottom: 20px;
          flex-wrap: wrap;
        }
      
        .date-filter-row label {
          font-size: 14px;
        }
      
        .date-filter-row input[type="date"],
        .date-filter-row button {
          width: 192px; /* ~2 inches */
          padding: 6px 10px;
          font-size: 14px;
          box-sizing: border-box;
        }
      
        .date-filter-row input[type="date"] {
          border: 1px solid #ccc;
          border-radius: 4px;
        }
      
        .date-filter-row button {
          background-color: #0077b6;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
        }
      
        .date-filter-row button:hover {
          background-color: #005f8a;
        }
      </style>
      <div class="date-filter-row">
        <label for="fromDate">From: </label>
        <input type="date" id="fromDate">
      
        <label for="toDate">To: </label>
        <input type="date" id="toDate">
      
        <button onclick="filterSKHRByDate()">Filter by Date</button>
        <button id="printButton" onclick="printSHEKHERTable()">Print</button>
      </div>
      
<div id="tableSKHRDiv"></div>


</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections14stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->
    
    </div>  <!-- sections Div close-->
  </div>  <!-- Dashboard div open -->
<!-- ============================================== sections stop =============================================================== -->
<!-- Dashboard div stop !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->






<!-- ==============================================footer start================================================================================ -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fixed Footer Example</title>
  <style>
  body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    position: relative;
    font-family: Arial, sans-serif;
  }

  .footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: #5c0a02;
    color: white;
    font-weight: bold;
    text-align: center;
    padding: 0; /* Remove padding */
    font-size: 14px;
    z-index: 1000;
    box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.3);
   
  }

  .footer table {
    margin: 0;               /* Remove default table margin */
    padding: 0;              /* Remove default table padding */
    border-spacing: 0;       /* Remove spacing between table cells */
    border-collapse: collapse; /* Optional: tighter table */
    width: 100%;  
          
  }

  .footer td {
     padding: 5px 10px; /* Top-Bottom = 0, Left-Right = 10px gap */
  }
</style>

</head>
<body>


  <div class="footer">   <!-- footer div start---- -->


 <marquee behavior="scroll" direction="left"  scrollamount="3"> <span id="globalMessage" style="color: white; font-size: 16px;"></span> </marquee>





    <!-- section1B content start hare *********************************************************************************************************-->
<div id="section1b" class="section hidden" style="background-color: rgb(1, 51, 92);border: none;">


  


    
  
<table style="background-color:#011d30 ;text-align: center; color:WHITE; border: none;">

<td style="text-align: center; color:WHITE; border: none;">
    <a href="https://www.google.co.in/" target="_blank"><img src="https://cdn.dribbble.com/users/1717214/screenshots/4124610/g-logo.gif" alt="Gmail" width="50" height="50" /></a>
    </td>
    <td style="text-align: center; color:WHITE;border: none;">
    <a href="https://accounts.zoho.in/signin?servicename=VirtualOffice&signupurl=https://www.zoho.com/mail/zohomail-pricing.html&serviceurl=https://mail.zoho.in" target="_blank"><img src="https://zenatta.com/wp-content/uploads/2020/08/mail-256-300x300.png" alt="Gmail" width="60" height="60" /></a>
    </td>
    <td style="text-align: center; color:WHITE;border: none;">
    <a href="https://mail.google.com/mail/u/0/" target="_blank"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSjpEIz6vZxfKx_cLh8Y6tDWalIuwi08MCggUEXk8cXLAy8NUilIHwNgrsjtFIxgEWCWAE&usqp=CAU" alt="You Tube" width="50" height="50" /></a>
    </td>
    <td style="text-align: center; color:WHITE;border: none;">
    <a href="https://netpnb.com/" target="_blank"><img src="https://cracku.in/latest-govt-jobs/wp-content/uploads/2021/01/PNB-Logo.png" alt="Google" width="50" height="50" /></a>
    </td>
    <td style="text-align: center; color:WHITE;border: none;">
    <a href="https://retail.onlinesbi.sbi/retail/login.htm" target="_blank"><img src="https://image3.mouthshut.com/images/ImagesR/2015/12/State-Bank-Anywhere-925771560-7182350-1.png" width="50" height="50" /></a>
    </td>
    <td style="text-align: center; color:WHITE;border: none;">
    <a href="https://netbanking.hdfcbank.com/netbanking/"  target="_blank"><img src="https://p.kindpng.com/picc/s/284-2843275_online-donation-shri-ramakrishna-ashrama-rajkot-using-hdfc.png" alt="You Tube" width="50" height="50" /></a>
    </td>
    
    <td style="text-align: center; color:WHITE;border: none;">
    <a href="https://www.youtube.com/" target="_blank"><img src="http://3d-sprinter.ru/pictures/youtube256-2-on.gif" alt="You Tube" width="50" height="50" /></a>
    </td>
    
    <td style="text-align: center; color:WHITE;border: none;">
    <a href="https://www.facebook.com/" target="_blank"><img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExNTZuaHQ1ZjdnajNwMWtrZHVhN3Q4djdwMDZmYWZuYzRoYTA0Ymx4MiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/IeRI0TleieCJ6ytPUr/giphy.gif" alt="You Tube" width="50" height="50" /></a>
     </td>
    
    <td style="text-align: center; color:WHITE;border: none;">
      <a href="https://web.whatsapp.com/" target="_blank"><img src="https://cliply.co/wp-content/uploads/2021/08/372108180_WHATSAPP_ICON_400.gif" alt="You Tube" width="50" height="50" /></a>
        </td>


              <td style="text-align: center; color:WHITE;border: none;">
                <a href="https://ssp.elcom.digital/" target="_blank"><img src="https://tallyerp9download.com/wp-content/uploads/2020/11/tally-prime-server-1-300x56.jpg" alt="You Tube" width="100" height="30" /></a>
                  </td>
                

                      <td style="text-align: center; color:WHITE;border: none;">
                        <a href="https://chatgpt.com/" target="_blank"><img src="https://static.vecteezy.com/system/resources/previews/022/841/114/original/chatgpt-logo-transparent-background-free-png.png" alt="You Tube" width="60" height="50" /></a>
                          </td>

                      <td style="text-align: center; color:WHITE;border: none;">
                        


                        <span style="color:#fcfcff;font-size:130%;font-family:Magneto;">eS |</span> 
                                    <span style="color:#cacacc;font-size:130%;font-family:Magneto;">MTally</span> 
                       </td>

                       <td style="text-align: center; color:WHITE;border: none;">
                        <a href="https://services.gst.gov.in/services/login" target="_blank"><img src="https://cdn.uxhack.co/product_logos/gstn_logo.jpg" alt="You Tube" width="60" height="60" /></a>
                          </td>

                          <td style="text-align: center; color:WHITE;border: none;">
                            <a href="https://ewaybillgst.gov.in/Login.aspx" target="_blank"><img src="https://bizdesk.in/wp-content/uploads/2019/11/E-Way-Bills-as-Per-New-GST-Rules.png" alt="You Tube" width="60" height="60" /></a>
                              </td>
                              <td style="text-align: center; color:WHITE;border: none;">
                                <a href="https://einvoice1.gst.gov.in/Others/GetPinCodeDistance" target="_blank"><img src="https://www.shutterstock.com/image-vector/distance-pin-icon-flat-style-260nw-1416511856.jpg" alt="You Tube" width="60" height="60" /></a>
                                  </td>
                                  <td style="text-align: center; color:WHITE;border: none;">
                                <a href="HOMEMIPL.HTML" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/1197/1197396.png" alt="You Tube" width="60" height="60" /></a>
                                  </td>
</table>
 </div>  <!-- section1B content stop hare *********************************************************************************************************-->


 <!-- section2B content start hare *********************************************************************************************************-->
      <div id="section2b" class="section hidden">

          <div id="userTotals" >
            <span>Total Receipt:</span> <span id="totaluserReceipt">0</span> |
            <span>Total Payment:</span> <span id="totaluserPayment">0</span> |
            <span>Total Payable Bill:</span> <span id="totaluserBilldr">0</span> |
            <span>Total Receivd Bill:</span> <span id="totaluserBillcr">0</span> |
            <span>Total Salary:</span> <span id="totaluserSalary">0</span> |
            <span>Balance:</span> <span id="totaluserDifference">0</span>
        </div>
        
 <div id="search123Container">
    
           <blink> <span style="color:rgb(1, 60, 60);font-size:120%;font-family:Arial Black;" id="resultDiv">Users & Cash Ledger Report</span> </blink> <br/>
    
            <label style="font-weight: bold;">Ledger:</label>
            <select id="filteruserColumn4"></select>
    
            <label style="font-weight: bold;  color: red ;">From:</label>
            <input type="date" id="starusertDate">
    
            <label style="font-weight: bold;  color: red ;">To:</label>
            <input type="date" id="enduserDate">
    
            <label style="font-weight: bold;">User:</label>
            <select id="filterusrColumn1"></select>
    
            <label style="font-weight: bold;">Voucher:</label>
            <select id="filteruserColumn2"></select>
    
            <button onclick="printuserTable()">🖨️ Print</button>  
        </div>
    
      
      </div>  <!-- section2B content stop hare *********************************************************************************************************-->

      
<!-- section3B content start hare *********************************************************************************************************-->
<div id="section3b" class="section hidden">

   <div id="totalsmipl" style="font-size: 16px; font-weight: bold;">
                <span>Total Receipt:</span> <span id="totalReceipt">0</span> |
                <span>Total TDS:</span> <span id="totalTds">0</span> |
                <span>Total Bill:</span> <span id="totalBill">0</span> |
                <span>Total Credit Note:</span> <span id="totalCn">0</span> |
                <span>Total Weight:</span> <span id="totalPEBWeight">0</span> |
                <span>Balance:</span> <span id="totalDifference">0</span>
            </div>
        
<div id="searchPEBContainer">
        
               <blink> <span style="color:#014384;font-size:120%;font-family:Arial Black;">MIPL Ledger Report</span> </blink><br/>
        
               <label style="font-weight: bold;">Ledger:</label>
                <select id="filterColumn4"></select> 
               
               <label style="font-weight: bold;">Job No.:</label>
                <select id="filterColumn2"></select>
        
                <label style="font-weight: bold;">Type:</label>
                <select id="filterColumn1"></select>
        
                <label style="font-weight: bold; color: red ;">From:</label>
                <input type="date" id="startDate">
        
                <label style="font-weight: bold;  color: red ;">To:</label>
                <input type="date" id="endDate">
        
                <button onclick="printpebTable()">🖨️ Print</button>  
            </div>
        
           

      </div>  <!-- section3B content stop hare *********************************************************************************************************-->

      <!-- section4B content start hare *********************************************************************************************************-->
       <div id="section4b" class="section hidden">

        <div id="totalsIV">
                <span>Total Receipt:</span> <span id="totalIVReceipt">0</span> |
                <span>Total Payment:</span> <span id="totalIVPayment">0</span> |
                <span>Total Bill:</span> <span id="totalIVBill">0</span> |
                <span>Total Salary:</span> <span id="totalIVSalary">0</span> |
                <span>Balance:</span> <span id="totalIVDifference">0</span>
            </div>

         <div id="searchIVContainer">
                <blink> <span style="color:#012400;font-size:120%;font-family:Arial Black;"id="resultIVDiv"> Imprest Voucher Report  </span> </blink> <br/>
        
                <label style="font-weight: bold;">Ledger:</label>
                <select id="filterIVColumn4"></select>
        
                <label style="font-weight: bold;  color: red ;">From:</label>
                <input type="date" id="starIVtDate">
        
                <label style="font-weight: bold;  color: red ;">To:</label>
                <input type="date" id="endIVDate">
        
                <label style="font-weight: bold;">User:</label>
                <select id="filterIVColumn1"></select>
        
                <label style="font-weight: bold;">Voucher:</label>
                <select id="filterIVColumn2"></select>
        
                <button onclick="printIVTable()">🖨️ Print</button>  
            </div>

      </div>  <!-- section4B content stop hare *********************************************************************************************************-->

      <div id="section6b" class="section hidden"><div id="jbSummaryBox"></div></div>    <!-- section6B content  hare ----->



      <div id="section7b" class="section hidden">    <!--  sections7b start  *****************************************-->


<style>
  .input-row {
    display: flex;
    align-items: center;
    gap: 10px; /* space between dropdown and input */
    font-size: 20px;
    color: #000;
  }

  #sheetSelector {
    width: 4in;
    font-size: 16px;
  
  }
</style>



<div id="searchDiv">

   <label for="sheetSelector" style="color: black;font-size: 20px;">Select Sheet:</label>
  <select id="sheetSelector" style="width: 6in; height: 30px; font-size:20px;" onchange="loadusrAdminSheet()">
    <option value="mpr">CASH LEDGER REPORT</option>
    <option value="ivcr">IMPREST VOUCHER REPORT</option>
    <option value="sale">SALE VOUCHER REPORT</option>
    <option value="po">PURCHASE ORDER REPORT </option>
    <option value="psw">ID/Password VIEW</option>
  </select>
           <label  style="color: black;font-size: 20px;">Search in Sheet:</label>
            <input type="text" id="searchbarAdmin" style="width: 6in; height: 30px; font-size:20px;" placeholder="🔍 Search Heare ..." />
        </div>

</div>  <!--  sections7b stop  *****************************************-->



<!-- section9B content start hare *********************************************************************************************************-->
 <div id="section9b" class="section hidden">
        
        
<style>
      #divsrr {
            position: sticky;
            top: 0;
           left: 0;
      width: 100%;
      background: #ebecec;
      padding: 10px 20px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1000;
      color: #000;
        }

        .divsrr select,
    .divsrr input,   .divsrr date  {
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }
       
      </style>
      <div id="divsrr">

        
  <blink> <span style="color:rgb(1, 60, 60);font-size:120%;font-family:Arial Black;" id="resultDiv">Store Ragister Voucher</span> </blink> <br/>
        <label for="fromSRRDate">From: </label>
        <input type="date" id="fromSRRDate">
      
        <label for="toSRRDate">To: </label>
        <input type="date" id="toSRRDate">
      
        <button onclick="filterByDate()">Filter by Date</button>
        <button id="printButton" onclick="printSRRTable()">Print</button>
      </div>
      
     
</div>  <!-- section9B content stop hare *******************************************************************-->




<!-- section14B content start hare *********************************************************************************************************-->
 <div id="section14b" class="section hidden">
  <blink><span style="color:#012760;font-size:120%;font-family:Arial Black;">Chander Shekher</span> </blink><br/>      
    
<div id="summaryRow" style="display: flex; justify-content: center; gap: 30px; font-weight: bold; font-size: 20px; color: black;">
  
  <div id="totalWeightDiv"></div>
  <div id="totalAmountDiv"></div>
  <div id="retentionDiv"></div>
  <div id="tdsSKHRDiv"></div>
  <div id="billAmountDiv"></div>
</div>

     
</div>  <!-- section14B content stop hare *******************************************************************-->




   <!-- Current date and time will be displayed here -->
            
<meta name="viewport" content="width=device-width, initial-scale=1.0">
            
<div style="display: flex; flex-direction: row; align-items: center; background-color: #002044; color: rgb(249, 252, 229); font-size: 20px; font-weight: bold;">
  
  <!-- Current Time -->
  <div id="currentDateTime" style="padding: 10px 20px; white-space: nowrap;"></div>

  <!-- Scrolling News Ticker -->
  <marquee behavior="scroll" direction="left" scrollamount="5" style="flex: 1;">
    <div style="display: inline-flex; align-items: center; gap: 8px;">
     
      <span id="newsTickerContent" style="color: white; font-size: 16px;"></span>
    </div>
  </marquee>

</div>
 
<script>
function displayCurrentDateTime() {
const now = new Date();

// Formatting options
const options = { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric', 
    hour: '2-digit', 
    minute: '2-digit', 
    second: '2-digit' 
};

// Formatting date and time
const formattedDateTime = now.toLocaleString('en-US', options);

// Displaying in the div
document.getElementById("currentDateTime").textContent = `Today: ${formattedDateTime}`;
}

// Call the function on page load to show the current date and time
displayCurrentDateTime();

// Update the date and time every second
setInterval(displayCurrentDateTime, 1000);
</script>
<!-- Current date and time will be displayed Stop -->

  </div>    <!-- footer div stop---- -->

</body>
</html>
<!-- ==============================================footer stop================================================================================ -->






<!-- यह एक नोट है, -------------------------  SCRIPT AND CODE START----------------------------------------- -->
      
<!-- यह एक नोट है, vertical Two Part Div (30-70) code start  Heare  (CODE501) -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>70-30 Split</title>
    <style>
        .container {
            display: flex;
           

            flex-direction: row; /* Arrange child divs side-by-side (flex-direction: column;) */

          /*  flex-direction: column;  Arrange child divs vertically */
            height: 85vh; /* Full viewport height */
        }
      .left {
    flex: 2; /* 70% */
    background-color: #b9e0f9;
    padding: 20px;
    border-bottom: 1px solid #ccc;
    overflow: auto; /* Scroll content if it overflows */
}

.right {
    flex: 8; /* 30% */
    background-color: #eaeaea;
    padding: 20px;
    overflow: auto; /* Scroll content if it overflows */
}
    </style>
</head>
<body>
</body> </html>
  <!-- यह एक नोट है, vertical Two Part Div (30-70) code stop  Heare -->








  
<!-- daybook serchbar script start (CODE502) -->


<!DOCTYPE html>
<html>
<head>
    <title>MIPL SEARCH</title>
    <style>
      
        #searchContainer {
           padding: 5px 10px;
            top: 0;
            background: #026186;
          padding: auto;
            border-bottom: 2px solid #263054;
            z-index: 1000;
         
        }
        #searchBar, #dateFilter {
            padding: 5px;
            margin: 5px 0;
            width: 30%;
            box-sizing: border-box;
            border: 2px solid #d4ac0d ;
            border-radius: 4px;
        }
        #totals, #difference {
            padding: 1px;
            background: #edfeff;
            color: black;
            border-bottom: 2px solid #fafbfc;
            border: 4px solid #026186 ;
            font-size: 16px;
            font-weight: bold;
            font-size: 16px;
            
        }
        
        #printButton {
            position: absolute;
           
            right: 100px;
            padding: 8px;
            background: #026186;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        #printButton:hover {
            background: #0c0c0c;
        }
        

        tr.hidden {
            display: none;
        }
        tr.blue {
            color: #bb0101;
        }
        tr.red {
            color: #7a0192;
        }

	tr.yellow {
            color: #0026ff;
        }

        #miplTable.hidden {
            display: none;
        }
        table {
            overflow-x: auto;
            display: block;
        }

        /* Print-specific styles */
        @media print {
            body {
                font-family: "Times New Roman", serif;
                background-color: #fff;
                padding: 0;
            }
            #searchContainer, #printButton {
                display: none;
            }
            #totals, #difference {
                font-size: 18px;
                margin-bottom: 10px;
            }
            table, th, td {
                border: 1px solid #000;
                border-collapse: collapse;
                font-size: 10PX;
            }
            th, td {
                padding: 10px;
                text-align: left;
                font-size: 14px;
            }
            tr.hidden {
                display: table-row;
            }
        }
    </style>
    <script>
       async function loadSheet() {
    const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
    const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
    const range = 'LEDGER!A:L';

    try {
        const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
        );
        const data = await response.json();

        if (data.values) {
            const table = document.getElementById('miplTable');
            table.innerHTML = ""; // Clear existing table content

            data.values.forEach((row, index) => {
                const tr = document.createElement('tr');

                row.forEach((cell) => {
                    const td = document.createElement(index === 0 ? 'th' : 'td');
                    if (cell.startsWith('http') || cell.startsWith('www')) {
                        const a = document.createElement('a');
                        a.href = cell;
                      //  a.textContent = "Download"; // use this code if text format 
                      a.innerHTML = "&#128221"; // DOWNLOAD ICON  use this code if symble or html code
                        a.target = "_blank"; // Open link in new tab
                        td.appendChild(a);
                    } else {
                        td.textContent = cell;
                    }
                    tr.appendChild(td);
                });

                if (index !== 0) {
                    row.forEach((cell, cellIndex) => {
                        if (cellIndex === 1) {
                            if (cell.toLowerCase() === "bank") {
                                tr.classList.add('blue');
                            } else if (cell.toLowerCase() === "tds") {
                                tr.classList.add('red');
                            } else if (cell.toLowerCase() === "credit note") {
                                tr.classList.add('yellow');
                            }
                        }
                    });
                }

                table.appendChild(tr);
            });

            setTodayDate();
            filterTable();
            calculateTotals();
        } else {
            console.error("No data found in the specified range.");
        }
    } catch (error) {
        console.error("Error fetching data from Google Sheets:", error);
    }
}

  function calculateTotals() {
            const rows = document.querySelectorAll('#miplTable tr:not(.hidden)');
            let totalInvoice = 0;
            let totalWeight = 0;
            let totalBankInvoice = 0;
            let totalTdsInvoice = 0;

            rows.forEach((row, index) => {
                if (index === 0) return; // Skip header row
                const cells = row.querySelectorAll('td');
                const invoiceAmount = parseFloat(cells[6]?.textContent || "0");
                const weight = parseFloat(cells[7]?.textContent || "0");
                const type = cells[1]?.textContent.toLowerCase();
                const bankInvoice = parseFloat(cells[4]?.textContent || "0");
                const tdsInvoice = parseFloat(cells[4]?.textContent || "0");

                if (!isNaN(invoiceAmount)) totalInvoice += invoiceAmount;
                if (!isNaN(weight)) totalWeight += weight;
                if (type === "bank" && !isNaN(bankInvoice)) totalBankInvoice += bankInvoice;
                if (type === "tds" && !isNaN(tdsInvoice)) totalTdsInvoice += tdsInvoice;
            });

            document.getElementById('totalInvoice').textContent = totalInvoice.toFixed();
            document.getElementById('totalWeight').textContent = totalWeight.toFixed();
            document.getElementById('totalBankInvoice').textContent = totalBankInvoice.toFixed();
            document.getElementById('totalTdsInvoice').textContent = totalTdsInvoice.toFixed();

            const difference = totalInvoice - totalTdsInvoice - totalBankInvoice;
            document.getElementById('difference').textContent = `Closing Balance: Rs. ${difference.toFixed()}`;
        }


// set by default open today entry
        function setTodayDate() {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
        const dd = String(today.getDate()).padStart(2, '0');
        const todayDate = `${yyyy}-${mm}-${dd}`;
        document.getElementById('dateFilter').value = todayDate; // Set the value in the date input
    }



        function formatDate(inputDate) {
            const date = new Date(inputDate);
            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            const day = String(date.getDate()).padStart(1, '0');
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            return `${day}-${month}-${year}`;
        }

        function filterTable() {
            const query = document.getElementById('searchBar').value.toLowerCase();
            const selectedDate = document.getElementById('dateFilter').value;
            const formattedDate = selectedDate ? formatDate(selectedDate) : null;
            const rows = document.querySelectorAll('#miplTable tr');

            rows.forEach((row, index) => {
                if (index === 0) return; // Skip header row

                const cells = row.querySelectorAll('td');
                const rowText = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(' ');
                const rowDate = cells[2]?.textContent;

                // Priority: Search Bar
                if (query.trim() !== '') {
                    row.classList.toggle('hidden', !rowText.includes(query));
                } else if (formattedDate) {
                    // Filter by date only if search bar is empty
                    row.classList.toggle('hidden', rowDate !== formattedDate);
                } else {
                    // Show all rows if both filters are empty
                    row.classList.remove('hidden');
                }
            });

            calculateTotals(); // Recalculate totals after filtering

            // Show or hide the table based on results
            const visibleRows = Array.from(rows).some((row, index) => index > 0 && !row.classList.contains('hidden'));
            const table = document.getElementById('miplTable');
            table.classList.toggle('hidden', !visibleRows);
        }

        function printTable() {
    const table = document.getElementById('miplTable');
    const filteredRows = Array.from(table.querySelectorAll('tr')).filter(row => {
        return !row.classList.contains('hidden');
    });

    const printContent = `
        <span style="color:grey;font-size:90%;font-family:Magneto;">eS|MTally</span> <br/> <span style="color:black;font-size:120%;font-family:Arial;">MIPL Cash Management</span>
 
        <div style="margin-bottom: 15px; font-size: 16px;">
            <div style="margin-bottom:5px;">${document.getElementById('totals').outerHTML}</div>
            <div>${document.getElementById('difference').outerHTML}</div>
        </div>
        <table style="width:100%; border-collapse: collapse; font-size:14px;">
            <thead>
                <tr style="background-color: #f2f2f2; text-align: left; font-weight:bold;">
                    ${Array.from(table.querySelectorAll('tr th')).map(th => `<th style="border: 1px solid #ddd; padding: 8px;">${th.innerHTML}</th>`).join('')}
                </tr>
            </thead>
            <tbody>
                ${filteredRows.map(row => {
                    return `<tr style="border: 1px solid #ddd; text-align: left;">
                        ${Array.from(row.cells).map(cell => `
                            <td style="border: 1px solid #ddd; padding: 8px;">${cell.innerHTML}</td>
                        `).join('')}
                    </tr>`;
                }).join('')}
            </tbody>
        </table>
    `;

    const printWindow = window.open('', '', 'height=600,width=900');
    printWindow.document.write(`
        <html>
            <head>
                <title>Print</title>
                <style>
                    body {
                        font-family: Arial, sans-serif;
                        margin: 20px;
                        color: #333;
                    }
                    table {
                        width: 100%;
                        border-collapse: collapse;
                    }
                    th, td {
                        border: 1px solid #ddd;
                        padding: 8px;
                    }
                    th {
                        background-color: #f2f2f2;
                        font-weight: bold;
                        text-align: left;
                    }
                    tr:nth-child(even) {
                        background-color: #f9f9f9;
                    }
                    tr:hover {
                        background-color: yellow;
                    }
                </style>
            </head>
            <body>
                ${printContent}
            </body>
        </html>
    `);

    printWindow.document.close();
    printWindow.print();
}

        window.onload = () => {

          loadusrAdminSheet(); // admin section

          jobbPOReffload();  // TO 10 ENTRY

          loadIVCRSheet();
          //
          filterSKHR(); // shekher table
         jobbJBload();
          eventSheet();
          fetchUserData();
          filterDp();  // SRR RAGISTER

//
loadSheet();
            document.getElementById('searchBar').addEventListener('input', filterTable);
            document.getElementById('dateFilter').addEventListener('change', filterTable);
            document.getElementById('printButton').addEventListener('click', printTable);
        //

//
     loadusrSheet();
            document.getElementById('filterusrColumn1').addEventListener('change', filteruserTable);
           document.getElementById('filteruserColumn2').addEventListener('change', filteruserTable);
           document.getElementById('starusertDate').addEventListener('change', filteruserTable);
           document.getElementById('enduserDate').addEventListener('change', filteruserTable);
      //
      //
     loadpebSheet();
            document.getElementById('filterColumn1').addEventListener('change', filterPEBTable);
            document.getElementById('filterColumn2').addEventListener('change', filterPEBTable);
            document.getElementById('startDate').addEventListener('change', filterPEBTable);
            document.getElementById('endDate').addEventListener('change', filterPEBTable);
          //
          //
           loadIVSheet();
            document.getElementById('filterIVColumn1').addEventListener('change', filterIVTable);
            document.getElementById('filterIVColumn2').addEventListener('change', filterIVTable);
            document.getElementById('starIVtDate').addEventListener('change', filterIVTable);
            document.getElementById('endIVDate').addEventListener('change', filterIVTable);
      //
      //
     document.getElementById('totalMonth').style.display = 'none';
            loadMonth();
          // ** document.getElementById('searchBarmonth').addEventListener('input', filterTablemonth);
       //
       //
        document.getElementById('myTable').style.display = 'none'; // Hide table initially
        addresssheet();
        document.getElementById('searchtab').addEventListener('input', serchAddress);
        //
       
 //
          //    loadSRSheet();
 //           document.getElementById('filterSRColumn1').addEventListener('change', filterSRTable);
   //         document.getElementById('filterSRColumn2').addEventListener('change', filterSRTable);
     //       document.getElementById('startDate').addEventListener('change', filterSRTable);
       //     document.getElementById('endDate').addEventListener('change', filterSRTable);

            //
        
        };
    </script>
</head>



<!-- daybook serchbar script stop  (CODE502)-->




<!-- Address & Purchase Order Script & code Stop Heare start (CODE503) --> 

<!DOCTYPE html>
<html >
<head>
    <title>HOME MIPL</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #searchCon {
            position: sticky;
            top: 0;
            background: #015757;
            padding: 10px;
            border-bottom: 2px solid #ccc;
            z-index: 1000; /* Ensure it stays above the table */
        }
        #searchtab {
            padding: 8px;
            width: 100%;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 4px;
        }

        tr.hidden {
            display: none;
        }
        #noResultsMessage {
            text-align: center;
            margin-top: 10px;
            background: #ff0000;
            color: white;
        }
    </style>
    <script>
       async function addresssheet() {
    const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
    const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
    const range = 'ADDRESS!A:J';

    try {
        const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
        );
        const data = await response.json();

        if (data.values) {
            const table = document.getElementById('myTable');
            table.innerHTML = ""; // Clear the table before adding new data

            data.values.forEach((row, index) => {
                const tr = document.createElement('tr');

                row.forEach((cell) => {
                    const cellElement = index === 0 ? document.createElement('th') : document.createElement('td');
                    
                    if (cell.startsWith('http') || cell.startsWith('www')) {
                        const a = document.createElement('a');
                        a.href = cell;
                        a.innerHTML = "&#128221 Click to View PO"; // DOWNLOAD ICON
                        a.target = "_blank";
                        cellElement.appendChild(a);
                    } else {
                        cellElement.textContent = cell;
                    }
                    tr.appendChild(cellElement);
                });

                table.appendChild(tr);
            });
        } else {
            console.error("No data found in the specified range.");
        }
    } catch (error) {
        console.error("Error fetching data from Google Sheets:", error);
    }
} 

        function serchAddress() {
            const query = document.getElementById('searchtab').value.toLowerCase();
            const table = document.getElementById('myTable');
            const rows = document.querySelectorAll('#myTable tr');
            let visibleRows = 0; // Track the number of visible rows

            rows.forEach((row, index) => {
                if (index === 0) return; // Skip header row

                if (query.trim() === '') {
                    row.classList.add('hidden'); // Hide all rows if search bar is blank
                } else {
                    const cells = row.querySelectorAll('td');
                    const rowText = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(' ');

                    if (rowText.includes(query)) {
                        row.classList.remove('hidden');
                        visibleRows++;
                    } else {
                        row.classList.add('hidden');
                    }
                }
            });

            // Show the table if there are visible rows
            if (visibleRows > 0) {
                table.style.display = 'table';
            } else {
                table.style.display = 'none';
            }

            // Display a message if no rows are visible
            const noResultsMessage = document.getElementById('noResultsMessage');
            if (!visibleRows && query.trim() !== '') {
                if (!noResultsMessage) {
                    const message = document.createElement('p');
                    message.id = 'noResultsMessage';
                    message.textContent = 'No matching results found.';
                    document.body.appendChild(message);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }
       
    </script>
</head>

</html>


 <!-- Address & Purchase Order Script & code Stop Heare stop  (CODE503) -->




 
 <!-- monthly sale & receipt Script & code Start Heare  (CODE504)  --> 
 
 <table id="totalMonth" border="1"></table>
    <script>
        async function loadMonth() {
            const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
            const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
            const range = 'LEDGER!B:J';
        
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
                );
                const data = await response.json();
        
                if (data.values) {
                    const table = document.getElementById('totalMonth');
                    const monthlyData = {}; // Object to hold data for each month
        
                    data.values.forEach((row, index) => {
                        const tr = document.createElement('tr');
        
                        if (index === 0) {
                            row.forEach((cell) => {
                                const th = document.createElement('th');
                                th.textContent = cell;
                                tr.appendChild(th);
                            });
                        } else {
                            const month = getMonthFromDate(row[1]); // Get month from the first column (date)
                            if (!monthlyData[month]) {
                                monthlyData[month] = { bank: 0, taxInvoice: 0 };
                            }
        
                            row.forEach((cell, cellIndex) => {
                                const td = document.createElement('td');
                                td.textContent = cell;
                                tr.appendChild(td);
        
                                if (cellIndex === 0) {
                                    if (cell.toLowerCase() === "bank" && row[0]) {
                                        monthlyData[month].bank += parseFloat(row[3]) || 0;
                                    } else if (cell.toLowerCase() === "tax invoice" && row[0]) {
                                        monthlyData[month].taxInvoice += parseFloat(row[5]) || 0;
                                    }
                                }
                            });
                        }
                        table.appendChild(tr);
                    });
        
                    // Populate the month dropdown
                    populateMonthDropdown(Object.keys(monthlyData));
        
                    // Set initial totals for the first month (optional)
                    const firstMonth = Object.keys(monthlyData)[0];
                    updateMonthlyTotalsDisplay(monthlyData[firstMonth]);
                    
                    window.monthlyData = monthlyData; // Store the data globally for later use
                } else {
                    console.error("No data found in the specified range.");
                }
            } catch (error) {
                console.error("Error fetching data from Google Sheets:", error);
            }
        }
        
        function getMonthFromDate(dateStr) {
            // Assuming the date is in the format "8-Jan-2025"
            const date = new Date(dateStr); // Convert string to Date object
            const month = date.toLocaleString('default', { month: 'short' }); // Get abbreviated month (Jan, Feb, etc.)
            const year = date.getFullYear(); // Get the year
            return `${month}-${year}`; // Format as "Jan-2025"
        }
        
        function populateMonthDropdown(months) {
            const dropdown = document.getElementById('monthDropdown');
            months.forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month;
                dropdown.appendChild(option);
            });
        
            // Add event listener for the dropdown change
            dropdown.addEventListener('change', (e) => {
                const selectedMonth = e.target.value;
                updateMonthlyTotalsDisplay(window.monthlyData[selectedMonth]);
            });
        }
        
        function updateMonthlyTotalsDisplay(totals) {
            const totalsElement = document.getElementById('monthlyTotals');
            totalsElement.innerHTML = `<span style="color: #002c2c ;font-size:100%;font-family:Arial Black;">Total Receipt : Rs. ${totals.bank.toFixed()}</span> | <span style="color: #002c2c ;font-size:100%;font-family:Arial Black;">Total Sale : Rs. ${totals.taxInvoice.toFixed()}</span> `;
        }
        
        function filterTablemonth() {
            const query = document.getElementById('searchBarmonth').value.toLowerCase();
            const table = document.getElementById('totalMonth');
            const rows = document.querySelectorAll('#totalMonth tr');
            let visibleRows = 0;
        
            rows.forEach((row, index) => {
                if (index === 0) return;
        
                const cells = row.querySelectorAll('td');
                const rowText = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(' ');
        
                if (rowText.includes(query)) {
                    row.classList.remove('hidden');
                    visibleRows++;
                } else {
                    row.classList.add('hidden');
                }
            });
        
            table.style.display = visibleRows > 0 ? 'table' : 'none';
        
            const noResultsMessage = document.getElementById('noResultsMessage');
            if (!visibleRows && query.trim() !== '') {
                if (!noResultsMessage) {
                    const message = document.createElement('p');
                    message.id = 'noResultsMessage';
                    message.textContent = 'No matching results found.';
                    document.body.appendChild(message);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }
        
     //   window.onload = () => {
       //     document.getElementById('totalMonth').style.display = 'none';
         //   loadMonth();
       //     document.getElementById('searchBarmonth').addEventListener('input', filterTablemonth);
      //  };
    </script>
</body>
</html>


<!-- monthly sale & receipt Script & code stop  Heare  (CODE504)--> 




<!-- user ma/ta script & code start   (CODE505) -->
<!DOCTYPE html>
<html>
<head>
    <title>Cash Ledger Report</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #search123Container {
            position: sticky;
            top: 0;
           left: 0;
      width: 100%;
      background: #ebecec;
      padding: 10px 20px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1000;
      color: #000;
        }

        .search123Container select,
    .search123Container input {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }


        .select2-container {
            flex: 1;
        }
        tr.hidden {
            display: none;
        }
        tr.receipt {
            background-color: #ffe6e6;
            color: #a10404;
        }

        tr.receipt2 {
            background-color: #ffe6e6;
            color: #5b0202;
          }
          tr.billdr {
             background-color: #e6f3ff;
             color: #1d03c6;
         }
         tr.billcr {
             background-color: #e6f3ff;
             color: #190599;
         }
        #userTotals {
           
            font-size: 20px;
            color: #f8f9fa;
            background-color: #1c1c1b;
        }
        #noResultsMessage {
            text-align: center;
            margin-top: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        async function loadusrSheet() {
            const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM"; // Replace with your API key
            const sheetId = "1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0"; // Replace with your Sheet ID
            const range = 'DATAINDEX!A:I'; // Replace with the correct range
    
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
                );
                const data = await response.json();
    
                if (data.values) {
                     populateuserTable(data.values);
    populateuserDropdowns(data.values);
    displayLast10EntriesPerUser(data.values); // 🔥 Show MA & TA last 10
                } else {
                    console.error("No data found in the specified range.");
                }
            } catch (error) {
                console.error("Error fetching data from Google Sheets:", error);
            }
        }
    
        function populateuserTable(data) {
            const table = document.getElementById('myuserTable');
            table.innerHTML = ''; // Clear existing rows
    
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
    
                if (index === 0) {
                    // Header row
                    row.forEach(cell => {
                        const th = document.createElement('th');
                        th.textContent = cell;
                        tr.appendChild(th);
                    });
    

                   
                

                    // Add "Running Balance" column to the header
                    const thRunningBalance = document.createElement('th');
                    thRunningBalance.textContent = 'Balance';
                    tr.appendChild(thRunningBalance);
                } else {
                    // Data rows
                    row.forEach((cell, cellIndex) => {
                        const td = document.createElement('td');
                        td.textContent = cell;
                        tr.appendChild(td);
    
                        // Add class based on "Type" column cloour row
                        if (cellIndex === 2) { // Assuming Type is in column 2
                            if (cell.toLowerCase() === "receipt") {
                                tr.classList.add('receipt');
                            } else if (cell.toLowerCase() === "receipt ") {
                                tr.classList.add('receipt2');
                            } else if (cell.toLowerCase() === "billdr") {
                             tr.classList.add('billdr');
                         }
                         else if (cell.toLowerCase() === "billcr") {
                             tr.classList.add('billcr');
                         }
                        }
                    });
    
                    // Add empty cell for "Running Balance"
                    const tdRunningBalance = document.createElement('td');
                    tdRunningBalance.classList.add('runningBalance');
                    tr.appendChild(tdRunningBalance);
                }
    
                table.appendChild(tr);
            });
    
            
        }
    
       
        
       
   
// runnin balance start hare 


        function calculateuserRunningBalance() {
    // Select only visible rows after filtering (excluding the header row)
    const rows = Array.from(document.querySelectorAll('#myuserTable tr:not(.hidden)')).slice(1); // Skip header row

    if (rows.length === 0) return; // Exit if no rows are visible

    // Get the amount from the last visible row (latest transaction)
    const lastRow = rows[rows.length - 1];
    const lastRowCells = lastRow.querySelectorAll('td');
    const lastRowTransactionType = lastRowCells[2]?.textContent.trim().toLowerCase(); // Type column
    const lastRowAmount = parseFloat(lastRowCells[5]?.textContent || 0); // Amount column

    // Start the running balance with the amount from the last row
   // let runningBalance = lastRowTransactionType === "receipt" ? lastRowAmount : -lastRowAmount;
   

  // Define transaction types that should be added to the balance
  const positiveTypes = ["receipt", "salary","billcr"];
// Start the running balance with the correct sign
let runningBalance = positiveTypes.includes(lastRowTransactionType) ? lastRowAmount : -lastRowAmount;




    // Update the running balance cell in the last row
    const lastRowBalanceCell = lastRow.querySelector('.runningBalance');
    if (lastRowBalanceCell) {
        lastRowBalanceCell.textContent = runningBalance.toFixed(2);
    }

    // Iterate upwards through the remaining rows
    for (let index = rows.length - 2; index >= 0; index--) {
        const row = rows[index];
        const cells = row.querySelectorAll('td');
        const transactionType = cells[2]?.textContent.trim().toLowerCase(); // Assuming "Type" column is at index 2
        const amount = parseFloat(cells[5]?.textContent || 0); // Assuming "Amount" column is at index 5

        if (!isNaN(amount)) {
            if (transactionType === "receipt") {
                runningBalance += amount; // Add for receipt
            } else if (transactionType === "payment") {
                 runningBalance -= amount; // Subtract for payment
             }else if (transactionType === "billdr") {
                 runningBalance -= amount; // Subtract for payment
                 
             }else if (transactionType === "salary") {
                 runningBalance += amount; // Subtract for payment
             }else if (transactionType === "billcr") {
                 runningBalance += amount; // Subtract for payment
             }
        }

        // Update the running balance cell
        const runningBalanceCell = row.querySelector('.runningBalance');
        if (runningBalanceCell) {
            runningBalanceCell.textContent = runningBalance.toFixed();
        }
    }
}

// running balance funtion stop
//calculateuserRunningBalance(); // Recalculate running balance after filtering


function populateuserDropdowns(data) {
    const dropdown1 = document.getElementById('filterusrColumn1');
    const dropdown2 = document.getElementById('filteruserColumn2');
    const dropdown4 = document.getElementById('filteruserColumn4');

    const uniqueValues1 = [...new Set(data.slice(1).map(row => row[1]))]; // Column 1
    const uniqueValues2 = [...new Set(data.slice(1).map(row => row[2]))]; // Column 2
    const uniqueValues4 = [...new Set(data.slice(1).map(row => row[4]))]; // Column 4

    populateuserDropdown(dropdown1, uniqueValues1);
    populateuserDropdown(dropdown2, uniqueValues2);
    populateuserDropdown(dropdown4, uniqueValues4);

    // Initialize Select2 for searchable dropdown
    $(dropdown4).select2({
        placeholder: "-- Select --",
        allowClear: true,
        width: 'resolve'
    });

    // Bind filter event for Select2
    $(dropdown4).on('change', filteruserTable);

    // Map for dropdown1 values to corresponding names
    const userMapping = {
        MA: "User | Mukhtiyar",
        TA: "User | Tushar Agarwal",
        JLN: "Voucher | Journal",
        BANK: "Voucher | Bank"

        //   <div id="resultDiv"></div>  user name show as per your requre
    };

    // Event listener for dropdown1 to show corresponding name
    dropdown1.addEventListener('change', function () {
        const selectedValue = dropdown1.value;
        const resultDiv = document.getElementById('resultDiv');

        if (userMapping[selectedValue]) {
            resultDiv.textContent = userMapping[selectedValue]; // Show corresponding name
        } else {
            resultDiv.textContent = ""; // Clear the div if no valid option is selected
        }
    });
}

function populateuserDropdown(dropdown, values) {
    dropdown.innerHTML = '<option value="">-- Select --</option>';
    values.forEach(value => {
        const option = document.createElement('option');
        option.value = value;
        option.textContent = value;
        dropdown.appendChild(option);
    });
}

    
        function filteruserTable() {
            const filter1 = document.getElementById('filterusrColumn1').value.toLowerCase();
            const filter2 = document.getElementById('filteruserColumn2').value.toLowerCase();
            const filter4 = $('#filteruserColumn4').val()?.toLowerCase();
            const starusertDate = new Date(document.getElementById("starusertDate").value);
            const enduserDate = new Date(document.getElementById("enduserDate").value);
    
            const rows = document.querySelectorAll('#myuserTable tr');
            let visibleRows = 0;
            let totaluserPayment = 0, totaluserReceipt = 0, totaluserBilldr = 0,totaluserBillcr = 0, totaluserSalary = 0;

             
    
            rows.forEach((row, index) => {
                if (index === 0) return; // Skip header row
    
                const cells = row.querySelectorAll('td');
                const date = new Date(cells[3]?.textContent.trim());
                const type = cells[2]?.textContent.trim().toUpperCase();
                const amount = parseFloat(cells[5]?.textContent.trim()) || 0;
    
                // Date filter check
                let dateMatches = true;
                if (starusertDate && date < starusertDate) dateMatches = false;
                if (enduserDate && date > enduserDate) dateMatches = false;
    
                // Filter checks
                const matchesFilter1 = !filter1 || cells[1]?.textContent.toLowerCase() === filter1;
                const matchesFilter2 = !filter2 || cells[2]?.textContent.toLowerCase() === filter2;
                const matchesFilter4 = !filter4 || cells[4]?.textContent.toLowerCase() === filter4;
    
                if (matchesFilter1 && matchesFilter2 && matchesFilter4 && dateMatches) {
                    row.classList.remove('hidden');
                    visibleRows++;
    
                    // Update totals based on type
                    if (type === "PAYMENT") {
                        totaluserPayment += amount;
                    } else if (type === "RECEIPT") {
                        totaluserReceipt += amount;
                    } else if (type === "BILLDR") {
                        totaluserBilldr += amount;
                    } else if (type === "SALARY") {
                        totaluserSalary += amount;
                    }
                    else if (type === "BILLCR") {
                        totaluserBillcr -= amount;
                    }
                } else {
                    row.classList.add('hidden');
                }
            });
    
            displayNoResultsMessage(visibleRows);
            updateuserTotals(totaluserPayment, totaluserReceipt, totaluserBilldr,totaluserBillcr, totaluserSalary);

           
           // running balance show after latest filter table 
            // Filtering logic here...
            calculateuserRunningBalance(); // Recalculate running balance after filtering


        }
    
        function displayNoResultsMessage(visibleRows) {
            const noResultsMessage = document.getElementById('noResultsMessage');
            if (!visibleRows) {
                if (!noResultsMessage) {
                    const message = document.createElement('p');
                    message.id = 'noResultsMessage';
                    message.textContent = 'No matching results found.';
                    document.body.appendChild(message);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }
    
        function updateuserTotals(totaluserPayment, totaluserReceipt, totaluserBilldr,totaluserBillcr, totaluserSalary) {
            document.getElementById("totaluserPayment").textContent = totaluserPayment.toFixed();
            document.getElementById("totaluserReceipt").textContent = totaluserReceipt.toFixed();
            document.getElementById("totaluserBilldr").textContent = totaluserBilldr.toFixed();
            document.getElementById("totaluserBillcr").textContent = totaluserBillcr.toFixed();
            document.getElementById("totaluserSalary").textContent = totaluserSalary.toFixed();
            document.getElementById("totaluserDifference").textContent = (totaluserReceipt - totaluserPayment - totaluserBilldr + totaluserBillcr + totaluserSalary).toFixed();
        }
    


// last 10 entry start hare

function displayLast10EntriesPerUser(data) {
    const headers = data[0];
    const entries = data.slice(1); // Exclude header row

    ['MA', 'TA'].forEach(userCode => {
        // Step 1: Filter entries for user
        const userEntries = entries.filter(row => row[1] === userCode);

        // Step 2: Sort all entries by Sr No. ASC (oldest to newest)
        const sorted = userEntries.sort((a, b) => parseInt(a[0]) - parseInt(b[0]));

        // Step 3: Compute running balance for all entries
        let balance = 0;
        const positiveTypes = ["receipt", "salary", "billcr"];
        const withBalance = sorted.map(row => {
            const type = row[2]?.toLowerCase();
            const amount = parseFloat(row[5]) || 0;
            balance += positiveTypes.includes(type) ? amount : -amount;
            return { row, balance: balance.toFixed() };
        });

        // Step 4: Get latest 10 entries (newest), in descending order
        const last10 = withBalance.slice(-10).reverse(); // latest to oldest

        // Step 5: Generate HTML
        const tableRows = last10.map(entry => {
            const type = entry.row[2]?.toLowerCase();
            const isReceipt = type === 'receipt';
            const rowStyle = isReceipt ? 'style="background-color: ; color: RED;"' : '';

            return `
                <tr ${rowStyle}>
                    <td>${entry.row[0]}</td> <!-- Trn. No -->
                    <td>${entry.row[3]}</td> <!-- Date -->
                    <td>${entry.row[2]}</td> <!-- Type -->
                    <td>${entry.row[4]}</td> <!-- Ledger -->
                    <td>${entry.row[5]}</td> <!-- Amount -->
                    <td>${entry.row[6]}</td> <!-- Narration -->
                    <td>${entry.balance}</td> <!-- Running Balance -->
                </tr>
            `;
        });

        const tableHTML = `
            <h3>Last 10 Entries - ${userCode}</h3>
            <table border="1" style="border-collapse: collapse; width: 100%; font-size:16px;">
                <thead>
                    <tr>
                        <th>T.No.</th>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Ledger</th>
                        <th>Amount</th>
                        <th>Narration</th>
                        <th>Balance</th>
                    </tr>
                </thead>
                <tbody>
                    ${tableRows.join('')}
                </tbody>
            </table>
        `;

        document.getElementById(`last10${userCode}`).innerHTML = tableHTML;
    });
}

// last 10 entry stop hare


        function printuserTable() {
    let printWindow = window.open('', '', 'height=500, width=800');

    const styles = `
        <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 12px; text-align: left; }
            table th, table td { border: 1px solid #ddd; padding: 5px; }
            table th { background-color: #f4f4f4; font-weight: bold; }
            table tr.payment { background-color: white; color: black; }
            table tr.receipt { background-color: blac; color: red; }
            table tr.bill { background-color: blac; color: blue; }
            .filter-summary { margin: 10px 0; font-size: 14px; }
            .filter-summary span { display: inline-block; margin-right: 20px; }
        </style>
    `;

    // Fetch filter values
    const ledger = document.getElementById("filteruserColumn4").value || "All";
    const starusertDate = document.getElementById("starusertDate").value || "Not Set";
    const enduserDate = document.getElementById("enduserDate").value || "Not Set";
    const user = document.getElementById("filterusrColumn1").value || "All";
    const voucher = document.getElementById("filteruserColumn2").value || "All";

    // Create a summary of filter options
    const filterSummary = `
        <div class="filter-summary">
            <span><strong>Ledger:</strong> ${ledger}</span>
            <span><strong>From:</strong> ${starusertDate}</span>
            <span><strong>To:</strong> ${enduserDate}</span>
            <span><strong>User:</strong> ${user}</span>
            <span><strong>Voucher:</strong> ${voucher}</span>
        </div>
    `;

    // Clone the table and remove hidden rows
    let table = document.getElementById("myuserTable");
    let tableClone = table.cloneNode(true);

    let rows = tableClone.querySelectorAll('tr');
    rows.forEach((row) => {
        if (row.classList.contains('hidden')) {
            row.remove(); // Remove hidden rows from the cloned table
        } else {
            // Retain only the first 7 columns for each row
            while (row.cells.length > 10) {
                row.deleteCell(10); // Remove extra columns starting from index 7
            }
        }
    });

    // Start writing to the print window
    printWindow.document.write('<html><head><title>🖨️ Print</title></head><body>');
    printWindow.document.write(styles);
   
    printWindow.document.write('<span style="color:grey;font-size:70%;font-family:Magneto;">eS|MTally</span> <br/> <span style="color:black;font-size:120%;font-family:Arial;">MIPL Cash Management</span>'); // Optional title
 
    printWindow.document.write(filterSummary); // Add the filter summary to the print view

    // Add totals section
    printWindow.document.write(document.getElementById("userTotals").outerHTML);

    // Write the cloned table with only visible rows and limited columns
    printWindow.document.write(tableClone.outerHTML);

    // Close and print
    printWindow.document.close();
    printWindow.print();
}







     //   window.onload = () => {
       //     loadusrSheet();
       //     document.getElementById('filterusrColumn1').addEventListener('change', filteruserTable);
       //     document.getElementById('filteruserColumn2').addEventListener('change', filteruserTable);
      //      document.getElementById('starusertDate').addEventListener('change', filteruserTable);
      //      document.getElementById('enduserDate').addEventListener('change', filteruserTable);
     //   };
    </script>
</head>

</html>


<!-- user ma/ta script & code stop  (CODE505) -->



<!-- IVMA form div script start here -->
<script>
  const scriptIVMAURL = 'https://script.google.com/macros/s/AKfycbz1qX7pBpLSoZRDEUqIs1B-DZCVBuUCYQvGKDPRPwLC4OJY_07Ooi0AI8SzRJbi9yyQWg/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainIVMAForm") return;

    e.preventDefault();
    const formMode = document.getElementById("formModeIVMA").value;
    console.log("Current form mode:", formMode);

    const submitIVMAButton = document.getElementById("submitIVMAButton");
    submitIVMAButton.disabled = true;
    submitIVMAButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampIVMA').value =
      `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    if (formMode === "modify") {
      await modifyIVMAEntry();
    } else {
      await submitIVMAEntry(form);
    }

    submitIVMAButton.disabled = false;
    submitIVMAButton.value = "Submit";
  });

  async function submitIVMAEntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptIVMAURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset();

        // ✅ Clear mode & sNo after reset
        setTimeout(() => {
          document.getElementById("formModeIVMA").value = "new";
          document.getElementById("sNo").value = "";
          document.getElementById("searchIVMASNo").value = "";
        }, 50);

              // cash user table refresh start--------------------
         
// Re-fetch the data and re-render the table
const raw = await fetchSheetData();
fullData = processRawData(raw);

// Get current filters (if any)
const currentAccountType = document.getElementById("cu123")?.value || "";
const currentLedgerFilter = document.getElementById("msaf54")?.value.trim() || "";

// Re-render the table with current filters
filterAndRender(currentAccountType, currentLedgerFilter);
//  // cash user table refresh stop -------------------------
        loadusrSheet();
        loadIVSheet();

        // ✅ Remove DLT option if exists
        const msaf51Dropdown = document.getElementById("msaf51");
        const dltIVMAOption = [...msaf51Dropdown.options].find(opt => opt.value === "DLT");
        if (dltIVMAOption) {
          msaf51Dropdown.removeChild(dltIVMAOption);
        }

      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }

  async function modifyIVMAEntry() {
    const waitMessage = document.getElementById("waitIVMAMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";

    const form = document.getElementById('mainIVMAForm');

    // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampIVMA').value =
      `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptIVMAURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();

        // ✅ Clear mode & sNo after reset
        setTimeout(() => {
          document.getElementById("formModeIVMA").value = "new";
          document.getElementById("sNo").value = "";
          document.getElementById("searchIVMASNo").value = "";
        }, 50);

              // cash user table refresh start-------------------------
         
// Re-fetch the data and re-render the table
const raw = await fetchSheetData();
fullData = processRawData(raw);

// Get current filters (if any)
const currentAccountType = document.getElementById("cu123")?.value || "";
const currentLedgerFilter = document.getElementById("msaf54")?.value.trim() || "";

// Re-render the table with current filters
filterAndRender(currentAccountType, currentLedgerFilter);
//  // cash user table refresh stop --------------------
        loadusrSheet();
        loadIVSheet();

        document.getElementById("submitIVMAButton").style.display = "inline-block";
        document.getElementById("modifyIVMAButton").style.display = "none";

        // ✅ Remove DLT option
        const msaf51Dropdown = document.getElementById("msaf51");
        const dltIVMAOption = [...msaf51Dropdown.options].find(opt => opt.value === "DLT");
        if (dltIVMAOption) {
          msaf51Dropdown.removeChild(dltIVMAOption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function fetchIVMADetails() {
    const sNo = document.getElementById("searchIVMASNo").value;
    const waitMessage = document.getElementById("waitIVMAMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

    try {
      const response = await fetch(`${scriptIVMAURL}?sNo=${sNo}`);
      const data = await response.json();

      if (
        data.result !== "error" &&
        (data.Voucher === "MA" || data.Voucher === "TA" || data.Voucher === "BANK" || data.Voucher === "JLN")
      ) {
        document.getElementById("sNo").value = data.SNo;
        document.getElementById("msaf51").value = data.Voucher;
        document.getElementById("msaf52").value = data.Type;
        document.getElementById("msaf53").value = data.Date;
        document.getElementById("msaf54").value = data.Ledger;
        document.getElementById("msaf55").value = data.Amount;
        document.getElementById("msaf56").value = data.Narration;

        // ✅ Add "DLT - delete" option if not present
        const msaf51Dropdown = document.getElementById("msaf51");
        if (![...msaf51Dropdown.options].some(opt => opt.value === "DLT")) {
          const dlt51Option = document.createElement("option");
          dlt51Option.value = "DLT";
          dlt51Option.text = "Delete";
          dlt51Option.style.color = "red";
          dlt51Option.style.backgroundColor = "blue";
          msaf51Dropdown.appendChild(dlt51Option);
        } 
        //

        // ✅ Switch to modify mode
        document.getElementById("formModeIVMA").value = "modify";

         // ✅ Show alert after successful data fetch
      alert("Select Delete Option in User Section For Delete Entry");

      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }
</script>
<!-- IVMA form div script stop here -->






<!-- ledger dropdown with USER SELECTION ENTRY (cash user) code stop hare -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ledger Table with Running Balance</title>
  <style>
    body {
      font-family: Arial;
    }

    .dropdownWrapper {
      position: relative;
      width: 300px;
    
    }

    .dropdownSearch {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      border: 1px solid #a3a1a1;
      border-radius: 4px;
    }

    .dropdownList {
      list-style: none;
      border: 1px solid #ccc;
      max-height: 5000px;
      width: 3in;
      overflow-y: auto;
      margin: 0;
      padding: 0;
      display: none;
      background: white;
      position: absolute;
      width: 100%;
      z-index: 1000;
      border-radius: 0 0 4px 4px;
    }
/* Style for the entire dropdown container */
  #ledgerDropdown.dropdownList {
    list-style-type: none;
    margin: 0;
    padding: 0;
    position: absolute;
    z-index: 999;
    width: 100%;
    max-height: 500px;
    overflow-y: auto;
    border: 1px solid #ccc;
    background-color: white;
    color: #000;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15);
    font-size: 16px;
    border-radius: 4px;
  }

  /* Style for each dropdown item */
  #ledgerDropdown.dropdownList li {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
    transition: background-color 0.2s ease-in-out;
  }

  /* Highlight on hover */
  #ledgerDropdown.dropdownList li:hover {
    background-color: #007BFF;
    color: white;
  }

  /* Optional: remove border from last item */
  #ledgerDropdown.dropdownList li:last-child {
    border-bottom: none;
  }

    .positive {
      color: RED;
      font-weight: bold;
      
    }
  </style>
</head>
<body>

  
 <script>
  const apiCLKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
  const sheetCLId = "1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0";
  const rangeCL = "DATAINDEX!A:G";

  let fullData = [];
  let filteredByAccount = [];

  async function fetchSheetData() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetCLId}/values/${rangeCL}?key=${apiCLKey}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      return data.values || [];
    } catch (err) {
      console.error("Error fetching data:", err);
      return [];
    }
  }

  function processRawData(rows) {
    return rows.slice(1).map(row => ({
      date: row[0],
      cUser: row[1],
      type: row[1],
      dt: row[3] || "-",
      drcr: row[2],
      ldgr: row[4],
      amount: parseFloat(row[5]) || 0,
      narration: row[6] || "-"
    }));
  }

  function renderTable(data) {
    const tableContainer = document.getElementById("tableContainer");
    if (!data || data.length === 0) {
      tableContainer.innerHTML = "<p>No matching records found.</p>";
      return;
    }

    let balance = 0;
    const reversed = [...data].reverse();
    const rowsWithBalance = reversed.map(row => {
      const signed = row.drcr.toLowerCase() === "payment" ? -row.amount : row.amount;
      balance += signed;
      return { ...row, signedAmount: signed, running: balance };
    }).reverse();

    const table = document.createElement("table");
    table.innerHTML = `
      <thead>
        <tr>
          <th>T.No.</th>
           <th>User</th>
          <th>Type</th>
          <th>Date</th>
          <th>Ledger</th>
          <th>Narration</th>
          <th>Amount (₹)</th>
          <th>Balance (₹)</th>
        </tr>
      </thead>
      <tbody>
        ${rowsWithBalance.map(row => `
          <tr style="${row.drcr.toLowerCase() === 'receipt' ? 'color: RED; background-color: rgb(248, 229, 229);' : ''}">
            <td>${row.date}</td>
            <td>${row.cUser}</td>
            <td>${row.drcr}</td>
            <td>${row.dt}</td>
            <td>${row.ldgr}</td>
            <td>${row.narration}</td>
            <td class="${row.signedAmount < 0 ? 'negative' : 'positive'}">${row.signedAmount.toFixed()}</td>
            <td>${row.running.toFixed()}</td>
          </tr>
        `).join("")}
      </tbody>
    `;
    tableContainer.innerHTML = "";
    tableContainer.appendChild(table);
  }

  function filterAndRender(accountType, ledgerFilter = "") {
    filteredByAccount = fullData.filter(row => row.type === accountType);
    let visible = filteredByAccount;

    if (ledgerFilter.trim() !== "") {
      visible = filteredByAccount.filter(row =>
        row.ldgr.toLowerCase().includes(ledgerFilter.toLowerCase())
      );
    }

    renderTable(visible);
  }

  async function setupLedgerSearch() {
    const input = document.getElementById("msaf54");
    const dropdown = document.getElementById("ledgerDropdown");

    const ledgers = [...new Set(fullData.map(row => row.ldgr).filter(Boolean))];

    input.addEventListener("input", () => {
      const value = input.value.trim().toLowerCase();
      dropdown.innerHTML = "";

      if (value === "") {
        dropdown.style.display = "none";
        filterAndRender(document.getElementById("cu123").value);
        return;
      }

      const matches = ledgers.filter(l => l.toLowerCase().includes(value));
      matches.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item;
        li.onclick = () => {
          input.value = item;
          dropdown.style.display = "none";
          filterAndRender(document.getElementById("cu123").value, item);
        };
        dropdown.appendChild(li);
      });

      dropdown.style.display = matches.length ? "block" : "none";

      // Live filter
      filterAndRender(document.getElementById("cu123").value, value);
    });

    document.addEventListener("click", e => {
      if (!input.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.innerHTML = "";
        dropdown.style.display = "none";
      }
    });
  }

  async function setupAccountSelect() {
    const select = document.getElementById("cu123");
    select.addEventListener("change", () => {
      const selected = select.value;
      document.getElementById("msaf54").value = "";
      document.getElementById("searchCLedger").value = ""; // Clear global search
      filterAndRender(selected);
    });
  }

  function setupGlobalSearch() {
    const input = document.getElementById("searchCLedger");

    input.addEventListener("input", () => {
      const query = input.value.trim().toLowerCase();

      if (query === "") {
        const selected = document.getElementById("cu123").value;
        filterAndRender(selected);
        return;
      }

      const results = fullData.filter(row => {
        return Object.values(row).some(val =>
          String(val).toLowerCase().includes(query)
        );
      });

      renderTable(results);
    });
  }

  document.addEventListener("DOMContentLoaded", async () => {
    const raw = await fetchSheetData();
    fullData = processRawData(raw);

    await setupLedgerSearch();
    await setupAccountSelect();
    setupGlobalSearch(); // Global search setup

    const defaultValue = document.getElementById("cu123").value;
    if (defaultValue) {
      filterAndRender(defaultValue);
    }
  });
</script>

  
</body>
</html>


<!-- ledger dropdown with USER SELECTION ENTRY (cash user) code stop hare -->







<!-- MIPL LEDGER REPORT SCRIPT & CODE START Heare -->
<!DOCTYPE html>
<html>
<head>
    <title>MIPL PARTY LEDGER</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
       
         #searchPEBContainer {
            position: sticky;
            top: 0;
           left: 0;
      width: 100%;
      background: #ebecec;
      padding: 10px 20px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1000;
      color: #000;
        }

        .searchPEBContainer label {
      font-weight: bold;
    }

        .searchPEBContainer select,
    .searchPEBContainer input {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }

        .select2-container {
            flex: 1;
        }

        tr.hidden {
            display: none;
        }
        tr.receipt {
            background-color: #ffe6e6;
            color: #a10404;
        }

        tr.cn {
            background-color: #dbdaf4;
            color: #030173;
          }
        tr.bill {
            background-color: #e6f3ff;
            color: #1d03c6;
        }
        #totalsmipl {
         
           font-size: 20px;
            font-weight: bold;
            color: #f7f8fa;
            background-color: #014384;
        }
        #noResultsMessage {
            text-align: center;
            margin-top: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        async function loadpebSheet() {
    const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM"; // Replace with your API key
    const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
    const range = 'LEDGER!B:L';

    try {
        const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
        );
        const data = await response.json();

        if (data.values) {
            populatePEBTable(data.values);
            populatePEBDropdowns(data.values);
        } else {
            console.error("No data found in the specified range.");
        }
    } catch (error) {
        console.error("Error fetching data from Google Sheets:", error);
    }
}

function populatePEBTable(data) {
    const table = document.getElementById('myPEBTable');
    table.innerHTML = ''; // Clear existing rows

    data.forEach((row, index) => {
        const tr = document.createElement('tr');

        if (index === 0) {
            // Header row
            row.forEach(cell => {
                const th = document.createElement('th');
                th.textContent = cell;
                tr.appendChild(th);
            });

            // Add "Running Balance" column to the header
            const thRunningBalance = document.createElement('th');
            thRunningBalance.textContent = 'Balance';
            tr.appendChild(thRunningBalance);
        } else {
            // Data rows
            row.forEach((cell, cellIndex) => {
                const td = document.createElement('td');

                if (cell.startsWith('http') || cell.startsWith('www')) {
                    // Create hyperlink if cell contains a URL
                    const a = document.createElement('a');
                    a.href = cell;
                    a.innerHTML = "&#128221"; // Download icon
                    a.target = "_blank"; // Open link in new tab
                    td.appendChild(a);
                } else {
                    td.textContent = cell;
                }
                tr.appendChild(td);

                // Add class based on "Type" column
                if (cellIndex === 0) { // Assuming Type is in column 2
                    if (cell.toLowerCase() === "bank") {
                        tr.classList.add('receipt');
                    } else if (cell.toLowerCase() === "credit note") {
                        tr.classList.add('cn');
                    } else if (cell.toLowerCase() === "tds") {
                        tr.classList.add('bill');
                    }
                }
            });

            // Add empty cell for "Running Balance"
            const tdRunningBalance = document.createElement('td');
            tdRunningBalance.classList.add('runningBalance');
            tr.appendChild(tdRunningBalance);
        }

        table.appendChild(tr);
    });
}

            
     
    
       
        
       
   
function calculatePEBRunningBalance() {
    // Select only visible rows after filtering (excluding the header row)
    const rows = Array.from(document.querySelectorAll('#myPEBTable tr:not(.hidden)')).slice(1); // Skip header row

    if (rows.length === 0) return; // Exit if no rows are visible

    // Get the amount from the last visible row (latest transaction)
    const lastRow = rows[rows.length - 1];
    const lastRowCells = lastRow.querySelectorAll('td');
    const lastRowTransactionType = lastRowCells[0]?.textContent.trim().toLowerCase(); // Type column at index 0
    const lastRowAmount = parseFloat(lastRowTransactionType === "bank" || lastRowTransactionType === "tds" 
        ? lastRowCells[3]?.textContent || 0 // Amount column at index 3 for "bank" and "tds"
        : lastRowCells[5]?.textContent || 0); // Amount column at index 6 for others

    // Start the running balance with the amount from the last row
   // let runningBalance = lastRowTransactionType === "bank" ? lastRowAmount : -lastRowAmount;


     // Define transaction types that should be added to the balance
  const positiveTypes = ["bank", "tds"];
// Start the running balance with the correct sign
let runningBalance = positiveTypes.includes(lastRowTransactionType) ? lastRowAmount : -lastRowAmount;


    // Update the running balance cell in the last row
    const lastRowBalanceCell = lastRow.querySelector('.runningBalance');
    if (lastRowBalanceCell) {
        lastRowBalanceCell.textContent = runningBalance.toFixed();
    }

    // Iterate upwards through the remaining rows
    for (let index = rows.length - 2; index >= 0; index--) {
        const row = rows[index];
        const cells = row.querySelectorAll('td');
        const transactionType = cells[0]?.textContent.trim().toLowerCase(); // Assuming "Type" column is at index 0
        const amount = parseFloat(transactionType === "bank" || transactionType === "tds"
            ? cells[3]?.textContent || 0 // Amount column at index 3 for "bank" and "tds"
            : cells[5]?.textContent || 0); // Amount column at index 6 for others

        if (!isNaN(amount)) {
            if (transactionType === "bank") {
                runningBalance += amount; // Add for bank
            } else if (transactionType === "tds") {
                runningBalance += amount; // Add for tds
            } else if (transactionType === "tax invoice") {
                runningBalance -= amount; // Subtract for tax invoice
            } else if (transactionType === "credit note") {
                runningBalance -= amount; // Add for credit note
            }
        }

        // Update the running balance cell
        const runningBalanceCell = row.querySelector('.runningBalance');
        if (runningBalanceCell) {
            runningBalanceCell.textContent = runningBalance.toFixed();
        }
    }
}

// running balance funtion stop
//calculatePEBRunningBalance(); // Recalculate running balance after filtering

function populatePEBDropdowns(data) {
    const dropdown1 = document.getElementById('filterColumn1');
    const dropdown2 = document.getElementById('filterColumn2');
    const dropdown4 = document.getElementById('filterColumn4');

    if (!dropdown1 || !dropdown2 || !dropdown4) {
        console.error("One or more dropdown elements not found.");
        return;
    }

    updateDropdowns(data);

    // Initialize Select2 for searchable dropdown
    $(dropdown4).select2({
        placeholder: "-- Select --",
        allowClear: true,
        width: 'resolve'
    });

    // Bind filter event for Select2
    $(dropdown4).on('change', filterPEBTable);
}

// Function to update dropdowns dynamically based on table data
function updateDropdowns(data) {
    const dropdown1 = document.getElementById('filterColumn1');
    const dropdown2 = document.getElementById('filterColumn2');
    const dropdown4 = document.getElementById('filterColumn4');

    if (!dropdown1 || !dropdown2 || !dropdown4) return;

    const uniqueValues1 = [...new Set(data.slice(1).map(row => row[0]))]; // Column 1
    const uniqueValues2 = [...new Set(data.slice(1).map(row => row[4]))]; // Column 2
    const uniqueValues4 = [...new Set(data.slice(1).map(row => row[2]))]; // Column 4

    populateDropdown(dropdown1, uniqueValues1);
    populateDropdown(dropdown2, uniqueValues2);
    populateDropdown(dropdown4, uniqueValues4);
}

// Function to populate dropdown
function populateDropdown(dropdown, values) {
    if (!dropdown) return;
    dropdown.innerHTML = '<option value="">-- Select --</option>';
    values.forEach(value => {
        const option = document.createElement('option');
        option.value = value;
        option.textContent = value;
        dropdown.appendChild(option);
    });
}

// Function to update dropdown4 dynamically based on the filtered table
// filter hone ke baad reff/job no dropdown update
function updateDropdown4Options() {
    const dropdown2 = document.getElementById('filterColumn2');
    if (!dropdown2) return;

    const rows = document.querySelectorAll('#myPEBTable tr:not(.hidden)');
    let uniqueValues2 = new Set();

    rows.forEach((row, index) => {
        if (index === 0) return; // Skip header row
        const cells = row.querySelectorAll('td');
        if (cells[4]) uniqueValues2.add(cells[4].textContent.trim());
    });

    populateDropdown(dropdown2, [...uniqueValues2]);

// filter hone ke baad reff/job no dropdown update


    // Reinitialize Select2 for dropdown4 after updating
    $(dropdown4).select2({
        placeholder: "-- Select --",
        allowClear: true,
        width: 'resolve'
    });
}

function filterPEBTable() {
    const filter1 = document.getElementById('filterColumn1').value.toLowerCase();
    const filter2 = $('#filterColumn2').val()?.toLowerCase();
    const filter4 = $('#filterColumn4').val()?.toLowerCase();
    const startDate = new Date(document.getElementById("startDate").value);
    const endDate = new Date(document.getElementById("endDate").value);

    const rows = document.querySelectorAll('#myPEBTable tr');
    let visibleRows = 0;
    let totalTds = 0, totalReceipt = 0, totalCn = 0, totalBill = 0, totalPEBWeight = 0;

    rows.forEach((row, index) => {
        if (index === 0) return; // Skip header row

        const cells = row.querySelectorAll('td');
        const date = new Date(cells[1]?.textContent.trim());
        const type = cells[0]?.textContent.trim().toUpperCase();
        const amount = parseFloat(cells[5]?.textContent.trim()) || 0;
        const weight = parseFloat(cells[6]?.textContent.trim()) || 0;
        const receipt = parseFloat(cells[3]?.textContent.trim()) || 0;

        let dateMatches = true;
        if (startDate && date < startDate) dateMatches = false;
        if (endDate && date > endDate) dateMatches = false;

        const matchesFilter1 = !filter1 || cells[0]?.textContent.toLowerCase() === filter1;
        const matchesFilter2 = !filter2 || cells[4]?.textContent.toLowerCase() === filter2;
        const matchesFilter4 = !filter4 || cells[2]?.textContent.toLowerCase() === filter4;

        if (matchesFilter1 && matchesFilter2 && matchesFilter4 && dateMatches) {
            row.classList.remove('hidden');
            visibleRows++;

            if (type === "TDS") {
                totalTds += receipt;
            } else if (type === "BANK") {
                totalReceipt += receipt;
            } else if (type === "TAX INVOICE") {
                totalBill += amount;
                totalPEBWeight += weight;
            } else if (type === "CREDIT NOTE") {
                totalCn += amount;
            }
        } else {
            row.classList.add('hidden');
        }
    });

    displayNoResultsMessage(visibleRows);
    updateTotals(totalTds, totalReceipt, totalBill, totalCn, totalPEBWeight);
    calculatePEBRunningBalance();

    // Update dropdown4 dynamically based on filtered table
    updateDropdown4Options();
    //
}

    
        function displayNoResultsMessage(visibleRows) {
            const noResultsMessage = document.getElementById('noResultsMessage');
            if (!visibleRows) {
                if (!noResultsMessage) {
                    const message = document.createElement('p');
                    message.id = 'noResultsMessage';
                    message.textContent = 'No matching results found.';
                    document.body.appendChild(message);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }
    
        function updateTotals(totalTds, totalReceipt, totalBill,totalCn, totalPEBWeight) {
            document.getElementById("totalTds").textContent = totalTds.toFixed();
            document.getElementById("totalReceipt").textContent = totalReceipt.toFixed();
            document.getElementById("totalBill").textContent = totalBill.toFixed();
            document.getElementById("totalCn").textContent = totalCn.toFixed();
            document.getElementById("totalPEBWeight").textContent = totalPEBWeight.toFixed();
            document.getElementById("totalDifference").textContent = (totalReceipt + totalTds - totalBill -totalCn).toFixed();
        }
    
      
    

        function printpebTable() {
    let printWindow = window.open('', '', 'height=500, width=800');

    const styles = `
        <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 12px; text-align: left; }
            table th, table td { border: 1px solid #ddd; padding: 5px; }
            table th { background-color: #f4f4f4; font-weight: bold; }
            table tr.payment { background-color: white; color: black; }
            table tr.receipt { background-color: blac; color: red; }
            table tr.bill { background-color: blac; color: blue; }
            .filter-summary { margin: 10px 0; font-size: 14px; }
            .filter-summary span { display: inline-block; margin-right: 20px; }
        </style>
    `;

    // Fetch filter values
    const ledger = document.getElementById("filterColumn4").value || "All";
    const startDate = document.getElementById("startDate").value || "Not Set";
    const endDate = document.getElementById("endDate").value || "Not Set";
    const user = document.getElementById("filterColumn1").value || "All";
    const voucher = document.getElementById("filterColumn2").value || "All";

    // Create a summary of filter options
    const filterSummary = `
        <div class="filter-summary">
            <span><strong>Ledger:</strong> ${ledger}</span>
            <span><strong>From:</strong> ${startDate}</span>
            <span><strong>To:</strong> ${endDate}</span>
            <span><strong>User:</strong> ${user}</span>
            <span><strong>Voucher:</strong> ${voucher}</span>
        </div>
    `;

    // Clone the table and remove hidden rows
    let table = document.getElementById("myPEBTable");
    let tableClone = table.cloneNode(true);

    let rows = tableClone.querySelectorAll('tr');
    rows.forEach((row) => {
        if (row.classList.contains('hidden')) {
            row.remove(); // Remove hidden rows from the cloned table
        } else {
            // Retain only the first 7 columns for each row
            while (row.cells.length > 12) {
                row.deleteCell(12); // Remove extra columns starting from index 7
            }
        }
    });

    // Start writing to the print window
    printWindow.document.write('<html><head><title>🖨️ Print</title></head><body>');
    printWindow.document.write(styles);
   
    printWindow.document.write('<span style="color:grey;font-size:70%;font-family:Magneto;">eS|MTally</span> <br/> <span style="color:black;font-size:120%;font-family:Arial;">MIPL Cash Management</span>'); // Optional title
 
    printWindow.document.write(filterSummary); // Add the filter summary to the print view

    // Add totalsmipl section
    printWindow.document.write(document.getElementById("totalsmipl").outerHTML);

    // Write the cloned table with only visible rows and limited columns
    printWindow.document.write(tableClone.outerHTML);

    // Close and print
    printWindow.document.close();
    printWindow.print();
}







     //   window.onload = () => {
       //     loadpebSheet();
       //     document.getElementById('filterColumn1').addEventListener('change', filterPEBTable);
        //    document.getElementById('filterColumn2').addEventListener('change', filterPEBTable);
         //   document.getElementById('startDate').addEventListener('change', filterPEBTable);
          //  document.getElementById('endDate').addEventListener('change', filterPEBTable);
      //  };
    </script>
</head>

</html>
<!-- MIPL LEDGER REPORT SCRIPT & CODE STOP Heare -->







<!-- BANKING form div script start hare -->
<script>
  const scriptBANKURL = 'https://script.google.com/macros/s/AKfycbw0xCIuyevQ3rXPs_sa-9yQGZ50eSIFGMwta7Rq0GqEXHCWDJqi5e4xvdE1hh1NSdU/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainBANKForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeBANK").value; //****
    const submitBANKButton = document.getElementById("submitBANKButton");
    submitBANKButton.disabled = true;
    submitBANKButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampBANK').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifyBANKEntry();
    } else {
      await submitBANKEntry(form);
    }

    submitBANKButton.disabled = false;
    submitBANKButton.value = "Submit";
  });

  async function submitBANKEntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptBANKURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset(); // FORM RESET
        document.getElementById("formModeBANK").value = "new";
       fetchData();  // ✅ Refresh dropdowns or UI
        loadSheet();

           // ✅ Remove DLT option after submit
        const BANKDropdown = document.getElementById("msaf7");
        const dltBANKOption = [...BANKDropdown.options].find(opt => opt.value === "DLT");
        if (dltBANKOption) {
          BANKDropdown.removeChild(dltBANKOption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchBANKDetails() {
    const sNo = document.getElementById("searchBANKSNo").value;
    const waitMessage = document.getElementById("waitBANKMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitBANKButton").style.display = "none";  //****
    try {
      const response = await fetch(`${scriptBANKURL}?sNo=${sNo}`);
      const data = await response.json();

    if (data.result !== "error" && data.Voucher === "RECEIPT") {
        document.getElementById("sNo").value = data.SNo;
        document.getElementById("msaf1").value = data.Date;
        document.getElementById("msaf2").value = data.Type;
        document.getElementById("msaf3").value = data.Ledger;
        document.getElementById("msaf4").value = data.VType;
        document.getElementById("msaf5").value = data.VNo;
        document.getElementById("msaf6").value = data.Narration;
        document.getElementById("msaf7").value = data.Voucher;
      //  document.getElementById("modifyBANKButton").style.display = "inline-block";


       // ✅ Add "DLT - delete" option if it doesn't exist already
const BANKDropdown = document.getElementById("msaf7");
if (![...BANKDropdown.options].some(opt => opt.value === "DLT")) {
  const dltRECEIPTOption = document.createElement("option");
  dltRECEIPTOption.value = "DLT";
  dltRECEIPTOption.text = "Delete";
  dltRECEIPTOption.style.color = "red";
  dltRECEIPTOption.style.backgroundColor = "blue";
  BANKDropdown.appendChild(dltRECEIPTOption);
}

       document.getElementById("formModeBANK").value = "modify"; // ✅ Set to modify

       // ✅ Show alert after successful data fetch
      alert("Select Delete Option in User Section For Delete Entry");
       
    //    document.getElementById("modifyBANKButton").style.display = "inline-block";
      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifyBANKEntry() {
    const waitMessage = document.getElementById("waitBANKMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainBANKForm');

    // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampBANK').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptBANKURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeBANK").value = "new"; // ✅ Reset to new
       fetchData();  // ✅ Refresh dropdowns or UI
        loadSheet();
        document.getElementById("submitBANKButton").style.display = "inline-block";
        document.getElementById("modifyBANKButton").style.display = "none";

          // ✅ Remove DLT option after modify
        const BANKDropdown = document.getElementById("msaf7");
        const dltBANKOption = [...BANKDropdown.options].find(opt => opt.value === "DLT");
        if (dltBANKOption) {
          BANKDropdown.removeChild(dltBANKOption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>
<!-- BANKING form div script stop hare -->




<!-- sale VOUCHER form div script start hare -->
<script>
  const scriptVCRURL = 'https://script.google.com/macros/s/AKfycbw0xCIuyevQ3rXPs_sa-9yQGZ50eSIFGMwta7Rq0GqEXHCWDJqi5e4xvdE1hh1NSdU/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainVCRForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeVCR").value; //****
    const submitVCRButton = document.getElementById("submitVCRButton");
    submitVCRButton.disabled = true;
    submitVCRButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampVCR').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifyVCREntry();
    } else {
      await submitVCREntry(form);
    }

    submitVCRButton.disabled = false;
    submitVCRButton.value = "Submit";
  });

  async function submitVCREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset(); // FORM RESET
        document.getElementById("formModeVCR").value = "new";
       fetchData();  // ✅ Refresh dropdowns or UI
        loadSheet();

           // ✅ Remove DLT option after submit
        const SALEDropdown = document.getElementById("msaf21");
        const dltVCROption = [...SALEDropdown.options].find(opt => opt.value === "DLT");
        if (dltVCROption) {
          SALEDropdown.removeChild(dltVCROption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchVCRDetails() {
    const sNo = document.getElementById("searchVCRSNo").value;
    const waitMessage = document.getElementById("waitVCRMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitVCRButton").style.display = "none";  //****
    try {
      const response = await fetch(`${scriptVCRURL}?sNo=${sNo}`);
      const data = await response.json();

    
    if (data.result !== "error" && data.Voucher === "SALE") {
      document.getElementById("sNo").value = data.SNo;
      document.getElementById("msaf11").value = data.Date;
      document.getElementById("msaf12").value = data.Type;
      document.getElementById("msaf13").value = data.Ledger;
      document.getElementById("msaf14").value = data.VNo;
      document.getElementById("msaf15").value = data.Reff;
      document.getElementById("msaf16").value = data.Amount;
      document.getElementById("msaf17").value = data.Weight;
      document.getElementById("msaf18").value = data.Rate;
      document.getElementById("msaf19").value = data.Narration;
      document.getElementById("msaf21").value = data.Voucher;
      //  document.getElementById("modifyVCRButton").style.display = "inline-block";


       // ✅ Add "DLT - delete" option if it doesn't exist already
const SALEDropdown = document.getElementById("msaf21");
if (![...SALEDropdown.options].some(opt => opt.value === "DLT")) {
  const dltSALEOption = document.createElement("option");
  dltSALEOption.value = "DLT";
  dltSALEOption.text = "Delete";
  dltSALEOption.style.color = "red";
  dltSALEOption.style.backgroundColor = "blue";
  SALEDropdown.appendChild(dltSALEOption);
}

       document.getElementById("formModeVCR").value = "modify"; // ✅ Set to modify

       // ✅ Show alert after successful data fetch
      alert("Select Delete Option in User Section For Delete Entry");
       
    //    document.getElementById("modifyVCRButton").style.display = "inline-block";
      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifyVCREntry() {
    const waitMessage = document.getElementById("waitVCRMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainVCRForm');

    // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampVCR').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeVCR").value = "new"; // ✅ Reset to new
       fetchData();  // ✅ Refresh dropdowns or UI
        loadSheet();
        document.getElementById("submitVCRButton").style.display = "inline-block";
        document.getElementById("modifyVCRButton").style.display = "none";

          // ✅ Remove DLT option after modify
        const SALEDropdown = document.getElementById("msaf21");
        const dltVCROption = [...SALEDropdown.options].find(opt => opt.value === "DLT");
        if (dltVCROption) {
          SALEDropdown.removeChild(dltVCROption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>
<!-- sale VOUCHER form div script stop hare -->





 <!-- ledger/jobb/reff code start hare *****************************-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ledger & Last 5 Entries</title>
  <style>
    .entry-box {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 20px 0;
      background-color: #f9f9f9;
    }
    .entry-box h4 {
      margin-top: 0;
      color: #333;
    }
  
  </style>
</head>
<body>


<script>
  let ledgerOption = [];
  let rawData = [];
  let dataHeader = [];

  async function fetchData() {
    const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
    const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
    const range = "FORM!A:K"; // Up to column K

    try {
      const response = await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
      );
      const data = await response.json();

      if (!data.values || data.values.length === 0) {
        console.warn("No data found.");
        return;
      }

      dataHeader = data.values[0];
      rawData = data.values.slice(1);

      // All unique ledger values (Column D)
      const allLedgerValues = rawData.map(row => row[3]).filter(Boolean);
      const allLedgerOptions = [...new Set(allLedgerValues)].sort((a, b) => a.localeCompare(b));

      // Filtered ledger values for TAX INVOICE (Column B)
      const taxInvoiceLedgerValues = rawData
        .filter(row => row[1] === "TAX INVOICE")
        .map(row => row[3])
        .filter(Boolean);
      const taxInvoiceOptions = [...new Set(taxInvoiceLedgerValues)].sort((a, b) => a.localeCompare(b));

      // Ledger Dropdowns
      document.querySelectorAll(".ledger-dropdown, .ledgerVCRdropdown").forEach(select => {
        select.innerHTML = '<option value="">Select Ledger</option>';

        const isMsaf13 = select.id === "msaf13";
        const optionsToUse = isMsaf13 ? taxInvoiceOptions : allLedgerOptions;

        optionsToUse.forEach(item => {
          const option = document.createElement("option");
          option.value = item;
          option.textContent = item;
          select.appendChild(option);
        });

        if (select.classList.contains("ledger-dropdown")) {
          select.addEventListener("change", function () {
            updateReffDropdown(this.value);
          });
        }
      });

      // Show last 5 entries for each type
      showLastFiveEntriesByType("RECEIPT", "receiptContainer");
      showLastFiveEntriesByType("SALE", "saleContainer");
      // showLastFiveEntriesByType("JOB/REFF", "jobReffContainer");

    } catch (error) {
      console.error("Error fetching data:", error);
      alert("Failed to fetch ledger list.");
    }
  }

  function updateReffDropdown(selectedLedger) {
    const reffSelect = document.querySelector(".Reff-dropdown");
    reffSelect.innerHTML = '<option value="">Select Job/Reff No.</option>';

    if (!selectedLedger) return;

    const reffValues = rawData
      .filter(row => row[3] === selectedLedger && row[5])
      .map(row => row[5]);

    const uniqueReffs = [...new Set(reffValues)].sort((a, b) => a.localeCompare(b));

    uniqueReffs.forEach(ref => {
      const option = document.createElement("option");
      option.value = ref;
      option.textContent = ref;
      reffSelect.appendChild(option);
    });
  }

  function showLastFiveEntriesByType(type, containerId) {
    const filtered = rawData.filter(row => row[10]?.toUpperCase() === type.toUpperCase());
    const lastFive = filtered.slice(-10).reverse();

    const container = document.getElementById(containerId);
    container.innerHTML = `<h4>Last 5 ${type} Entries</h4>`;

    if (lastFive.length === 0) {
      container.innerHTML += "<p>No entries found.</p>";
      return;
    }

    const table = document.createElement("table");

    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    dataHeader.forEach(header => {
      const th = document.createElement("th");
      th.textContent = header;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");
    lastFive.forEach(row => {
      const tr = document.createElement("tr");
      dataHeader.forEach((_, index) => {
        const td = document.createElement("td");
        td.textContent = row[index] || "";
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);

    container.appendChild(table);
  }

  document.addEventListener("DOMContentLoaded", fetchData);
</script>


</body>
</html>
 <!-- ledger/jobb/reff code stop hare *****************************-->




 

<!-- imprest voucher REPORT SCRIPT & CODE start Heare -->

<!DOCTYPE html>
<html>
<head>
    <title>IV Ledger Report</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
       

         #searchIVContainer {
            position: sticky;
            top: 0;
           left: 0;
      width: 100%;
      background: #ebecec;
      padding: 10px 20px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1000;
      color: #000;
        }

        .searchIVContainer select,
    .searchIVContainer input {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }

        .select2-container {
            flex: 1;
        }

        tr.hidden {
            display: none;
        }
        tr.receipt {
            background-color: #ffe6e6;
            color: #a10404;
        }

        tr.receipt2 {
            background-color: #ffe6e6;
            color: #5b0202;
          }
        tr.bill {
            background-color: #e6f3ff;
            color: #1d03c6;
        }
        #totalsIV {
             font-size: 20px;
            color: #f5f6f9;
            background-color: #012400;
        }
        #noResultsMessage {
            text-align: center;
            margin-top: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        async function loadIVSheet() {
            const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM"; // Replace with your API key
            const sheetId = "1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA"; // Replace with your Sheet ID
            const range = 'IVCR!W:AD'; // Replace with the correct range
    
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
                );
                const data = await response.json();
    
                if (data.values) {
                    populateIVTable(data.values);
                    populateIVDropdowns(data.values);
                } else {
                    console.error("No data found in the specified range.");
                }
            } catch (error) {
                console.error("Error fetching data from Google Sheets:", error);
            }
        }
    
        function populateIVTable(data) {
            const table = document.getElementById('myIVTable');
            table.innerHTML = ''; // Clear existing rows
    
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
    
                if (index === 0) {
                    // Header row
                    row.forEach(cell => {
                        const th = document.createElement('th');
                        th.textContent = cell;
                        tr.appendChild(th);
                    });
    

                    // Add "Running Balance" column to the header
                    const thRunningBalance = document.createElement('th');
                    thRunningBalance.textContent = 'Balance';
                    tr.appendChild(thRunningBalance);
                } else {
                    // Data rows
                    row.forEach((cell, cellIndex) => {
                        const td = document.createElement('td');
                        td.textContent = cell;
                        tr.appendChild(td);
    
                        // Add class based on "Type" column
                        if (cellIndex === 2) { // Assuming Type is in column 2
                            if (cell.toLowerCase() === "receipt") {
                                tr.classList.add('receipt');
                            } else if (cell.toLowerCase() === "receipt ") {
                                tr.classList.add('receipt2');
                            } else if (cell.toLowerCase() === "bill") {
                                tr.classList.add('bill');
                            }
                        }
                    });
    
                    // Add empty cell for "Running Balance"
                    const tdRunningBalance = document.createElement('td');
                    tdRunningBalance.classList.add('runningBalance');
                    tr.appendChild(tdRunningBalance);
                }
    
                table.appendChild(tr);
            });
    
            
        }
    
    
   
// runnin balance start hare 


        function calculateIVRunningBalance() {
    // Select only visible rows after filtering (excluding the header row)
    const rows = Array.from(document.querySelectorAll('#myIVTable tr:not(.hidden)')).slice(1); // Skip header row

    if (rows.length === 0) return; // Exit if no rows are visible

    // Get the amount from the last visible row (latest transaction)
    const lastRow = rows[rows.length - 1];
    const lastRowCells = lastRow.querySelectorAll('td');
    const lastRowTransactionType = lastRowCells[2]?.textContent.trim().toLowerCase(); // Type column
    const lastRowAmount = parseFloat(lastRowCells[5]?.textContent || 0); // Amount column

    // Start the running balance with the amount from the last row
    let runningBalance = lastRowTransactionType === "receipt" ? lastRowAmount : -lastRowAmount;

    // Update the running balance cell in the last row
    const lastRowBalanceCell = lastRow.querySelector('.runningBalance');
    if (lastRowBalanceCell) {
        lastRowBalanceCell.textContent = runningBalance.toFixed(2);
    }

    // Iterate upwards through the remaining rows
    for (let index = rows.length - 2; index >= 0; index--) {
        const row = rows[index];
        const cells = row.querySelectorAll('td');
        const transactionType = cells[2]?.textContent.trim().toLowerCase(); // Assuming "Type" column is at index 2
        const amount = parseFloat(cells[5]?.textContent || 0); // Assuming "Amount" column is at index 5

        if (!isNaN(amount)) {
            if (transactionType === "receipt") {
                runningBalance += amount; // Add for receipt
            } else if (transactionType === "payment") {
                runningBalance -= amount; // Subtract for payment
            }else if (transactionType === "bill") {
                runningBalance -= amount; // Subtract for payment
            }else if (transactionType === "salary") {
                runningBalance += amount; // Subtract for payment
            }
        }

        // Update the running balance cell
        const runningBalanceCell = row.querySelector('.runningBalance');
        if (runningBalanceCell) {
            runningBalanceCell.textContent = runningBalance.toFixed();
        }
    }
}

// running balance funtion stop
//calculateIVRunningBalance(); // Recalculate running balance after filtering


function populateIVDropdowns(data) {
    const dropdown1 = document.getElementById('filterIVColumn1');
    const dropdown2 = document.getElementById('filterIVColumn2');
    const dropdown4 = document.getElementById('filterIVColumn4');

    const uniqueValues1 = [...new Set(data.slice(1).map(row => row[1]))]; // Column 1
    const uniqueValues2 = [...new Set(data.slice(1).map(row => row[2]))]; // Column 2
    const uniqueValues4 = [...new Set(data.slice(1).map(row => row[4]))]; // Column 4

    populateIVDropdown(dropdown1, uniqueValues1);
    populateIVDropdown(dropdown2, uniqueValues2);
    populateIVDropdown(dropdown4, uniqueValues4);

    // Initialize Select2 for searchable dropdown
    $(dropdown4).select2({
        placeholder: "-- Select --",
        allowClear: true,
        width: 'resolve'
    });

    // Bind filter event for Select2
    $(dropdown4).on('change', filterIVTable);

    // Map for dropdown1 values to corresponding names
    const userMapping = {
        IV01: "User | Amarbahadur",
        IV02: "User | Vijender Sharma",
        IV03: "User | Rahul",
        IV04: "User | Raju - UK18CA3770",
        IV05: "User | Mannu - UK18CA14819",
        IV06: "User | Aakash - UK04CC1458",
        IV07: "User | Manjeet - UK18CA4818",
        IV08: "User | NITIN KUMAR",
        IV09: "User | SUNIL YADAV",
        IV10: "User | AJAY KUMAR-UK18CA4819"

        //   <div id="resultIVDiv"></div>  user name show as per your requre
    };

    // Event listener for dropdown1 to show corresponding name
    dropdown1.addEventListener('change', function () {
        const selectedValue = dropdown1.value;
        const resultIVDiv = document.getElementById('resultIVDiv');

        if (userMapping[selectedValue]) {
            resultIVDiv.textContent = userMapping[selectedValue]; // Show corresponding name
        } else {
            resultIVDiv.textContent = ""; // Clear the div if no valid option is selected
        }
    });
}

function populateIVDropdown(dropdown, values) {
    dropdown.innerHTML = '<option value="">-- Select --</option>';
    values.forEach(value => {
        const option = document.createElement('option');
        option.value = value;
        option.textContent = value;
        dropdown.appendChild(option);
    });
}




        function filterIVTable() {
            const filter1 = document.getElementById('filterIVColumn1').value.toLowerCase();
            const filter2 = document.getElementById('filterIVColumn2').value.toLowerCase();
            const filter4 = $('#filterIVColumn4').val()?.toLowerCase();
            const starIVtDate = new Date(document.getElementById("starIVtDate").value);
            const endIVDate = new Date(document.getElementById("endIVDate").value);
    
            const rows = document.querySelectorAll('#myIVTable tr');
            let visibleRows = 0;
            let totalIVPayment = 0, totalIVReceipt = 0, totalIVBill = 0, totalIVSalary = 0;

             
    
            rows.forEach((row, index) => {
                if (index === 0) return; // Skip header row
    
                const cells = row.querySelectorAll('td');
                const date = new Date(cells[3]?.textContent.trim());
                const type = cells[2]?.textContent.trim().toUpperCase();
                const amount = parseFloat(cells[5]?.textContent.trim()) || 0;
    
                // Date filter check
                let dateMatches = true;
                if (starIVtDate && date < starIVtDate) dateMatches = false;
                if (endIVDate && date > endIVDate) dateMatches = false;
    
                // Filter checks
                const matchesFilter1 = !filter1 || cells[1]?.textContent.toLowerCase() === filter1;
                const matchesFilter2 = !filter2 || cells[2]?.textContent.toLowerCase() === filter2;
                const matchesFilter4 = !filter4 || cells[4]?.textContent.toLowerCase() === filter4;
    
                if (matchesFilter1 && matchesFilter2 && matchesFilter4 && dateMatches) {
                    row.classList.remove('hidden');
                    visibleRows++;
    
                    // Update totalsIV based on type
                    if (type === "PAYMENT") {
                        totalIVPayment += amount;
                    } else if (type === "RECEIPT") {
                        totalIVReceipt += amount;
                    } else if (type === "BILL") {
                        totalIVBill += amount;
                    } else if (type === "SALARY") {
                        totalIVSalary += amount;
                    }
                } else {
                    row.classList.add('hidden');
                }
            });
    
            displayIVNoResultsMessage(visibleRows);
            updateIVTotals(totalIVPayment, totalIVReceipt, totalIVBill, totalIVSalary);

           
           // running balance show after latest filter table 
            // Filtering logic here...
            calculateIVRunningBalance(); // Recalculate running balance after filtering


        }
    
        function displayIVNoResultsMessage(visibleRows) {
            const noResultsMessage = document.getElementById('noResultsMessage');
            if (!visibleRows) {
                if (!noResultsMessage) {
                    const message = document.createElement('p');
                    message.id = 'noResultsMessage';
                    message.textContent = 'No matching results found.';
                    document.body.appendChild(message);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }
    
        function updateIVTotals(totalIVPayment, totalIVReceipt, totalIVBill, totalIVSalary) {
            document.getElementById("totalIVPayment").textContent = totalIVPayment.toFixed();
            document.getElementById("totalIVReceipt").textContent = totalIVReceipt.toFixed();
            document.getElementById("totalIVBill").textContent = totalIVBill.toFixed();
            document.getElementById("totalIVSalary").textContent = totalIVSalary.toFixed();
            document.getElementById("totalIVDifference").textContent = (totalIVReceipt - totalIVPayment - totalIVBill + totalIVSalary).toFixed();
        }
    

        function printIVTable() {
    let printWindow = window.open('', '', 'height=500, width=800');

    const styles = `
        <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 12px; text-align: left; }
            table th, table td { border: 1px solid #ddd; padding: 5px; }
            table th { background-color: #f4f4f4; font-weight: bold; }
            table tr.payment { background-color: white; color: black; }
            table tr.receipt { background-color: blac; color: red; }
            table tr.bill { background-color: blac; color: blue; }
            .filter-summary { margin: 10px 0; font-size: 14px; }
            .filter-summary span { display: inline-block; margin-right: 20px; }
        </style>
    `;

    // Fetch filter values
    const ledger = document.getElementById("filterIVColumn4").value || "All";
    const starIVtDate = document.getElementById("starIVtDate").value || "Not Set";
    const endIVDate = document.getElementById("endIVDate").value || "Not Set";
    const user = document.getElementById("filterIVColumn1").value || "All";
    const voucher = document.getElementById("filterIVColumn2").value || "All";

    // Create a summary of filter options
    const filterSummary = `
        <div class="filter-summary">
            <span><strong>Ledger:</strong> ${ledger}</span>
            <span><strong>From:</strong> ${starIVtDate}</span>
            <span><strong>To:</strong> ${endIVDate}</span>
            <span><strong>User:</strong> ${user}</span>
            <span><strong>Voucher:</strong> ${voucher}</span>
        </div>
    `;

    // Clone the table and remove hidden rows
    let table = document.getElementById("myIVTable");
    let tableClone = table.cloneNode(true);

    let rows = tableClone.querySelectorAll('tr');
    rows.forEach((row) => {
        if (row.classList.contains('hidden')) {
            row.remove(); // Remove hidden rows from the cloned table
        } else {
            // Retain only the first 7 columns for each row
            while (row.cells.length > 9) {
                row.deleteCell(7); // Remove extra columns starting from index 7
            }
        }
    });

    // Start writing to the print window
    printWindow.document.write('<html><head><title>🖨️ Print</title></head><body>');
    printWindow.document.write(styles);
   
    printWindow.document.write('<span style="color:grey;font-size:70%;font-family:Magneto;">eS|MTally</span> <br/> <span style="color:black;font-size:120%;font-family:Arial;">MIPL Cash Management</span>'); // Optional title
 
    printWindow.document.write(filterSummary); // Add the filter summary to the print view

    // Add totalsIV section
    printWindow.document.write(document.getElementById("totalsIV").outerHTML);

    // Write the cloned table with only visible rows and limited columns
    printWindow.document.write(tableClone.outerHTML);

    // Close and print
    printWindow.document.close();
    printWindow.print();
}







      //  window.onload = () => {
        //    loadIVSheet();
     //       document.getElementById('filterIVColumn1').addEventListener('change', filterIVTable);
       //     document.getElementById('filterIVColumn2').addEventListener('change', filterIVTable);
      //      document.getElementById('starIVtDate').addEventListener('change', filterIVTable);
      //      document.getElementById('endIVDate').addEventListener('change', filterIVTable);
   //     };
    </script>


</head>
</html>


<!-- imprest voucher REPORT SCRIPT & CODE STOP Heare -->






 <!-- IVCR form div script start hare -->
<script>
  const scriptIVCRURL = 'https://script.google.com/macros/s/AKfycbz-lyd06EKKSO4xVaTSRWoIgMWS0C9nZvzipEP59K25TZSOSdL5CMpYJNPgmF1nyyGrXg/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainIVCRForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeIVCR").value; //****
    const submitIVCRButton = document.getElementById("submitIVCRButton");
    submitIVCRButton.disabled = true;
    submitIVCRButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampIVCR').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifyIVCREntry();
    } else {
      await submitIVCREntry(form);
    }

    submitIVCRButton.disabled = false;
    submitIVCRButton.value = "Submit";
  });

  async function submitIVCREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptIVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset(); // FORM RESET
        document.getElementById("formModeIVCR").value = "new";
        loadIVCRSheet(); //REFRESH
         loadIVSheet();  // REFRESH

           // ✅ Remove DLT option after submit
        const voucherDropdown = document.getElementById("voucherType");
        const dltOption = [...voucherDropdown.options].find(opt => opt.value === "DLT");
        if (dltOption) {
          voucherDropdown.removeChild(dltOption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchIVCRDetails() {
    const sNo = document.getElementById("searchIVCRSNo").value;
    const waitMessage = document.getElementById("waitIVCRMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitIVCRButton").style.display = "none";  //****
    try {
      const response = await fetch(`${scriptIVCRURL}?sNo=${sNo}`);
      const data = await response.json();

       if (data.Voucher === "IV03" || data.Voucher === "IV04" ||data.Voucher === "IV05" || data.Voucher === "IV06"|| data.Voucher === "IV07"|| data.Voucher === "IV08"|| data.Voucher === "IV09") {
        document.getElementById("sNo").value = data.SNo;
        document.getElementById("voucherType").value = data.Voucher;
        document.getElementById("ivcr0").value = data.Type;
        document.getElementById("ivcr1").value = data.Date;
        document.getElementById("dropdownIVCRSearch").value = data.Ledger;
        document.getElementById("ivcr2").value = data.Amount;
        document.getElementById("ivcr3").value = data.Narration;
      //  document.getElementById("modifyIVCRButton").style.display = "inline-block";


       // ✅ Add "DLT - delete" option if it doesn't exist already
const voucherDropdown = document.getElementById("voucherType");
if (![...voucherDropdown.options].some(opt => opt.value === "DLT")) {
  const deleteOption = document.createElement("option");
  deleteOption.value = "DLT";
  deleteOption.text = "Delete";
  deleteOption.style.color = "red";
  deleteOption.style.backgroundColor = "blue";
  voucherDropdown.appendChild(deleteOption);
}

       document.getElementById("formModeIVCR").value = "modify"; // ✅ Set to modify
    //    document.getElementById("modifyIVCRButton").style.display = "inline-block";

    // ✅ Show alert after successful data fetch
      alert(" Select Delete Option in User Section For Delete Entry");

      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifyIVCREntry() {
    const waitMessage = document.getElementById("waitIVCRMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainIVCRForm');

    // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampIVCR').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptIVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeIVCR").value = "new"; // ✅ Reset to new
      loadIVCRSheet(); //REFRESH
         loadIVSheet();  // REFRESH
        document.getElementById("submitIVCRButton").style.display = "inline-block";
        document.getElementById("modifyIVCRButton").style.display = "none";

          // ✅ Remove DLT option after modify
        const voucherDropdown = document.getElementById("voucherType");
        const dltOption = [...voucherDropdown.options].find(opt => opt.value === "DLT");
        if (dltOption) {
          voucherDropdown.removeChild(dltOption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>
<!-- IVCR form div script stop hare -->





 <!-- IMPREST VOUCHER FORM LEDGER DROPDOWN & TABLE CODE START -->
<!DOCTYPE html>
<html>
<head>
  <title>Ledger Filter</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }
    th {
      background-color: #333;
      color: white;
    }
     table tr:hover {
            background-color: #011d30 ; color: white;
        }
    tr.receipt { background-color: #ffe6e6; color: #a10404; }
    tr.bill { background-color: #e6f3ff; color: #1d03c6; }
    .runningBalance { font-weight: bold; }

      .dropdown-container {
    position: relative;
    margin-top: 20px;
  }

  #dropdownIVCRSearch {
    width: 3in;
  }

  ul.dropdownCSSlist {
    display: none;
    list-style: none;
    padding: 0;
    margin: 0;
    border: 1px solid #ccc;
    max-height: 8in; /* ✅ 8-inch height */
    overflow-y: auto;
    background: white;
    position: absolute;
    z-index: 10;
    width: 4in;
  }

  ul.dropdownCSSlist li {
    padding: 5px;
    cursor: pointer;
  }

  ul.dropdownCSSlist li:hover {
    background-color: #ddd;
  }
  </style>
</head>
<body>



 
  <script>
    let fulivcrData = [];

    async function loadIVCRSheet() {
      const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
      const sheetId = "1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA";
      const range = 'IVCR!W:AD';

      try {
        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`);
        const data = await response.json();
        if (data.values) {
          fulivcrData = data.values;
          updateIVCRTableAndDropdown();
        }
      } catch (err) {
        console.error("Error fetching Google Sheets data:", err);
      }
    }

    function updateIVCRTableAndDropdown() {
      const selectedVoucher = document.getElementById('ivuser').value;
      const filteredData = fulivcrData.filter((row, i) => i === 0 || row[1] === selectedVoucher);
      populateDropdownList(filteredData);
      populateIVCRTable(filteredData);
    }

    function populateDropdownList(data) {
      const ul = document.getElementById("dropdownIVCRList");
      ul.innerHTML = '';
      const uniqueValues = [...new Set(data.slice(1).map(row => row[4]))];

      uniqueValues.forEach(value => {
        const li = document.createElement("li");
        li.textContent = value;
        li.onclick = () => {
          document.getElementById('dropdownIVCRSearch').value = value;
          ul.style.display = "none";
          const filtered = data.filter((row, i) => i === 0 || row[4] === value);
          populateIVCRTable(filtered);
        };
        ul.appendChild(li);
      });
    }

   function filterIVCRDropdown() {
  const searchInput = document.getElementById("dropdownIVCRSearch");
  const list = document.getElementById("dropdownIVCRList");
  const searchVal = searchInput.value.toLowerCase();

  if (searchVal === "") {
    list.style.display = "none";
    return;
  }

  let found = false;
  const items = list.querySelectorAll("li");
  items.forEach(item => {
    const match = item.textContent.toLowerCase().includes(searchVal);
    item.style.display = match ? "block" : "none";
    if (match) found = true;
  });

  list.style.display = found ? "block" : "none";
}

function populateDropdownList(data) {
  const ul = document.getElementById("dropdownIVCRList");
  ul.innerHTML = '';
  const uniqueValues = [...new Set(data.slice(1).map(row => row[4]))];

  uniqueValues.forEach(value => {
    const li = document.createElement("li");
    li.textContent = value;

    // When clicked, just fill the input, DO NOT filter the table
    li.onclick = () => {
      document.getElementById('dropdownIVCRSearch').value = value;
      ul.style.display = "none";
      // 🔴 No effect on the table
    };

    ul.appendChild(li);
  });
}


    function populateIVCRTable(data) {
      const table = document.getElementById("myIVCRTable");
      table.innerHTML = '';

      data.forEach((row, index) => {
        const tr = document.createElement("tr");
        if (index === 0) {
          row.forEach(cell => {
            const th = document.createElement("th");
            th.textContent = cell;
            tr.appendChild(th);
          });
          const th = document.createElement("th");
          th.textContent = "Balance";
          tr.appendChild(th);
        } else {
          row.forEach((cell, idx) => {
            const td = document.createElement("td");
            td.textContent = cell;
            tr.appendChild(td);

            if (idx === 2) {
              const type = cell.trim().toLowerCase();
              if (type === 'receipt') tr.classList.add('receipt');
              if (type === 'bill') tr.classList.add('bill');
            }
          });
          const td = document.createElement("td");
          td.className = "runningBalance";
          tr.appendChild(td);
        }
        table.appendChild(tr);
      });

      calculateIVCRRunningBalance();
    }

    function calculateIVCRRunningBalance() {
      const rows = Array.from(document.querySelectorAll("#myIVCRTable tr")).slice(1);
      if (rows.length === 0) return;

      let lastRow = rows[rows.length - 1];
      let cells = lastRow.querySelectorAll('td');
      let amount = parseFloat(cells[5]?.textContent || 0);
      let type = cells[2]?.textContent.trim().toLowerCase();

      let balance = (type === 'receipt') ? amount : -amount;
      cells[cells.length - 1].textContent = balance.toFixed(2);

      for (let i = rows.length - 2; i >= 0; i--) {
        const row = rows[i];
        const tds = row.querySelectorAll('td');
        const amt = parseFloat(tds[5]?.textContent || 0);
        const typ = tds[2]?.textContent.trim().toLowerCase();

        if (!isNaN(amt)) {
          if (typ === 'receipt' || typ === 'salary') balance += amt;
          else if (typ === 'payment' || typ === 'bill') balance -= amt;
        }
        tds[tds.length - 1].textContent = balance.toFixed();
      }
    }

    document.getElementById("ivuser").addEventListener("change", updateIVCRTableAndDropdown);

    // Hide dropdown when clicking outside
    document.addEventListener('click', function (e) {
      const searchBox = document.getElementById("dropdownIVCRSearch");
      const list = document.getElementById("dropdownIVCRList");
      if (!searchBox.contains(e.target) && !list.contains(e.target)) {
        list.style.display = "none";
      }
    });

  //  window.onload = loadIVCRSheet;
  </script>

</body>
</html>

  
 <!-- IMPREST VOUCHER FORM LEDGER DROPDOWN & TABLE CODE STOP -->

  





 
            
<!-- job/reff VOUCHER form div script start hare -->
<script>
  const scriptREFFNOURL = 'https://script.google.com/macros/s/AKfycbw0xCIuyevQ3rXPs_sa-9yQGZ50eSIFGMwta7Rq0GqEXHCWDJqi5e4xvdE1hh1NSdU/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainREFFNOForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeREFFNO").value; //****
    const submitREFFNOButton = document.getElementById("submitREFFNOButton");
    submitREFFNOButton.disabled = true;
    submitREFFNOButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampREFFNO').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifyREFFNOEntry();
    } else {
      await submitREFFNOEntry(form);
    }

    submitREFFNOButton.disabled = false;
    submitREFFNOButton.value = "Submit";
  });

  async function submitREFFNOEntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptREFFNOURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset(); // FORM RESET
        document.getElementById("formModeREFFNO").value = "new";
        jobbJBload(); // Reload dropdowns or table if needed
         fetchData();  // ✅ Refresh dropdowns or UI
         jobbPOReffload(); //

           // ✅ Remove DLT option after submit
        const jobreffDropdown = document.getElementById("msaf70");
        const dltJOBOption = [...jobreffDropdown.options].find(opt => opt.value === "DLT");
        if (dltJOBOption) {
          jobreffDropdown.removeChild(dltJOBOption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchREFFNODetails() {
    const sNo = document.getElementById("searchREFFNOSNo").value;
    const waitMessage = document.getElementById("waitREFFNOMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitREFFNOButton").style.display = "none";  //****
    try {
      const response = await fetch(`${scriptREFFNOURL}?sNo=${sNo}`);
      const data = await response.json();

      if (data.result !== "error" && (data.Type === "PRAKHAR" || data.Type === "HARSHIT")) {
        document.getElementById("sNo").value = data.SNo;
        document.getElementById("msaf70").value = data.Voucher;
        document.getElementById("msaf71").value = data.Type;
        document.getElementById("msaf72").value = data.Date;
        document.getElementById("msaf73").value = data.Ledger;
        document.getElementById("msaf74").value = data.VNo;
        document.getElementById("msaf75").value = data.Reff;
        document.getElementById("msaf76").value = data.Amount;
        document.getElementById("msaf77").value = data.Weight;
      //  document.getElementById("modifyREFFNOButton").style.display = "inline-block";


       // ✅ Add "DLT - delete" option if it doesn't exist already
const jobreffDropdown = document.getElementById("msaf70");
if (![...jobreffDropdown.options].some(opt => opt.value === "DLT")) {
  const dltOptionJOBREFF = document.createElement("option");
  dltOptionJOBREFF.value = "DLT";
  dltOptionJOBREFF.text = "Delete";
  dltOptionJOBREFF.style.color = "red";
  dltOptionJOBREFF.style.backgroundColor = "blue";
  jobreffDropdown.appendChild(dltOptionJOBREFF);
}

       document.getElementById("formModeREFFNO").value = "modify"; // ✅ Set to modify
    //    document.getElementById("modifyREFFNOButton").style.display = "inline-block";

    // ✅ Show alert after successful data fetch
      alert(" Select Delete Option in User Section For Delete Entry");

      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifyREFFNOEntry() {
    const waitMessage = document.getElementById("waitREFFNOMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainREFFNOForm');

    // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampREFFNO').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptREFFNOURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeREFFNO").value = "new"; // ✅ Reset to new
      
         jobbJBload(); // Reload dropdowns or table if needed
         fetchData();  // ✅ Refresh dropdowns or UI
         jobbPOReffload(); //
        document.getElementById("submitREFFNOButton").style.display = "inline-block";
        document.getElementById("modifyREFFNOButton").style.display = "none";

          // ✅ Remove DLT option after modify
        const jobreffDropdown = document.getElementById("msaf71");
        const dltJOBOption = [...jobreffDropdown.options].find(opt => opt.value === "DLT");
        if (dltJOBOption) {
          jobreffDropdown.removeChild(dltJOBOption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>

<!-- job/reff VOUCHER form div script stop hare -->


<!-- job/reff TOP 10 ENTRY WITH TOTAL JOB BY USER script START hare -->

<script>
   let sheetJRdata = []; // Store filtered and sorted data

// Function to load the data from Google Sheets
async function jobbPOReffload() {
    const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
    const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
    const range = 'FORM!A:N';
    const jobRefResultsDiv = document.getElementById("jobRefResults");

    try {
        jobRefResultsDiv.innerHTML = "<p>Loading job reference data...</p>";

        const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
        );
        const data = await response.json();

        if (data.values) {
            // Filter and store only the entries where column K (index 10) is "JOB/REFF"
            sheetJRdata = data.values.filter(row => row.length > 10 && row[10] === "JOB/REFF");

            // Sort the filtered data by column A (index 0) in descending order
            sheetJRdata.sort((a, b) => (b[0] > a[0] ? 1 : -1));

            console.log("Filtered and Sorted Data:", sheetJRdata);

            // Display results and summary
            displayJOBNOResults(getFilteredJOBNOData("latestEntry"));
            displayJOBNOSummary();

            // Update `jobRefResults` div with summary
            jobRefResultsDiv.innerHTML = `
                <p><strong>Total Job/Ref:</strong> ${sheetJRdata.length}</p>
                <p><strong>Last Updated:</strong> ${new Date().toLocaleString()}</p>
            `;
        } else {
            jobRefResultsDiv.innerHTML = "<p>No data found in the specified range.</p>";
            console.error("No data found in the specified range.");
        }
    } catch (error) {
        jobRefResultsDiv.innerHTML = "<p>Error loading data.</p>";
        console.error("Error fetching data from Google Sheets:", error);
    }
}

// Function to handle the dropdown selection
function jobPOreffDropdown() {
    const filterType = document.getElementById("filterType").value;
    displayJOBNOResults(getFilteredJOBNOData(filterType));
}

// Function to filter data based on the selected option
function getFilteredJOBNOData(filterType) {
    let filteredData = [];
    switch (filterType) {
        case "latestEntry":
            filteredData = sheetJRdata.slice(0, 10); // Get last 10 entries
            break;
        case "allJobreff":
            filteredData = sheetJRdata; // Show all "JOB/REFF" entries
            break;
        case "userHarshit":
            filteredData = sheetJRdata.filter(row => row.length > 1 && row[1].toLowerCase() === "harshit");
            break;
        case "userPrakhar":
            filteredData = sheetJRdata.filter(row => row.length > 1 && row[1].toLowerCase() === "prakhar");
            break;
    }
    return filteredData;
}

// Function to display the filtered results in a table
function displayJOBNOResults(entries) {
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    if (entries.length === 0) {
        resultsDiv.innerHTML = "<p>No matching records found.</p>";
        return;
    }

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const tbody = document.createElement("tbody");

    // Create table header
    const headerRow = document.createElement("tr");
    const headers = ["S.No", "User", "Order By", "Client Name", "Firm Name/Details", "Address", "Job/Reff No.", "Status", "View Order", "Description", "Job/Reff No."];
    headers.forEach(headerText => {
        const th = document.createElement("th");
        th.textContent = headerText;
        headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    // Create table body with filtered entries
    entries.forEach(entry => {
        const row = document.createElement("tr");

        entry.forEach((cell, index) => {
            const td = document.createElement(index === 0 ? 'th' : 'td');

            // If the cell is a URL, make it clickable
            if (typeof cell === "string" && (cell.startsWith('http') || cell.startsWith('www'))) {
                const a = document.createElement('a');
                a.href = cell;
                a.innerHTML = "&#128221;"; // Icon (📑)
                a.target = "_blank";
                td.appendChild(a);
            } else {
                td.textContent = cell;
            }

            row.appendChild(td);
        });

        tbody.appendChild(row);
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    resultsDiv.appendChild(table);
}

// Function to display the summary of "Prakhar" and "Harshit" counts
function displayJOBNOSummary() {
    const summaryDiv = document.getElementById("summary");
    
    const prakharCount = sheetJRdata.filter(row => row.length > 1 && row[1].toLowerCase() === "prakhar").length;
    const harshitCount = sheetJRdata.filter(row => row.length > 1 && row[1].toLowerCase() === "harshit").length;

    summaryDiv.innerHTML = `
        <p><strong>Total Project By Prakhar:</strong> ${prakharCount}</p>
        <p><strong>Total Project By Harshit:</strong> ${harshitCount}</p>
    `;
}

// Run on page load
//  window.onload = jobbPOReffload;
</script>




<!-- job/reff TOP 10 ENTRY WITH TOTAL JOB BY USER  script stop hare -->


<!-- job/reff  filter code start hare -- -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JOB/REFF</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
     
    }

    .filterJBcontainer {
     position: fixed;
      top: 50;
      left: 0;
      width: 100%;
      background: #ebecec;
      padding: 10px 20px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1000;
    
    }

    .filterJBcontainer label {
      font-weight: bold;
    }

    .filterJBcontainer select,
    .filterJBcontainer input {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }
/* Table content */
    .contentJB {
      margin-top: 60px;
      padding: 0 20px;
    }

    

    .pending { background-color: rgb(218, 218, 248); }
    .canceled { background-color: rgb(246, 220, 220); }
    .complete { background-color: #d4f7d4; }
    .running { background-color: rgb(243, 243, 241); }

    #jbSummaryBox {
      /*  margin-top: 60px;*/
      padding: 10px 20px;
      font-size: 16px;
      font-weight: bold;
      color: black;
    }

    .print-btn {
      padding: 8px 12px;
      border: none;
      background-color: #0077b6;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }

    .print-btn:hover {
      background-color: #005f8c;
    }
  </style>
</head>


  <script>
  let sheetJBdata = [];
  let uniqueUsers = new Set();
  let uniqueOrderBy = new Set();
  let uniqueTypes = new Set();

  async function jobbJBload() {
    const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
    const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
    const range = 'POINDEX!E:O';

    try {
      const response = await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
      );
      const data = await response.json();

      if (data.values) {
        sheetJBdata = data.values.filter(row => row.length > 10 && row[10] === "JOB/REFF");

        sheetJBdata.sort((a, b) => b[0].localeCompare(a[0], undefined, { numeric: true }));

        sheetJBdata.forEach(row => {
          if (row.length > 1) uniqueUsers.add(row[1]);
          if (row.length > 2) uniqueOrderBy.add(row[2]);
          if (row.length > 7) uniqueTypes.add(row[7]);
        });

        populateJBDropdown("userFilter", uniqueUsers);
        populateJBDropdown("orderByFilter", uniqueOrderBy);
        populateJBDropdown("typeFilter", uniqueTypes);

        displayJBResults(sheetJBdata);
      }
    } catch (error) {
      console.error("Error fetching data from Google Sheets:", error);
    }
  }

  function populateJBDropdown(dropdownId, values) {
    const dropdown = document.getElementById(dropdownId);
    dropdown.innerHTML = '<option value="">All</option>';
    values.forEach(value => {
      const option = document.createElement("option");
      option.value = value;
      option.textContent = value;
      dropdown.appendChild(option);
    });
  }

  function filterJBData() {
    const selectedUser = document.getElementById("userFilter").value.toLowerCase();
    const selectedOrderBy = document.getElementById("orderByFilter").value.toLowerCase();
    const selectedType = document.getElementById("typeFilter").value.toLowerCase();
    const searchKeyword = document.getElementById("searchBox").value.toLowerCase();

    const filteredData = sheetJBdata.filter(row => {
      const userMatch = !selectedUser || row[1].toLowerCase() === selectedUser;
      const orderByMatch = !selectedOrderBy || row[2].toLowerCase() === selectedOrderBy;
      const typeMatch = !selectedType || row[7].toLowerCase() === selectedType;
      const keywordMatch = !searchKeyword || row.some(cell => String(cell).toLowerCase().includes(searchKeyword));
      return userMatch && orderByMatch && typeMatch && keywordMatch;
    });

    displayJBResults(filteredData);
  }

  function displayJBResults(entries) {
    const resultsDiv = document.getElementById("resultsJB");
    const summaryDiv = document.getElementById("jbSummaryBox");
    resultsDiv.innerHTML = "";
    summaryDiv.innerHTML = "";

    if (entries.length === 0) {
      resultsDiv.innerHTML = "<p>No matching records found.</p>";
      return;
    }

    // Count statuses
    let completedCount = 0, pendingCount = 0, canceledCount = 0, runningCount = 0;
    entries.forEach(entry => {
      const status = entry[7]?.toLowerCase();
      if (status === "pending") pendingCount++;
      else if (status === "canceled") canceledCount++;
      else if (status === "completed") completedCount++;
      else if (status === "running") runningCount++;
    });

    // Display summary
    summaryDiv.innerHTML = `
      ✅ Completed: <span class="complete">${completedCount}</span> |
      ⏳ Pending: <span class="pending">${pendingCount}</span> |
      ❌ Canceled: <span class="canceled">${canceledCount}</span> |
      🔄 Running: <span class="running">${runningCount}</span>
    `;

    // Table headers (without S.No)
    const headers = ["S.No.","User", "Order By", "Firm/Ledger Name", "Address", "Contect Details", "Job/Reff No.", "Status", "View Order", "Running Bill Status", "Type"];
    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    headers.forEach(headerText => {
      const th = document.createElement("th");
      th.textContent = headerText;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    // Table body
    const tbody = document.createElement("tbody");
    entries.forEach(entry => {
      const tr = document.createElement("tr");

      entry.forEach((cell, cellIndex) => {
        const td = createCell(cell, "td");

        // Add row class based on Status (index 7)
        if (cellIndex === 7) {
          const cellText = cell.toLowerCase();
          if (cellText === "pending") tr.classList.add("pending");
          else if (cellText === "canceled") tr.classList.add("canceled");
          else if (cellText === "completed") tr.classList.add("complete");
          else if (cellText === "running") tr.classList.add("running");
        }

        tr.appendChild(td);
      });

      tbody.appendChild(tr);
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    resultsDiv.appendChild(table);
  }

  function createCell(value, type) {
    const cell = document.createElement(type);
    if (typeof value === "string" && (value.startsWith("http") || value.startsWith("www"))) {
      const link = document.createElement("a");
      link.href = value;
      link.innerHTML = "🔗";
      link.target = "_blank";
      cell.appendChild(link);
    } else {
      cell.textContent = value;
    }
    return cell;
  }

  function printJBTable() {
    const printWindow = window.open('', '', 'width=800,height=600');
    const tableHTML = document.getElementById("resultsJB").innerHTML;

    printWindow.document.write(`
      <html>
      <head>
        <title>Print Table</title>
        <style>
          body { font-family: Arial, sans-serif; text-align: center; }
          table { width: 100%; border-collapse: collapse; margin-top: 10px; }
          th, td { padding: 10px; border: 1px solid black; text-align: center; }
          th { background: #0077b6; color: white; font-weight: bold; }
          .complete { background-color: #d4f7d4; }
          .pending { background-color: rgb(205, 205, 252); }
          .canceled { background-color: rgb(243, 194, 194); }
          .running { background-color: rgb(252, 252, 181); }
        </style>
      </head>
      <body>
        <h2>Job | Reff Status</h2>
        ${tableHTML}
        <script>window.onload = () => { window.print(); window.close(); }<\/script>
      </body>
      </html>
    `);
    printWindow.document.close();
  }

//  window.onload = jobbJBload;
</script>

</body>
</html>
<!-- job/reff  filter code stop hare (code506) -->







 <!-- mainSRRForm  code start hare -->


             <!-- SRR form div script start hare -->
             <script>
                const scriptSRRURL = 'https://script.google.com/macros/s/AKfycbxNCtOS7UZu2mw_Zuwkx-KHdORL1DATDoSp0Gv2Q5EQw6CKJOSPowawczVE_7uYHQw_/exec';
              
                document.addEventListener("submit", async function (e) {
                  const form = e.target;
                  if (form.id !== "mainSRRForm") return;
              
                  e.preventDefault();
                   const formMode = document.getElementById("formModeSRR").value;   //****
                  const submitSRRButton = document.getElementById("submitSRRButton");
                  submitSRRButton.disabled = true;
                  submitSRRButton.value = "Wait..";
              
                  const now = new Date();
                  document.getElementById('timestampSRR').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
              
                  const formInputs = form.querySelectorAll('input, textarea');
                  formInputs.forEach(input => {
                    if (input.type === 'text' || input.type === 'textarea') {
                      input.value = input.value.toUpperCase();
                    }
                  });
                  //
              
                 if (formMode === "modify") {
      await modifySRREntry();
    } else {
      await submitSRREntry(form);
    }

    submitSRRButton.disabled = false;
    submitSRRButton.value = "Submit";
  });

  async function submitSRREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptSRRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset();
        document.getElementById("formModeSRR").value = "new";
        filterDp();
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
   //           
                async function fetchSRRDetails() {
                  const sNo = document.getElementById("searchSRRSNo").value;
                  const waitMessage = document.getElementById("waitSRRMessage");
                  waitMessage.innerText = "Fetching data... Please wait...";
                  waitMessage.style.display = 'block';
              

                   // 🔻 HIDE SUBMIT BUTTON WHEN FETCH STARTS
          //    document.getElementById("submitSRRButton").style.display = "none";

                  try {
                    const response = await fetch(`${scriptSRRURL}?sNo=${sNo}`);
                    const data = await response.json();
              
                    if (data.result !== "error" && data.User === "STORE") {
                      document.getElementById("sNo").value = data.SNo;
                      document.getElementById("msaf91").value = data.User;
                      document.getElementById("dropdownSRRSearch").value = data.Ledger;
                      document.getElementById("msaf92").value = data.Date;
                      document.getElementById("msaf93").value = data.cl1;
                      document.getElementById("msaf94").value = data.cl2;
                      document.getElementById("msaf95").value = data.cl3;
                      document.getElementById("msaf96").value = data.cl4;
                      document.getElementById("msaf97").value = data.cl5;
                      document.getElementById("msaf98").value = data.cl6;
                      document.getElementById("msaf99").value = data.cl7;
                     
                        document.getElementById("formModeSRR").value = "modify"; // ✅ Set to modify   ****
             //         document.getElementById("modifySRRButton").style.display = "inline-block";  // Show modify
                    } else {
                      alert("No record found for the given S.No. with Type 'SHEKHER'.");
                    }
                  } catch (error) {
                    console.error("Error fetching details:", error);
                    alert("Please reconcile details or contact admin.");
                  } finally {
                    setTimeout(() => waitMessage.style.display = 'none', 2000);
                  }
                }
              
                async function modifySRREntry() {

                  const waitMessage = document.getElementById("waitSRRMessage");
                   waitMessage.innerText = "Please wait...";
                     waitMessage.style.display = "block";

                 const form = document.getElementById('mainSRRForm');

                 // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampSRR').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
//
                const formData = new FormData(form);
                formData.set('SNo', document.getElementById('sNo').value);
                     try {
              const response = await fetch(scriptSRRURL, { method: 'POST', body: formData });
               const result = await response.json();

               if (result.result === 'success') {
               alert('Entry modified successfully!');
                document.getElementById("formModeSRR").value = "new"; // ✅ Reset to new
               form.reset(); // ✅ Reset form
       filterDp();  // ✅ Refresh 
      document.getElementById("submitSRRButton").style.display = "inline-block"; // ✅ Show submit button
      document.getElementById("modifySRRButton").style.display = "none";         // ✅ Hide modify button
    } else {
      alert(`Error modifying entry: ${result.error}`);
    }
  } catch (error) {
    alert(`Error: ${error.message}`);
  } finally {
    setTimeout(() => waitMessage.style.display = 'none', 2000); // ✅ Hide wait message
  }
}


              </script>
 <!-- mainSRRForm body code stop hare -->

       
<!-- STOCK RAGISTER TABLE AND LEDGER SERCH BAR CODE AND SCRIPT START -->
              
                           <style>
                            .dropdown-container {
                                position: relative;
                                width: 250px;
                            }
                            
                            #dropdownSRRSearch {
                                width: 100%;
                                padding: 8px;
                                border: 1px solid #ccc;
                                border-radius: 5px;
                            }
                            
                            .dropdown-list {
                                position: absolute;
                                width: 4in;
                                background: white;
                                color: black;
                                border: 1px solid #ccc;
                                max-height: 500px;
                                overflow-y: auto;
                                display: none;
                                z-index: 1000;
                                list-style: none;
                                padding: 0;
                                margin: 0;
                                
                            }
                            
                            .dropdown-list.show {
                                display: block;
                            }
                            
                            .dropdown-list li {
                                padding: 8px;
                                cursor: pointer;
                                border-bottom: 1px solid #ddd;
                            }
                            
                            .dropdown-list li:hover {
                                background: #f0f0f0;
                            }
                            
                            /* Hide last border */
                            .dropdown-list li:last-child {
                                border-bottom: none;
                            }

                            
                            </style>
                            


<script>
    let columnSRRData = [];
    let allStoreData = [];
    let tableData = [];

    async function filterDp() {
        const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
        const sheetId = "1wvsPdAQA57HxhTxA3cCcQvUEz93IWkBre_Ix-qvzwss";
        const range = 'FORM!A:L';

        try {
            const response = await fetch(
                `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
            );
            const data = await response.json();

            if (data.values) {
                columnSRRData = [];
                allStoreData = [];

                const seenValues = new Set();

                data.values.forEach((row, index) => {
                    if (index !== 0) {
                        const value = row[3];
                        const type = row[1]?.trim().toUpperCase();

                        if (value && !seenValues.has(value)) {
                            seenValues.add(value);
                            columnSRRData.push(value);
                        }

                        if (type === "STORE") {
                            allStoreData.push({ indexNo: index, row });
                        }
                    }
                });

                // Show all data (no limit to 10 entries)
                tableData = allStoreData.reverse();

                populatedpDropdown();
                populatedpTable();
            } else {
                console.error("No data found in the specified range.");
            }
        } catch (error) {
            console.error("Error fetching data from Google Sheets:", error);
        }
    }

    function populatedpDropdown() {
        const dropdownList = document.getElementById("dropdownList");
        dropdownList.innerHTML = "";

        columnSRRData.forEach(option => {
            const li = document.createElement("li");
            li.textContent = option;
            li.onclick = function () {
                document.getElementById("dropdownSRRSearch").value = option;
                dropdownList.classList.remove("show");
                filterByDropdownSelection();
            };
            dropdownList.appendChild(li);
        });
    }

    function filterDropdown() {
        const input = document.getElementById("dropdownSRRSearch").value.toLowerCase().trim();
        const dropdownList = document.getElementById("dropdownList");
        dropdownList.innerHTML = "";

        // Filter only dropdown options (columnSRRData)
        const filteredDropdown = columnSRRData.filter(item =>
            item.toLowerCase().includes(input)
        );

        if (filteredDropdown.length > 0) {
            dropdownList.classList.add("show");
            filteredDropdown.forEach(option => {
                const li = document.createElement("li");
                li.textContent = option;
                li.onclick = function () {
                    document.getElementById("dropdownSRRSearch").value = option;
                    dropdownList.classList.remove("show");
                    filterByDropdownSelection();
                };
                dropdownList.appendChild(li);
            });
        } else {
            dropdownList.classList.remove("show");
        }

        // Table search across ALL cells
        const filteredTable = allStoreData.filter(item =>
            item.row.some(cell =>
                cell?.toLowerCase().includes(input)
            )
        );

        tableData = filteredTable;
        renderFilteredSRRTable(filteredTable);
    }

    function filterByDropdownSelection() {
        const selectedValue = document.getElementById("dropdownSRRSearch").value.trim().toLowerCase();
        if (!selectedValue) {
            tableData = allStoreData;
            populatedpTable();
            return;
        }

        const filtered = allStoreData.filter(item => {
            const party = item.row[3]?.toLowerCase();
            return party && party.includes(selectedValue);
        });

        tableData = filtered;
        renderFilteredSRRTable(filtered);
    }

    function filterByDate() {
        const fromDate = document.getElementById("fromSRRDate").value;
        const toDate = document.getElementById("toSRRDate").value;

        if (!fromDate || !toDate) {
            alert("Please select both From and To dates.");
            return;
        }

        const from = new Date(fromDate);
        const to = new Date(toDate);

        const filtered = allStoreData.filter(item => {
            const rowDateStr = item.row[2];
            if (!rowDateStr) return false;
            const rowDate = new Date(rowDateStr);
            return rowDate >= from && rowDate <= to;
        });

        tableData = filtered;
        renderFilteredSRRTable(filtered);
    }

    function populatedpTable() {
        renderFilteredSRRTable(tableData);
    }

    function renderFilteredSRRTable(dataArray) {
    const tableDiv = document.getElementById("tableDiv");

    let table = `<table border='1'>
        <thead>
            <tr>
                <th>SNo</th><th>User</th><th>Date</th><th>Party</th><th>Type</th>
                <th>Vcr. Type</th><th>Doc No.</th><th>Weight</th>
                <th>Item Details</th><th>Vehicle No.</th><th>Status</th>
            </tr>
        </thead>
        <tbody>`;

    dataArray.forEach(item => {
        const row = item.row || [];

        const isLoad = row.length > 10 && row[10].toLowerCase() === "load";
        const isX = row.length > 10 && row[10].toLowerCase() === "x";
        const isUnload = row.length > 10 && row[10].toLowerCase() === "unload";

        let rowStyle = "";
        if (isLoad || isUnload) {
           // rowStyle = "style='background-color: rgb(170, 230, 247);'";
              rowStyle = "style='background-color: rgb(209, 238, 238);color: blue; font-weight: bold;'";
        } else if (isX) {
            rowStyle = "style='background-color: rgb(238, 209, 209);color: red; font-weight: bold;'";
        }

        table += `<tr ${rowStyle}>
            <td>${item.indexNo}</td>
            <td>${row[1] || ""}</td>
            <td>${row[2] || ""}</td>
            <td>${row[3] || ""}</td>
            <td>${row[4] || ""}</td>
            <td>${row[5] || ""}</td>
            <td>${row[6] || ""}</td>
            <td>${row[7] || ""}</td>
            <td>${row[8] || ""}</td>
            <td>${row[9] || ""}</td>
            <td>${row[10] || ""}</td>
        </tr>`;
    });

    table += `</tbody></table>`;
    tableDiv.innerHTML = table;

    // Dropdown close on outside click
    document.addEventListener("click", function (event) {
        const dropdown = document.getElementById("dropdownList");
        const searchBox = document.getElementById("dropdownSRRSearch");
        if (!searchBox.contains(event.target) && !dropdown.contains(event.target)) {
            dropdown.classList.remove("show");
        }
    });
}


    function printSRRTable() {
        const tableDiv = document.getElementById("tableDiv");
        const fromDate = document.getElementById("fromSRRDate").value;
        const toDate = document.getElementById("toSRRDate").value;

        const formattedFromDate = formatSRRDate(fromDate);
        const formattedToDate = formatSRRDate(toDate);

        const printWindow = window.open("", "", "width=800, height=600");

        let printContent = `
            <html>
            <head>
                <title>Store Ragister</title>
                <style>
                    body { font-family: Arial, sans-serif; padding: 20px; }
                    table {
                        width: 100%;
                        border-collapse: collapse;
                        font-size: 8px;
                        word-wrap: break-word;
                    }
                    table, th, td {
                        border: 1px solid #c1c2c2;
                        padding: 5px;
                        text-align: left;
                        overflow: hidden;
                        text-overflow: ellipsis;
                    }
                    th { background-color: #013b76; color: white; }
                    table tr:hover { background-color: yellow; }
                </style>
            </head>
            <body>
                <h4>Store Register Report</h4>
                <p><strong>From:</strong> ${formattedFromDate} <strong>To:</strong> ${formattedToDate}</p>
                <span style="color:black;font-size:90%;font-family:Arial Black;">Weight/Bill Report:</span><br/>
                ${tableDiv.innerHTML}
            </body>
            </html>`;

        function formatSRRDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            const date = new Date(dateString);
            return date.toLocaleDateString('en-GB', options);
        }

        printWindow.document.write(printContent);
        printWindow.document.close();
        printWindow.print();
        printWindow.close();
    }

//    window.onload = () => {
  //      filterDp();

      
 //   };
</script>


<!-- STOCK RAGISTER TABLE AND LEDGER SERCH BAR CODE AND SCRIPT START -->
                      
                      
              
                        
        
 
<!-- SHEKHER FORM ENTRY SCRIPT SCRIPT START -->
<style>
           
          
/* Dropdown Styling */
.dropdown-container {
position: relative;
text-align: left;
}         
     /* Dropdown styling */
     #ledgerDropdown {
       display: none;
       position: absolute;
       background-color: rgb(12, 1, 1);
       color: rgb(245, 239, 239);
       width: 50%;
       border: 1px solid #ccc;
       border-radius: 8px;
       max-height: 150px;
       overflow-y: auto;
       box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
       margin-top: 5px;
       z-index: 10;
     }
 
     #ledgerDropdown li {
       padding: 10px;
       cursor: pointer;
       transition: background-color 0.3s ease;
     }
 
     #ledgerDropdown li:hover {
       background-color: #01534d;
     }
 
   </style>

             <!-- SKHR form div script start hare -->
             <script>
  const scriptSKHRURL = 'https://script.google.com/macros/s/AKfycbxNCtOS7UZu2mw_Zuwkx-KHdORL1DATDoSp0Gv2Q5EQw6CKJOSPowawczVE_7uYHQw_/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainSKHRForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeSKHR").value; //****
    const submitSKHRButton = document.getElementById("submitSKHRButton");
    submitSKHRButton.disabled = true;
    submitSKHRButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampSKHR').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifySKHREntry();
    } else {
      await submitSKHREntry(form);
    }

    submitSKHRButton.disabled = false;
    submitSKHRButton.value = "Submit";
  });

  async function submitSKHREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptSKHRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset(); // FORM RESET
        document.getElementById("formModeSKHR").value = "new";
        filterSKHR();  // ✅ Refresh 
        

           // ✅ Remove DLT option after submit
        const SKHRDropdown = document.getElementById("msaf101");
        const dltSKHROption = [...SKHRDropdown.options].find(opt => opt.value === "DLT");
        if (dltSKHROption) {
          SKHRDropdown.removeChild(dltSKHROption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchSKHRDetails() {
    const sNo = document.getElementById("searchSKHRSNo").value;
    const waitMessage = document.getElementById("waitSKHRMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitSKHRButton").style.display = "none";  //****
    try {
      const response = await fetch(`${scriptSKHRURL}?sNo=${sNo}`);
      const data = await response.json();

     if (data.result !== "error" && data.User === "SHEKHER") {
                    document.getElementById("sNo").value = data.SNo;
      document.getElementById("msaf101").value = data.User;
      document.getElementById("dropdownskhrSearch").value = data.Ledger;
      document.getElementById("msaf102").value = data.Date;
      document.getElementById("msaf103").value = data.cl1;
      document.getElementById("msaf104").value = data.cl2;
      document.getElementById("msaf105").value = data.cl3;
      document.getElementById("msaf106").value = data.cl4;
      //  document.getElementById("modifySKHRButton").style.display = "inline-block";


       // ✅ Add "DLT - delete" option if it doesn't exist already
const SKHRDropdown = document.getElementById("msaf101");
if (![...SKHRDropdown.options].some(opt => opt.value === "DLT")) {
  const dlt101Option = document.createElement("option");
  dlt101Option.value = "DLT";
  dlt101Option.text = "Delete";
  dlt101Option.style.color = "red";
  dlt101Option.style.backgroundColor = "blue";
  SKHRDropdown.appendChild(dlt101Option);
}

       document.getElementById("formModeSKHR").value = "modify"; // ✅ Set to modify

       // ✅ Show alert after successful data fetch
      alert(" Select Delete Option in User Section For Delete Entry");
       
    //    document.getElementById("modifySKHRButton").style.display = "inline-block";
      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifySKHREntry() {
    const waitMessage = document.getElementById("waitSKHRMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainSKHRForm');

    // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampSKHR').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptSKHRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeSKHR").value = "new"; // ✅ Reset to new
        filterSKHR(); // ✅ Refresh dropdowns or UI
        
        document.getElementById("submitSKHRButton").style.display = "inline-block";
        document.getElementById("modifySKHRButton").style.display = "none";

          // ✅ Remove DLT option after modify
        const SKHRDropdown = document.getElementById("msaf101");
        const dltSKHROption = [...SKHRDropdown.options].find(opt => opt.value === "DLT");
        if (dltSKHROption) {
          SKHRDropdown.removeChild(dltSKHROption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>

<!-- SHEKHER FORM ENTRY SCRIPT SCRIPT STOP -->



              

                        
              
<!-- SHEKHER TABLE AND LEDGER SERCH BAR CODE AND SCRIPT START -->
              
<style>
.dropdown-container {
 position: relative;
width: 250px;
}
                            
#dropdownskhrSearch {
 width: 100%;
  padding: 8px;
 border: 1px solid #ccc;
 border-radius: 5px;
}
                            
.dp-list {
 position: absolute;
width: 100%;
 background: white;
  border: 1px solid #ccc;
max-height: 500px;
overflow-y: auto;
 display: none;
 z-index: 1000;
 list-style: none;
 padding: 0;
margin: 0;
 }
                            
.dp-list.show {
 display: block;
}

 .dp-list li {
 padding: 8px;
 cursor: pointer;
 border-bottom: 1px solid #ddd;
 }
                            
.dp-list li:hover {
 background: #f0f0f0;
 }
                            
 /* Hide last border */
 .dp-list li:last-child {
  border-bottom: none;
}
 </style>
                            
            
 <script>
 let skhrData = [];
 let allShekherData = []; // All SHEKHER entries
 let tableSKHRData = [];      // Currently displayed data (e.g., last 10 or filtered by date)
                          
 async function filterSKHR() {
    const apiSKHRKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
    const sheetSKHRId = "1wvsPdAQA57HxhTxA3cCcQvUEz93IWkBre_Ix-qvzwss";
    const rangeSKHR = 'FORM!A:H';

    try {
        const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${sheetSKHRId}/values/${rangeSKHR}?key=${apiSKHRKey}`
        );
        const data = await response.json();

        if (data.values) {
            skhrData = [];
            allShekherData = [];

            // Collect all unique values from Column D (index 3)
            const seenValues = new Set();

            data.values.forEach((row, index) => {
                if (index !== 0) {
                    const value = row[3];
                    const type = row[1]?.trim().toUpperCase();

                    // Unique column 4 (D column) data for dropdown
                    if (value && !seenValues.has(value)) {
                        seenValues.add(value);
                        skhrData.push(value);
                    }

                    // Filter only SHEKHER entries
                    if (type === "SHEKHER") {
                        allShekherData.push({ indexNo: index, row });
                    }
                }
            });

            // Show last 10 SHEKHER entries
            tableSKHRData = allShekherData.slice(-100).reverse();

            populatedpSKHRDropdown();
            populateSKHRTable();
        } else {
            console.error("No data found in the specified range.");
        }
    } catch (error) {
        console.error("Error fetching data from Google Sheets:", error);
    }
}

                          
                              function populatedpSKHRDropdown() {
                                  const dropdownSKHRList = document.getElementById("dropdownSKHRList");
                                  dropdownSKHRList.innerHTML = "";
                          
                                  skhrData.forEach(option => {
                                      const li = document.createElement("li");
                                      li.textContent = option;
                                      li.onclick = function () {
                                          document.getElementById("dropdownskhrSearch").value = option;
                                          dropdownSKHRList.classList.remove("show");
                                      };
                                      dropdownSKHRList.appendChild(li);
                                  });
                              }
                          
                              function populateSKHRTable() {
                                  renderFilteredSKHRTable(tableSKHRData);
                              }
                          
                              function filterSKHRDropdown() {
                                  const input = document.getElementById("dropdownskhrSearch").value.toLowerCase();
                                  const dropdownSKHRList = document.getElementById("dropdownSKHRList");
                                  dropdownSKHRList.innerHTML = "";
                          
                                  const filteredData = skhrData.filter(item => item.toLowerCase().includes(input));
                                  if (filteredData.length > 0) {
                                      dropdownSKHRList.classList.add("show");
                                      filteredData.forEach(option => {
                                          const li = document.createElement("li");
                                          li.textContent = option;
                                          li.onclick = function () {
                                              document.getElementById("dropdownskhrSearch").value = option;
                                              dropdownSKHRList.classList.remove("show");
                                          };
                                          dropdownSKHRList.appendChild(li);
                                      });
                                  } else {
                                      dropdownSKHRList.classList.remove("show");
                                  }
                              }
                          
                              function filterSKHRByDate() {
                                  const fromDate = document.getElementById("fromDate").value;
                                  const toDate = document.getElementById("toDate").value;
                          
                                  if (!fromDate || !toDate) {
                                      alert("Please select both From and To dates.");
                                      return;
                                  }
                          
                                  const from = new Date(fromDate);
                                  const to = new Date(toDate);
                          
                                  const filtered = allShekherData.filter(item => {
                                      const rowDateStr = item.row[2];
                                      if (!rowDateStr) return false;
                                      const rowDate = new Date(rowDateStr);
                                      return rowDate >= from && rowDate <= to;
                                  });
                          
                                  if (filtered.length === 0) {
                                      document.getElementById("tableSKHRDiv").innerHTML = "<p>No records found for selected date range.</p>";
                                  } else {
                                      tableSKHRData = filtered; // Update tableSKHRData if needed elsewhere
                                      renderFilteredSKHRTable(filtered);
                                  }
                              }
                          
                              function renderFilteredSKHRTable(dataArray) {
  const tableSKHRDiv = document.getElementById("tableSKHRDiv");
  const totalWeightDiv = document.getElementById("totalWeightDiv");
  const totalAmountDiv = document.getElementById("totalAmountDiv");

  let totalWeight = 0;
  let totalAmount = 0;

  let table = `<table border='1'>
      <tr>
        <th>SNo</th>
        <th>User</th>
        <th>Date</th>
        <th>Party</th>
        <th>Weight</th>
        <th>Rate</th>
        <th>Amount</th>
        <th>Narration</th>
      </tr>`;

  dataArray.forEach(item => {
    let row = item.row.map(cell => {
      return (!cell || cell.toString().trim().toLowerCase() === "undefined") ? "" : cell;
    });

    const weight = parseFloat(row[4]);
    const amount = parseFloat(row[6]);

    if (!isNaN(weight)) {
      totalWeight += weight;
    }

    if (!isNaN(amount)) {
      totalAmount += amount;
    }

    table += `
      <tr>
        <td>${item.indexNo}</td>
        <td>${row[1] || ""}</td>
        <td>${row[2] || ""}</td>
        <td>${row[3] || ""}</td>
        <td>${row[4] || ""}</td>
        <td>${row[5] || ""}</td>
        <td>${row[6] || ""}</td>
        <td>${row[7] || ""}</td>
      </tr>`;
  });

  table += `</table>`;
  tableSKHRDiv.innerHTML = table;

  const retention = totalAmount * 0.10;
  const tdsSKHR = totalAmount * 0.01;
  const billAmount = totalAmount - retention - tdsSKHR;

  totalWeightDiv.innerHTML = `Total Weight: <span style="color: #0077b6;">${totalWeight.toFixed()}</span>`;
  totalAmountDiv.innerHTML = `Total Amount: <span style="color: #0077b6;">${totalAmount.toFixed()}</span>`;
  document.getElementById("retentionDiv").innerHTML = `Retention (10%): <span style="color: #0077b6;">${retention.toFixed()}</span>`;
  document.getElementById("tdsSKHRDiv").innerHTML = `TDS (1%): <span style="color: #0077b6;">${tdsSKHR.toFixed()}</span>`;
  document.getElementById("billAmountDiv").innerHTML = `Total Bill Amount: <span style="color: #0077b6;">${billAmount.toFixed()}</span>`;
}


// print function start
                              function printSHEKHERTable() {
    const tableSKHRDiv = document.getElementById("tableSKHRDiv");
    const totalWeightDiv = document.getElementById("totalWeightDiv");
    const totalAmountDiv = document.getElementById("totalAmountDiv");
    const retentionDiv = document.getElementById("retentionDiv");
    const tdsSKHRDiv = document.getElementById("tdsSKHRDiv");
    const billAmountDiv = document.getElementById("billAmountDiv");
    const fromDate = document.getElementById("fromDate").value;
    const toDate = document.getElementById("toDate").value;

     // Format the dates to "5-May-2025"
     const formattedFromDate = formatSKHRDate(fromDate);
    const formattedToDate = formatSKHRDate(toDate);

    // Create a printable window
    const printWindow = window.open("", "", "width=800, height=600");

    // Build the content for printing
    let printContent = `
        <html>
        <head>
            <title>Chander Shekher</title>
            <style>
                body {
                    font-family: Arial, sans-serif;
                    padding: 20px;
                }
                  table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 5px;
  font-size: 12px;
  table-layout: auto; /* Let column widths auto adjust */
  word-wrap: break-word;
}

table, th, td {
  border: 1px solid #c1c2c2;
  padding: 5px 5px;
  text-align: left;
   /* Prevent text from wrapping   white-space: nowrap; */
   white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis; /* Add ... if text overflows */
}

th {
  background-color: #013b76;
  color: white;
}

table tr:hover {
  background-color: yellow;
}

                
            </style>
        </head>
        <body>
            <h4>Chander Shekher Weight Report</h4>
            <p><strong>From:</strong> ${formattedFromDate} <strong>To:</strong> ${formattedToDate}</p>
            
            <div class="summary" style="display: flex; gap: 30px; margin-top: 20px; font-weight: bold; font-size: 16px;">
                <p>${totalWeightDiv.innerHTML}</p>
                <p>${totalAmountDiv.innerHTML}</p>
                <p>${retentionDiv.innerHTML}</p>
                <p>${tdsSKHRDiv.innerHTML}</p>
                <p>${billAmountDiv.innerHTML}</p>
            </div>
           
            <span style="color:black;font-size:90%;font-family:Arial Black;"id="resultIVDiv"> Weight/Bill Report:  </span> <br/>
            ${tableSKHRDiv.innerHTML}
        </body>
        </html>
    `;

    function formatSKHRDate(dateString) {
    const options = { year: 'numeric', month: 'short', day: 'numeric' };
    const date = new Date(dateString);
    return date.toLocaleDateString('en-GB', options); // This will return the date in the desired format: 5-May-2025
}
    // Write the content into the print window and trigger print
    printWindow.document.write(printContent);
    printWindow.document.close();  // Needed for IE
    printWindow.print();
    printWindow.close();
}
// print function stop
                          
// window.onload = () => {
 // filterSKHR();
   //};
 </script>
<!-- SHEKHER TABLE AND LEDGER SERCH BAR CODE AND SCRIPT STOP -->










<!-- यह एक नोट है, REFRESH BUTTON START HARE -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Single Button for Multiple Function Refresh</title>

  <style>
    /* 👇 Refresh button fixed to bottom-right corner */
    #refreshButton {
      position: fixed;
      bottom: 3px;
      right: 10px;
      padding: 2px 5px;
      background-color: #00254d;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      z-index: 1000;
    }

    #refreshButton:hover {
      background-color: #0056b3;
    }
  </style>

  <!-- ✅ Fixed Positioned Refresh Button -->
  <button id="refreshButton" onclick="refreshAll()">Refresh</button>

   <!-- Combine Refresh Script -->
  <script>
    function refreshAll() {
      filterDp();  // SRR TABLE 
      loadMonth();  //SALE PURCHSHAE MONTHLY SUMMRY
      loadSheet();  // DAYBOOK SUMMRY
      loadIVCRSheet();   // IVCR ENTRY FORM TABLE
      loadusrAdminSheet();  // ADMIN USER 
    }


    // ✅ Auto Refresh Every 1 Minute (60000 milliseconds)
  setInterval(refreshAll, 60000);  // auto refresh after 1 mnt
    // Optional: Run once on page load
  //  window.onload = refreshAll;
  </script>


</body>
</html>
<!-- यह एक नोट है, REFRESH BUTTON START STOP -->






<!-- यह एक नोट है, indian news headline script start -->
<script>
//  api key website: https://gnews.io/dashboard
//  user id : multitechsolution87@gmail.com ,  password:  Adv@2025

const apiNEWSKey = '3b9045bc736598e29bff337027ba6d78';  // 🔑 GNews API key
const ticker = document.getElementById('newsTickerContent');

fetch(`https://gnews.io/api/v4/top-headlines?lang=hi&country=in&max=10&token=${apiNEWSKey}`)
    .then(response => response.json())
    .then(data => {
        ticker.innerHTML = '';
        data.articles.forEach(article => {
            const span = document.createElement('span');
            span.innerHTML = `<span style="color:#b1f4fd ;font-size:100%;font-family:Magneto;">eS|MTally</span> 📰 ${article.title}`;
            ticker.appendChild(span);
        });
    })
    .catch(error => {
        ticker.innerHTML = `<span>❌ खबरें लोड नहीं हो सकीं।</span>`;
        console.error("News fetch error:", error);
    });
</script>
<!-- यह एक नोट है, indian news headline script stop -->







<!-- यह एक नोट है, Admin Section SCript STart -->
<script>
  async function loadusrAdminSheet() {
    const sheetConfigs = {
      mpr: {
        apiKey: "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM",
        sheetId: "1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0",
        range: "MPR!J:R"
      },
      ivcr: {
        apiKey: "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM",
        sheetId: "1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA",
        range: "IVCR!W:AD"
      },
      sale: {
        apiKey: "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM",
        sheetId: "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4",
        range: "ADMIN!A:L"
      },
       po: {
        apiKey: "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM",
        sheetId: "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4",
        range: "POINDEX!E:O"
      },
       psw: {
        apiKey: "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM",
        sheetId: "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4",
        range: "M1000!A:J"
      }
    };

    const selectedSheet = document.getElementById("sheetSelector").value;
    const { apiKey, sheetId, range } = sheetConfigs[selectedSheet];

    try {
      const response = await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
      );
      const data = await response.json();

      if (data.values && data.values.length > 0) {
        populateAdminTable(data.values);
        populateAdminDropdowns(data.values);
      } else {
        console.error("No data found");
        document.getElementById("userTableHead").innerHTML = "";
        document.getElementById("userTableBody").innerHTML = "<tr><td>No data found</td></tr>";
      }
    } catch (error) {
      console.error("Error fetching sheet:", error);
      document.getElementById("userTableBody").innerHTML = "<tr><td>Error loading data</td></tr>";
    }
  }

  function populateAdminTable(data) {
    const tableHead = document.getElementById("userTableHead");
    const tableBody = document.getElementById("userTableBody");
    tableHead.innerHTML = "";
    tableBody.innerHTML = "";

    const headerRow = document.createElement("tr");
    data[0].forEach(headerText => {
      const th = document.createElement("th");
      th.textContent = headerText;
      headerRow.appendChild(th);
    });
    tableHead.appendChild(headerRow);

    for (let i = 1; i < data.length; i++) {
      const row = document.createElement("tr");
      data[i].forEach((cellText, cellIndex) => {
        const td = createCell(cellText, "td");  // Use createCell here
        row.appendChild(td);

        if (cellIndex === 2) {
          const type = cellText.trim().toLowerCase();
          if (type === "receipt") row.classList.add("receipt");
          else if (type === "billdr") row.classList.add("billdr");
          else if (type === "billcr") row.classList.add("billcr");
          else if (type === "bank") row.classList.add("billdr");
        }
      });
      tableBody.appendChild(row);
    }
  }

  function populateAdminDropdowns(data) {
    const dropdown1 = document.getElementById('adminColumn1');
    const dropdown2 = document.getElementById('adminColumn2');
    const dropdown4 = document.getElementById('adminColumn4');

    const unique1 = [...new Set(data.slice(1).map(r => r[1]))].filter(Boolean);
    const unique2 = [...new Set(data.slice(1).map(r => r[2]))].filter(Boolean);
    const unique4 = [...new Set(data.slice(1).map(r => r[4]))].filter(Boolean);

    setDropdown(dropdown1, unique1);
    setDropdown(dropdown2, unique2);
    setDropdown(dropdown4, unique4);

    $(dropdown4).select2({ placeholder: "-- Select --", allowClear: true });

    dropdown1.onchange = filterAdminTable;
    dropdown2.onchange = filterAdminTable;
    dropdown4.onchange = filterAdminTable;
    document.getElementById('startAdmintDate').onchange = filterAdminTable;
    document.getElementById('endAdminDate').onchange = filterAdminTable;
    document.getElementById('searchbarAdmin').addEventListener('input', filterAdminTable);
  }

  function setDropdown(dropdown, items) {
    dropdown.innerHTML = '<option value="">-- Select --</option>';
    items.forEach(val => {
      const opt = document.createElement('option');
      opt.value = val;
      opt.textContent = val;
      dropdown.appendChild(opt);
    });
  }

 function filterAdminTable() {
  const f1 = document.getElementById('adminColumn1').value.toLowerCase();
  const f2 = document.getElementById('adminColumn2').value.toLowerCase();
  const f4 = $('#adminColumn4').val()?.toLowerCase();
  const fromDate = new Date(document.getElementById('startAdmintDate').value);
  const toDate = new Date(document.getElementById('endAdminDate').value);
  const searchQuery = document.getElementById('searchbarAdmin').value.toLowerCase().trim();
  const rows = document.querySelectorAll('#userTableBody tr');

  rows.forEach(row => {
    const cells = row.querySelectorAll("td");
    const date = new Date(cells[3]?.textContent.trim());
    const val1 = cells[1]?.textContent.toLowerCase();
    const val2 = cells[2]?.textContent.toLowerCase();
    const val4 = cells[4]?.textContent.toLowerCase();

    const match1 = !f1 || val1 === f1;
    const match2 = !f2 || val2 === f2;
    const match4 = !f4 || val4 === f4;
    const matchDate = (!isNaN(fromDate) ? date >= fromDate : true) && (!isNaN(toDate) ? date <= toDate : true);

    let searchMatch = !searchQuery; // default true if no search query

    cells.forEach(cell => {
      const originalHTML = cell.innerHTML;
      let textToCheck;

      // If the cell contains a link, extract the text from inside
      const link = cell.querySelector("a");
      if (link) {
        textToCheck = link.href.toLowerCase(); // you can also use link.textContent if needed
      } else {
        textToCheck = cell.textContent.toLowerCase();
      }

      // Remove previous highlights (only from text parts)
      if (!link) {
        cell.innerHTML = cell.textContent;
      }

      // Apply search match and highlight
      if (searchQuery && textToCheck.includes(searchQuery)) {
        searchMatch = true;

        // Only highlight if it's not a link
        if (!link) {
          const regex = new RegExp(`(${searchQuery})`, 'gi');
          cell.innerHTML = cell.textContent.replace(regex, '<mark>$1</mark>');
        }
      }
    });

    row.classList.toggle('hidden', !(match1 && match2 && match4 && matchDate && searchMatch));
  });
}

  function downloadAdminHTML() {
    const table = document.getElementById("userTable").cloneNode(true);
    const rows = table.querySelectorAll("tr");
    rows.forEach(r => r.classList.contains("hidden") && r.remove());

    const htmlContent = `
      <html><head><title>Filtered Table</title></head><body>
      ${table.outerHTML}
      </body></html>
    `;

    const blob = new Blob([htmlContent], { type: "text/html" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "filtered_table.html";
    a.click();
  }

  function downloadAsExcel() {
    const table = document.getElementById("userTable").cloneNode(true);
    const rows = table.querySelectorAll("tr");
    rows.forEach(r => r.classList.contains("hidden") && r.remove());

    const excelContent = `
      <html xmlns:o="urn:schemas-microsoft-com:office:office"
            xmlns:x="urn:schemas-microsoft-com:office:excel"
            xmlns="http://www.w3.org/TR/REC-html40">
        <head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>
          <x:Name>Sheet1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions>
        </x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head>
        <body>${table.outerHTML}</body>
      </html>
    `;

    const blob = new Blob([excelContent], { type: "application/vnd.ms-excel" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "filtered_table.xls";
    a.click();
  }

//  window.onload = loadusrAdminSheet;
</script>

<!-- यह एक नोट है, Admin Section SCript stop -->









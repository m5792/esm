<!-- ==============================================dashboard start================================================================================ -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MIPL e|SmTally</title>
 <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
      
     
    }

    /* Login section with full screen and positioned at top */
    #login-section {
      display: flex;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 10;
      background-color: #fff;
    }

    .left-panel {
      flex: 1;
      background-color: #026186;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 40px;

      overflow: hidden;
  z-index: 1;
  position: relative; /* if only image show in right panal "position: relative;" */
    }

    .left-panel h1 {
      font-size: 32px;
      margin-bottom: 20px;
    }

    .right-panel {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #ffffff;

       
    }

    .left-panel::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: url('https://i.gifer.com/OFAF.gif'); /* Replace with your image URL */
  background-size: cover;
  background-position: center;
  opacity: 0.4; /* Change opacity here */
  z-index: -1; /* Keep it behind the login box */
}


    .login-box {
      width: 300px;
    }

    .login-box h2 {
      margin-bottom: 20px;
      text-align: center;
    }

    .login-box input {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

   
    .login-box button {
      width: 100%;
      padding: 10px;
      background-color: #026186;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      border-radius: 4px;
    }

    .login-box button:hover {
      background-color: #026186;
    }

    #login-msg {
      color: red;
      margin-top: 10px;
      text-align: center;
    }

    /* Dashboard styles */
    #dashboard {
      top: 20px;
      display: none;
      padding: 10px;
      min-height: 90vh;
      background-color: rgb(255, 255, 255);
    }

   
    .section {
      border: 1px solid #ccc;
      padding: 2px;
      background-color: #f8f9fa;
      border-radius: 1px;
    }

#sections {
  position: fixed;
  top: 50px; /* 1 inch from top */
  left: 0;
  right: 0;
  bottom: 0; /* allows full height scrolling inside */
  overflow-y: auto; /* only inner content scrolls */
  padding: 1px;
  background-color: #e9f7fc;
}
  .message {
    display: none;
  }

    .hidden {
      display: none;
    }



   header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: #f9fafa;
      color: white;
      padding: 5px 10px;
      text-align: center;
      z-index: 1000;
    }

    #top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 2px;
  background-color: #026186;
  color: white;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 999;
}

.button-div {
  display: flex;
  flex-wrap: nowrap;              /* ❌ wrapping band */
  overflow-x: auto;               /* ✅ horizontal scroll */
  white-space: nowrap;            /* ✅ content ek line me */
  gap: 1px;
}

.button-div button {
  flex: 0 0 auto;                 /* ✅ fixed width, no shrink/wrap */
  min-width: 200px;
  padding: 10px 10px;
  background-color: #026186;
  color: white;
  border: none;
  border-radius: 0px;
  cursor: pointer;
  font-size: 18px;
}


.button-div button:hover {
  background-color: #01384e;
  color: rgb(233, 248, 26);
}


#logout-btn {
  background-color: #f44336;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
}

#logout-btn:hover {
  background-color: #e53935;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 16px;
  background-color: rgb(8, 8, 8);
  color: white;
  border: 1px solid rgb(1, 45, 75);       /* "border: yes;" ko correct kiya */
  border-radius: 4px;
  padding-left: 5px;              /* Left se 5px space */
  padding-right: 5px;             /* Right se 5px space */
}

#username {
  font-size: 20px;
  font-weight: bold;
  color: rgb(243, 243, 242);
  text-align: center;
}


  .multidivbar {
            margin-bottom: 10px;
            padding: 5px 2px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }


/* Table Styling */
/* Container to control table width and responsiveness */
.table-container {
  width: 100%;
  overflow-x: auto;
}



 
 /* Table container */
table{
    width: 100%;
    border-collapse: collapse;
    font-family: "Segoe UI", Tahoma, Arial, sans-serif;
    font-size: 14px;
    background: #ffffff;
    box-shadow: 0px 2px 8px rgba(0,0,0,0.15);
    border-radius: 8px;
    overflow: hidden;
    table-layout: fixed; /* columns fixed width */
  }

  /* Table border & cell style */
th, 
 td {
    border: 1px solid #dcdcdc;
    padding: 8px 10px;
    text-align: left;
   
    overflow: hidden;
    text-overflow: ellipsis; /* show ... if text overflow */
    vertical-align: middle;
    font-size: clamp(10px, 1vw, 14px); /* auto shrink text */
  }

  /* Header design */
th {
    background: linear-gradient(135deg, #070707, #616161);
    color: #fff;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 13px;
    letter-spacing: 0.5px;
  }

  tr:nth-child(even) {
  background-color: #f9f9f9;
}

  /* Row hover effect */
  tr:hover td {
    background: #fce303;
    transition: background 0.2s ease-in-out;  }
    
    table tr:hover {
  background-color: #f81404;
  color: rgb(1, 20, 37);
  transition: background-color 0.3s ease, color 0.3s ease;
  }

 

/* Form Styling Scoped to .form-container */
.form-container input,
.form-container select {
    width: 100%;
    padding: 6px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 16px;
    box-sizing: border-box;
}

.form-container input[type="text"],
.form-container input[type="number"],
.form-container input[type="date"],
.form-container select {
    background-color: #f9f9f9;
}

.form-container input[type="submit"],
.form-container button {
    background-color: #080808;
    color: #f6f6f8;
    font-weight: bold;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.form-container input[type="submit"]:hover,
.form-container button:hover {
    background-color: #575555;
    transform: translateY(-2px);
}


.fetchbtn {
  background-color: #b9e0f9;
  color: rgb(44, 3, 0);
  border: none;
  font-size: 16px;
  font-weight: bold;
  font-family: 'Eras Bold ITC', sans-serif;
  width: 1.5in;
  padding: 5px;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.fetchbtn:hover {
  background-color: #a5d4f0;
}

  </style>
</head>
<body>

  <!-- Login Section -->
  <div id="login-section">
    <div class="left-panel">
     
<br/><br/><br/><br/><br/>
<h1 style="color:#2F4F4F;text-align:center;font-size:150%">
<span style="color:#f8f9fa;font-size: 150%;">Multitech Infracon Pvt. Ltd.</span>
</h1>

 <h1 style="color:rgb(251, 249, 249); text-align: center; font-size: 100%;">Nh 74 12th Km Stone <br/> Vill Dabhora Mustakam Bazpur Road Kashipur <br/>U.S Nagar Uttarakhand 244713</h1>
<h1 style="color:#2F4F4F;text-align:center;font-size:100%">
<span style="color:#def8f8;font-size: 100%;">#9719012011,9639012011</span>
<span style="color:#f8e1e1;font-size: 100%;">(mail:-multitechsolutions@yahoo.com)</span>
</h1>



<br/>
<h3>
        <span style="color:rgb(250, 218, 218);font-size:130%;font-family:Magneto;">eS | <span style="color:#e0f5f5;font-size:130%;font-family:Magneto;">MTally</span></span> 
       </h3> 

    </div>
    <div class="right-panel">
    
      <div class="login-box">
        <h2>Login</h2>
        <input type="text" id="user-id" placeholder="User ID" />
        <input type="password" id="password" placeholder="Password" />
        <button onclick="login()">Login</button>
        <div id="login-msg"></div>
      </div>
    </div>
  </div>

  <!-- Dashboard div start !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
  <div id="dashboard">  <!-- Dashboard div open -->
    <header>
    <div id="top-bar">
  <div class="button-div">
    <button onclick="showSection(1)" id="f1" style="color: rgb(245, 245, 247); font-weight: bold;">HOME &nbsp;<span style="color:  red;font-weight: bold;">(F1)</span> </button>
    <button onclick="showSection(2)">Cash Ledger Report</button>
    <button onclick="showSection(3)">MIPL Ledger Report</button>
    <button onclick="showSection(4)">Imprest Voucher Report</button>
    <button onclick="showSection(5)" id="f4">Job/Reff Summry &nbsp;<span style="color:  red;font-weight: bold;">(F4)</span></button>

 
    
     <!-- <button onclick="showSection(6)">Job/Reff</button> -->
  
    <button onclick="showSection(7)" id="f6" style="color: rgb(250, 184, 184);" >Admin* &nbsp;<span style="color:  red;font-weight: bold;">(F6)</span></button>
 
      
  
  </div>
  <div class="user-info">
    <span id="username"></span>
    <button id="logout-btn" onclick="logout()">Logout</button>
  </div>
</div>

  </header>



  

  
  <script>
  const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
  const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
  const range = 'USER!A:G';

  let users = {};
  let currentUser = "";

  async function fetchUserData() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;

    try {
      const response = await fetch(url);
      const data = await response.json();

      const rows = data.values;
      users = {};

      for (let i = 1; i < rows.length; i++) {
        const [enabled, userId, password, status, displayName, perms] = rows[i];

        if (enabled === "1") {
          users[userId] = {
            password: password,
            displayName: displayName,
            status: status?.toLowerCase() || "unlocked",
            permissions: perms?.split(',').map(p => parseInt(p.trim()))
          };
        }
      }
    } catch (error) {
      console.error("Error fetching user data:", error);
      document.getElementById('login-msg').innerText = "Failed to load user data.";
    }
  }

  async function login() {
    const userId = document.getElementById('user-id').value.trim();
    const password = document.getElementById('password').value;

    if (!users[userId]) {
      document.getElementById('login-msg').innerText = "Invalid User ID or Password!";
      return;
    }

    const user = users[userId];


    //****
   const status = user.status;

if (status === "locked") {
  document.getElementById('login-msg').innerText = "Your account is locked!";
  return;
}

// Check if status is a valid date
const expiryDate = Date.parse(status);
if (!isNaN(expiryDate)) {
  const today = new Date();
  const expiry = new Date(expiryDate);
  const diffTime = expiry - today;
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

  if (diffDays < 0) {
    document.getElementById('login-msg').innerText = "Your Licence Expired, Please Contact Admin";
    return;  // warning dikhani ho aur login allow karna ho, to return mat likhna.
  } else if (diffDays <= 5) {
    const msg = `Your licence will expire in ${diffDays} day${diffDays === 1 ? '' : 's'}`;
    alert(msg);
    document.getElementById('login-msg').innerText = msg;
    
    // Yahan return nahi dena chahenge agar login allow karna hai
  }
}
//***

    if (user.password === password) {
      currentUser = userId;

      document.getElementById('login-section').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
      document.getElementById('username').innerText = user.displayName;
      document.getElementById('login-msg').innerText = "";
      document.getElementById('user-id').value = "";
      document.getElementById('password').value = "";
      document.querySelector('.button-div').style.display = 'flex';

      window.scrollTo(0, 0);

      // 👇 Add this line to show section1 by default
    showSection(1);
     fetchGlobalMessage(); // <-- ✅ fetchGlobalMessage function
     speakOnce(); // welcome massage ru after login
    } else {
      document.getElementById('login-msg').innerText = "Invalid User ID or Password!";
    }
  }

function showSection(buttonNum) {
  document.querySelectorAll('.section').forEach(div => div.classList.add('hidden'));
  //*** document.getElementById('message').innerText = "";

  const permissions = users[currentUser]?.permissions || [];
  if (permissions.includes(buttonNum)) {
    document.getElementById(`section${buttonNum}`).classList.remove('hidden');
    document.getElementById(`section${buttonNum}b`).classList.remove('hidden');
  } else {
    alert("You are not authorized for this Tab.\n\nMore Details Contact Admin:\nMukhtar Ahamad\n+91-9756735792");

    // Automatically redirect to Section 1 after alert
    document.getElementById(`section1`).classList.remove('hidden');
    document.getElementById(`section1b`).classList.remove('hidden');
  }
}

async function fetchGlobalMessage() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/USER!H2?key=${apiKey}`;

  try {
    const response = await fetch(url);
    const data = await response.json();

    const message = data?.values?.[0]?.[0] || ""; // Safely get cell value

    const globalMessageDiv = document.getElementById('globalMessage');
    if (message.trim() !== "") {
      globalMessageDiv.innerText = message;
      globalMessageDiv.style.display = "block";
    } else {
      globalMessageDiv.style.display = "none";
    }
  } catch (error) {
    console.error("Error fetching global message:", error);
  }
}


  function logout() {
    currentUser = "";
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('login-section').style.display = 'flex';
    document.querySelectorAll('.section').forEach(div => div.classList.add('hidden'));
    document.getElementById('message').innerText = "";
    document.getElementById('username').innerText = "";
    document.querySelector('.button-div').style.display = 'none';

    window.scrollTo(0, 0);

    // ✅ Full page reload
    location.reload(); 
}




  // Call this function on page load to fetch user data
 //  window.onload = fetchUserData;
</script>

<!-- Welcome Massage start-->
 <script>
    //   let hasSpoken = false;
    //   function speakOnce() {
     //  if (hasSpoken) return;
   //    hasSpoken = true;
     // const msg = new SpeechSynthesisUtterance("Welcome");
   //   window.speechSynthesis.speak(msg);
  //   }
  </script>
   <!-- Welcome Massage Stop-->
</body>
</html>



<!-- ============================================== sections start =============================================================== -->

  <div id="sections">  <!-- sections Div open-->

 <div id="section1" class="section hidden"> <!--  sections1 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
   
      
<!-- यह एक नोट है, vertical Two Part Div (30-70) container content start  Heare ((CODE501)) -->
    <div class="container">  <div class="left" style="background-color: #f5f5f5; border: none;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start -->

<style>
  .voucher-button-panel {
    background-color: #cfcfcf;
    border: 2px solid #b0d4ec;
    border-radius: 10px;
    padding: 5px;
    width: 300px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    font-family: 'Eras Bold ITC', sans-serif;
    margin: 20px auto;
  }

  .voucher-button-panel button {
    background-color: #035e97;
    color: rgb(248, 249, 250);
    border: none;
    font-size: 15px;
    font-weight: bold;
    margin: 4px 0;
    width: 100%;
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .voucher-button-panel button:hover {
    background-color: #a5d4f0;
  }
</style>




<div class="voucher-button-panel">

  <button onclick="openDialog()" id="daybookButton" style="padding: 10px 20px; font-size: 16px; border-radius: 6px; background-color: #000;">📘 Daybook & Search &nbsp;<span style="color:  red;font-weight: bold;">(F3)</span></button>

  <button onclick="showSection(8)" id="f2">Cash Voucher &nbsp;<span style="color:  red;font-weight: bold;">(F2)</span></button><br/>
  <button onclick="showSection(9)">Store Register Voucher</button><br/>
  <button onclick="showSection(10)">Sales Voucher</button><br/>
  <button onclick="showSection(11)">Banking Voucher</button><br/>
  <button onclick="showSection(12)">Imprest Voucher</button><br/>
  <button onclick="showSection(13)">Job/Ref Voucher </button><br/>
   <button onclick="showSection(14)">Chander Shekher Voucher</button><br/>
</div>



<!-- यह एक नोट है, ADDRESS BAR SERCH BAR OPTION START  -->
 <blink><span style="color:#011136;font-size:100%;font-family:Arial Black;">Address & Purchase Order</span> </blink><br/>
           <div id="searchCon">
          <input type="text" id="searchtab" placeholder="🔍 Search Party Name, Purchase Order, Address, GSTIN ..." />
          </div>
   <!-- यह एक नोट है, ADDRESS BAR SERCH BAR OPTION STOP  --> 
    
   
      
        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right" style="background-color: white;"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->






 <div class="container2">  
  <div class="leftdiv"  style="max-height: 600px;width: 800px; overflow-y: auto; border: 3px solid #013342; padding: 5px; border-radius: 6px;background-color: #f3f9f8;" >

  <span style="color: #0515f0; font-weight: bold;font-size: 16px;">Loading Status</span>
<table id="noticeBoard">  <thead ><tr> <th>Type</th><th>Date</th> <th>Name</th><th>Vehicle No.</th><th>Job No.</th> <th>Status</th> <th>Inv. No.</th></tr></thead><tbody></tbody></table>


  <div style="display: flex; align-items: center; background: rgb(234, 235, 235); padding: 10px; gap: 10px;">
    <select id="monthDropdown" style="padding: 5px; font-size: 16px;"></select>
    <div id="monthlyTotals" style="color: white; font-size: 16px;">Please Wait!</div>

</div>

 
   
</div>

<div class="rightdiv" >
 <!-- event & reminder  body start -->

<div class="event-section" id="allEvents" style="max-height: 300px; overflow-y: auto; border: 3px solid #011632; padding: 10px; border-radius: 6px; padding: 10px; border-radius: 6px; background-color: #fcfbeb;">
  <span style="font-size: 20px; font-weight: bold; color: #000;">📅 Event Reminders</span>
  
  <input type="text" id="searchInput" placeholder="🔍 Search events..." 
         style="padding: 4px 8px; width: 98%; max-width: 300px; margin-bottom: 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px;background-color: #f6e0e0;">
  
  <ul style="list-style-type: none; padding-left: 0; margin: 0;"></ul>
</div>

 <!-- event & reminder  body stop -->
<span  style="color: rgb(1, 26, 116); font-size: 16px; font-weight: bold;">Notice Board:</span><br/>
      <span id="globalMessage" style="color: rgb(16, 15, 15); font-size: 16px;"></span>
 
</div></div>





<!-- यह एक नोट है, vertical Two Part Div (30-70) right content stop -->
</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->

</div>  <!--  sections1 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->

   
      <div id="section2" class="section hidden"><table id="myuserTable"></table> <br/><br/><br/><br/><br/><br/><br/><br/></div>  <!--  sections2 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
      <div id="section3" class="section hidden"> <table id="myPEBTable"></table><br/><br/><br/><br/><br/><br/><br/><br/></div>  <!--  sections3 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
     
      <div id="section4" class="section hidden"><table id="myIVTable"></table><br/><br/><br/><br/><br/><br/><br/><br/></div>    <!--  sections4 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
      

      <!--  sections5 START  AAAAAAAAAAAAAAAAAAA  X -->
      <div id="section5" class="section hidden"> 
      
      
  <table id="dataTable"></table>

  <!-- Modal Popup -->
  <div id="overlay" onclick="closeModal()"></div>
  <div id="dataModal">
    <h3>Multitech Infracon Pvt Ltd. <br/>Ledger Details</h3>
     <button onclick="printModal()">🖨️ Print</button>
    <button onclick="closeModal()">❌ Close</button>
     
    <div id="modalContent"></div>

     <p style="color: #a00202;">Click to Invoice No For invoice copy.</p>
  </div>

        <br/><br/><br/><br/><br/><br/><br/><br/>
      
      
      </div>    <!--  sections5 stop  AAAAAAAAAAAAAAAAAAA  X -->
      





<div id="section7" class="section hidden">   <!--  sections7 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->
  
<div class="container">  <div class="left" style="background-color: rgb(200, 249, 234);color:#004d80;font-weight: bold;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->

<!-- यह एक नोट है, Admin Table div body start Heare -->
<style>
  .adminGrid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-gap: 12px;
    max-width: 700px;
    margin-top: 10px;
  }

  .adminGrid label {
    align-self: center;
    font-weight: bold;
  }

  .adminGrid select,
  .adminGrid input[type="date"],
  .adminGrid input[type="text"] {
    width: 100%;
    padding: 4px 6px;
    box-sizing: border-box;
  }

  .adminDiv {
    padding: 20px;
    border: 1px solid #ddd;
    margin: 20px;
    background-color: #f9f9f9;
    border-radius: 8px;
  }

  button {
    margin-right: 8px;
  }

 
</style>

<div class="adminDiv">
  <h4>📋 Select Sheet to Load</h4>

  <div class="adminGrid">
    

    <label for="adminColumn1">User:</label>
    <select id="adminColumn1"></select>

    <label for="adminColumn2">Voucher:</label>
    <select id="adminColumn2"></select>

    <label for="adminColumn4">Ledger:</label>
    <select id="adminColumn4" style="width:200px;"></select>

    <label for="startAdmintDate">From:</label>
    <input type="date" id="startAdmintDate" />

    <label for="endAdminDate">To:</label>
    <input type="date" id="endAdminDate" />

    

    <div></div> <!-- empty for spacing -->
    <div>
      <h3>📤 Export</h3>
      <button onclick="downloadAdminHTML()">Download as HTML</button>
      <button onclick="downloadAsExcel()">Download as Excel (.xls)</button>
    </div>
  </div>

  <div id="resultDiv"></div>
</div>

<!-- यह एक नोट है, Admin Table div body stop Heare -->


<BR/>
<!-- यह एक नोट है, Dropdown URL  Script Start Heare -->
<!DOCTYPE html>
<html>
<head>

    <script>
        // Function to handle dropdown selection
        function handleDropdownChange() {
            const dropdown = document.getElementById('linkDropdown');
            const selectedOption = dropdown.options[dropdown.selectedIndex];

            if (selectedOption.value) {
                // Open the link in a new tab
                window.open(selectedOption.value, '_blank');
            }
        }
    </script>
    <style>
        select {
            padding:5px;
            font-size: 14px;
            margin: 2px 0;
        }
    </style>
</head>
<body>

 <label style="color: #000;"> Google Sheet Links</label>
    <select id="linkDropdown" onchange="handleDropdownChange()">
        <option value="">--Google Sheet Links --</option>
        <option value="https://docs.google.com/spreadsheets/d/1FXdbotep3MTk34gUdSF0e0h_hN_Uz66AL0Gnvc-pt_s/edit?gid=475142657#gid=475142657">	Party Weight Sheet</option>
        <option value="https://docs.google.com/spreadsheets/d/1EMIe8Y50_vMXg7y9zT7lXV0vgLyOZuSKdthf8C5XUXc/edit?gid=1752231070#gid=1752231070">	Mukhtiyar</option>
        <option value="https://docs.google.com/spreadsheets/d/1F3Wf5V8sLxENPJFtHij-0GDGBXfeYByGx0DSafDucgM/edit?gid=90095763#gid=90095763">	Tushar</option>
	<option value="https://www.google.com/android/find/">	Find My Device</option>
	<option value="https://docs.google.com/spreadsheets/d/1wvsPdAQA57HxhTxA3cCcQvUEz93IWkBre_Ix-qvzwss/edit?gid=627393391#gid=627393391">	Store Database SHeet*</option>
	<option value="https://docs.google.com/spreadsheets/d/1U_jwvZNtFuP91Gljjrbz_cpmb1OIkeDHnKa7aDe7F20/edit?gid=1511450281#gid=1511450281">	Clint List Sheet*</option>
	<option value="https://docs.google.com/spreadsheets/d/17GZv2O6uupdA5r6p7-zqKZ8AQgZozbGQf2aXPlUzhDA/edit?gid=1122888223#gid=1122888223">	Mipl Office</option>
	<option value="https://docs.google.com/spreadsheets/d/13N0HBuorZJM-ARnlTh36EUaD1-uQckaC6sLLzMnWAks/edit?gid=696561165#gid=696561165">	Office Noida</option>
	<option value="https://docs.google.com/spreadsheets/d/1Rw_6cDYP-ETicn9YhHkdF_Sgmi8ps5JhjhlrkWvtwRQ/edit?gid=2123243236#gid=2123243236">	GUPTA CAMUNICATION Sheet*</option>
    <option value="https://docs.google.com/spreadsheets/d/1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4/edit?gid=0#gid=0">	INDEX SHEET MIPL Sheet*</option>
    <option value="https://docs.google.com/spreadsheets/d/1B6dyXPay3Tyl_7RzGuL9Rg8AhkzdBNhJNRu-T-3kmvI/edit?gid=147958071#gid=147958071">	MIPL Clint Cash Ledger Sheet*</option>
     <option value="https://docs.google.com/spreadsheets/d/1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0/edit?gid=0#gid=0">	Cash Management Sheet*</option>
     <option value="https://docs.google.com/spreadsheets/d/1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA/edit?gid=0#gid=0">	Imprest Voucher Sheet*</option>
      <option value="https://docs.google.com/spreadsheets/d/1B6dyXPay3Tyl_7RzGuL9Rg8AhkzdBNhJNRu-T-3kmvI/edit?pli=1&gid=207048997#gid=207048997">	MIPL Party Weight REport*</option>
     <option value="MULTITECH V.2023.html">	MIPL DASHBOARD OLD</option>
     <option value="MULTITECH2023.html">MIPL Old Dashboard</option>
     <option value="https://github.com/">	github (mukhtarahamadksp@gmail.com)</option>
     <option value="eTally.html">	eTally Dashboard</option>
		<option value="DAYBOOK.html">Daybook</option>
    </select>
</body>
</html>

<!-- यह एक नोट है, Dropdown URL  Script Stop Heare -->

<option value="\\Laptop-q248401d\mipl">Sharing Folder</option>

<br/><br/><br/>

 <a href="\\Laptop-q248401d\mipl" target="_blank"><img src="https://cdn-icons-png.freepik.com/512/7575/7575914.png" alt="You Tube" width="60" height="60" /></a>
                            


        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->




<!-- Admin Table Section -->
<h3>📊 Admin Data Table</h3>
<table id="userTable">
  <thead id="userTableHead"></thead>
  <tbody id="userTableBody"></tbody>
</table>



</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->



</div>  <!--  sections7 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-->









<!--  sections8 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA   -->
      <div id="section8" class="section hidden">

    <div class="container">  <div class="left" style="background-color: rgb(247, 249, 249);color:#004d80;font-weight: bold;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->


        
    <div class="form-container">
<form id="mainIVMAForm">
        <input type="hidden" name="SNo" id="sNo">
      

<label style="color: red;font-weight: bold;" >User*</label>
          <!-- User selection dropdown -->
<select class="userDropdown" id="msaf51" name="Voucher" required>
 
</select>



          <label  >Select Voucher</label>
          <select id="msaf52" name="Type" required>
            <option value="PAYMENT" style="color: green;">Payment</option>
            <option value="RECEIPT" style="color: red;">Receipt</option>
            <option value="BILLDR">Bills Payable</option>
            <option value="BILLCR">Bills Receivable</option>
            <option value="SALARY">Salary</option>
          </select>
          
          <label >Select Date</label>
          <input type="date" id="msaf53" name="Date" required>

<!-- Searchable Ledger Dropdown -->
  <div class="dropdownWrapper">
    <label">Search & Select Ledger</label>
    <input type="text" id="msaf54" name="Ledger" class="dropdownCLSearch" placeholder="🔍 Search Ledger..." />
    <ul id="ledgerDropdown" class="dropdownList"></ul>
  </div>


         
        <label  >Enter Amount</label>
          <input type="number" id="msaf55" name="Amount" required placeholder="Amount" > 

          <label >Enter Narration</label>
          <input type="text" id="msaf56" name="Narration" placeholder="Narration"style="text-transform: uppercase;">
   
          <input type="hidden" name="Timestamp" id="timestampIVMA">

        <input type="submit" id="submitIVMAButton" value="Submit">

        <H3 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Entry Modify</H3>

         <!-- Form for Fetching and Modifying Entries -->
    <form id="modifyIVMAForm">
       <input type="hidden" id="formModeIVMA" name="formModeIVMA" value="new">
        <input type="number" id="searchIVMASNo" placeholder="Enter S.No. to Modify Entry" >
        <button type="button" class="fetchbtn" onclick="fetchIVMADetails()">Fetch Details</button>
        <button type="button" class="fetchbtn" id="modifyIVMAButton" onclick="modifyIVMAEntry()" style="display:none;">Modify Entry</button>
        <!-- Wait message div -->
<div id="waitIVMAMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
    </form>

    </form>

     
     <br/> <br/> <br/>
      <label style="color: #014060; font-weight: bold;font-size: 18px;">Search MA,TA,JLN,Bank Entry.</label>
    <input type="text" id="searchCLedger" placeholder="🔍 Search in Table..." />
    </div>

<button onclick="printCUSERTable()" style="border: none; color: rgb(0, 27, 37); font-weight: bold;  cursor: pointer;">🖨️ Print Table</button>
  

        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->




<!-- First dropdown populated based on username -->
 <label style="font-size: 20px; font-weight: bold;">Select User Name:</label>
<select id="cu123" required style="width: 3in; font-size: 16px; text-align: center; background-color: #014060;color: white;"></select>

<script>
// 1. All dropdown options
const allOptions = [
{ value: "", text: "Select a User" },
  { value: "MA", text: "MUKHTAR" },
  { value: "TA", text: "TUSHAR" },
  { value: "JLN", text: "JOURNAL" },
  { value: "BANK", text: "BANK" }
];

// 2. Which user sees which options
const userOptionsMap = {
  "Anchal": [0,2, 3,4],              // TUSHAR, JOURNAL, BANK
  "Mukhtar (Admin)": [0, 1, 2, 3,4]   // All options
};

// 3. Populate cu123 dropdown based on username
function updateDropdown(username) {
  const cu123 = document.getElementById("cu123");
  cu123.innerHTML = ""; // Clear existing options

  const allowedIndexes = userOptionsMap[username] || [];

  allowedIndexes.forEach(index => {
    const option = document.createElement("option");
    option.value = allOptions[index].value;
    option.textContent = allOptions[index].text;
    cu123.appendChild(option);
  });

  // Trigger sync after populating cu123
  syncledgerOption();
}

// 4. Sync selected cu123 option to msaf51
function syncledgerOption() {
  const cu123Select = document.getElementById("cu123");
  const ledgerSelect = document.getElementById("msaf51");

  const selectedValue = cu123Select.value;
  const selectedText = cu123Select.options[cu123Select.selectedIndex]?.text || "";

  // Clear and set new option
  ledgerSelect.innerHTML = "";
  if (selectedValue && selectedText) {
    const newOption = document.createElement("option");
    newOption.value = selectedValue;
    newOption.textContent = selectedText;
    ledgerSelect.appendChild(newOption);
  }
}

// 5. Wait until username appears, then update dropdown
const checkUsername = setInterval(() => {
  const username = document.getElementById("username").textContent.trim();
  if (username) {
    updateDropdown(username);
    clearInterval(checkUsername); // Stop checking
  }
}, 300);

// 6. Attach sync on change event after DOM is ready
document.addEventListener("DOMContentLoaded", function () {
  const cu123Select = document.getElementById("cu123");
  cu123Select.addEventListener("change", syncledgerOption);
});
</script>






<!-- Table Output -->
  <div id="tableContainer" style="background-color: #fef8f6;"></div>

</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections8 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->


<!--  sections9 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section9" class="section hidden">

    <div class="container">  <div class="left" style="background-color: #e3ecf2;color: white;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->


       <div class="form-container">
 <form id="mainSRRForm">
              <input type="hidden" name="SNo" id="sNo" />

             <label  style="color:#fd0505;font-size:90%;font-family:Arial; font-weight: bold;">User*</label>
             <input type="text" id="msaf91" name="User" value="STORE" readonly>


              <label  style="color:#0a0a0a;font-size:90%;font-family:Arial;">Select Date*</label>
  <input type="date" id="msaf92" name="Date" required>
<!-- (VCN-111) dropdown div start -->
<div class="dropdown-container">
    <label for="dropdownSRRSearch" style="color:#0c0c0c;font-size:90%;font-family:Arial;">Search SRR Ledger*</label><br/>
    <input type="text" id="dropdownSRRSearch" placeholder="🔍 Search Ledger..." oninput="filterDropdown()" name="Ledger" required autocomplete="off">
    <ul id="dropdownList" class="dropdown-list">
        <!-- The dropdown options will be populated here -->
    </ul>
</div>
<!-- (VCN-111) dropdown div stop -->

<label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Select Entry Type</label><br/>
  <select id="msaf93" name="cl1" required>
              <option value="">--Select Type--</option>
                <option value="IN">IN</option>
                <option value="OUT">OUT</option>
                <option value="OTHER">OTHER</option>
              </select>
<label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Select Tr. Type</label><br/>
              <select id="msaf94" name="cl2" required>
                <option value="">--Select Type--</option>
                <option value="P">PURCHASE</option>
                <option value="S">SALE</option>
                <option value="RGP">RGP</option>
                 <option value="NRGP">NRGP</option>
                  <option value="C">CHALLAN</option>
                   <option value="O">OTHER</option>
              </select>

               <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Enter Document No.</label><br/>
          <input type="text" id="msaf95" name="cl3" placeholder="Enter Document No." >

                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Enter Weight*</label><br/>
                <input type="number" id="msaf96" name="cl4" placeholder="Enter Weight" required>
                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Item Discription</label><br/>
                <input type="text" id="msaf97" name="cl5" placeholder="Enter Item Discription" required>
                 <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Vehicle No.</label><br/>
                <input type="text" id="msaf98" name="cl6" placeholder="Enter Vehicle No." >

<!-- STATUS WITH INIQU DROPDOWN START here -----------------------------------> 
<label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Select Status</label><br/>
<select id="msaf99" name="cl7" required></select>

<script>
// 1. All dropdown options
const allmsaf99Options = [
  { value: "", text: "Select a Status" },
  { value: "LOAD", text: "LOADING" },
  { value: "UNLOAD", text: "UNLOADING" },
  { value: "---", text: "COMPLETE" },
  { value: "O", text: "OTHER" },
  { value: "✔", text: "VERIFIED" },
  { value: "X", text: "UNVERIFIED" }
];

// 2. User-specific options by index
const userOptionsmsaf99Map = {
  "Anchal": [0,5,6],
  "Mukhtar (Admin)": [0, 1, 2, 3, 4,5,6],
  "Suryabhan": [0, 1,2,3,4]
};

// 3. Populate dropdown based on username
function updateMsaf99Dropdown(username) {
  const msaf99 = document.getElementById("msaf99");
  msaf99.innerHTML = ""; // Clear existing options

  const allowedIndexes = userOptionsmsaf99Map[username] || [];

  allowedIndexes.forEach(index => {
    const optionData = allmsaf99Options[index];
    const option = document.createElement("option");
    option.value = optionData.value;
    option.textContent = optionData.text;
    msaf99.appendChild(option);
  });

  // Optional: handle syncing after change
  syncLedgerMsaf99Option();
}

// 4. Wait until username appears, then update dropdown
const checkMsaf99Username = setInterval(() => {
  const usernameEl = document.getElementById("username");
  if (usernameEl && usernameEl.textContent.trim()) {
    updateMsaf99Dropdown(usernameEl.textContent.trim());
    clearInterval(checkMsaf99Username);
  }
}, 300);

// 5. Attach event listener after DOM is ready
document.addEventListener("DOMContentLoaded", () => {
  const msaf99Select = document.getElementById("msaf99");
  msaf99Select.addEventListener("change", syncLedgerMsaf99Option);
});

// 6. Dummy function for sync (implement as needed)
function syncLedgerMsaf99Option() {
  console.log("Dropdown changed. Implement sync logic here.");
}
</script>
<!-- STATUS WITH INIQU DROPDOWN STOP here -----------------------------------> 

              
              <input type="hidden" name="Timestamp" id="timestampSRR">
              <input type="submit" id="submitSRRButton" value="Submit">
     
        
              <H2 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Entry Modify</H2>
    <!-- Wait message div -->
    <div id="waitSRRMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
   </form>


            <form id="modifySRRForm">
               <input type="hidden" id="formModeSRR" name="formModeSRR" value="new">
              <input type="number" id="searchSRRSNo" placeholder="Enter S.No. to Modify Entry"  />
              <button type="button" class="fetchbtn" onclick="fetchSRRDetails()">Fetch Details</button>
              <button type="button" class="fetchbtn" id="modifySRRButton" onclick="modifySRREntry()" style="display:none;">Modify Entry</button>
    </form>  

<br/><br/><br/>
    </div>



        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->

  <div id="tableDiv"></div>


</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections9 stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->


<!--  sections10 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section10" class="section hidden">

    <div class="container">  <div class="left" style="background-color: rgb(233, 252, 228);color:#003e3f;font-weight: bold;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->

    <div class="form-container">

<form id="mainVCRForm">
        <input type="hidden" name="SNo" id="sNo">
        
        <select id="msaf21"  name="Voucher" style="color: #6803a2 ;font-size:100%;" required>
            <option value="SALE">SALE</option>
        </select>

          <label > Date</label>
         <input type="date" id="msaf11" name="Date" required>
        
        <label > Tr. Type</label>
        <select id="msaf12" name="Type" style="color: #6803a2 ;font-size:100%;" required>
           <option value="TAX INVOICE">Tax Invoice</option>
           <option value="CREDIT NOTE">Credit Note</option>
           <option value="CANCEL">Cancel Invoice</option>
            <option value="CHALLAN">CHALLAN</option>
        </select>

         

        
<!-- Form Section 1: Ledger + Reff -->

    <label for="msaf13">Select VCR Ledger:</label>
    <select class="ledger-dropdown" id="msaf13" required name="Ledger"></select>

    <label for="msaf15">Job/Reff:</label>
    <select class="Reff-dropdown" id="msaf15" required name="Reff"></select>




        <input type="text" id="msaf14" name="VNo" placeholder="Enter Invoice No. (25-26/xxxx)" required >
        

        <input type="text" id="msaf16" name="Amount" placeholder="Enter Amount" required >
        <input type="text" id="msaf17" name="Weight" placeholder="Enter Weight" required >
        <input type="text" id="msaf18" name="Rate" placeholder="Enter Rate" required >

            <input type="text" id="msaf19" name="Narration" placeholder="Narration if any">

         <input type="hidden" name="Timestamp" id="timestampVCR">

        <input type="submit" id="submitVCRButton" value="Submit">

        <H3 style="background-color: #d1f4f7;color: rgb(2, 45, 70);font-size: 120%; text-align: center;font-weight: bold;">Entry Modify</H3>

        <form id="modifyVCRForm">
           <input type="hidden" id="formModeVCR" name="formModeVCR" value="new">
            <input type="number" id="searchVCRSNo" placeholder="Enter S.No. to Modify Entry" >
            <button type="button" class="fetchbtn" onclick="fetchVCRDetails()">Fetch Details</button>
            <button type="button" class="fetchbtn"  id="modifyVCRButton" onclick="modifyVCREntry()" style="display:none;">Modify Entry</button>
             <!-- Wait message div -->
<div id="waitVCRMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
        </form>
    </form>
    

   
</div>   

        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->
  <div id="saleContainer" class="entry-box"></div>
<BR/><BR/>
  <BR/><a href="https://docs.google.com/spreadsheets/d/1Bx0FqnXHadVATN9DGhUtRZr2EDgz10hfDEgIlwtSC_4/edit?gid=2081509697#gid=2081509697" target="_blank" style="color:rgb(1, 41, 1); text-align: center; font-size: 100%;">Click to Open Packing List</a>

 


</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections10stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->


<!--  sections11 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section11" class="section hidden">

    <div class="container">  <div class="left" style="background-color: rgb(248, 238, 238);color: rgb(0, 2, 27);font-weight: bold;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->

    <div class="form-container">

  
<form id="mainBANKForm">
        <input type="hidden" name="SNo" id="sNo">
        <select id="msaf7"  name="Voucher" style="color: #6803a2 ;font-size:100%;" required>
            <option value="RECEIPT">RECEIPT</option>
        </select>

         <label >Date</label>
         <input type="date" id="msaf1" name="Date" required>
        

        <label >Type</label>
        <select id="msaf2" name="Type" style="color: #6803a2 ;font-size:100%;" required>
            <option value="BANK">Receipt (87-1723)</option>
            <option value="CASH">CASH</option>
            <option value="TDS">TDS</option>
        </select>

         
   <!-- Form Section 2: Ledger Only (No Reff dropdown update) -->
  <div class="form-section">
    <label for="msaf3">Select Bank Ledger:</label>
    <select class="ledgerVCRdropdown" id="msaf3" required name="Ledger"></select>
  </div>


   <label >Sekect Dr./Cr.</label>
             <select id="msaf4" name="VType" style="color: #6803a2 ;font-size:100%;" required>
                    <option value="CR">CR</option>
                    <option value="DR">DR</option>
                </select>
         <label >Amount</label>   
         <input type="text" id="msaf5" name="VNo" placeholder="Enter Amount" required >
        <label >Narration</label>
        <input type="text" id="msaf6" name="Narration" placeholder="Narration if any">

        <input type="hidden" name="Timestamp" id="timestampBANK">

        <input type="submit" id="submitBANKButton" value="Submit">
 </form>

 <H3 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Entry Modify</H3>

          <!-- Form for Fetching and Modifying Entries -->
    <form id="modifyBANKForm">
       <input type="hidden" id="formModeBANK" name="formModeBANK" value="new">
        <input type="number" id="searchBANKSNo" placeholder="Enter S.No. to Modify Entry" >
        <button type="button" class="fetchbtn"  onclick="fetchBANKDetails()">Fetch Details</button>
        <button type="button"  class="fetchbtn" id="modifyBANKButton" onclick="modifyBANKEntry()" style="display:none;">Modify Entry</button>
        <div id="waitBANKMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
    </form>

    

    <br/>
        <span style="color:rgb(129, 1, 1);font-size:130%;font-family:Magneto;">eS |</span> 
        <span style="color:#004d80;font-size:130%;font-family:Magneto;">MTally</span>
</div>   

        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->
 <div id="receiptContainer" class="entry-box"></div>

</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections11stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->

<!--  sections12 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section12" class="section hidden">

    <div class="container">  <div class="left" style="background-color: white;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->

    <div class="form-container">

  
<form id="mainIVCRForm">
  <input type="hidden" name="SNo" id="sNo" />

   <label style="color: red;font-weight: bold;">User</label>
  <select id="voucherType" name="Voucher" required style="font-size: 20px; text-align: center;">
  <!-- Populated dynamically -->
</select>



          <label >Select Tr. Type</label>
         <select id="ivcr0" name="Type" required>
           <option value="PAYMENT" style="color: green;">Payment</option>
           <option value="RECEIPT" style="color: red;">Receipt</option>
          
         </select>
           <label >Date</label>
         <input type="date" id="ivcr1" name="Date" required>


          <!-- (VCN- 111) dropdown div start -->
         <div class="dropdown-container" >
            <label >Serch IV Ledger</label>
            <input type="text" id="dropdownIVCRSearch" placeholder="🔍 Search..." oninput="filterIVCRDropdown()" name="Ledger" required>
            <ul id="dropdownIVCRList" class="dropdownCSSlist">
                <!-- The dropdown options will be populated here -->
            </ul>
        </div>
 <!-- (VCN- 111) dropdown div stop -->
        

         <label >Amount</label>
         <input type="number" id="ivcr2" name="Amount" required placeholder="Amount">
          <label >Narration</label>
         <input type="text" id="ivcr3" name="Narration" placeholder="Narration"style="text-transform: uppercase;">

         <input type="hidden" name="Timestamp" id="timestampIVCR">
         <input type="submit" id="submitIVCRButton" value="Submit">
       </form>
   
     <!-- Form for Fetching and Modifying Entries -->
    <form id="modifyIVCRForm">
      <input type="hidden" id="formModeIVCR" name="formModeIVCR" value="new">
        <input type="number" id="searchIVCRSNo" placeholder="Enter S.No. to Modify Entry" >
        <button type="button" class="fetchbtn" onclick="fetchIVCRDetails()">Fetch Details</button>
        <button type="button" class="fetchbtn" id="modifyIVCRButton" onclick="modifyIVCREntry()" style="display:none;">Modify Entry</button>
        <!-- Wait message div -->
<div id="waitIVCRMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
       </form>

    <br/>
        <span style="color:rgb(129, 1, 1);font-size:130%;font-family:Magneto;">eS |</span> 
        <span style="color:#004d80;font-size:130%;font-family:Magneto;">MTally</span>
</div>   

        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->

    <!-- IV User Selection -->
     
 <!-- IV User Selection -->
<label style="font-size: 20px; font-weight: bold;">Select IV User:</label>
<select id="ivuser" style="width: 3in; font-size: 16px; text-align: center; background-color: #014060;color: white;">

</select>


<script>
// 1. All dropdown options
const allivuserOptions = [
{ value: "", text: "Select a User" },
  { value: "IV03", text: "RAHUL KUMAR-IV03" },
  { value: "IV08", text: "NITIN KUMAR-IV08" },
  { value: "IV09", text: "SUNIL KUMAR-IV09" },
  { value: "IV04", text: "RAJU-IV04" },
  { value: "IV05", text: "MANNU-IV05" },
   { value: "IV06", text: "AAKASH-IV06" },
  { value: "IV07", text: "MANJEET-IV07" },
  { value: "IV10", text: "AJAY KUMAR-IV10" }
];

// 2. Which user sees which options
const userOptionsivuserMap = {
   "NITIN": [0,2],          // 
  "Anchal": [0,2, 3,4,5,6,7,8],              // 
  "Mukhtar (Admin)": [0, 1, 2, 3,4,5,6,7,8],   // All options
   "Rahul Kumar": [0,1]   // All options
};

// 3. Populate ivuser dropdown based on username
function updateivuserDropdown(username) {
  const ivuser = document.getElementById("ivuser");
  ivuser.innerHTML = ""; // Clear existing options

  const allowedIndexes = userOptionsivuserMap[username] || [];

  allowedIndexes.forEach(index => {
    const option = document.createElement("option");
    option.value = allivuserOptions[index].value;
    option.textContent = allivuserOptions[index].text;
    ivuser.appendChild(option);
  });

  // Trigger sync after populating ivuser
  syncledgerivuserOption();
}

// 4. Sync selected ivuser option to voucherType
function syncledgerivuserOption() {
  const ivuserSelect = document.getElementById("ivuser");
  const ledgerSelect = document.getElementById("voucherType");

  const selectedValue = ivuserSelect.value;
  const selectedText = ivuserSelect.options[ivuserSelect.selectedIndex]?.text || "";

  // Clear and set new option
  ledgerSelect.innerHTML = "";
  if (selectedValue && selectedText) {
    const newOption = document.createElement("option");
    newOption.value = selectedValue;
    newOption.textContent = selectedText;
    ledgerSelect.appendChild(newOption);
  }
}

// 5. Wait until username appears, then update dropdown
const checkivuserUsername = setInterval(() => {
  const username = document.getElementById("username").textContent.trim();
  if (username) {
    updateivuserDropdown(username);
    clearInterval(checkivuserUsername); // Stop checking
  }
}, 300);

// 6. Attach sync on change event after DOM is ready
document.addEventListener("DOMContentLoaded", function () {
  const ivuserSelect = document.getElementById("ivuser");
  ivuserSelect.addEventListener("change", syncledgerivuserOption);
});
</script>




  <table id="myIVCRTable" style="background-color: rgb(239, 249, 246);"></table>

</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections12stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->



<!--  sections13 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section13" class="section hidden">

    <div class="container">  <div class="left" style="background-color: #e2e5e6;">   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->

      <label style="font-size: 16px; font-weight: bold;color: rgb(1, 25, 68);">Select Voucher:</label>
<select id="designUSER" required onchange="showForm(this.value)" style="width: 3in; font-size: 18px; text-align: center; background-color: #030010;color: rgb(247, 247, 247);">
     <option value="MFDY">Modify Entry</option>
      <option value="CREAT">New Job/Reff No.</option>
</select>


    <div class="form-container">

<div id="formContent">
    <!-- Form will be injected here -->
  </div>
       
</div>   

        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->

  <!-- यह एक नोट है, uniq option selectio id msaf71 start -->
   <label style="font-size: 20px; font-weight: bold;">Select Job/Reff User:</label>
 <select id="jobreffuser" name="Type" required style="width: 3in; font-size: 16px; text-align: center; background-color: #014060;color: white;"></select> 
<script>
// 1. All dropdown options
const alljobreffuserOptions = [
{ value: "", text: "Select a User" },
  { value: "PRAKHAR", text: "PRAKHAR" },
  { value: "HARSHIT", text: "HARSHIT" }
];

// 2. Which user sees which options
const userOptionsjobreffuserMap = {
  "Prakhar": [0,1],              // TUSHAR, JOURNAL, BANK
  "Mukhtar (Admin)": [0, 1, 2],   // All options
   "Harshit": [0,2]   // All options
};

// 3. Populate jobreffuser dropdown based on username
function updatejobreffuserDropdown(username) {
  const jobreffuser = document.getElementById("jobreffuser");
  jobreffuser.innerHTML = ""; // Clear existing options

  const allowedIndexes = userOptionsjobreffuserMap[username] || [];

  allowedIndexes.forEach(index => {
    const option = document.createElement("option");
    option.value = alljobreffuserOptions[index].value;
    option.textContent = alljobreffuserOptions[index].text;
    jobreffuser.appendChild(option);
  });

  // Trigger sync after populating jobreffuser
  syncledgerjobreffuserOption();
}

// 4. Sync selected jobreffuser option to msaf71
function syncledgerjobreffuserOption() {
  const jobreffuserSelect = document.getElementById("jobreffuser");
  const ledgerSelect = document.getElementById("msaf71");

  const selectedValue = jobreffuserSelect.value;
  const selectedText = jobreffuserSelect.options[jobreffuserSelect.selectedIndex]?.text || "";

  // Clear and set new option
  ledgerSelect.innerHTML = "";
  if (selectedValue && selectedText) {
    const newOption = document.createElement("option");
    newOption.value = selectedValue;
    newOption.textContent = selectedText;
    ledgerSelect.appendChild(newOption);
  }
}

// 5. Wait until username appears, then update dropdown
const checkjobreffuserUsername = setInterval(() => {
  const username = document.getElementById("username").textContent.trim();
  if (username) {
    updatejobreffuserDropdown(username);
    clearInterval(checkjobreffuserUsername); // Stop checking
  }
}, 300);

// 6. Attach sync on change event after DOM is ready
document.addEventListener("DOMContentLoaded", function () {
  const jobreffuserSelect = document.getElementById("jobreffuser");
  jobreffuserSelect.addEventListener("change", syncledgerjobreffuserOption);
});
</script>

<!-- यह एक नोट है, uniq option selectio id stop start -->




<div id="results"></div> <!-- For displayJOBNOResults function -->


<div style="display: flex; align-items: center; gap: 10px;">
    <select id="filterType" onchange="jobPOreffDropdown()" style="background-color: #0026ff; color: white;">
        <option value="latestEntry">Latest 10 Entries</option>
        <option value="allJobreff">All JOB/REFF Entries</option>
        <option value="userHarshit">Harshit's Entries</option>
        <option value="userPrakhar">Prakhar's Entries</option>
    </select>
    
    <div id="summary"></div>
    <div id="jobRefResults" style="color: red;"></div>
</div>


  <BR/><a href="https://docs.google.com/spreadsheets/d/1Bx0FqnXHadVATN9DGhUtRZr2EDgz10hfDEgIlwtSC_4/edit?gid=2081509697#gid=2081509697" target="_blank" style="color:blue; text-align: center; font-size: 100%;">Click to Open Packing List</a>



   <div id="jobReffContainer" class="entry-box"></div>   <!-- top 10 job/reff no by function fetchData(); (close) script --> 
 
 

</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections13stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->




<!--  sections14 start  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -->
      <div id="section14" class="section hidden">

    <div class="container">  <div class="left" >   <!-- यह एक नोट है, vertical Two Part Div (30-70) left content start ((CODE501)) -->

    <div class="form-container">

      
            <form id="mainSKHRForm">
              <input type="hidden" name="SNo" id="sNo" />

              <label for="dropdownskhrSearch" style="color:#f90404;font-size:90%;font-family:Arial;font-weight: bold;" >User*</label><br/>
              <select id="msaf101" name="User" required>
                <option value="SHEKHER">SHEKHER</option>
              </select>

              <label  style="color:#0a0a0a;font-size:90%;font-family:Arial;">Select Date*</label>
  <input type="date" id="msaf102" name="Date" required>

  <!-- (VCN- 112) dropdown div start -->
<div class="dropdown-container">
<label for="dropdownskhrSearch" style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Search SKHR Ledger*</label><br/>
<input type="text" id="dropdownskhrSearch" placeholder="🔍 Search .." oninput="filterSKHRDropdown()" name="Ledger" required autocomplete="off">
<ul id="dropdownSKHRList" class="dp-list">
<!-- The dropdown options will be populated here -->
</ul>
</div>
<!-- (VCN- 112) dropdown div stop -->
                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Enter Weight*</label><br/>
                <input type="text" id="msaf103" name="cl1" placeholder="Enter Weight" required>
                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Rate</label><br/>
                <input type="text" id="msaf104" name="cl2" value="3.9" readonly>
                <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Amount</label><br/>
                <input type="text" id="msaf105" name="cl3" placeholder="Enter Amount" required readonly>
                
                <script>
                function calculateAmount() {
                  const weight = parseFloat(document.getElementById('msaf103').value) || 0;
                //  const rate = parseFloat(document.getElementById('msaf104').value) || 0;    if rate manual type than use this code
                const rate = 3.9; // Fixed rate
                  const amount = weight * rate;
                
                  document.getElementById('msaf105').value = amount.toFixed(); // two decimal places
                }
                
                // Attach the event listeners to both input fields
                document.getElementById('msaf103').addEventListener('input', calculateAmount);
              //  document.getElementById('msaf104').addEventListener('input', calculateAmount);   if rate manual type than use this code
                </script>
           <label  style="color:#0c0c0c;font-size:90%;font-family:Arial;" >Enter Narration If Any</label><br/>
          <input type="text" id="msaf106" name="cl4" placeholder="Enter Narration" >
              
              <input type="hidden" name="Timestamp" id="timestampSKHR">
              <input type="submit" id="submitSKHRButton" value="Submit">
            </form>
        
    
            <form id="modifySKHRForm">
               <input type="hidden" id="formModeSKHR" name="formModeSKHR" value="new">
              <input type="number" id="searchSKHRSNo" placeholder="Enter S.No. to Modify Entry" required />
              <button type="button" class="fetchbtn" onclick="fetchSKHRDetails()">Fetch Details</button>
              <button type="button" class="fetchbtn" id="modifySKHRButton" onclick="modifySKHREntry()" style="display:none;">Modify Entry</button>
    
              <!-- Wait message div -->
    <div id="waitSKHRMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
            </form>
      
    <br/>
        <span style="color:rgb(129, 1, 1);font-size:130%;font-family:Magneto;">eS |</span> 
        <span style="color:#004d80;font-size:130%;font-family:Magneto;">MTally</span>
</div>   

        </div> <!-- यह एक नोट है, vertical Two Part Div (30-70) left content stop -->
<div class="right"> <!-- यह एक नोट है, vertical Two Part Div (30-70) right content start -->

  

 <style>
        .date-filter-row {
          display: flex;
          align-items: center;
          gap: 10px;
          margin-bottom: 20px;
          flex-wrap: wrap;
        }
      
        .date-filter-row label {
          font-size: 14px;
        }
      
        .date-filter-row input[type="date"],
        .date-filter-row button {
          width: 192px; /* ~2 inches */
          padding: 6px 10px;
          font-size: 14px;
          box-sizing: border-box;
        }
      
        .date-filter-row input[type="date"] {
          border: 1px solid #ccc;
          border-radius: 4px;
        }
      
        .date-filter-row button {
          background-color: #0077b6;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
        }
      
        .date-filter-row button:hover {
          background-color: #005f8a;
        }
      </style>
      <div class="date-filter-row">
        <label for="fromDate">From: </label>
        <input type="date" id="fromDate">
      
        <label for="toDate">To: </label>
        <input type="date" id="toDate">
      
        <button onclick="filterSKHRByDate()">Filter by Date</button>
        <button id="printButton" onclick="printSHEKHERTable()">Print</button>
      </div>
      
<div id="tableSKHRDiv"></div>


</div> </div>  <!-- यह एक नोट है, vertical Two Part Div (30-70) container content stop  Heare ((CODE501)) -->
</div> <!--  sections14stop  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA  X -->
    
    </div>  <!-- sections Div close-->
  </div>  <!-- Dashboard div open -->
<!-- ============================================== sections stop =============================================================== -->
<!-- Dashboard div stop !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->






<!-- ==============================================footer start================================================================================ -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fixed Footer Example</title>
  <style>
  body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    position: relative;
    font-family: Arial, sans-serif;
  }

  .footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: #5c0a02;
    color: white;
   
    text-align: center;
    padding: 0; /* Remove padding */
    font-size: 14px;
    z-index: 1000;
    box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.3);
   
  }

  .footer table {
    margin: 0;               /* Remove default table margin */
    padding: 0;              /* Remove default table padding */
    border-spacing: 0;       /* Remove spacing between table cells */
    border-collapse: collapse; /* Optional: tighter table */
    width: 100%;  
          
  }

  .footer td {
     padding: 5px 10px; /* Top-Bottom = 0, Left-Right = 10px gap */
  }
</style>

</head>
<body>


  <div class="footer" >   <!-- footer div start---- -->


 <!-- dialog box div code and css start///////////////////////////////////////////// -->

<!-- ✅ Fullscreen Overlay/Backdrop -->
<div id="dialogBackdrop" style="
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(233, 115, 115, 0.8);  /* 50% black dim */
  z-index: 1000;
"></div>

<!-- ✅ Dialog Box -->
<div id="daybookDialog" style="
  display: none;
  position: fixed;
  top: 46%; left: 50%;
  transform: translate(-50%, -50%);
  width: 20in;
  height: 8.2in;
  background-color: white;
  border: 10px solid #913300;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  z-index: 1000;
">

  <!-- Header 1 -->
  <div style="
    background-color: #090909;
    color: white;
    padding: 10px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  
    font-weight: bold;
  ">
    <span style="color: red;">📘 Daybook</span>
   

      <div id="balance" style="background: #080808;color: white; border: none;">  </div>

    
        <button id="printdaybook" onclick="printdaybook()" style="background: #080808;color: white; border: none; cursor: pointer;">Print</button>
    

     <span style="cursor: pointer; font-size: 18px;" onclick="closeDialog()">❌</span>
  </div>


    <!-- Header 2 -->
  <div style="
    background-color: #e7e8ea;
    color: rgb(12, 12, 12);
    padding: 10px 15px;
    display: flex;
    
    align-items: center;
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
    font-weight: bold;
  ">
       
        <label style="color: #000d1d ;font-size:90%;">Search </label>&nbsp;
        <input type="text" id="searchBar" placeholder="🔍 Search for Ledger, Job No., Vehicle No.,Narration.." /> 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <label style="color: #000d1d ;font-size:90%;">Select Day:</label>&nbsp;
        <input type="date" id="dateFilter" />
  </div>

     <div id="totals">
           <span style="color: #680268 ;font-size:90%;">Invoice Amt:</span>  	Rs.	<span id="totalInvoice">0.00</span> |
           <span style="color: #037e71 ;font-size:90%;">Weight:</span>  		Kg. 	<span id="totalWeight">0.00</span>  |
           <span style="color: #8f3f02 ;font-size:90%;">Receipt:</span> 		Rs. 	<span id="totalBankInvoice">0.00</span> |
           <span style="color: blue ;font-size:90%;">TDS:</span>  		Rs.	<span id="totalTdsInvoice">0.00</span>
           
   </div>

  <!-- Content -->
  <div style="
    padding: 20px;
    overflow-y: auto;
    height: calc(100% - 60px);
    font-family: Arial, sans-serif;
    font-size: 15px;
  ">

 
    <table id="miplTable" class="hidden" style="background-color: rgb(255, 255, 255);height: 560px; overflow-y: auto;"> </table>
    <p style="color: #002044;">Search Ledger, Job No., Bank & Invoice Entry content table or inputs here.</p>
  </div>
</div>


<script>
  function openDialog() {
    document.getElementById("dialogBackdrop").style.display = "block";
    document.getElementById("daybookDialog").style.display = "block";

    // Optional: Lock body scroll
    document.body.style.overflow = 'hidden';
  }

  function closeDialog() {
    document.getElementById("dialogBackdrop").style.display = "none";
    document.getElementById("daybookDialog").style.display = "none";

    // Restore body scroll
    document.body.style.overflow = 'auto';
  }
</script>


  <!-- daybook filter and serchbar code stop hare -->







    <!-- section1B content start hare *********************************************************************************************************-->
<div id="section1b" class="section hidden" style="background-color: rgb(1, 51, 92);border: none;">


<div style="height:30vh; overflow-y:auto; overflow-x:auto; border:1px solid #ccc; padding:8px;">

   <table id="myTable" style="background-color: rgb(245, 243, 243); color: blue;"> </table>  <!-- Address bar Table -->
 

   <style>
  /* Table container */
  #MIPLDATATABLE {
    width: 100%;
    border-collapse: collapse;
    font-family: "Segoe UI", Tahoma, Arial, sans-serif;
    font-size: 14px;
    background: #ffffff;
    color: black;
    box-shadow: 0px 2px 8px rgba(0,0,0,0.15);
    border-radius: 8px;
    overflow: hidden;
    table-layout: fixed; /* columns fixed width */
  }

  /* Table border & cell style */
  #MIPLDATATABLE th, 
  #MIPLDATATABLE td {
    border: 1px solid #dcdcdc;
    padding: 8px 10px;
    text-align: left;
    overflow: hidden;
    text-overflow: ellipsis; /* show ... if text overflow */
    vertical-align: middle;
    font-size: clamp(10px, 1vw, 14px); /* auto shrink text */
  }

  /* Header design */
  #MIPLDATATABLE th {
    background: linear-gradient(135deg, #620101, #f03838);
    color: #fff;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 13px;
    letter-spacing: 0.5px;
  }

  /* Alternate row coloring */
  #MIPLDATATABLE tr:nth-child(even) {
    background-color: #f9f9f9;
  }

  /* Row hover effect */
  #MIPLDATATABLE tr:hover td {
    background: #fce303;
    transition: background 0.2s ease-in-out;
  }

  #MIPLDATATABLE tr:hover {
    background-color: #f81404;
    color: rgb(1, 20, 37);
    transition: background-color 0.3s ease, color 0.3s ease;
  }
</style>

<table id="MIPLDATATABLE"></table>
</div>
    

 
<table style="background-color:#011d30 ;text-align: center; color:WHITE; border: none;">

<td style="text-align: center; color:WHITE; border: none; background-color: #011d30;">
    <a href="https://www.google.co.in/" target="_blank"><img src="https://cdn.dribbble.com/users/1717214/screenshots/4124610/g-logo.gif" alt="Gmail" width="50" height="50" /></a>
    </td>
    <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">
    <a href="https://accounts.zoho.in/signin?servicename=VirtualOffice&signupurl=https://www.zoho.com/mail/zohomail-pricing.html&serviceurl=https://mail.zoho.in" target="_blank"><img src="https://zenatta.com/wp-content/uploads/2020/08/mail-256-300x300.png" alt="Gmail" width="60" height="60" /></a>
    </td>
    <td style="text-align: center; color:WHITE;border: none;">
    <a href="https://mail.google.com/mail/u/0/" target="_blank"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSjpEIz6vZxfKx_cLh8Y6tDWalIuwi08MCggUEXk8cXLAy8NUilIHwNgrsjtFIxgEWCWAE&usqp=CAU" alt="You Tube" width="50" height="50" /></a>
    </td>
    <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">
    <a href="https://ibanking.pnb.bank.in/" target="_blank"><img src="https://cracku.in/latest-govt-jobs/wp-content/uploads/2021/01/PNB-Logo.png" alt="Google" width="50" height="50" /></a>
    </td>
    <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">
    <a href="https://retail.onlinesbi.sbi/retail/login.htm" target="_blank"><img src="https://image3.mouthshut.com/images/ImagesR/2015/12/State-Bank-Anywhere-925771560-7182350-1.png" width="50" height="50" /></a>
    </td>
    <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">
    <a href="https://netbanking.hdfcbank.com/netbanking/"  target="_blank"><img src="https://p.kindpng.com/picc/s/284-2843275_online-donation-shri-ramakrishna-ashrama-rajkot-using-hdfc.png" alt="You Tube" width="50" height="50" /></a>
    </td>
    
    <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">
    <a href="https://www.youtube.com/" target="_blank"><img src="http://3d-sprinter.ru/pictures/youtube256-2-on.gif" alt="You Tube" width="50" height="50" /></a>
    </td>
    
    <td style="text-align: center; color:WHITE;border: none; background-color: #011d30; ">
    <a href="https://www.facebook.com/" target="_blank"><img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExNTZuaHQ1ZjdnajNwMWtrZHVhN3Q4djdwMDZmYWZuYzRoYTA0Ymx4MiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/IeRI0TleieCJ6ytPUr/giphy.gif" alt="You Tube" width="50" height="50" /></a>
     </td>
    
    <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">
      <a href="https://web.whatsapp.com/" target="_blank"><img src="https://cliply.co/wp-content/uploads/2021/08/372108180_WHATSAPP_ICON_400.gif" alt="You Tube" width="50" height="50" /></a>
        </td>


              <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">
                <a href="https://ssp.elcom.digital/" target="_blank"><img src="https://tallyerp9download.com/wp-content/uploads/2020/11/tally-prime-server-1-300x56.jpg" alt="You Tube" width="100" height="30" /></a>
                  </td>
                

                      <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">
                        <a href="https://chatgpt.com/" target="_blank"><img src="https://static.vecteezy.com/system/resources/previews/022/841/114/original/chatgpt-logo-transparent-background-free-png.png" alt="You Tube" width="60" height="50" /></a>
                          </td>

                      <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">
                        


                        <span style="color:#fcfcff;font-size:130%;font-family:Magneto;">eS |</span> 
                                    <span style="color:#cacacc;font-size:130%;font-family:Magneto;">MTally</span> 
                       </td>

                       <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">
                        <a href="https://services.gst.gov.in/services/login" target="_blank"><img src="https://cdn.uxhack.co/product_logos/gstn_logo.jpg" alt="You Tube" width="60" height="60" /></a>
                          </td>

                          <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">
                            <a href="https://ewaybillgst.gov.in/Login.aspx" target="_blank"><img src="https://bizdesk.in/wp-content/uploads/2019/11/E-Way-Bills-as-Per-New-GST-Rules.png" alt="You Tube" width="60" height="60" /></a>
                              </td>
                              <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">
                                <a href="https://einvoice1.gst.gov.in/Others/GetPinCodeDistance" target="_blank"><img src="https://www.shutterstock.com/image-vector/distance-pin-icon-flat-style-260nw-1416511856.jpg" alt="You Tube" width="60" height="60" /></a>
                                  </td>
                                  <td style="text-align: center; color:WHITE;border: none;background-color: #011d30;">
                                <a href="https://m5792.github.io/esm/" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/1197/1197396.png" alt="You Tube" width="60" height="60" /></a>
                                  </td>

   <td style="text-align: center; color:WHITE;border: none; background-color: #011d30;">    
    <label style="color: white;"> Daybook Search :</label>                            <!-- Search Box -->
<input type="text" id="DATASEARCMIPL" placeholder="🔍 Search Ledger, Invoice, Reff, Vehicle No...." style="padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; margin-bottom:10px; width:200px; width: 4in; background-color: rgb(241, 212, 212);" />
</td>
</table>

 </div>  <!-- section1B content stop hare *********************************************************************************************************-->


 <!-- section2B content start hare *********************************************************************************************************-->
      <div id="section2b" class="section hidden">

          <div id="userTotals" >
            <span>Total Receipt:</span> <span id="totaluserReceipt">0</span> |
            <span>Total Payment:</span> <span id="totaluserPayment">0</span> |
            <span>Total Payable Bill:</span> <span id="totaluserBilldr">0</span> |
            <span>Total Receivd Bill:</span> <span id="totaluserBillcr">0</span> |
            <span>Total Salary:</span> <span id="totaluserSalary">0</span> |
            <span>Balance:</span> <span id="totaluserDifference">0</span>
        </div>
        
 <div id="search123Container">
    
           <blink> <span style="color:rgb(1, 60, 60);font-size:120%;font-family:Arial Black;" id="resultDiv">Users & Cash Ledger Report</span> </blink> <br/>
    
            <label style="font-weight: bold;">Ledger:</label>
            <select id="filteruserColumn4"></select>
    
            <label style="font-weight: bold;  color: red ;">From:</label>
            <input type="date" id="starusertDate">
    
            <label style="font-weight: bold;  color: red ;">To:</label>
            <input type="date" id="enduserDate">
    
            <label style="font-weight: bold;">User:</label>
            <select id="filterusrColumn1"></select>
    
            <label style="font-weight: bold;">Voucher:</label>
            <select id="filteruserColumn2"></select>
    
            <button onclick="printuserTable()">🖨️ Print</button>  
        </div>
    
      
      </div>  <!-- section2B content stop hare *********************************************************************************************************-->

      
<!-- section3B content start hare *********************************************************************************************************-->
<div id="section3b" class="section hidden">

   <div id="totalsmipl" style="font-size: 16px; font-weight: bold;">
                <span>Total Receipt:</span> <span id="totalReceipt">0</span> |
                <span>Total TDS:</span> <span id="totalTds">0</span> |
                <span>Total Bill:</span> <span id="totalBill">0</span> |
                <span>Total Credit Note:</span> <span id="totalCn">0</span> |
                <span>Total Weight:</span> <span id="totalPEBWeight">0</span> |
                <span>Balance:</span> <span id="totalDifference">0</span>
            </div>
        
<div id="searchPEBContainer">
        
               <blink> <span style="color:#014384;font-size:120%;font-family:Arial Black;">MIPL Ledger Report</span> </blink><br/>
        
               <label style="font-weight: bold;">Ledger:</label>
                <select id="filterColumn4"></select> 
               
               <label style="font-weight: bold;">Job No.:</label>
                <select id="filterColumn2"></select>
        
                <label style="font-weight: bold;">Type:</label>
                <select id="filterColumn1"></select>
        
                <label style="font-weight: bold; color: red ;">From:</label>
                <input type="date" id="startDate">
        
                <label style="font-weight: bold;  color: red ;">To:</label>
                <input type="date" id="endDate">
        
                <button onclick="printpebTable()">🖨️ Print</button>  
            </div>
        
           

      </div>  <!-- section3B content stop hare *********************************************************************************************************-->

      <div id="section5b" class="section hidden" style="background-color: #d7d9dc;">  <!-- section5B content START hare ****-->
        
          <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
    <div id="poSummaryBox" style="color: rgb(0, 30, 38); padding-left: 10px;">Summary</div>
    <div style="display: flex; align-items: center; gap: 8px; padding-right: 10px;">
      <label for="search123Input" style="color: rgb(1, 17, 53);">Search:</label>
      <input type="text" id="search123Input" placeholder="🔍 Search..." style="padding: 4px 8px; border-radius: 4px; border: none;" />
    </div>
  </div>
      
      </div> <!-- section5B content stop hare ****-->

      <!-- section4B content start hare *********************************************************************************************************-->
       <div id="section4b" class="section hidden">

        <div id="totalsIV">
                <span>Total Receipt:</span> <span id="totalIVReceipt">0</span> |
                <span>Total Payment:</span> <span id="totalIVPayment">0</span> |
                <span>Total Bill:</span> <span id="totalIVBill">0</span> |
                <span>Total Salary:</span> <span id="totalIVSalary">0</span> |
                <span>Balance:</span> <span id="totalIVDifference">0</span>
            </div>

         <div id="searchIVContainer">
                <blink> <span style="color:#012400;font-size:120%;font-family:Arial Black;"id="resultIVDiv"> Imprest Voucher Report  </span> </blink> <br/>
        
                <label style="font-weight: bold;">Ledger:</label>
                <select id="filterIVColumn4"></select>
        
                <label style="font-weight: bold;  color: red ;">From:</label>
                <input type="date" id="starIVtDate">
        
                <label style="font-weight: bold;  color: red ;">To:</label>
                <input type="date" id="endIVDate">
        
                <label style="font-weight: bold;">User:</label>
                <select id="filterIVColumn1"></select>
        
                <label style="font-weight: bold;">Voucher:</label>
                <select id="filterIVColumn2"></select>
        
                <button onclick="printIVTable()">🖨️ Print</button>  
            </div>

      </div>  <!-- section4B content stop hare *********************************************************************************************************-->




      <div id="section7b" class="section hidden">    <!--  sections7b start  *****************************************-->


<style>
  .input-row {
    display: flex;
    align-items: center;
    gap: 10px; /* space between dropdown and input */
    font-size: 20px;
    color: #000;
  }

  #sheetSelector {
    width: 4in;
    font-size: 16px;
  
  }
</style>



<div id="searchDiv">

   <label for="sheetSelector" style="color: black;font-size: 20px;">Select Sheet:</label>
  <select id="sheetSelector" style="width: 6in; height: 30px; font-size:15px;" onchange="loadusrAdminSheet()">
    <option value="psw">ID/Password View</option>
    <option value="mpr">CASH LEDGER REPORT</option>
    <option value="ivcr">IMPREST VOUCHER REPORT</option>
    <option value="sale">SALE VOUCHER REPORT</option>
    <option value="po">PURCHASE ORDER REPORT </option>
    
  </select>
           <label  style="color: black;font-size: 20px;">Search in Sheet:</label>
            <input type="text" id="searchbarAdmin" style="width: 6in; height: 30px; font-size:20px;" placeholder="🔍 Search Heare ..." />
        </div>

</div>  <!--  sections7b stop  *****************************************-->



<!-- section9B content start hare *********************************************************************************************************-->
 <div id="section9b" class="section hidden">
        
        
<style>
      #divsrr {
            position: sticky;
            top: 0;
           left: 0;
      width: 100%;
      background: #ebecec;
      padding: 10px 20px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1000;
      color: #000;
        }

        .divsrr select,
    .divsrr input,   .divsrr date  {
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }
       
      </style>
      <div id="divsrr">

        
  <blink> <span style="color:rgb(1, 60, 60);font-size:120%;font-family:Arial Black;" id="resultDiv">Store Ragister Voucher</span> </blink> <br/>
        <label for="fromSRRDate">From: </label>
        <input type="date" id="fromSRRDate">
      
        <label for="toSRRDate">To: </label>
        <input type="date" id="toSRRDate">
      
        <button onclick="filterByDate()">Filter by Date</button>
        <button id="printButton" onclick="printSRRTable()">Print</button>
      </div>
      
     
</div>  <!-- section9B content stop hare *******************************************************************-->




<!-- section14B content start hare *********************************************************************************************************-->
 <div id="section14b" class="section hidden">
  <blink><span style="color:#012760;font-size:120%;font-family:Arial Black;">Chander Shekher</span> </blink><br/>      
    
<div id="summaryRow" style="display: flex; justify-content: center; gap: 30px; font-weight: bold; font-size: 20px; color: black;">
  
  <div id="totalWeightDiv"></div>
  <div id="totalAmountDiv"></div>
  <div id="retentionDiv"></div>
  <div id="tdsSKHRDiv"></div>
  <div id="billAmountDiv"></div>
</div>

     
</div>  <!-- section14B content stop hare *******************************************************************-->







   <!-- Current date and time will be displayed here -->
            
<meta name="viewport" content="width=device-width, initial-scale=1.0">
            
<div style="display: flex; flex-direction: row; align-items: center; background-color: #002044; color: rgb(249, 252, 229); font-size: 20px; font-weight: bold;">
  
  <!-- Current Time -->
  <div id="currentDateTime" style="padding: 10px 20px; white-space: nowrap;"></div>

  <!-- Scrolling News Ticker -->
  <marquee behavior="scroll" direction="left" scrollamount="5" style="flex: 1;">
    <div style="display: inline-flex; align-items: center; gap: 8px;">
     
      <span id="newsTickerContent" style="color: white; font-size: 16px;"></span>
    </div>
  </marquee>

</div>
 
<script>
function displayCurrentDateTime() {
const now = new Date();

// Formatting options
const options = { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric', 
    hour: '2-digit', 
    minute: '2-digit', 
    second: '2-digit' 
};

// Formatting date and time
const formattedDateTime = now.toLocaleString('en-US', options);

// Displaying in the div
document.getElementById("currentDateTime").textContent = `Today: ${formattedDateTime}`;
}

// Call the function on page load to show the current date and time
displayCurrentDateTime();

// Update the date and time every second
setInterval(displayCurrentDateTime, 1000);
</script>
<!-- Current date and time will be displayed Stop -->

  </div>    <!-- footer div stop---- -->

</body>
</html>
<!-- ==============================================footer stop================================================================================ -->






<!-- यह एक नोट है, -------------------------  SCRIPT AND CODE START----------------------------------------- -->
      
<!-- यह एक नोट है, vertical Two Part Div (30-70) code start  Heare  (CODE501) -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>70-30 Split</title>
    <style>
        .container {
            display: flex;
           

            flex-direction: row; /* Arrange child divs side-by-side (flex-direction: column;) */

          /*  flex-direction: column;  Arrange child divs vertically */
            height: 85vh; /* Full viewport height */
        }
      .left {
    flex: 2; /* 70% */
    background-color: #dddedf;
      border: 7px solid #004d80;
      padding: 10px;
      z-index: 99;
      overflow-y: auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      border-radius: 8px;
}

.right {
    flex: 8; /* 30% */
    background-color: #eaeaea;
    padding: 20px;
    overflow: auto; /* Scroll content if it overflows */
}
    </style>


 <style>
        .container2 {
            display: flex;
           

            flex-direction: row; /* Arrange child divs side-by-side (flex-direction: column;) */

          /*  flex-direction: column;  Arrange child divs vertically */
            height: 48vh; /* Full viewport height */
        }
      .leftdiv {
    flex: 5.4; /* 70% */
    background-color: #e7eef5;
      border: 3px solid #004d80;
      padding: 10px;
      z-index: 99;
      overflow-y: auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      border-radius: 8px;
   
}

.rightdiv {
    flex: 4.6; /* 30% */
    background-color: #eaeaea;
    border: 3px solid #004d80;
      padding: 10px;
      z-index: 99;
    overflow: auto; /* Scroll content if it overflows */
    border-radius: 8px;
}
    </style>
</head>
<body>
</body> </html>
  <!-- यह एक नोट है, vertical Two Part Div (30-70) code stop  Heare -->



<!-- eventa & reminder script stop home section stop site -->

<!DOCTYPE html>
<html>
<head>
  <title>Event Reminder</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f0f0f0; }
    .event-section { margin-bottom: 20px; padding: 15px; background: white; border-radius: 10px; }
    h2 { margin-bottom: 10px; color: #004080; }
    ul { padding-left: 20px; }
    li { margin-bottom: 5px; cursor: default; }
    li.clickable:hover { text-decoration: underline; cursor: pointer; }

    /* Popup Modal */
    #popupOverlay {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none; justify-content: center; align-items: center;
    }
    #popupBox {
      background: white; padding: 20px; border-radius: 10px;
      max-width: 400px; box-shadow: 0 0 10px gray;
      width: 4in;
      height: 3in;
    }
    #closeBtn {
      float: right; cursor: pointer; color: red; font-weight: bold;
    }
    #popupContent a {
      text-decoration: none;
      font-size: 18px;
      color: #015187;
      margin-left: 5px;
    }
    #popupContent a:hover {
      text-decoration: underline;
      color: #d00;
    }
  </style>
</head>
<body>



<!-- Popup Box -->
<div id="popupOverlay">
  <div id="popupBox">
    <span id="closeBtn" onclick="closePopup()">✖</span>
    <div id="popupContent"></div>
  </div>
</div>



<script>
  const style = document.createElement("style");
  style.textContent = `
    .monthly { color: #871301; }
    .yearly { color: #007509; }
    .today { color: #015187; }
    .clickable { cursor: pointer; }
    .clickable:hover { text-decoration: underline; }
  `;
  document.head.appendChild(style);

  const apiEVENTKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
  const sheetEVENTId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
  const rangeEVENT = 'HOLIDAY!A:D';

  const today = new Date();

  function parseDate(input) {
    const parts = input.split("-");
    if (parts.length === 3) {
      const day = parseInt(parts[0]);
      const month = new Date(Date.parse(parts[1] + " 1, 2000")).getMonth();
      const year = parts[2].length === 2 ? parseInt("20" + parts[2]) : parseInt(parts[2]);
      return new Date(year, month, day);
    } else if (parts.length === 2) {
      const day = parseInt(parts[0]);
      const month = new Date(Date.parse(parts[1] + " 1, 2000")).getMonth();
      return new Date(today.getFullYear(), month, day);
    }
    return null;
  }

  function showPopup(content) {
    const popupContent = document.getElementById('popupContent');
    popupContent.innerHTML = '';
    const urlPattern = /"(https?:\/\/[^"]+)"/;
    const match = content.match(urlPattern);

    if (match) {
      const url = match[1];
      const text = content.replace(urlPattern, '').trim();

      const span = document.createElement("span");
      span.textContent = text;

      const icon = document.createElement("a");
      icon.href = url;
      icon.target = "_blank";
      icon.innerText = "📝";

      popupContent.appendChild(span);
      popupContent.appendChild(icon);
    } else {
      popupContent.innerText = content;
    }

    document.getElementById('popupOverlay').style.display = 'flex';
  }

  function closePopup() {
    document.getElementById('popupOverlay').style.display = 'none';
  }

  async function loadReminder() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetEVENTId}/values/${rangeEVENT}?key=${apiEVENTKey}`;
    const response = await fetch(url);
    const data = await response.json();

    const rows = data.values.slice(1);
    const allList = document.querySelector("#allEvents ul");
    allList.innerHTML = "";

    window.originalEvents = [];

    rows.forEach((row) => {
      if (!row || row.length < 3 || !row[0] || !row[1] || !row[2]) return;

      const [type, title, dateStr, extra] = row;
      const eventDate = parseDate(dateStr);
      if (!eventDate) return;

      const eventDay = eventDate.getDate();
      const eventMonth = eventDate.getMonth();
      let li = null;

      for (let i = 0; i <= 2; i++) {
        const futureDate = new Date(today);
        futureDate.setDate(today.getDate() + i);
        const fDay = futureDate.getDate();
        const fMonth = futureDate.getMonth();

        const label = type.toLowerCase();

        if (label === "monthly" && fDay === eventDay) {
          li = document.createElement("li");
          li.textContent = i === 0 ? `Today:- ${title}` : `Monthly:- ${title} Due on ${fDay}-${fMonth + 1}`;
          li.classList.add(i === 0 ? "today" : "monthly");
          break;
        }

        if (label === "yearly" && fDay === eventDay && fMonth === eventMonth) {
          li = document.createElement("li");
          li.textContent = i === 0 ? `Today:- ${title}` : `Yearly:- ${title} Due on ${fDay}-${fMonth + 1}`;
          li.classList.add(i === 0 ? "today" : "yearly");
          break;
        }

        if (i === 0 && eventDate.toDateString() === today.toDateString()) {
          li = document.createElement("li");
          li.textContent = `Today:- ${title}`;
          li.classList.add("today");
          break;
        }
      }

      if (!li) return;

      if (extra && extra.trim() !== "") {
        li.classList.add("clickable");
        li.addEventListener("click", () => {
          showPopup(extra.trim());
        });
      }

      window.originalEvents.push({ li, row });
      allList.appendChild(li);
    });
  }

  document.getElementById("searchInput").addEventListener("input", async function () {
    const query = this.value.trim().toLowerCase();
    const ul = document.querySelector("#allEvents ul");
    ul.innerHTML = "";

    if (!query) {
  // 👇 Just reload original list when input is blank
  loadReminder();
  return;
}


    if (!query) {
      window.originalEvents.forEach((obj) => ul.appendChild(obj.li));
    } else {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetEVENTId}/values/${rangeEVENT}?key=${apiEVENTKey}`;
      const response = await fetch(url);
      const data = await response.json();
      const rows = data.values.slice(1);

      rows.forEach((row) => {
        if (!row || row.length < 3) return;
        const [type, title, dateStr, extra] = row;

        const matchStr = `${type} ${title} ${dateStr} ${extra || ""}`.toLowerCase();
        if (matchStr.includes(query)) {
          const li = document.createElement("li");
          li.textContent = `${type}:- ${title} (${dateStr})`;
          if (extra && extra.trim()) {
            li.classList.add("clickable");
            li.addEventListener("click", () => {
              showPopup(extra.trim());
            });
          }
          ul.appendChild(li);
        }
      });
    }
  });

  loadReminder();
</script>

</body>
</html>


<!-- eventa & reminder script stop home section right site -->


  
<!-- daybook serchbar script start (CODE502) -->


<!DOCTYPE html>
<html>
<head>
    <title>MIPL SEARCH</title>
    <style>
      
        #searchContainer {
           padding: 5px 10px;
            top: 0;
            background: #026186;
          padding: auto;
            border-bottom: 2px solid #263054;
            z-index: 1000;
         
        }
        #searchBar, #dateFilter {
            padding: 5px;
            margin: 5px 0;
            width: 30%;
            box-sizing: border-box;
            border: 2px solid #d4ac0d ;
            border-radius: 4px;
        }
        #totals {
            padding: 1px;
            background: #f9fafa;
            color: black;
            border-bottom: 2px solid #fafbfc;
            border: 2px solid #0f0f0f ;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            
        }
        
        #printButton {
            position: absolute;
           
            right: 100px;
            padding: 8px;
            background: #026186;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        #printButton:hover {
            background: #0c0c0c;
        }
        

        tr.hidden {
            display: none;
        }
        tr.blue {
            color: #bb0101;
        }
        tr.red {
            color: #7a0192;
        }

	tr.yellow {
            color: #0026ff;
        }

        #miplTable.hidden {
            display: none;
        }
        table {
            overflow-x: auto;
            display: block;
        }

        /* Print-specific styles */
        @media print {
            body {
                font-family: "Times New Roman", serif;
                background-color: #fff;
                padding: 0;
            }
            #searchContainer, #printButton {
                display: none;
            }
            #totals, #difference {
                font-size: 18px;
                margin-bottom: 10px;
            }
            table, th, td {
                border: 1px solid #000;
                border-collapse: collapse;
                font-size: 10PX;
            }
            th, td {
                padding: 10px;
                text-align: left;
                font-size: 14px;
            }
            tr.hidden {
                display: table-row;
            }
        }
    </style>
    
    


</head>



<!-- daybook serchbar script stop  (CODE502)-->




<!-- Address & Purchase Order Script & code Stop Heare start (CODE503) --> 

<!DOCTYPE html>
<html >
<head>
    <title>HOME MIPL</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #searchCon {
            position: sticky;
            top: 0;
            background: #c3c4c4;
            padding: 5px;
            border-bottom: 1px solid #ccc;
            z-index: 1000; /* Ensure it stays above the table */
        }
        #searchtab {
            padding: 8px;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        tr.hidden {
            display: none;
        }
        #noResultsMessage {
            text-align: center;
            margin-top: 10px;
            background: #ff0000;
            color: white;
        }
    </style>
    <script>
       async function addresssheet() {
    const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
    const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
    const range = 'ADDRESS!A:J';

    try {
        const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
        );
        const data = await response.json();

        if (data.values) {
            const table = document.getElementById('myTable');
            table.innerHTML = ""; // Clear the table before adding new data

            data.values.forEach((row, index) => {
                const tr = document.createElement('tr');

                row.forEach((cell) => {
                    const cellElement = index === 0 ? document.createElement('th') : document.createElement('td');
                    
                    if (cell.startsWith('http') || cell.startsWith('www')) {
                        const a = document.createElement('a');
                        a.href = cell;
                        a.innerHTML = "&#128221 Click to View PO"; // DOWNLOAD ICON
                        a.target = "_blank";
                        cellElement.appendChild(a);
                    } else {
                        cellElement.textContent = cell;
                    }
                    tr.appendChild(cellElement);
                });

                table.appendChild(tr);
            });
        } else {
            console.error("No data found in the specified range.");
        }
    } catch (error) {
        console.error("Error fetching data from Google Sheets:", error);
    }
} 

        function serchAddress() {
            const query = document.getElementById('searchtab').value.toLowerCase();
            const table = document.getElementById('myTable');
            const rows = document.querySelectorAll('#myTable tr');
            let visibleRows = 0; // Track the number of visible rows

            rows.forEach((row, index) => {
                if (index === 0) return; // Skip header row

                if (query.trim() === '') {
                    row.classList.add('hidden'); // Hide all rows if search bar is blank
                } else {
                    const cells = row.querySelectorAll('td');
                    const rowText = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(' ');

                    if (rowText.includes(query)) {
                        row.classList.remove('hidden');
                        visibleRows++;
                    } else {
                        row.classList.add('hidden');
                    }
                }
            });

            // Show the table if there are visible rows
            if (visibleRows > 0) {
                table.style.display = 'table';
            } else {
                table.style.display = 'none';
            }

            // Display a message if no rows are visible
            const noResultsMessage = document.getElementById('noResultsMessage');
            if (!visibleRows && query.trim() !== '') {
                if (!noResultsMessage) {
                    const message = document.createElement('p');
                    message.id = 'noResultsMessage';
                    message.textContent = 'No matching results found.';
                    document.body.appendChild(message);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }
       
    </script>
</head>

</html>


 <!-- Address & Purchase Order Script & code Stop Heare stop  (CODE503) -->




 
 <!-- monthly sale & receipt Script & code Start Heare  (CODE504)  --> 
 
 <table id="totalMonth" border="1"></table>
    <script>
        async function loadMonth() {
            const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
            const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
            const range = 'LEDGER!B:J';
        
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
                );
                const data = await response.json();
        
                if (data.values) {
                    const table = document.getElementById('totalMonth');
                    const monthlyData = {}; // Object to hold data for each month
        
                    data.values.forEach((row, index) => {
                        const tr = document.createElement('tr');
        
                        if (index === 0) {
                            row.forEach((cell) => {
                                const th = document.createElement('th');
                                th.textContent = cell;
                                tr.appendChild(th);
                            });
                        } else {
                            const month = getMonthFromDate(row[1]); // Get month from the first column (date)
                            if (!monthlyData[month]) {
                                monthlyData[month] = { bank: 0, taxInvoice: 0 };
                            }
        
                            row.forEach((cell, cellIndex) => {
                                const td = document.createElement('td');
                                td.textContent = cell;
                                tr.appendChild(td);
        
                                if (cellIndex === 0) {
                                    if (cell.toLowerCase() === "bank" && row[0]) {
                                        monthlyData[month].bank += parseFloat(row[3]) || 0;
                                    } else if (cell.toLowerCase() === "tax invoice" && row[0]) {
                                        monthlyData[month].taxInvoice += parseFloat(row[5]) || 0;
                                    }
                                }
                            });
                        }
                        table.appendChild(tr);
                    });
        
                    // Populate the month dropdown
                    populateMonthDropdown(Object.keys(monthlyData));
        
                    // Set initial totals for the first month (optional)
                    const firstMonth = Object.keys(monthlyData)[0];
                    updateMonthlyTotalsDisplay(monthlyData[firstMonth]);
                    
                    window.monthlyData = monthlyData; // Store the data globally for later use
                } else {
                    console.error("No data found in the specified range.");
                }
            } catch (error) {
                console.error("Error fetching data from Google Sheets:", error);
            }
        }
        
        function getMonthFromDate(dateStr) {
            // Assuming the date is in the format "8-Jan-2025"
            const date = new Date(dateStr); // Convert string to Date object
            const month = date.toLocaleString('default', { month: 'short' }); // Get abbreviated month (Jan, Feb, etc.)
            const year = date.getFullYear(); // Get the year
            return `${month}-${year}`; // Format as "Jan-2025"
        }
        
        function populateMonthDropdown(months) {
            const dropdown = document.getElementById('monthDropdown');
            months.forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month;
                dropdown.appendChild(option);
            });
        
            // Add event listener for the dropdown change
            dropdown.addEventListener('change', (e) => {
                const selectedMonth = e.target.value;
                updateMonthlyTotalsDisplay(window.monthlyData[selectedMonth]);
            });
        }
        
        function updateMonthlyTotalsDisplay(totals) {
            const totalsElement = document.getElementById('monthlyTotals');
            totalsElement.innerHTML = `<span style="color: #4067DD ;font-size:100%;font-family:Arial Black;">Total Receipt : Rs. ${totals.bank.toFixed()}</span>   | <span style="color: #08BF36 ;font-size:100%;font-family:Arial Black;">Total Sale : Rs. ${totals.taxInvoice.toFixed()}</span> `;
        }
        
        function filterTablemonth() {
            const query = document.getElementById('searchBarmonth').value.toLowerCase();
            const table = document.getElementById('totalMonth');
            const rows = document.querySelectorAll('#totalMonth tr');
            let visibleRows = 0;
        
            rows.forEach((row, index) => {
                if (index === 0) return;
        
                const cells = row.querySelectorAll('td');
                const rowText = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(' ');
        
                if (rowText.includes(query)) {
                    row.classList.remove('hidden');
                    visibleRows++;
                } else {
                    row.classList.add('hidden');
                }
            });
        
            table.style.display = visibleRows > 0 ? 'table' : 'none';
        
            const noResultsMessage = document.getElementById('noResultsMessage');
            if (!visibleRows && query.trim() !== '') {
                if (!noResultsMessage) {
                    const message = document.createElement('p');
                    message.id = 'noResultsMessage';
                    message.textContent = 'No matching results found.';
                    document.body.appendChild(message);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }
        
     
// -------------------- Onload --------------------
window.onload = () => {
    loadusrAdminSheet();
    jobbPOReffload();
    loadIVCRSheet();
    filterSKHR();
    fetchUserData();
    filterDp();
    document.getElementById("designUSER").value = "CREAT";
    showForm("CREAT");

    
//
//

//
    loadusrSheet();
    document.getElementById('filterusrColumn1').addEventListener('change', filteruserTable);
    document.getElementById('filteruserColumn2').addEventListener('change', filteruserTable);
    document.getElementById('starusertDate').addEventListener('change', filteruserTable);
    document.getElementById('enduserDate').addEventListener('change', filteruserTable);

    loadpebSheet();
    document.getElementById('filterColumn1').addEventListener('change', filterPEBTable);
    document.getElementById('filterColumn2').addEventListener('change', filterPEBTable);
    document.getElementById('startDate').addEventListener('change', filterPEBTable);
    document.getElementById('endDate').addEventListener('change', filterPEBTable);

    loadIVSheet();
    document.getElementById('filterIVColumn1').addEventListener('change', filterIVTable);
    document.getElementById('filterIVColumn2').addEventListener('change', filterIVTable);
    document.getElementById('starIVtDate').addEventListener('change', filterIVTable);
    document.getElementById('endIVDate').addEventListener('change', filterIVTable);

    document.getElementById('totalMonth').style.display = 'none';
    loadMonth();
    document.getElementById('myTable').style.display = 'none';
    addresssheet();
    document.getElementById('searchtab').addEventListener('input', serchAddress);
};
    </script>
</body>
</html>


<!-- monthly sale & receipt Script & code stop  Heare  (CODE504)--> 




<!-- user ma/ta script & code start   (CODE505) -->
<!DOCTYPE html>
<html>
<head>
    <title>Cash Ledger Report</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #search123Container {
            position: sticky;
            top: 0;
           left: 0;
      width: 100%;
      background: #ebecec;
      padding: 10px 20px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1000;
      color: #000;
        }

        .search123Container select,
    .search123Container input {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }


        .select2-container {
            flex: 1;
        }
        tr.hidden {
            display: none;
        }
        tr.receipt {
            background-color: #ffe6e6;
            color: #a10404;
        }

        tr.receipt2 {
            background-color: #ffe6e6;
            color: #5b0202;
          }
          tr.billdr {
             background-color: #e6f3ff;
             color: #1d03c6;
         }
         tr.billcr {
             background-color: #e6f3ff;
             color: #190599;
         }
        #userTotals {
           
            font-size: 20px;
            color: #f8f9fa;
            background-color: #1c1c1b;
        }
        #noResultsMessage {
            text-align: center;
            margin-top: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        async function loadusrSheet() {
            const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM"; // Replace with your API key
            const sheetId = "1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0"; // Replace with your Sheet ID
            const range = 'DATAINDEX!K:S'; // Replace with the correct range
    
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
                );
                const data = await response.json();
    
                if (data.values) {
                     populateuserTable(data.values);
    populateuserDropdowns(data.values);
    displayLast10EntriesPerUser(data.values); // 🔥 Show MA & TA last 10
                } else {
                    console.error("No data found in the specified range.");
                }
            } catch (error) {
                console.error("Error fetching data from Google Sheets:", error);
            }
        }
    
        function populateuserTable(data) {
            const table = document.getElementById('myuserTable');
            table.innerHTML = ''; // Clear existing rows
    
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
    
                if (index === 0) {
                    // Header row
                    row.forEach(cell => {
                        const th = document.createElement('th');
                        th.textContent = cell;
                        tr.appendChild(th);
                    });
    

                   
                

                    // Add "Running Balance" column to the header
                    const thRunningBalance = document.createElement('th');
                    thRunningBalance.textContent = 'Balance';
                    tr.appendChild(thRunningBalance);
                } else {
                    // Data rows
                    row.forEach((cell, cellIndex) => {
                        const td = document.createElement('td');
                        td.textContent = cell;
                        tr.appendChild(td);
    
                        // Add class based on "Type" column cloour row
                        if (cellIndex === 2) { // Assuming Type is in column 2
                            if (cell.toLowerCase() === "receipt") {
                                tr.classList.add('receipt');
                            } else if (cell.toLowerCase() === "receipt ") {
                                tr.classList.add('receipt2');
                            } else if (cell.toLowerCase() === "billdr") {
                             tr.classList.add('billdr');
                         }
                         else if (cell.toLowerCase() === "billcr") {
                             tr.classList.add('billcr');
                         }
                        }
                    });
    
                    // Add empty cell for "Running Balance"
                    const tdRunningBalance = document.createElement('td');
                    tdRunningBalance.classList.add('runningBalance');
                    tr.appendChild(tdRunningBalance);
                }
    
                table.appendChild(tr);
            });
    
            
        }
    
       
        
       
   
// runnin balance start hare 


        function calculateuserRunningBalance() {
    // Select only visible rows after filtering (excluding the header row)
    const rows = Array.from(document.querySelectorAll('#myuserTable tr:not(.hidden)')).slice(1); // Skip header row

    if (rows.length === 0) return; // Exit if no rows are visible

    // Get the amount from the last visible row (latest transaction)
    const lastRow = rows[rows.length - 1];
    const lastRowCells = lastRow.querySelectorAll('td');
    const lastRowTransactionType = lastRowCells[2]?.textContent.trim().toLowerCase(); // Type column
    const lastRowAmount = parseFloat(lastRowCells[5]?.textContent || 0); // Amount column

    // Start the running balance with the amount from the last row
   // let runningBalance = lastRowTransactionType === "receipt" ? lastRowAmount : -lastRowAmount;
   

  // Define transaction types that should be added to the balance
  const positiveTypes = ["receipt", "salary","billcr"];
// Start the running balance with the correct sign
let runningBalance = positiveTypes.includes(lastRowTransactionType) ? lastRowAmount : -lastRowAmount;




    // Update the running balance cell in the last row
    const lastRowBalanceCell = lastRow.querySelector('.runningBalance');
    if (lastRowBalanceCell) {
        lastRowBalanceCell.textContent = runningBalance.toFixed(2);
    }

    // Iterate upwards through the remaining rows
    for (let index = rows.length - 2; index >= 0; index--) {
        const row = rows[index];
        const cells = row.querySelectorAll('td');
        const transactionType = cells[2]?.textContent.trim().toLowerCase(); // Assuming "Type" column is at index 2
        const amount = parseFloat(cells[5]?.textContent || 0); // Assuming "Amount" column is at index 5

        if (!isNaN(amount)) {
            if (transactionType === "receipt") {
                runningBalance += amount; // Add for receipt
            } else if (transactionType === "payment") {
                 runningBalance -= amount; // Subtract for payment
             }else if (transactionType === "billdr") {
                 runningBalance -= amount; // Subtract for payment
                 
             }else if (transactionType === "salary") {
                 runningBalance += amount; // Subtract for payment
             }else if (transactionType === "billcr") {
                 runningBalance += amount; // Subtract for payment
             }
        }

        // Update the running balance cell
        const runningBalanceCell = row.querySelector('.runningBalance');
        if (runningBalanceCell) {
            runningBalanceCell.textContent = runningBalance.toFixed();
        }
    }
}

// running balance funtion stop
//calculateuserRunningBalance(); // Recalculate running balance after filtering


function populateuserDropdowns(data) {
    const dropdown1 = document.getElementById('filterusrColumn1');
    const dropdown2 = document.getElementById('filteruserColumn2');
    const dropdown4 = document.getElementById('filteruserColumn4');

    const uniqueValues1 = [...new Set(data.slice(1).map(row => row[1]))]; // Column 1
    const uniqueValues2 = [...new Set(data.slice(1).map(row => row[2]))]; // Column 2
    const uniqueValues4 = [...new Set(data.slice(1).map(row => row[4]))]; // Column 4

    populateuserDropdown(dropdown1, uniqueValues1);
    populateuserDropdown(dropdown2, uniqueValues2);
    populateuserDropdown(dropdown4, uniqueValues4);

    // Initialize Select2 for searchable dropdown
    $(dropdown4).select2({
        placeholder: "-- Select --",
        allowClear: true,
        width: 'resolve'
    });

    // Bind filter event for Select2
    $(dropdown4).on('change', filteruserTable);

    // Map for dropdown1 values to corresponding names
    const userMapping = {
        MA: "User | Mukhtiyar",
        TA: "User | Tushar Agarwal",
        JLN: "Voucher | Journal",
        BANK: "Voucher | Bank"

        //   <div id="resultDiv"></div>  user name show as per your requre
    };

    // Event listener for dropdown1 to show corresponding name
    dropdown1.addEventListener('change', function () {
        const selectedValue = dropdown1.value;
        const resultDiv = document.getElementById('resultDiv');

        if (userMapping[selectedValue]) {
            resultDiv.textContent = userMapping[selectedValue]; // Show corresponding name
        } else {
            resultDiv.textContent = ""; // Clear the div if no valid option is selected
        }
    });
}

function populateuserDropdown(dropdown, values) {
    dropdown.innerHTML = '<option value="">-- Select --</option>';
    values.forEach(value => {
        const option = document.createElement('option');
        option.value = value;
        option.textContent = value;
        dropdown.appendChild(option);
    });
}

    
        function filteruserTable() {
    const filter1 = document.getElementById('filterusrColumn1').value.toLowerCase();
    const filter2 = document.getElementById('filteruserColumn2').value.toLowerCase();
    const filter4 = $('#filteruserColumn4').val()?.toLowerCase();

    const starusertDateInput = document.getElementById("starusertDate").value;
    const enduserDateInput = document.getElementById("enduserDate").value;

    // ---- Convert input to pure date (ignore time) ----
    const starusertDate = starusertDateInput ? new Date(starusertDateInput + "T00:00:00") : null;
    const enduserDate = enduserDateInput ? new Date(enduserDateInput + "T23:59:59") : null;

    const rows = document.querySelectorAll('#myuserTable tr');
    let visibleRows = 0;
    let totaluserPayment = 0, totaluserReceipt = 0, totaluserBilldr = 0, totaluserBillcr = 0, totaluserSalary = 0;

    rows.forEach((row, index) => {
        if (index === 0) return; // Skip header row

        const cells = row.querySelectorAll('td');
        const rowDateStr = cells[3]?.textContent.trim();
        const date = rowDateStr ? new Date(rowDateStr) : null;

        const type = cells[2]?.textContent.trim().toUpperCase();
        const amount = parseFloat(cells[5]?.textContent.trim()) || 0;

        // ---- Date filter check ----
        let dateMatches = true;
        if (starusertDate && date && date < starusertDate) dateMatches = false;
        if (enduserDate && date && date > enduserDate) dateMatches = false;

        // ---- Other filters ----
        const matchesFilter1 = !filter1 || cells[1]?.textContent.toLowerCase() === filter1;
        const matchesFilter2 = !filter2 || cells[2]?.textContent.toLowerCase() === filter2;
        const matchesFilter4 = !filter4 || cells[4]?.textContent.toLowerCase() === filter4;

        if (matchesFilter1 && matchesFilter2 && matchesFilter4 && dateMatches) {
            row.classList.remove('hidden');
            visibleRows++;

            // ---- Totals update ----
            if (type === "PAYMENT") {
                totaluserPayment += amount;
            } else if (type === "RECEIPT") {
                totaluserReceipt += amount;
            } else if (type === "BILLDR") {
                totaluserBilldr += amount;
            } else if (type === "SALARY") {
                totaluserSalary += amount;
            } else if (type === "BILLCR") {
                totaluserBillcr -= amount;
            }
        } else {
            row.classList.add('hidden');
        }
    });

    displayNoResultsMessage(visibleRows);
    updateuserTotals(totaluserPayment, totaluserReceipt, totaluserBilldr, totaluserBillcr, totaluserSalary);

    // Recalculate running balance after filtering
    calculateuserRunningBalance();
}

    
        function displayNoResultsMessage(visibleRows) {
            const noResultsMessage = document.getElementById('noResultsMessage');
            if (!visibleRows) {
                if (!noResultsMessage) {
                    const message = document.createElement('p');
                    message.id = 'noResultsMessage';
                    message.textContent = 'No matching results found.';
                    document.body.appendChild(message);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }
    
        function updateuserTotals(totaluserPayment, totaluserReceipt, totaluserBilldr,totaluserBillcr, totaluserSalary) {
            document.getElementById("totaluserPayment").textContent = totaluserPayment.toFixed();
            document.getElementById("totaluserReceipt").textContent = totaluserReceipt.toFixed();
            document.getElementById("totaluserBilldr").textContent = totaluserBilldr.toFixed();
            document.getElementById("totaluserBillcr").textContent = totaluserBillcr.toFixed();
            document.getElementById("totaluserSalary").textContent = totaluserSalary.toFixed();
            document.getElementById("totaluserDifference").textContent = (totaluserReceipt - totaluserPayment - totaluserBilldr + totaluserBillcr + totaluserSalary).toFixed();
        }
    


// last 10 entry start hare

function displayLast10EntriesPerUser(data) {
    const headers = data[0];
    const entries = data.slice(1); // Exclude header row

    ['MA', 'TA'].forEach(userCode => {
        // Step 1: Filter entries for user
        const userEntries = entries.filter(row => row[1] === userCode);

        // Step 2: Sort all entries by Sr No. ASC (oldest to newest)
        const sorted = userEntries.sort((a, b) => parseInt(a[0]) - parseInt(b[0]));

        // Step 3: Compute running balance for all entries
        let balance = 0;
        const positiveTypes = ["receipt", "salary", "billcr"];
        const withBalance = sorted.map(row => {
            const type = row[2]?.toLowerCase();
            const amount = parseFloat(row[5]) || 0;
            balance += positiveTypes.includes(type) ? amount : -amount;
            return { row, balance: balance.toFixed() };
        });

        // Step 4: Get latest 10 entries (newest), in descending order
        const last10 = withBalance.slice(-10).reverse(); // latest to oldest

        // Step 5: Generate HTML
        const tableRows = last10.map(entry => {
            const type = entry.row[2]?.toLowerCase();
            const isReceipt = type === 'receipt';
            const rowStyle = isReceipt ? 'style="background-color: ; color: RED;"' : '';

            return `
                <tr ${rowStyle}>
                    <td>${entry.row[0]}</td> <!-- Trn. No -->
                    <td>${entry.row[3]}</td> <!-- Date -->
                    <td>${entry.row[2]}</td> <!-- Type -->
                    <td>${entry.row[4]}</td> <!-- Ledger -->
                    <td>${entry.row[5]}</td> <!-- Amount -->
                    <td>${entry.row[6]}</td> <!-- Narration -->
                    <td>${entry.balance}</td> <!-- Running Balance -->
                </tr>
            `;
        });

        const tableHTML = `
            <h3>Last 10 Entries - ${userCode}</h3>
            <table border="1" style="border-collapse: collapse; width: 100%; font-size:16px;">
                <thead>
                    <tr>
                        <th>T.No.</th>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Ledger</th>
                        <th>Amount</th>
                        <th>Narration</th>
                        <th>Balance</th>
                    </tr>
                </thead>
                <tbody>
                    ${tableRows.join('')}
                </tbody>
            </table>
        `;

        document.getElementById(`last10${userCode}`).innerHTML = tableHTML;
    });
}

// last 10 entry stop hare


        function printuserTable() {
    let printWindow = window.open('', '', 'height=500, width=800');

    const styles = `
        <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 12px; text-align: left; }
            table th, table td { border: 1px solid #ddd; padding: 5px; }
            table th { background-color: #f4f4f4; font-weight: bold; }
            table tr.payment { background-color: white; color: black; }
            table tr.receipt { background-color: blac; color: red; }
            table tr.bill { background-color: blac; color: blue; }
            .filter-summary { margin: 10px 0; font-size: 14px; }
            .filter-summary span { display: inline-block; margin-right: 20px; }
        </style>
    `;

    // Fetch filter values
    const ledger = document.getElementById("filteruserColumn4").value || "All";
    const starusertDate = document.getElementById("starusertDate").value || "Not Set";
    const enduserDate = document.getElementById("enduserDate").value || "Not Set";
    const user = document.getElementById("filterusrColumn1").value || "All";
    const voucher = document.getElementById("filteruserColumn2").value || "All";

    // Create a summary of filter options
    const filterSummary = `
        <div class="filter-summary">
            <span><strong>Ledger:</strong> ${ledger}</span>
            <span><strong>From:</strong> ${starusertDate}</span>
            <span><strong>To:</strong> ${enduserDate}</span>
            <span><strong>User:</strong> ${user}</span>
            <span><strong>Voucher:</strong> ${voucher}</span>
        </div>
    `;

    // Clone the table and remove hidden rows
    let table = document.getElementById("myuserTable");
    let tableClone = table.cloneNode(true);

    let rows = tableClone.querySelectorAll('tr');
    rows.forEach((row) => {
        if (row.classList.contains('hidden')) {
            row.remove(); // Remove hidden rows from the cloned table
        } else {
            // Retain only the first 7 columns for each row
            while (row.cells.length > 10) {
                row.deleteCell(10); // Remove extra columns starting from index 7
            }
        }
    });

    // Start writing to the print window
    printWindow.document.write('<html><head><title>🖨️ Print</title></head><body>');
    printWindow.document.write(styles);
   
    printWindow.document.write('<span style="color:grey;font-size:70%;font-family:Magneto;">eS|MTally</span> <br/> <span style="color:black;font-size:120%;font-family:Arial;">MIPL Cash Management</span>'); // Optional title
 
    printWindow.document.write(filterSummary); // Add the filter summary to the print view

    // Add totals section
    printWindow.document.write(document.getElementById("userTotals").outerHTML);

    // Write the cloned table with only visible rows and limited columns
    printWindow.document.write(tableClone.outerHTML);

    // Close and print
    printWindow.document.close();
    printWindow.print();
}







     //   window.onload = () => {
       //     loadusrSheet();
       //     document.getElementById('filterusrColumn1').addEventListener('change', filteruserTable);
       //     document.getElementById('filteruserColumn2').addEventListener('change', filteruserTable);
      //      document.getElementById('starusertDate').addEventListener('change', filteruserTable);
      //      document.getElementById('enduserDate').addEventListener('change', filteruserTable);
     //   };
    </script>
</head>

</html>


<!-- user ma/ta script & code stop  (CODE505) -->



<!-- IVMA form div script start here -->
<script>
  const scriptIVMAURL = 'https://script.google.com/macros/s/AKfycbz1qX7pBpLSoZRDEUqIs1B-DZCVBuUCYQvGKDPRPwLC4OJY_07Ooi0AI8SzRJbi9yyQWg/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainIVMAForm") return;

    e.preventDefault();
    const formMode = document.getElementById("formModeIVMA").value;
    console.log("Current form mode:", formMode);

    const submitIVMAButton = document.getElementById("submitIVMAButton");
    submitIVMAButton.disabled = true;
    submitIVMAButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampIVMA').value =
      `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    if (formMode === "modify") {
      await modifyIVMAEntry();
    } else {
      await submitIVMAEntry(form);
    }

    submitIVMAButton.disabled = false;
    submitIVMAButton.value = "Submit";
  });

  async function submitIVMAEntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptIVMAURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset();

        // ✅ Clear mode & sNo after reset
        setTimeout(() => {
          document.getElementById("formModeIVMA").value = "new";
          document.getElementById("sNo").value = "";
          document.getElementById("searchIVMASNo").value = "";
        }, 50);

              // cash user table refresh start--------------------
         
// Re-fetch the data and re-render the table
const raw = await fetchSheetData();
fullData = processRawData(raw);

// Get current filters (if any)
const currentAccountType = document.getElementById("cu123")?.value || "";
const currentLedgerFilter = document.getElementById("msaf54")?.value.trim() || "";

// Re-render the table with current filters
filterAndRender(currentAccountType, currentLedgerFilter);
//  // cash user table refresh stop -------------------------
        loadusrSheet();
        loadIVSheet();

        // ✅ Remove DLT option if exists
        const msaf51Dropdown = document.getElementById("msaf51");
        const dltIVMAOption = [...msaf51Dropdown.options].find(opt => opt.value === "DLT");
        if (dltIVMAOption) {
          msaf51Dropdown.removeChild(dltIVMAOption);
        }

      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }

  async function modifyIVMAEntry() {
    const waitMessage = document.getElementById("waitIVMAMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";

    const form = document.getElementById('mainIVMAForm');

    // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampIVMA').value =
      `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptIVMAURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();

        // ✅ Clear mode & sNo after reset
        setTimeout(() => {
          document.getElementById("formModeIVMA").value = "new";
          document.getElementById("sNo").value = "";
          document.getElementById("searchIVMASNo").value = "";
        }, 50);

              // cash user table refresh start-------------------------
         
// Re-fetch the data and re-render the table
const raw = await fetchSheetData();
fullData = processRawData(raw);

// Get current filters (if any)
const currentAccountType = document.getElementById("cu123")?.value || "";
const currentLedgerFilter = document.getElementById("msaf54")?.value.trim() || "";

// Re-render the table with current filters
filterAndRender(currentAccountType, currentLedgerFilter);
//  // cash user table refresh stop --------------------
        loadusrSheet();
        loadIVSheet();

        document.getElementById("submitIVMAButton").style.display = "inline-block";
        document.getElementById("modifyIVMAButton").style.display = "none";

        // ✅ Remove DLT option
        const msaf51Dropdown = document.getElementById("msaf51");
        const dltIVMAOption = [...msaf51Dropdown.options].find(opt => opt.value === "DLT");
        if (dltIVMAOption) {
          msaf51Dropdown.removeChild(dltIVMAOption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function fetchIVMADetails() {
    const sNo = document.getElementById("searchIVMASNo").value;
    const waitMessage = document.getElementById("waitIVMAMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

    try {
      const response = await fetch(`${scriptIVMAURL}?sNo=${sNo}`);
      const data = await response.json();
      

      //**** option value ke base par data fetch krna
const msaf51Dropdown = document.getElementById("msaf51");
const selectedVoucher = msaf51Dropdown.value;

if (data.result !== "error" && data.Voucher === selectedVoucher) {
  document.getElementById("sNo").value = data.SNo;
  msaf51Dropdown.value = data.Voucher;
  document.getElementById("msaf52").value = data.Type;
  document.getElementById("msaf53").value = data.Date;
  document.getElementById("msaf54").value = data.Ledger;
  document.getElementById("msaf55").value = data.Amount;
  document.getElementById("msaf56").value = data.Narration;

  // ✅ Add "DLT - delete" option if not present
  if (![...msaf51Dropdown.options].some(opt => opt.value === "DLT")) {
    const dlt51Option = document.createElement("option");
    dlt51Option.value = "DLT";
    dlt51Option.text = "Delete";
    dlt51Option.style.color = "red";
    dlt51Option.style.backgroundColor = "blue";
    msaf51Dropdown.appendChild(dlt51Option);
  }
 
        //

        // ✅ Switch to modify mode
        document.getElementById("formModeIVMA").value = "modify";

         // ✅ Show alert after successful data fetch
      alert("Select Delete Option in User Section For Delete Entry");

      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }
</script>
<!-- IVMA form div script stop here -->






<!-- ledger dropdown with USER SELECTION ENTRY (cash user) code stop hare -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ledger Table with Running Balance</title>
  <style>
    body {
      font-family: Arial;
    }

    .dropdownWrapper {
      position: relative;
      width: 300px;
    
    }

    .dropdownSearch {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      border: 1px solid #a3a1a1;
      border-radius: 4px;
    }

    .dropdownList {
      list-style: none;
      border: 1px solid #ccc;
      max-height: 5000px;
      width: 3in;
      overflow-y: auto;
      margin: 0;
      padding: 0;
      display: none;
      background: white;
      position: absolute;
      width: 100%;
      z-index: 1000;
      border-radius: 0 0 4px 4px;
    }
/* Style for the entire dropdown container */
  #ledgerDropdown.dropdownList {
    list-style-type: none;
    margin: 0;
    padding: 0;
    position: absolute;
    z-index: 999;
    width: 100%;
    max-height: 500px;
    overflow-y: auto;
    border: 1px solid #ccc;
    background-color: white;
    color: #000;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15);
    font-size: 16px;
    border-radius: 4px;
  }

  /* Style for each dropdown item */
  #ledgerDropdown.dropdownList li {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
    transition: background-color 0.2s ease-in-out;
  }

  /* Highlight on hover */
  #ledgerDropdown.dropdownList li:hover {
    background-color: #007BFF;
    color: white;
  }

  /* Optional: remove border from last item */
  #ledgerDropdown.dropdownList li:last-child {
    border-bottom: none;
  }

    .positive {
      color: RED;
      font-weight: bold;
      
    }
  </style>
</head>
<body>

  
 <script>
  const apiCLKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
  const sheetCLId = "1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0";
  const rangeCL = "DATAINDEX!A:G";

  let fullData = [];
  let filteredByAccount = [];

  async function fetchSheetData() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetCLId}/values/${rangeCL}?key=${apiCLKey}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      return data.values || [];
    } catch (err) {
      console.error("Error fetching data:", err);
      return [];
    }
  }

  function processRawData(rows) {
    return rows.slice(1).map(row => ({
      date: row[0],
      cUser: row[1],
      type: row[1],
      dt: row[3] || "-",
      drcr: row[2],
      ldgr: row[4],
      amount: parseFloat(row[5]) || 0,
      narration: row[6] || "-"
    }));
  }

  function renderTable(data) {
    const tableContainer = document.getElementById("tableContainer");
    if (!data || data.length === 0) {
      tableContainer.innerHTML = "<p>No matching records found.</p>";
      return;
    }

    let balance = 0;
  const reversed = [...data].reverse();
  const rowsWithBalance = reversed.map(row => {
    const type = row.drcr.toLowerCase();
    const isNegative = type === "payment" || type === "billdr";
    const signed = isNegative ? -row.amount : row.amount;
    balance += signed;
    return { ...row, signedAmount: signed, running: balance };
  }).reverse();


    const table = document.createElement("table");
    table.innerHTML = `
      <thead>
        <tr>
          <th>T.No.</th>
           <th>User</th>
          <th>Type</th>
          <th>Date</th>
          <th>Ledger</th>
          <th>Narration</th>
          <th>Amount (₹)</th>
          <th>Balance (₹)</th>
        </tr>
      </thead>
      <tbody>
        ${rowsWithBalance.map(row => `
          <tr style="${row.drcr.toLowerCase() === 'receipt' ? 'color: RED; background-color: rgb(248, 229, 229);' : ''}">
            <td>${row.date}</td>
            <td>${row.cUser}</td>
            <td>${row.drcr}</td>
            <td>${row.dt}</td>
            <td>${row.ldgr}</td>
            <td>${row.narration}</td>
            <td class="${row.signedAmount < 0 ? 'negative' : 'positive'}">${row.signedAmount.toFixed()}</td>
            <td>${row.running.toFixed()}</td>
          </tr>
        `).join("")}
      </tbody>
    `;
    tableContainer.innerHTML = "";
    tableContainer.appendChild(table);
  }

  function filterAndRender(accountType, ledgerFilter = "") {
    filteredByAccount = fullData.filter(row => row.type === accountType);
    let visible = filteredByAccount;

    if (ledgerFilter.trim() !== "") {
      visible = filteredByAccount.filter(row =>
        row.ldgr.toLowerCase().includes(ledgerFilter.toLowerCase())
      );
    }

    renderTable(visible);
  }

  async function setupLedgerSearch() {
    const input = document.getElementById("msaf54");
    const dropdown = document.getElementById("ledgerDropdown");

    const ledgers = [...new Set(fullData.map(row => row.ldgr).filter(Boolean))];

    input.addEventListener("input", () => {
      const value = input.value.trim().toLowerCase();
      dropdown.innerHTML = "";

      if (value === "") {
        dropdown.style.display = "none";
        filterAndRender(document.getElementById("cu123").value);
        return;
      }

      const matches = ledgers.filter(l => l.toLowerCase().includes(value));
      matches.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item;
        li.onclick = () => {
          input.value = item;
          dropdown.style.display = "none";
          filterAndRender(document.getElementById("cu123").value, item);
        };
        dropdown.appendChild(li);
      });

      dropdown.style.display = matches.length ? "block" : "none";

      // Live filter
      filterAndRender(document.getElementById("cu123").value, value);
    });

    document.addEventListener("click", e => {
      if (!input.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.innerHTML = "";
        dropdown.style.display = "none";
      }
    });
  }

  async function setupAccountSelect() {
    const select = document.getElementById("cu123");
    select.addEventListener("change", () => {
      const selected = select.value;
      document.getElementById("msaf54").value = "";
      document.getElementById("searchCLedger").value = ""; // Clear global search
      filterAndRender(selected);
    });
  }

  function setupGlobalSearch() {
    const input = document.getElementById("searchCLedger");

    input.addEventListener("input", () => {
      const query = input.value.trim().toLowerCase();

      if (query === "") {
        const selected = document.getElementById("cu123").value;
        filterAndRender(selected);
        return;
      }

      const results = fullData.filter(row => {
        return Object.values(row).some(val =>
          String(val).toLowerCase().includes(query)
        );
      });

      renderTable(results);
    });
  }


// print table

function printCUSERTable() {
  const tableHTML = document.getElementById("tableContainer").innerHTML;
  const style = `
    <style>
      body { font-family: Arial; padding: 20px; }
      table {
  width: 100%;
  margin-top: 20px;
  border-collapse: collapse;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 14px;

}

th, td {
  border: 1px solid #e0e0e0;
  padding: 10px 14px;
  text-align: left;
}

th {
  background-color: #004d80;
  color: white;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

tr:nth-child(even) {
  background-color: #f9f9f9;
}

      .negative { color: black; }
      .positive { color: red; }
    </style>
  `;
  const win = window.open("", "_blank");
  win.document.write(`
    <html>
      <head>
        <title>Print Table</title>
        ${style}
      </head>
      <body>
        <h2>MIPL Cash Ledger</h2>
        ${tableHTML}
        <script>
          window.onload = function() {
            window.print();
            window.onafterprint = function() { window.close(); };
          };
        <\/script>
      </body>
    </html>
  `);
  win.document.close();
}

//
  document.addEventListener("DOMContentLoaded", async () => {
    const raw = await fetchSheetData();
    fullData = processRawData(raw);

    await setupLedgerSearch();
    await setupAccountSelect();
    setupGlobalSearch(); // Global search setup

    const defaultValue = document.getElementById("cu123").value;
    if (defaultValue) {
      filterAndRender(defaultValue);
    }
  });
</script>

  
</body>
</html>


<!-- ledger dropdown with USER SELECTION ENTRY (cash user) code stop hare -->







<!-- MIPL LEDGER REPORT SCRIPT & CODE START Heare -->
<!DOCTYPE html>
<html>
<head>
    <title>MIPL PARTY LEDGER</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
       
         #searchPEBContainer {
            position: sticky;
            top: 0;
           left: 0;
      width: 100%;
      background: #ebecec;
      padding: 10px 20px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1000;
      color: #000;
        }

        .searchPEBContainer label {
      font-weight: bold;
    }

        .searchPEBContainer select,
    .searchPEBContainer input {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }

        .select2-container {
            flex: 1;
        }

        tr.hidden {
            display: none;
        }
        tr.receipt {
            background-color: #ffe6e6;
            color: #a10404;
        }

        tr.cn {
            background-color: #dbdaf4;
            color: #030173;
          }
        tr.bill {
            background-color: #e6f3ff;
            color: #1d03c6;
        }
        #totalsmipl {
         
           font-size: 20px;
            font-weight: bold;
            color: #f7f8fa;
            background-color: #014384;
        }
        #noResultsMessage {
            text-align: center;
            margin-top: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        async function loadpebSheet() {
    const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM"; // Replace with your API key
    const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
    const range = 'LEDGER!B:K';

    try {
        const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
        );
        const data = await response.json();

        if (data.values) {
            populatePEBTable(data.values);
            populatePEBDropdowns(data.values);
        } else {
            console.error("No data found in the specified range.");
        }
    } catch (error) {
        console.error("Error fetching data from Google Sheets:", error);
    }
}

function populatePEBTable(data) {
    const table = document.getElementById('myPEBTable');
    table.innerHTML = ''; // Clear existing rows

    data.forEach((row, index) => {
        const tr = document.createElement('tr');

        if (index === 0) {
            // Header row
            row.forEach(cell => {
                const th = document.createElement('th');
                th.textContent = cell;
                tr.appendChild(th);
            });

            // Add "Running Balance" column to the header
            const thRunningBalance = document.createElement('th');
            thRunningBalance.textContent = 'Balance';
            tr.appendChild(thRunningBalance);
        } else {
            // Data rows
            row.forEach((cell, cellIndex) => {
                const td = document.createElement('td');

                if (cell.startsWith('http') || cell.startsWith('www')) {
                    // Create hyperlink if cell contains a URL
                    const a = document.createElement('a');
                    a.href = cell;
                    a.innerHTML = "&#128221"; // Download icon
                    a.target = "_blank"; // Open link in new tab
                    td.appendChild(a);
                } else {
                    td.textContent = cell;
                }
                tr.appendChild(td);

                // Add class based on "Type" column
                if (cellIndex === 0) { // Assuming Type is in column 2
                    if (cell.toLowerCase() === "bank") {
                        tr.classList.add('receipt');
                    } else if (cell.toLowerCase() === "credit note") {
                        tr.classList.add('cn');
                    } else if (cell.toLowerCase() === "tds") {
                        tr.classList.add('bill');
                    }
                }
            });

            // Add empty cell for "Running Balance"
            const tdRunningBalance = document.createElement('td');
            tdRunningBalance.classList.add('runningBalance');
            tr.appendChild(tdRunningBalance);
        }

        table.appendChild(tr);
       
    });
}

            
     
    
       
        
       
   
function calculatePEBRunningBalance() {
    // Select only visible rows after filtering (excluding the header row)
    const rows = Array.from(document.querySelectorAll('#myPEBTable tr:not(.hidden)')).slice(1); // Skip header row

    if (rows.length === 0) return; // Exit if no rows are visible

    // Get the amount from the last visible row (latest transaction)
    const lastRow = rows[rows.length - 1];
    const lastRowCells = lastRow.querySelectorAll('td');
    const lastRowTransactionType = lastRowCells[0]?.textContent.trim().toLowerCase(); // Type column at index 0
    const lastRowAmount = parseFloat(lastRowTransactionType === "bank" || lastRowTransactionType === "tds" 
        ? lastRowCells[3]?.textContent || 0 // Amount column at index 3 for "bank" and "tds"
        : lastRowCells[5]?.textContent || 0); // Amount column at index 6 for others

    // Start the running balance with the amount from the last row
   // let runningBalance = lastRowTransactionType === "bank" ? lastRowAmount : -lastRowAmount;


     // Define transaction types that should be added to the balance
  const positiveTypes = ["bank", "tds"];
// Start the running balance with the correct sign
let runningBalance = positiveTypes.includes(lastRowTransactionType) ? lastRowAmount : -lastRowAmount;


    // Update the running balance cell in the last row
    const lastRowBalanceCell = lastRow.querySelector('.runningBalance');
    if (lastRowBalanceCell) {
        lastRowBalanceCell.textContent = runningBalance.toFixed();
    }

    // Iterate upwards through the remaining rows
    for (let index = rows.length - 2; index >= 0; index--) {
        const row = rows[index];
        const cells = row.querySelectorAll('td');
        const transactionType = cells[0]?.textContent.trim().toLowerCase(); // Assuming "Type" column is at index 0
        const amount = parseFloat(transactionType === "bank" || transactionType === "tds"
            ? cells[3]?.textContent || 0 // Amount column at index 3 for "bank" and "tds"
            : cells[5]?.textContent || 0); // Amount column at index 6 for others

        if (!isNaN(amount)) {
            if (transactionType === "bank") {
                runningBalance += amount; // Add for bank
            } else if (transactionType === "tds") {
                runningBalance += amount; // Add for tds
            } else if (transactionType === "tax invoice") {
                runningBalance -= amount; // Subtract for tax invoice
            } else if (transactionType === "credit note") {
                runningBalance -= amount; // Add for credit note
            }
        }

        // Update the running balance cell
        const runningBalanceCell = row.querySelector('.runningBalance');
        if (runningBalanceCell) {
            runningBalanceCell.textContent = runningBalance.toFixed();
        }
    }
}

// running balance funtion stop
//calculatePEBRunningBalance(); // Recalculate running balance after filtering

function populatePEBDropdowns(data) {
    const dropdown1 = document.getElementById('filterColumn1');
    const dropdown2 = document.getElementById('filterColumn2');
    const dropdown4 = document.getElementById('filterColumn4');

    if (!dropdown1 || !dropdown2 || !dropdown4) {
        console.error("One or more dropdown elements not found.");
        return;
    }

    updateDropdowns(data);

    // Initialize Select2 for searchable dropdown
    $(dropdown4).select2({
        placeholder: "-- Select --",
        allowClear: true,
        width: 'resolve'
    });

    // Bind filter event for Select2
    $(dropdown4).on('change', filterPEBTable);
}

// Function to update dropdowns dynamically based on table data
function updateDropdowns(data) {
    const dropdown1 = document.getElementById('filterColumn1');
    const dropdown2 = document.getElementById('filterColumn2');
    const dropdown4 = document.getElementById('filterColumn4');

    if (!dropdown1 || !dropdown2 || !dropdown4) return;

    const uniqueValues1 = [...new Set(data.slice(1).map(row => row[0]))]; // Column 1
    const uniqueValues2 = [...new Set(data.slice(1).map(row => row[4]))]; // Column 2
    const uniqueValues4 = [...new Set(data.slice(1).map(row => row[2]))]; // Column 4

    populateDropdown(dropdown1, uniqueValues1);
    populateDropdown(dropdown2, uniqueValues2);
    populateDropdown(dropdown4, uniqueValues4);
}

// Function to populate dropdown
function populateDropdown(dropdown, values) {
    if (!dropdown) return;
    dropdown.innerHTML = '<option value="">-- Select --</option>';
    values.forEach(value => {
        const option = document.createElement('option');
        option.value = value;
        option.textContent = value;
        dropdown.appendChild(option);
    });
}

// Function to update dropdown4 dynamically based on the filtered table
// filter hone ke baad reff/job no dropdown update
function updateDropdown4Options() {
    const dropdown2 = document.getElementById('filterColumn2');
    if (!dropdown2) return;

    const rows = document.querySelectorAll('#myPEBTable tr:not(.hidden)');
    let uniqueValues2 = new Set();

    rows.forEach((row, index) => {
        if (index === 0) return; // Skip header row
        const cells = row.querySelectorAll('td');
        if (cells[4]) uniqueValues2.add(cells[4].textContent.trim());
    });

    populateDropdown(dropdown2, [...uniqueValues2]);

// filter hone ke baad reff/job no dropdown update


    // Reinitialize Select2 for dropdown4 after updating
    $(dropdown4).select2({
        placeholder: "-- Select --",
        allowClear: true,
        width: 'resolve'
    });
}

function filterPEBTable() {
    const filter1 = document.getElementById('filterColumn1').value.toLowerCase();
    const filter2 = $('#filterColumn2').val()?.toLowerCase();
    const filter4 = $('#filterColumn4').val()?.toLowerCase();

    const startDateInput = document.getElementById("startDate").value;
    const endDateInput = document.getElementById("endDate").value;

    // ---- Convert input to pure date (ignore time) ----
    const startDate = startDateInput ? new Date(startDateInput + "T00:00:00") : null;
    const endDate = endDateInput ? new Date(endDateInput + "T23:59:59") : null;

    const rows = document.querySelectorAll('#myPEBTable tr');
    let visibleRows = 0;
    let totalTds = 0, totalReceipt = 0, totalCn = 0, totalBill = 0, totalPEBWeight = 0;

    rows.forEach((row, index) => {
        if (index === 0) return; // Skip header row

        const cells = row.querySelectorAll('td');
        const rowDateStr = cells[1]?.textContent.trim();
        const date = rowDateStr ? new Date(rowDateStr) : null;

        const type = cells[0]?.textContent.trim().toUpperCase();
        const amount = parseFloat(cells[5]?.textContent.trim()) || 0;
        const weight = parseFloat(cells[6]?.textContent.trim()) || 0;
        const receipt = parseFloat(cells[3]?.textContent.trim()) || 0;

        // ---- Date filter check (inclusive) ----
        let dateMatches = true;
        if (startDate && date && date < startDate) dateMatches = false;
        if (endDate && date && date > endDate) dateMatches = false;

        // ---- Other filters ----
        const matchesFilter1 = !filter1 || cells[0]?.textContent.toLowerCase() === filter1;
        const matchesFilter2 = !filter2 || cells[4]?.textContent.toLowerCase() === filter2;
        const matchesFilter4 = !filter4 || cells[2]?.textContent.toLowerCase() === filter4;

        if (matchesFilter1 && matchesFilter2 && matchesFilter4 && dateMatches) {
            row.classList.remove('hidden');
            visibleRows++;

            if (type === "TDS") {
                totalTds += receipt;
            } else if (type === "BANK") {
                totalReceipt += receipt;
            } else if (type === "TAX INVOICE") {
                totalBill += amount;
                totalPEBWeight += weight;
            } else if (type === "CREDIT NOTE") {
                totalCn += amount;
            }
        } else {
            row.classList.add('hidden');
        }
    });

    displayNoResultsMessage(visibleRows);
    updateTotals(totalTds, totalReceipt, totalBill, totalCn, totalPEBWeight);
    calculatePEBRunningBalance();

    // Update dropdown4 dynamically based on filtered table
    updateDropdown4Options();
}


    
        function displayNoResultsMessage(visibleRows) {
            const noResultsMessage = document.getElementById('noResultsMessage');
            if (!visibleRows) {
                if (!noResultsMessage) {
                    const message = document.createElement('p');
                    message.id = 'noResultsMessage';
                    message.textContent = 'No matching results found.';
                    document.body.appendChild(message);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }
    
        function updateTotals(totalTds, totalReceipt, totalBill,totalCn, totalPEBWeight) {
            document.getElementById("totalTds").textContent = totalTds.toFixed();
            document.getElementById("totalReceipt").textContent = totalReceipt.toFixed();
            document.getElementById("totalBill").textContent = totalBill.toFixed();
            document.getElementById("totalCn").textContent = totalCn.toFixed();
            document.getElementById("totalPEBWeight").textContent = totalPEBWeight.toFixed();
            document.getElementById("totalDifference").textContent = (totalReceipt + totalTds - totalBill -totalCn).toFixed();
        }
    
      
    

        function printpebTable() {
    let printWindow = window.open('', '', 'height=500, width=800');

    const styles = `
        <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 12px; text-align: left; }
            table th, table td { border: 1px solid #ddd; padding: 5px; }
            table th { background-color: #f4f4f4; font-weight: bold; }
            table tr.payment { background-color: white; color: black; }
            table tr.receipt { background-color: blac; color: red; }
            table tr.bill { background-color: blac; color: blue; }
            .filter-summary { margin: 10px 0; font-size: 14px; }
            .filter-summary span { display: inline-block; margin-right: 20px; }
        </style>
    `;

    // Fetch filter values
    const ledger = document.getElementById("filterColumn4").value || "All";
    const startDate = document.getElementById("startDate").value || "Not Set";
    const endDate = document.getElementById("endDate").value || "Not Set";
    const user = document.getElementById("filterColumn1").value || "All";
    const voucher = document.getElementById("filterColumn2").value || "All";

    // Create a summary of filter options
    const filterSummary = `
        <div class="filter-summary">
            <span><strong>Ledger:</strong> ${ledger}</span>
            <span><strong>From:</strong> ${startDate}</span>
            <span><strong>To:</strong> ${endDate}</span>
            <span><strong>User:</strong> ${user}</span>
            <span><strong>Voucher:</strong> ${voucher}</span>
        </div>
    `;

    // Clone the table and remove hidden rows
    let table = document.getElementById("myPEBTable");
    let tableClone = table.cloneNode(true);

    let rows = tableClone.querySelectorAll('tr');
    rows.forEach((row) => {
        if (row.classList.contains('hidden')) {
            row.remove(); // Remove hidden rows from the cloned table
        } else {
            // Retain only the first 7 columns for each row
            while (row.cells.length > 12) {
                row.deleteCell(12); // Remove extra columns starting from index 7
            }
        }
    });

    // Start writing to the print window
    printWindow.document.write('<html><head><title>🖨️ Print</title></head><body>');
    printWindow.document.write(styles);
   
    printWindow.document.write('<span style="color:grey;font-size:70%;font-family:Magneto;">eS|MTally</span> <br/> <span style="color:black;font-size:120%;font-family:Arial;">MIPL Cash Management</span>'); // Optional title
 
    printWindow.document.write(filterSummary); // Add the filter summary to the print view

    // Add totalsmipl section
    printWindow.document.write(document.getElementById("totalsmipl").outerHTML);

    // Write the cloned table with only visible rows and limited columns
    printWindow.document.write(tableClone.outerHTML);

    // Close and print
    printWindow.document.close();
    printWindow.print();
}





     //   window.onload = () => {
       //     loadpebSheet();
       //     document.getElementById('filterColumn1').addEventListener('change', filterPEBTable);
        //    document.getElementById('filterColumn2').addEventListener('change', filterPEBTable);
         //   document.getElementById('startDate').addEventListener('change', filterPEBTable);
          //  document.getElementById('endDate').addEventListener('change', filterPEBTable);
      //  };
    </script>
</head>

</html>
<!-- MIPL LEDGER REPORT SCRIPT & CODE STOP Heare -->







<!-- BANKING form div script start hare -->
<script>
  const scriptBANKURL = 'https://script.google.com/macros/s/AKfycbw0xCIuyevQ3rXPs_sa-9yQGZ50eSIFGMwta7Rq0GqEXHCWDJqi5e4xvdE1hh1NSdU/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainBANKForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeBANK").value; //****
    const submitBANKButton = document.getElementById("submitBANKButton");
    submitBANKButton.disabled = true;
    submitBANKButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampBANK').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifyBANKEntry();
    } else {
      await submitBANKEntry(form);
    }

    submitBANKButton.disabled = false;
    submitBANKButton.value = "Submit";
  });

  async function submitBANKEntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptBANKURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset(); // FORM RESET
        document.getElementById("formModeBANK").value = "new";
       fetchData();  // ✅ Refresh dropdowns or UI
        refreshAll();

           // ✅ Remove DLT option after submit
        const BANKDropdown = document.getElementById("msaf7");
        const dltBANKOption = [...BANKDropdown.options].find(opt => opt.value === "DLT");
        if (dltBANKOption) {
          BANKDropdown.removeChild(dltBANKOption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchBANKDetails() {
    const sNo = document.getElementById("searchBANKSNo").value;
    const waitMessage = document.getElementById("waitBANKMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitBANKButton").style.display = "none";  //****
    try {
      const response = await fetch(`${scriptBANKURL}?sNo=${sNo}`);
      const data = await response.json();

    if (data.result !== "error" && data.Voucher === "RECEIPT") {
        document.getElementById("sNo").value = data.SNo;
        document.getElementById("msaf1").value = data.Date;
        document.getElementById("msaf2").value = data.Type;
        document.getElementById("msaf3").value = data.Ledger;
        document.getElementById("msaf4").value = data.VType;
        document.getElementById("msaf5").value = data.VNo;
        document.getElementById("msaf6").value = data.Narration;
        document.getElementById("msaf7").value = data.Voucher;
      //  document.getElementById("modifyBANKButton").style.display = "inline-block";


       // ✅ Add "DLT - delete" option if it doesn't exist already
const BANKDropdown = document.getElementById("msaf7");
if (![...BANKDropdown.options].some(opt => opt.value === "DLT")) {
  const dltRECEIPTOption = document.createElement("option");
  dltRECEIPTOption.value = "DLT";
  dltRECEIPTOption.text = "Delete";
  dltRECEIPTOption.style.color = "red";
  dltRECEIPTOption.style.backgroundColor = "blue";
  BANKDropdown.appendChild(dltRECEIPTOption);
}

       document.getElementById("formModeBANK").value = "modify"; // ✅ Set to modify

       // ✅ Show alert after successful data fetch
      alert("Select Delete Option in User Section For Delete Entry");
       
    //    document.getElementById("modifyBANKButton").style.display = "inline-block";
      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifyBANKEntry() {
    const waitMessage = document.getElementById("waitBANKMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainBANKForm');

    // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampBANK').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptBANKURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeBANK").value = "new"; // ✅ Reset to new
       fetchData();  // ✅ Refresh dropdowns or UI
        refreshAll();
        document.getElementById("submitBANKButton").style.display = "inline-block";
        document.getElementById("modifyBANKButton").style.display = "none";

          // ✅ Remove DLT option after modify
        const BANKDropdown = document.getElementById("msaf7");
        const dltBANKOption = [...BANKDropdown.options].find(opt => opt.value === "DLT");
        if (dltBANKOption) {
          BANKDropdown.removeChild(dltBANKOption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>
<!-- BANKING form div script stop hare -->




<!-- sale VOUCHER form div script start hare -->
<script>
  const scriptVCRURL = 'https://script.google.com/macros/s/AKfycbw0xCIuyevQ3rXPs_sa-9yQGZ50eSIFGMwta7Rq0GqEXHCWDJqi5e4xvdE1hh1NSdU/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainVCRForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeVCR").value; //****
    const submitVCRButton = document.getElementById("submitVCRButton");
    submitVCRButton.disabled = true;
    submitVCRButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampVCR').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifyVCREntry();
    } else {
      await submitVCREntry(form);
    }

    submitVCRButton.disabled = false;
    submitVCRButton.value = "Submit";
  });

  async function submitVCREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset(); // FORM RESET
        document.getElementById("formModeVCR").value = "new";
       fetchData();  // ✅ Refresh dropdowns or UI
        refreshAll();

           // ✅ Remove DLT option after submit
        const SALEDropdown = document.getElementById("msaf21");
        const dltVCROption = [...SALEDropdown.options].find(opt => opt.value === "DLT");
        if (dltVCROption) {
          SALEDropdown.removeChild(dltVCROption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchVCRDetails() {
    const sNo = document.getElementById("searchVCRSNo").value;
    const waitMessage = document.getElementById("waitVCRMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitVCRButton").style.display = "none";  //****
    try {
      const response = await fetch(`${scriptVCRURL}?sNo=${sNo}`);
      const data = await response.json();

    
    if (data.result !== "error" && data.Voucher === "SALE") {
      document.getElementById("sNo").value = data.SNo;
      document.getElementById("msaf11").value = data.Date;
      document.getElementById("msaf12").value = data.Type;
      document.getElementById("msaf13").value = data.Ledger;
      document.getElementById("msaf14").value = data.VNo;
      document.getElementById("msaf15").value = data.Reff;
      document.getElementById("msaf16").value = data.Amount;
      document.getElementById("msaf17").value = data.Weight;
      document.getElementById("msaf18").value = data.Rate;
      document.getElementById("msaf19").value = data.Narration;
      document.getElementById("msaf21").value = data.Voucher;
      //  document.getElementById("modifyVCRButton").style.display = "inline-block";


       // ✅ Add "DLT - delete" option if it doesn't exist already
const SALEDropdown = document.getElementById("msaf21");
if (![...SALEDropdown.options].some(opt => opt.value === "DLT")) {
  const dltSALEOption = document.createElement("option");
  dltSALEOption.value = "DLT";
  dltSALEOption.text = "Delete";
  dltSALEOption.style.color = "red";
  dltSALEOption.style.backgroundColor = "blue";
  SALEDropdown.appendChild(dltSALEOption);
}

       document.getElementById("formModeVCR").value = "modify"; // ✅ Set to modify

       // ✅ Show alert after successful data fetch
      alert("Select Delete Option in User Section For Delete Entry");
       
    //    document.getElementById("modifyVCRButton").style.display = "inline-block";
      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifyVCREntry() {
    const waitMessage = document.getElementById("waitVCRMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainVCRForm');

    // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampVCR').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeVCR").value = "new"; // ✅ Reset to new
       fetchData();  // ✅ Refresh dropdowns or UI
        refreshAll();
        document.getElementById("submitVCRButton").style.display = "inline-block";
        document.getElementById("modifyVCRButton").style.display = "none";

          // ✅ Remove DLT option after modify
        const SALEDropdown = document.getElementById("msaf21");
        const dltVCROption = [...SALEDropdown.options].find(opt => opt.value === "DLT");
        if (dltVCROption) {
          SALEDropdown.removeChild(dltVCROption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>
<!-- sale VOUCHER form div script stop hare -->





 <!-- ledger/jobb/reff code start hare *****************************-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ledger & Last 5 Entries</title>
  <style>
    .entry-box {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 20px 0;
      background-color: #f9f9f9;
    }
    .entry-box h4 {
      margin-top: 0;
      color: #333;
    }
  
  </style>
</head>
<body>

<script>
  let ledgerOption = [];
  let rawData = [];
  let dataHeader = [];

  async function fetchData() {
    const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
    const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
    const range = "FORM!A:K";

    try {
      const response = await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
      );
      const data = await response.json();

      if (!data.values || data.values.length === 0) {
        console.warn("No data found.");
        return;
      }

      dataHeader = data.values[0];
      rawData = data.values.slice(1);

      // All ledger values
      const allLedgerValues = rawData.map(row => row[3]).filter(Boolean);
      const allLedgerOptions = [...new Set(allLedgerValues)].sort((a, b) =>
        a.localeCompare(b)
      );

      // Tax invoice ledgers
      const taxInvoiceLedgerValues = rawData
        .filter(row => row[1] === "TAX INVOICE")
        .map(row => row[3])
        .filter(Boolean);
      const taxInvoiceOptions = [...new Set(taxInvoiceLedgerValues)].sort(
        (a, b) => a.localeCompare(b)
      );

      // Populate dropdowns
      document
        .querySelectorAll(".ledger-dropdown, .ledgerVCRdropdown")
        .forEach(select => {
          select.innerHTML = '<option value="">Select Ledger</option>';
          const isMsaf13 = select.id === "msaf13";
          const optionsToUse = isMsaf13 ? taxInvoiceOptions : allLedgerOptions;

          optionsToUse.forEach(item => {
            const option = document.createElement("option");
            option.value = item;
            option.textContent = item;
            select.appendChild(option);
          });

          if (select.classList.contains("ledger-dropdown")) {
            select.addEventListener("change", function () {
              updateReffDropdown(this.value);
            });
          }
        });

      // Show last entries
      showLastFiveEntriesByType("RECEIPT", "receiptContainer");
      showLastFiveEntriesByType("SALE", "saleContainer");

    } catch (error) {
      console.error("Error fetching data:", error);
      alert("Failed to fetch ledger list.");
    }
  }

  function updateReffDropdown(selectedLedger) {
    const reffSelect = document.querySelector(".Reff-dropdown");
    reffSelect.innerHTML = '<option value="">Select Job/Reff No.</option>';

    if (!selectedLedger) return;

    const reffValues = rawData
      .filter(row => row[3] === selectedLedger && row[5])
      .map(row => row[5]);

    const uniqueReffs = [...new Set(reffValues)].sort((a, b) =>
      a.localeCompare(b)
    );

    uniqueReffs.forEach(ref => {
      const option = document.createElement("option");
      option.value = ref;
      option.textContent = ref;
      reffSelect.appendChild(option);
    });
  }

  function showLastFiveEntriesByType(type, containerId) {
    const filtered = rawData.filter(
      row => row[10]?.toUpperCase() === type.toUpperCase()
    );
    const lastFive = filtered.slice(-10).reverse();

    const container = document.getElementById(containerId);
    container.innerHTML = `<h4>Last 5 ${type} Entries</h4>`;

    if (lastFive.length === 0) {
      container.innerHTML += "<p>No entries found.</p>";
      return;
    }

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    dataHeader.forEach(header => {
      const th = document.createElement("th");
      th.textContent = header;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");
    lastFive.forEach(row => {
      const tr = document.createElement("tr");
      dataHeader.forEach((_, index) => {
        const td = document.createElement("td");
        td.textContent = row[index] || "";
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    container.appendChild(table);
  }

  document.addEventListener("DOMContentLoaded", fetchData);
</script>


</body>
</html>
 <!-- ledger/jobb/reff code stop hare *****************************-->




 

<!-- imprest voucher REPORT SCRIPT & CODE start Heare -->

<!DOCTYPE html>
<html>
<head>
    <title>IV Ledger Report</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
       

         #searchIVContainer {
            position: sticky;
            top: 0;
           left: 0;
      width: 100%;
      background: #ebecec;
      padding: 10px 20px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1000;
      color: #000;
        }

        .searchIVContainer select,
    .searchIVContainer input {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }

        .select2-container {
            flex: 1;
        }

        tr.hidden {
            display: none;
        }
        tr.receipt {
            background-color: #ffe6e6;
            color: #a10404;
        }

        tr.receipt2 {
            background-color: #ffe6e6;
            color: #5b0202;
          }
        tr.bill {
            background-color: #e6f3ff;
            color: #1d03c6;
        }
        #totalsIV {
             font-size: 20px;
            color: #f5f6f9;
            background-color: #012400;
        }
        #noResultsMessage {
            text-align: center;
            margin-top: 10px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        async function loadIVSheet() {
            const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM"; // Replace with your API key
            const sheetId = "1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA"; // Replace with your Sheet ID
            const range = 'IVCR!W:AD'; // Replace with the correct range
    
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
                );
                const data = await response.json();
    
                if (data.values) {
                    populateIVTable(data.values);
                    populateIVDropdowns(data.values);
                } else {
                    console.error("No data found in the specified range.");
                }
            } catch (error) {
                console.error("Error fetching data from Google Sheets:", error);
            }
        }
    
        function populateIVTable(data) {
            const table = document.getElementById('myIVTable');
            table.innerHTML = ''; // Clear existing rows
    
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
    
                if (index === 0) {
                    // Header row
                    row.forEach(cell => {
                        const th = document.createElement('th');
                        th.textContent = cell;
                        tr.appendChild(th);
                    });
    

                    // Add "Running Balance" column to the header
                    const thRunningBalance = document.createElement('th');
                    thRunningBalance.textContent = 'Balance';
                    tr.appendChild(thRunningBalance);
                } else {
                    // Data rows
                    row.forEach((cell, cellIndex) => {
                        const td = document.createElement('td');
                        td.textContent = cell;
                        tr.appendChild(td);
    
                        // Add class based on "Type" column
                        if (cellIndex === 2) { // Assuming Type is in column 2
                            if (cell.toLowerCase() === "receipt") {
                                tr.classList.add('receipt');
                            } else if (cell.toLowerCase() === "receipt ") {
                                tr.classList.add('receipt2');
                            } else if (cell.toLowerCase() === "bill") {
                                tr.classList.add('bill');
                            }
                        }
                    });
    
                    // Add empty cell for "Running Balance"
                    const tdRunningBalance = document.createElement('td');
                    tdRunningBalance.classList.add('runningBalance');
                    tr.appendChild(tdRunningBalance);
                }
    
                table.appendChild(tr);
            });
    
            
        }
    
    
   
// runnin balance start hare 


        function calculateIVRunningBalance() {
    // Select only visible rows after filtering (excluding the header row)
    const rows = Array.from(document.querySelectorAll('#myIVTable tr:not(.hidden)')).slice(1); // Skip header row

    if (rows.length === 0) return; // Exit if no rows are visible

    // Get the amount from the last visible row (latest transaction)
    const lastRow = rows[rows.length - 1];
    const lastRowCells = lastRow.querySelectorAll('td');
    const lastRowTransactionType = lastRowCells[2]?.textContent.trim().toLowerCase(); // Type column
    const lastRowAmount = parseFloat(lastRowCells[5]?.textContent || 0); // Amount column

    // Start the running balance with the amount from the last row
    let runningBalance = lastRowTransactionType === "receipt" ? lastRowAmount : -lastRowAmount;

    // Update the running balance cell in the last row
    const lastRowBalanceCell = lastRow.querySelector('.runningBalance');
    if (lastRowBalanceCell) {
        lastRowBalanceCell.textContent = runningBalance.toFixed(2);
    }

    // Iterate upwards through the remaining rows
    for (let index = rows.length - 2; index >= 0; index--) {
        const row = rows[index];
        const cells = row.querySelectorAll('td');
        const transactionType = cells[2]?.textContent.trim().toLowerCase(); // Assuming "Type" column is at index 2
        const amount = parseFloat(cells[5]?.textContent || 0); // Assuming "Amount" column is at index 5

        if (!isNaN(amount)) {
            if (transactionType === "receipt") {
                runningBalance += amount; // Add for receipt
            } else if (transactionType === "payment") {
                runningBalance -= amount; // Subtract for payment
            }else if (transactionType === "bill") {
                runningBalance -= amount; // Subtract for payment
            }else if (transactionType === "salary") {
                runningBalance += amount; // Subtract for payment
            }
        }

        // Update the running balance cell
        const runningBalanceCell = row.querySelector('.runningBalance');
        if (runningBalanceCell) {
            runningBalanceCell.textContent = runningBalance.toFixed();
        }
    }
}

// running balance funtion stop
//calculateIVRunningBalance(); // Recalculate running balance after filtering


function populateIVDropdowns(data) {
    const dropdown1 = document.getElementById('filterIVColumn1');
    const dropdown2 = document.getElementById('filterIVColumn2');
    const dropdown4 = document.getElementById('filterIVColumn4');

    const uniqueValues1 = [...new Set(data.slice(1).map(row => row[1]))]; // Column 1
    const uniqueValues2 = [...new Set(data.slice(1).map(row => row[2]))]; // Column 2
    const uniqueValues4 = [...new Set(data.slice(1).map(row => row[4]))]; // Column 4

    populateIVDropdown(dropdown1, uniqueValues1);
    populateIVDropdown(dropdown2, uniqueValues2);
    populateIVDropdown(dropdown4, uniqueValues4);

    // Initialize Select2 for searchable dropdown
    $(dropdown4).select2({
        placeholder: "-- Select --",
        allowClear: true,
        width: 'resolve'
    });

    // Bind filter event for Select2
    $(dropdown4).on('change', filterIVTable);

    // Map for dropdown1 values to corresponding names
    const userMapping = {
        IV01: "User | Amarbahadur",
        IV02: "User | Vijender Sharma",
        IV03: "User | Rahul",
        IV04: "User | Raju - UK18CA4818",
        IV05: "User | Mannu - UK18CA4819",
        IV06: "User | Aakash - UK04CC1458",
        IV07: "User | Manjeet - UK18CA8919",
        IV08: "User | NITIN KUMAR",
        IV09: "User | SUNIL YADAV",
        IV10: "User | AJAY KUMAR-UK18CA3770"

        //   <div id="resultIVDiv"></div>  user name show as per your requre
    };

    // Event listener for dropdown1 to show corresponding name
    dropdown1.addEventListener('change', function () {
        const selectedValue = dropdown1.value;
        const resultIVDiv = document.getElementById('resultIVDiv');

        if (userMapping[selectedValue]) {
            resultIVDiv.textContent = userMapping[selectedValue]; // Show corresponding name
        } else {
            resultIVDiv.textContent = ""; // Clear the div if no valid option is selected
        }
    });
}

function populateIVDropdown(dropdown, values) {
    dropdown.innerHTML = '<option value="">-- Select --</option>';
    values.forEach(value => {
        const option = document.createElement('option');
        option.value = value;
        option.textContent = value;
        dropdown.appendChild(option);
    });
}




        function filterIVTable() {
    const filter1 = document.getElementById('filterIVColumn1').value.toLowerCase();
    const filter2 = document.getElementById('filterIVColumn2').value.toLowerCase();
    const filter4 = $('#filterIVColumn4').val()?.toLowerCase();

    const starIVtDateInput = document.getElementById("starIVtDate").value;
    const endIVDateInput = document.getElementById("endIVDate").value;

    // ---- Convert input to pure date (ignore time) ----
    const starIVtDate = starIVtDateInput ? new Date(starIVtDateInput + "T00:00:00") : null;
    const endIVDate = endIVDateInput ? new Date(endIVDateInput + "T23:59:59") : null;

    const rows = document.querySelectorAll('#myIVTable tr');
    let visibleRows = 0;
    let totalIVPayment = 0, totalIVReceipt = 0, totalIVBill = 0, totalIVSalary = 0;

    rows.forEach((row, index) => {
        if (index === 0) return; // Skip header row

        const cells = row.querySelectorAll('td');
        const rowDateStr = cells[3]?.textContent.trim();
        const date = rowDateStr ? new Date(rowDateStr) : null;

        const type = cells[2]?.textContent.trim().toUpperCase();
        const amount = parseFloat(cells[5]?.textContent.trim()) || 0;

        // ---- Date filter check (inclusive) ----
        let dateMatches = true;
        if (date && !isNaN(date)) {
            if (starIVtDate && date < starIVtDate) dateMatches = false;
            if (endIVDate && date > endIVDate) dateMatches = false;
        }
        // Agar date column blank/invalid hai → filter skip karega (row dikhegi)

        // ---- Other filters ----
        const matchesFilter1 = !filter1 || cells[1]?.textContent.toLowerCase() === filter1;
        const matchesFilter2 = !filter2 || cells[2]?.textContent.toLowerCase() === filter2;
        const matchesFilter4 = !filter4 || cells[4]?.textContent.toLowerCase() === filter4;

        if (matchesFilter1 && matchesFilter2 && matchesFilter4 && dateMatches) {
            row.classList.remove('hidden');
            visibleRows++;

            // ---- Totals update ----
            if (type === "PAYMENT") {
                totalIVPayment += amount;
            } else if (type === "RECEIPT") {
                totalIVReceipt += amount;
            } else if (type === "BILL") {
                totalIVBill += amount;
            } else if (type === "SALARY") {
                totalIVSalary += amount;
            }
        } else {
            row.classList.add('hidden');
        }
    });

    displayIVNoResultsMessage(visibleRows);
    updateIVTotals(totalIVPayment, totalIVReceipt, totalIVBill, totalIVSalary);

    // Recalculate running balance after filtering
    calculateIVRunningBalance();
}

    
        function displayIVNoResultsMessage(visibleRows) {
            const noResultsMessage = document.getElementById('noResultsMessage');
            if (!visibleRows) {
                if (!noResultsMessage) {
                    const message = document.createElement('p');
                    message.id = 'noResultsMessage';
                    message.textContent = 'No matching results found.';
                    document.body.appendChild(message);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }
    
        function updateIVTotals(totalIVPayment, totalIVReceipt, totalIVBill, totalIVSalary) {
            document.getElementById("totalIVPayment").textContent = totalIVPayment.toFixed();
            document.getElementById("totalIVReceipt").textContent = totalIVReceipt.toFixed();
            document.getElementById("totalIVBill").textContent = totalIVBill.toFixed();
            document.getElementById("totalIVSalary").textContent = totalIVSalary.toFixed();
            document.getElementById("totalIVDifference").textContent = (totalIVReceipt - totalIVPayment - totalIVBill + totalIVSalary).toFixed();
        }
    

        function printIVTable() {
    let printWindow = window.open('', '', 'height=500, width=800');

    const styles = `
        <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 12px; text-align: left; }
            table th, table td { border: 1px solid #ddd; padding: 5px; }
            table th { background-color: #f4f4f4; font-weight: bold; }
            table tr.payment { background-color: white; color: black; }
            table tr.receipt { background-color: blac; color: red; }
            table tr.bill { background-color: blac; color: blue; }
            .filter-summary { margin: 10px 0; font-size: 14px; }
            .filter-summary span { display: inline-block; margin-right: 20px; }
        </style>
    `;

    // Fetch filter values
    const ledger = document.getElementById("filterIVColumn4").value || "All";
    const starIVtDate = document.getElementById("starIVtDate").value || "Not Set";
    const endIVDate = document.getElementById("endIVDate").value || "Not Set";
    const user = document.getElementById("filterIVColumn1").value || "All";
    const voucher = document.getElementById("filterIVColumn2").value || "All";

    // Create a summary of filter options
    const filterSummary = `
        <div class="filter-summary">
            <span><strong>Ledger:</strong> ${ledger}</span>
            <span><strong>From:</strong> ${starIVtDate}</span>
            <span><strong>To:</strong> ${endIVDate}</span>
            <span><strong>User:</strong> ${user}</span>
            <span><strong>Voucher:</strong> ${voucher}</span>
        </div>
    `;

    // Clone the table and remove hidden rows
    let table = document.getElementById("myIVTable");
    let tableClone = table.cloneNode(true);

    let rows = tableClone.querySelectorAll('tr');
    rows.forEach((row) => {
        if (row.classList.contains('hidden')) {
            row.remove(); // Remove hidden rows from the cloned table
        } else {
            // Retain only the first 7 columns for each row
            while (row.cells.length > 9) {
                row.deleteCell(7); // Remove extra columns starting from index 7
            }
        }
    });

    // Start writing to the print window
    printWindow.document.write('<html><head><title>🖨️ Print</title></head><body>');
    printWindow.document.write(styles);
   
    printWindow.document.write('<span style="color:grey;font-size:70%;font-family:Magneto;">eS|MTally</span> <br/> <span style="color:black;font-size:120%;font-family:Arial;">MIPL Cash Management</span>'); // Optional title
 
    printWindow.document.write(filterSummary); // Add the filter summary to the print view

    // Add totalsIV section
    printWindow.document.write(document.getElementById("totalsIV").outerHTML);

    // Write the cloned table with only visible rows and limited columns
    printWindow.document.write(tableClone.outerHTML);

    // Close and print
    printWindow.document.close();
    printWindow.print();
}







      //  window.onload = () => {
        //    loadIVSheet();
     //       document.getElementById('filterIVColumn1').addEventListener('change', filterIVTable);
       //     document.getElementById('filterIVColumn2').addEventListener('change', filterIVTable);
      //      document.getElementById('starIVtDate').addEventListener('change', filterIVTable);
      //      document.getElementById('endIVDate').addEventListener('change', filterIVTable);
   //     };
    </script>


</head>
</html>


<!-- imprest voucher REPORT SCRIPT & CODE STOP Heare -->






 <!-- IVCR form div script start hare -->
<script>
  const scriptIVCRURL = 'https://script.google.com/macros/s/AKfycbz-lyd06EKKSO4xVaTSRWoIgMWS0C9nZvzipEP59K25TZSOSdL5CMpYJNPgmF1nyyGrXg/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainIVCRForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeIVCR").value; //****
    const submitIVCRButton = document.getElementById("submitIVCRButton");
    submitIVCRButton.disabled = true;
    submitIVCRButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampIVCR').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifyIVCREntry();
    } else {
      await submitIVCREntry(form);
    }

    submitIVCRButton.disabled = false;
    submitIVCRButton.value = "Submit";
  });

  async function submitIVCREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptIVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset(); // FORM RESET
        document.getElementById("formModeIVCR").value = "new";
        loadIVCRSheet(); //REFRESH
         loadIVSheet();  // REFRESH

           // ✅ Remove DLT option after submit
        const voucherDropdown = document.getElementById("voucherType");
        const dltOption = [...voucherDropdown.options].find(opt => opt.value === "DLT");
        if (dltOption) {
          voucherDropdown.removeChild(dltOption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchIVCRDetails() {
    const sNo = document.getElementById("searchIVCRSNo").value;
    const waitMessage = document.getElementById("waitIVCRMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitIVCRButton").style.display = "none";  //****
 //   try {
  //    const response = await fetch(`${scriptIVCRURL}?sNo=${sNo}`);
   //   const data = await response.json();

    //   if (data.Voucher === "IV03" || data.Voucher === "IV10" ||data.Voucher === "IV04" ||data.Voucher === "IV05" || data.Voucher === "IV06"|| data.Voucher === "IV07"|| data.Voucher === "IV08"|| data.Voucher === "IV09") {
     


    //**** option value ke base par data fetch krna

    try {
  const response = await fetch(`${scriptIVCRURL}?sNo=${sNo}`);
  const data = await response.json(); // ✅ You need this line!

const voucherTypeDropdown = document.getElementById("voucherType");
const selectedIVVoucher = voucherTypeDropdown.value;

if (data.result !== "error" && data.Voucher === selectedIVVoucher) {
    
    document.getElementById("sNo").value = data.SNo;
        document.getElementById("voucherType").value = data.Voucher;
        document.getElementById("ivcr0").value = data.Type;
        document.getElementById("ivcr1").value = data.Date;
        document.getElementById("dropdownIVCRSearch").value = data.Ledger;
        document.getElementById("ivcr2").value = data.Amount;
        document.getElementById("ivcr3").value = data.Narration;
      //  document.getElementById("modifyIVCRButton").style.display = "inline-block";


       // ✅ Add "DLT - delete" option if it doesn't exist already
const voucherDropdown = document.getElementById("voucherType");
if (![...voucherDropdown.options].some(opt => opt.value === "DLT")) {
  const deleteOption = document.createElement("option");
  deleteOption.value = "DLT";
  deleteOption.text = "Delete";
  deleteOption.style.color = "red";
  deleteOption.style.backgroundColor = "blue";
  voucherDropdown.appendChild(deleteOption);
}

       document.getElementById("formModeIVCR").value = "modify"; // ✅ Set to modify
    //    document.getElementById("modifyIVCRButton").style.display = "inline-block";

    // ✅ Show alert after successful data fetch
      alert(" Select Delete Option in User Section For Delete Entry");

      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifyIVCREntry() {
    const waitMessage = document.getElementById("waitIVCRMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainIVCRForm');

    // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampIVCR').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptIVCRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeIVCR").value = "new"; // ✅ Reset to new
      loadIVCRSheet(); //REFRESH
         loadIVSheet();  // REFRESH
        document.getElementById("submitIVCRButton").style.display = "inline-block";
        document.getElementById("modifyIVCRButton").style.display = "none";

          // ✅ Remove DLT option after modify
        const voucherDropdown = document.getElementById("voucherType");
        const dltOption = [...voucherDropdown.options].find(opt => opt.value === "DLT");
        if (dltOption) {
          voucherDropdown.removeChild(dltOption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>
<!-- IVCR form div script stop hare -->





 <!-- IMPREST VOUCHER FORM LEDGER DROPDOWN & TABLE CODE START -->
<!DOCTYPE html>
<html>
<head>
  <title>Ledger Filter</title>
  <style>
   
    tr.receipt { background-color: #ffe6e6; color: #a10404; }
    tr.bill { background-color: #e6f3ff; color: #1d03c6; }
    .runningBalance { font-weight: bold; }

      .dropdown-container {
    position: relative;
    margin-top: 20px;
  }

  #dropdownIVCRSearch {
    width: 3in;
  }

  ul.dropdownCSSlist {
    display: none;
    list-style: none;
    padding: 0;
    margin: 0;
    border: 1px solid #ccc;
    max-height: 8in; /* ✅ 8-inch height */
    overflow-y: auto;
    background: white;
    position: absolute;
    z-index: 10;
    width: 4in;
  }

  ul.dropdownCSSlist li {
    padding: 5px;
    cursor: pointer;
  }

  ul.dropdownCSSlist li:hover {
    background-color: #ddd;
  }
  </style>
</head>
<body>



 
  <script>
    let fulivcrData = [];

    async function loadIVCRSheet() {
      const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
      const sheetId = "1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA";
      const range = 'IVCR!W:AD';

      try {
        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`);
        const data = await response.json();
        if (data.values) {
          fulivcrData = data.values;
          updateIVCRTableAndDropdown();
        }
      } catch (err) {
        console.error("Error fetching Google Sheets data:", err);
      }
    }

    function updateIVCRTableAndDropdown() {
      const selectedVoucher = document.getElementById('ivuser').value;
      const filteredData = fulivcrData.filter((row, i) => i === 0 || row[1] === selectedVoucher);
      populateDropdownList(filteredData);
      populateIVCRTable(filteredData);
    }

    function populateDropdownList(data) {
      const ul = document.getElementById("dropdownIVCRList");
      ul.innerHTML = '';
      const uniqueValues = [...new Set(data.slice(1).map(row => row[4]))];

      uniqueValues.forEach(value => {
        const li = document.createElement("li");
        li.textContent = value;
        li.onclick = () => {
          document.getElementById('dropdownIVCRSearch').value = value;
          ul.style.display = "none";
          const filtered = data.filter((row, i) => i === 0 || row[4] === value);
          populateIVCRTable(filtered);
        };
        ul.appendChild(li);
      });
    }

   function filterIVCRDropdown() {
  const searchInput = document.getElementById("dropdownIVCRSearch");
  const list = document.getElementById("dropdownIVCRList");
  const searchVal = searchInput.value.toLowerCase();

  if (searchVal === "") {
    list.style.display = "none";
    return;
  }

  let found = false;
  const items = list.querySelectorAll("li");
  items.forEach(item => {
    const match = item.textContent.toLowerCase().includes(searchVal);
    item.style.display = match ? "block" : "none";
    if (match) found = true;
  });

  list.style.display = found ? "block" : "none";
}

function populateDropdownList(data) {
  const ul = document.getElementById("dropdownIVCRList");
  ul.innerHTML = '';
  const uniqueValues = [...new Set(data.slice(1).map(row => row[4]))];

  uniqueValues.forEach(value => {
    const li = document.createElement("li");
    li.textContent = value;

    // When clicked, just fill the input, DO NOT filter the table
    li.onclick = () => {
      document.getElementById('dropdownIVCRSearch').value = value;
      ul.style.display = "none";
      // 🔴 No effect on the table
    };

    ul.appendChild(li);
  });
}


    function populateIVCRTable(data) {
      const table = document.getElementById("myIVCRTable");
      table.innerHTML = '';

      data.forEach((row, index) => {
        const tr = document.createElement("tr");
        if (index === 0) {
          row.forEach(cell => {
            const th = document.createElement("th");
            th.textContent = cell;
            tr.appendChild(th);
          });
          const th = document.createElement("th");
          th.textContent = "Balance";
          tr.appendChild(th);
        } else {
          row.forEach((cell, idx) => {
            const td = document.createElement("td");
            td.textContent = cell;
            tr.appendChild(td);

            if (idx === 2) {
              const type = cell.trim().toLowerCase();
              if (type === 'receipt') tr.classList.add('receipt');
              if (type === 'bill') tr.classList.add('bill');
            }
          });
          const td = document.createElement("td");
          td.className = "runningBalance";
          tr.appendChild(td);
        }
        table.appendChild(tr);
      });

      calculateIVCRRunningBalance();
    }

    function calculateIVCRRunningBalance() {
      const rows = Array.from(document.querySelectorAll("#myIVCRTable tr")).slice(1);
      if (rows.length === 0) return;

      let lastRow = rows[rows.length - 1];
      let cells = lastRow.querySelectorAll('td');
      let amount = parseFloat(cells[5]?.textContent || 0);
      let type = cells[2]?.textContent.trim().toLowerCase();

      let balance = (type === 'receipt') ? amount : -amount;
      cells[cells.length - 1].textContent = balance.toFixed(2);

      for (let i = rows.length - 2; i >= 0; i--) {
        const row = rows[i];
        const tds = row.querySelectorAll('td');
        const amt = parseFloat(tds[5]?.textContent || 0);
        const typ = tds[2]?.textContent.trim().toLowerCase();

        if (!isNaN(amt)) {
          if (typ === 'receipt' || typ === 'salary') balance += amt;
          else if (typ === 'payment' || typ === 'bill') balance -= amt;
        }
        tds[tds.length - 1].textContent = balance.toFixed();
      }
    }

    document.getElementById("ivuser").addEventListener("change", updateIVCRTableAndDropdown);

    // Hide dropdown when clicking outside
    document.addEventListener('click', function (e) {
      const searchBox = document.getElementById("dropdownIVCRSearch");
      const list = document.getElementById("dropdownIVCRList");
      if (!searchBox.contains(e.target) && !list.contains(e.target)) {
        list.style.display = "none";
      }
    });

  //  window.onload = loadIVCRSheet;
  </script>

</body>
</html>

  
 <!-- IMPREST VOUCHER FORM LEDGER DROPDOWN & TABLE CODE STOP -->

  


 <!-- mainSRRForm  code start hare -->


             <!-- SRR form div script start hare -->
             <script>
                const scriptSRRURL = 'https://script.google.com/macros/s/AKfycbxNCtOS7UZu2mw_Zuwkx-KHdORL1DATDoSp0Gv2Q5EQw6CKJOSPowawczVE_7uYHQw_/exec';
              
                document.addEventListener("submit", async function (e) {
                  const form = e.target;
                  if (form.id !== "mainSRRForm") return;
              
                  e.preventDefault();
                   const formMode = document.getElementById("formModeSRR").value;   //****
                  const submitSRRButton = document.getElementById("submitSRRButton");
                  submitSRRButton.disabled = true;
                  submitSRRButton.value = "Wait..";
              
                  const now = new Date();
                  document.getElementById('timestampSRR').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
              
                  const formInputs = form.querySelectorAll('input, textarea');
                  formInputs.forEach(input => {
                    if (input.type === 'text' || input.type === 'textarea') {
                      input.value = input.value.toUpperCase();
                    }
                  });
                  //
              
                 if (formMode === "modify") {
      await modifySRREntry();
    } else {
      await submitSRREntry(form);
    }

    submitSRRButton.disabled = false;
    submitSRRButton.value = "Submit";
  });

  async function submitSRREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptSRRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset();
        document.getElementById("formModeSRR").value = "new";
        filterDp();
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
   //           
                async function fetchSRRDetails() {
                  const sNo = document.getElementById("searchSRRSNo").value;
                  const waitMessage = document.getElementById("waitSRRMessage");
                  waitMessage.innerText = "Fetching data... Please wait...";
                  waitMessage.style.display = 'block';
              

                   // 🔻 HIDE SUBMIT BUTTON WHEN FETCH STARTS
          //    document.getElementById("submitSRRButton").style.display = "none";

                  try {
                    const response = await fetch(`${scriptSRRURL}?sNo=${sNo}`);
                    const data = await response.json();
              
                    if (data.result !== "error" && data.User === "STORE") {
                      document.getElementById("sNo").value = data.SNo;
                      document.getElementById("msaf91").value = data.User;
                      document.getElementById("dropdownSRRSearch").value = data.Ledger;
                      document.getElementById("msaf92").value = data.Date;
                      document.getElementById("msaf93").value = data.cl1;
                      document.getElementById("msaf94").value = data.cl2;
                      document.getElementById("msaf95").value = data.cl3;
                      document.getElementById("msaf96").value = data.cl4;
                      document.getElementById("msaf97").value = data.cl5;
                      document.getElementById("msaf98").value = data.cl6;
                      document.getElementById("msaf99").value = data.cl7;
                     
                        document.getElementById("formModeSRR").value = "modify"; // ✅ Set to modify   ****
             //         document.getElementById("modifySRRButton").style.display = "inline-block";  // Show modify
                    } else {
                      alert("No record found for the given S.No. with Type 'SHEKHER'.");
                    }
                  } catch (error) {
                    console.error("Error fetching details:", error);
                    alert("Please reconcile details or contact admin.");
                  } finally {
                    setTimeout(() => waitMessage.style.display = 'none', 2000);
                  }
                }
              
                async function modifySRREntry() {

                  const waitMessage = document.getElementById("waitSRRMessage");
                   waitMessage.innerText = "Please wait...";
                     waitMessage.style.display = "block";

                 const form = document.getElementById('mainSRRForm');

                 // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampSRR').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
//
                const formData = new FormData(form);
                formData.set('SNo', document.getElementById('sNo').value);
                     try {
              const response = await fetch(scriptSRRURL, { method: 'POST', body: formData });
               const result = await response.json();

               if (result.result === 'success') {
               alert('Entry modified successfully!');
                document.getElementById("formModeSRR").value = "new"; // ✅ Reset to new
               form.reset(); // ✅ Reset form
       filterDp();  // ✅ Refresh 
      document.getElementById("submitSRRButton").style.display = "inline-block"; // ✅ Show submit button
      document.getElementById("modifySRRButton").style.display = "none";         // ✅ Hide modify button
    } else {
      alert(`Error modifying entry: ${result.error}`);
    }
  } catch (error) {
    alert(`Error: ${error.message}`);
  } finally {
    setTimeout(() => waitMessage.style.display = 'none', 2000); // ✅ Hide wait message
  }
}


              </script>
 <!-- mainSRRForm body code stop hare -->

       
<!-- STOCK RAGISTER TABLE AND LEDGER SERCH BAR CODE AND SCRIPT START -->
              
                           <style>
                            .dropdown-container {
                                position: relative;
                                width: 250px;
                            }
                            
                            #dropdownSRRSearch {
                                width: 100%;
                                padding: 8px;
                                border: 1px solid #ccc;
                                border-radius: 5px;
                            }
                            
                            .dropdown-list {
                                position: absolute;
                                width: 4in;
                                background: white;
                                color: black;
                                border: 1px solid #ccc;
                                max-height: 500px;
                                overflow-y: auto;
                                display: none;
                                z-index: 1000;
                                list-style: none;
                                padding: 0;
                                margin: 0;
                                
                            }
                            
                            .dropdown-list.show {
                                display: block;
                            }
                            
                            .dropdown-list li {
                                padding: 8px;
                                cursor: pointer;
                                border-bottom: 1px solid #ddd;
                            }
                            
                            .dropdown-list li:hover {
                                background: #f0f0f0;
                            }
                            
                            /* Hide last border */
                            .dropdown-list li:last-child {
                                border-bottom: none;
                            }

                            
                            </style>
                            


<script>
    let columnSRRData = [];
    let allStoreData = [];
    let tableData = [];

    async function filterDp() {
        const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
        const sheetId = "1wvsPdAQA57HxhTxA3cCcQvUEz93IWkBre_Ix-qvzwss";
        const range = 'FORM!A:L';

        try {
            const response = await fetch(
                `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
            );
            const data = await response.json();

            if (data.values) {
                columnSRRData = [];
                allStoreData = [];

                const seenValues = new Set();

                data.values.forEach((row, index) => {
                    if (index !== 0) {
                        const value = row[3];
                        const type = row[1]?.trim().toUpperCase();

                        if (value && !seenValues.has(value)) {
                            seenValues.add(value);
                            columnSRRData.push(value);
                        }

                        if (type === "STORE") {
                            allStoreData.push({ indexNo: index, row });
                        }
                    }
                });

                // Show all data (no limit to 10 entries)
                tableData = allStoreData.reverse();

                populatedpDropdown();
                populatedpTable();
            } else {
                console.error("No data found in the specified range.");
            }
        } catch (error) {
            console.error("Error fetching data from Google Sheets:", error);
        }
    }

    function populatedpDropdown() {
        const dropdownList = document.getElementById("dropdownList");
        dropdownList.innerHTML = "";

        columnSRRData.forEach(option => {
            const li = document.createElement("li");
            li.textContent = option;
            li.onclick = function () {
                document.getElementById("dropdownSRRSearch").value = option;
                dropdownList.classList.remove("show");
                filterByDropdownSelection();
            };
            dropdownList.appendChild(li);
        });
    }

    function filterDropdown() {
        const input = document.getElementById("dropdownSRRSearch").value.toLowerCase().trim();
        const dropdownList = document.getElementById("dropdownList");
        dropdownList.innerHTML = "";

        // Filter only dropdown options (columnSRRData)
        const filteredDropdown = columnSRRData.filter(item =>
            item.toLowerCase().includes(input)
        );

        if (filteredDropdown.length > 0) {
            dropdownList.classList.add("show");
            filteredDropdown.forEach(option => {
                const li = document.createElement("li");
                li.textContent = option;
                li.onclick = function () {
                    document.getElementById("dropdownSRRSearch").value = option;
                    dropdownList.classList.remove("show");
                    filterByDropdownSelection();
                };
                dropdownList.appendChild(li);
            });
        } else {
            dropdownList.classList.remove("show");
        }

        // Table search across ALL cells
        const filteredTable = allStoreData.filter(item =>
            item.row.some(cell =>
                cell?.toLowerCase().includes(input)
            )
        );

        tableData = filteredTable;
        renderFilteredSRRTable(filteredTable);
    }

    function filterByDropdownSelection() {
        const selectedValue = document.getElementById("dropdownSRRSearch").value.trim().toLowerCase();
        if (!selectedValue) {
            tableData = allStoreData;
            populatedpTable();
            return;
        }

        const filtered = allStoreData.filter(item => {
            const party = item.row[3]?.toLowerCase();
            return party && party.includes(selectedValue);
        });

        tableData = filtered;
        renderFilteredSRRTable(filtered);
    }

    function filterByDate() {
        const fromDate = document.getElementById("fromSRRDate").value;
        const toDate = document.getElementById("toSRRDate").value;

        if (!fromDate || !toDate) {
            alert("Please select both From and To dates.");
            return;
        }

        const from = new Date(fromDate);
        const to = new Date(toDate);

        const filtered = allStoreData.filter(item => {
            const rowDateStr = item.row[2];
            if (!rowDateStr) return false;
            const rowDate = new Date(rowDateStr);
            return rowDate >= from && rowDate <= to;
        });

        tableData = filtered;
        renderFilteredSRRTable(filtered);
    }

    function populatedpTable() {
        renderFilteredSRRTable(tableData);
    }

    function renderFilteredSRRTable(dataArray) {
    const tableDiv = document.getElementById("tableDiv");

    let table = `<table border='1'>
        <thead>
            <tr>
                <th>SNo</th><th>User</th><th>Date</th><th>Party</th><th>Type</th>
                <th>Vcr. Type</th><th>Doc No.</th><th>Weight</th>
                <th>Item Details</th><th>Vehicle No.</th><th>Status</th>
            </tr>
        </thead>
        <tbody>`;

    dataArray.forEach(item => {
        const row = item.row || [];

        const isLoad = row.length > 10 && row[10].toLowerCase() === "load";
        const isX = row.length > 10 && row[10].toLowerCase() === "x";
        const isUnload = row.length > 10 && row[10].toLowerCase() === "unload";

        let rowStyle = "";
        if (isLoad || isUnload) {
           // rowStyle = "style='background-color: rgb(170, 230, 247);'";
              rowStyle = "style='background-color: rgb(209, 238, 238);color: blue; font-weight: bold;'";
        } else if (isX) {
            rowStyle = "style='background-color: rgb(238, 209, 209);color: red; font-weight: bold;'";
        }

        table += `<tr ${rowStyle}>
            <td>${item.indexNo}</td>
            <td>${row[1] || ""}</td>
            <td>${row[2] || ""}</td>
            <td>${row[3] || ""}</td>
            <td>${row[4] || ""}</td>
            <td>${row[5] || ""}</td>
            <td>${row[6] || ""}</td>
            <td>${row[7] || ""}</td>
            <td>${row[8] || ""}</td>
            <td>${row[9] || ""}</td>
            <td>${row[10] || ""}</td>
        </tr>`;
    });

    table += `</tbody></table>`;
    tableDiv.innerHTML = table;

    // Dropdown close on outside click
    document.addEventListener("click", function (event) {
        const dropdown = document.getElementById("dropdownList");
        const searchBox = document.getElementById("dropdownSRRSearch");
        if (!searchBox.contains(event.target) && !dropdown.contains(event.target)) {
            dropdown.classList.remove("show");
        }
    });
}


    function printSRRTable() {
        const tableDiv = document.getElementById("tableDiv");
        const fromDate = document.getElementById("fromSRRDate").value;
        const toDate = document.getElementById("toSRRDate").value;

        const formattedFromDate = formatSRRDate(fromDate);
        const formattedToDate = formatSRRDate(toDate);

        const printWindow = window.open("", "", "width=800, height=600");

        let printContent = `
            <html>
            <head>
                <title>Store Ragister</title>
                <style>
                    body { font-family: Arial, sans-serif; padding: 20px; }
                    table {
                        width: 100%;
                        border-collapse: collapse;
                        font-size: 8px;
                        word-wrap: break-word;
                    }
                    table, th, td {
                        border: 1px solid #c1c2c2;
                        padding: 5px;
                        text-align: left;
                        overflow: hidden;
                        text-overflow: ellipsis;
                    }
                    th { background-color: #013b76; color: white; }
                    table tr:hover { background-color: yellow; }
                </style>
            </head>
            <body>
                <h4>Store Register Report</h4>
                <p><strong>From:</strong> ${formattedFromDate} <strong>To:</strong> ${formattedToDate}</p>
                <span style="color:black;font-size:90%;font-family:Arial Black;">Weight/Bill Report:</span><br/>
                ${tableDiv.innerHTML}
            </body>
            </html>`;

        function formatSRRDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            const date = new Date(dateString);
            return date.toLocaleDateString('en-GB', options);
        }

        printWindow.document.write(printContent);
        printWindow.document.close();
        printWindow.print();
        printWindow.close();
    }

//    window.onload = () => {
  //      filterDp();

      
 //   };
</script>


<!-- STOCK RAGISTER TABLE AND LEDGER SERCH BAR CODE AND SCRIPT START -->
                      
                      
              
                        
        
 
<!-- SHEKHER FORM ENTRY SCRIPT SCRIPT START -->
<style>
           
          
/* Dropdown Styling */
.dropdown-container {
position: relative;
text-align: left;
}         
     /* Dropdown styling */
     #ledgerDropdown {
       display: none;
       position: absolute;
       background-color: rgb(12, 1, 1);
       color: rgb(245, 239, 239);
       width: 50%;
       border: 1px solid #ccc;
       border-radius: 8px;
       max-height: 150px;
       overflow-y: auto;
       box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
       margin-top: 5px;
       z-index: 10;
     }
 
     #ledgerDropdown li {
       padding: 10px;
       cursor: pointer;
       transition: background-color 0.3s ease;
     }
 
     #ledgerDropdown li:hover {
       background-color: #01534d;
     }
 
   </style>

             <!-- SKHR form div script start hare -->
             <script>
  const scriptSKHRURL = 'https://script.google.com/macros/s/AKfycbxNCtOS7UZu2mw_Zuwkx-KHdORL1DATDoSp0Gv2Q5EQw6CKJOSPowawczVE_7uYHQw_/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainSKHRForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeSKHR").value; //****
    const submitSKHRButton = document.getElementById("submitSKHRButton");
    submitSKHRButton.disabled = true;
    submitSKHRButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampSKHR').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifySKHREntry();
    } else {
      await submitSKHREntry(form);
    }

    submitSKHRButton.disabled = false;
    submitSKHRButton.value = "Submit";
  });

  async function submitSKHREntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptSKHRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset(); // FORM RESET
        document.getElementById("formModeSKHR").value = "new";
        filterSKHR();  // ✅ Refresh 
        

           // ✅ Remove DLT option after submit
        const SKHRDropdown = document.getElementById("msaf101");
        const dltSKHROption = [...SKHRDropdown.options].find(opt => opt.value === "DLT");
        if (dltSKHROption) {
          SKHRDropdown.removeChild(dltSKHROption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchSKHRDetails() {
    const sNo = document.getElementById("searchSKHRSNo").value;
    const waitMessage = document.getElementById("waitSKHRMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitSKHRButton").style.display = "none";  //****
    try {
      const response = await fetch(`${scriptSKHRURL}?sNo=${sNo}`);
      const data = await response.json();

     if (data.result !== "error" && data.User === "SHEKHER") {
                    document.getElementById("sNo").value = data.SNo;
      document.getElementById("msaf101").value = data.User;
      document.getElementById("dropdownskhrSearch").value = data.Ledger;
      document.getElementById("msaf102").value = data.Date;
      document.getElementById("msaf103").value = data.cl1;
      document.getElementById("msaf104").value = data.cl2;
      document.getElementById("msaf105").value = data.cl3;
      document.getElementById("msaf106").value = data.cl4;
      //  document.getElementById("modifySKHRButton").style.display = "inline-block";


       // ✅ Add "DLT - delete" option if it doesn't exist already
const SKHRDropdown = document.getElementById("msaf101");
if (![...SKHRDropdown.options].some(opt => opt.value === "DLT")) {
  const dlt101Option = document.createElement("option");
  dlt101Option.value = "DLT";
  dlt101Option.text = "Delete";
  dlt101Option.style.color = "red";
  dlt101Option.style.backgroundColor = "blue";
  SKHRDropdown.appendChild(dlt101Option);
}

       document.getElementById("formModeSKHR").value = "modify"; // ✅ Set to modify

       // ✅ Show alert after successful data fetch
      alert(" Select Delete Option in User Section For Delete Entry");
       
    //    document.getElementById("modifySKHRButton").style.display = "inline-block";
      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifySKHREntry() {
    const waitMessage = document.getElementById("waitSKHRMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainSKHRForm');

    // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampSKHR').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptSKHRURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeSKHR").value = "new"; // ✅ Reset to new
        filterSKHR(); // ✅ Refresh dropdowns or UI
        
        document.getElementById("submitSKHRButton").style.display = "inline-block";
        document.getElementById("modifySKHRButton").style.display = "none";

          // ✅ Remove DLT option after modify
        const SKHRDropdown = document.getElementById("msaf101");
        const dltSKHROption = [...SKHRDropdown.options].find(opt => opt.value === "DLT");
        if (dltSKHROption) {
          SKHRDropdown.removeChild(dltSKHROption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>

<!-- SHEKHER FORM ENTRY SCRIPT SCRIPT STOP -->



              

                        
              
<!-- SHEKHER TABLE AND LEDGER SERCH BAR CODE AND SCRIPT START -->
              
<style>
.dropdown-container {
 position: relative;
width: 250px;
}
                            
#dropdownskhrSearch {
 width: 100%;
  padding: 8px;
 border: 1px solid #ccc;
 border-radius: 5px;
}
                            
.dp-list {
 position: absolute;
width: 100%;
 background: white;
  border: 1px solid #ccc;
max-height: 500px;
overflow-y: auto;
 display: none;
 z-index: 1000;
 list-style: none;
 padding: 0;
margin: 0;
 }
                            
.dp-list.show {
 display: block;
}

 .dp-list li {
 padding: 8px;
 cursor: pointer;
 border-bottom: 1px solid #ddd;
 }
                            
.dp-list li:hover {
 background: #f0f0f0;
 }
                            
 /* Hide last border */
 .dp-list li:last-child {
  border-bottom: none;
}
 </style>
                            
            
 <script>
 let skhrData = [];
 let allShekherData = []; // All SHEKHER entries
 let tableSKHRData = [];      // Currently displayed data (e.g., last 10 or filtered by date)
                          
 async function filterSKHR() {
    const apiSKHRKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
    const sheetSKHRId = "1wvsPdAQA57HxhTxA3cCcQvUEz93IWkBre_Ix-qvzwss";
    const rangeSKHR = 'FORM!A:H';

    try {
        const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${sheetSKHRId}/values/${rangeSKHR}?key=${apiSKHRKey}`
        );
        const data = await response.json();

        if (data.values) {
            skhrData = [];
            allShekherData = [];

            // Collect all unique values from Column D (index 3)
            const seenValues = new Set();

            data.values.forEach((row, index) => {
                if (index !== 0) {
                    const value = row[3];
                    const type = row[1]?.trim().toUpperCase();

                    // Unique column 4 (D column) data for dropdown
                    if (value && !seenValues.has(value)) {
                        seenValues.add(value);
                        skhrData.push(value);
                    }

                    // Filter only SHEKHER entries
                    if (type === "SHEKHER") {
                        allShekherData.push({ indexNo: index, row });
                    }
                }
            });

            // Show last 10 SHEKHER entries
            tableSKHRData = allShekherData.slice(-100).reverse();

            populatedpSKHRDropdown();
            populateSKHRTable();
        } else {
            console.error("No data found in the specified range.");
        }
    } catch (error) {
        console.error("Error fetching data from Google Sheets:", error);
    }
}

                          
                              function populatedpSKHRDropdown() {
                                  const dropdownSKHRList = document.getElementById("dropdownSKHRList");
                                  dropdownSKHRList.innerHTML = "";
                          
                                  skhrData.forEach(option => {
                                      const li = document.createElement("li");
                                      li.textContent = option;
                                      li.onclick = function () {
                                          document.getElementById("dropdownskhrSearch").value = option;
                                          dropdownSKHRList.classList.remove("show");
                                      };
                                      dropdownSKHRList.appendChild(li);
                                  });
                              }
                          
                              function populateSKHRTable() {
                                  renderFilteredSKHRTable(tableSKHRData);
                              }
                          
                              function filterSKHRDropdown() {
                                  const input = document.getElementById("dropdownskhrSearch").value.toLowerCase();
                                  const dropdownSKHRList = document.getElementById("dropdownSKHRList");
                                  dropdownSKHRList.innerHTML = "";
                          
                                  const filteredData = skhrData.filter(item => item.toLowerCase().includes(input));
                                  if (filteredData.length > 0) {
                                      dropdownSKHRList.classList.add("show");
                                      filteredData.forEach(option => {
                                          const li = document.createElement("li");
                                          li.textContent = option;
                                          li.onclick = function () {
                                              document.getElementById("dropdownskhrSearch").value = option;
                                              dropdownSKHRList.classList.remove("show");
                                          };
                                          dropdownSKHRList.appendChild(li);
                                      });
                                  } else {
                                      dropdownSKHRList.classList.remove("show");
                                  }
                              }
                          
                             function filterSKHRByDate() {
    const fromDate = document.getElementById("fromDate").value;
    const toDate = document.getElementById("toDate").value;

    if (!fromDate || !toDate) {
        alert("Please select both From and To dates.");
        return;
    }

    // ---- Convert to inclusive range ----
    const from = new Date(fromDate + "T00:00:00");
    const to = new Date(toDate + "T23:59:59");

    const filtered = allShekherData.filter(item => {
        const rowDateStr = item.row[2];
        if (!rowDateStr) return true; // agar date blank hai to row ko skip na kare (show kare)
        const rowDate = new Date(rowDateStr);
        if (isNaN(rowDate)) return true; // invalid date bhi show kare

        return rowDate >= from && rowDate <= to;
    });

    if (filtered.length === 0) {
        document.getElementById("tableSKHRDiv").innerHTML = "<p>No records found for selected date range.</p>";
    } else {
        tableSKHRData = filtered; // Update tableSKHRData if needed elsewhere
        renderFilteredSKHRTable(filtered);
    }
}

                          
                              function renderFilteredSKHRTable(dataArray) {
  const tableSKHRDiv = document.getElementById("tableSKHRDiv");
  const totalWeightDiv = document.getElementById("totalWeightDiv");
  const totalAmountDiv = document.getElementById("totalAmountDiv");

  let totalWeight = 0;
  let totalAmount = 0;

  let table = `<table border='1'>
      <tr>
        <th>SNo</th>
        <th>User</th>
        <th>Date</th>
        <th>Party</th>
        <th>Weight</th>
        <th>Rate</th>
        <th>Amount</th>
        <th>Narration</th>
      </tr>`;

  dataArray.forEach(item => {
    let row = item.row.map(cell => {
      return (!cell || cell.toString().trim().toLowerCase() === "undefined") ? "" : cell;
    });

    const weight = parseFloat(row[4]);
    const amount = parseFloat(row[6]);

    if (!isNaN(weight)) {
      totalWeight += weight;
    }

    if (!isNaN(amount)) {
      totalAmount += amount;
    }

    table += `
      <tr>
        <td>${item.indexNo}</td>
        <td>${row[1] || ""}</td>
        <td>${row[2] || ""}</td>
        <td>${row[3] || ""}</td>
        <td>${row[4] || ""}</td>
        <td>${row[5] || ""}</td>
        <td>${row[6] || ""}</td>
        <td>${row[7] || ""}</td>
      </tr>`;
  });

  table += `</table>`;
  tableSKHRDiv.innerHTML = table;

  const retention = totalAmount * 0.10;
  const tdsSKHR = totalAmount * 0.01;
  const billAmount = totalAmount - retention - tdsSKHR;

  totalWeightDiv.innerHTML = `Total Weight: <span style="color: #0077b6;">${totalWeight.toFixed()}</span>`;
  totalAmountDiv.innerHTML = `Total Amount: <span style="color: #0077b6;">${totalAmount.toFixed()}</span>`;
  document.getElementById("retentionDiv").innerHTML = `Retention (10%): <span style="color: #0077b6;">${retention.toFixed()}</span>`;
  document.getElementById("tdsSKHRDiv").innerHTML = `TDS (1%): <span style="color: #0077b6;">${tdsSKHR.toFixed()}</span>`;
  document.getElementById("billAmountDiv").innerHTML = `Total Bill Amount: <span style="color: #0077b6;">${billAmount.toFixed()}</span>`;
}


// print function start
                              function printSHEKHERTable() {
    const tableSKHRDiv = document.getElementById("tableSKHRDiv");
    const totalWeightDiv = document.getElementById("totalWeightDiv");
    const totalAmountDiv = document.getElementById("totalAmountDiv");
    const retentionDiv = document.getElementById("retentionDiv");
    const tdsSKHRDiv = document.getElementById("tdsSKHRDiv");
    const billAmountDiv = document.getElementById("billAmountDiv");
    const fromDate = document.getElementById("fromDate").value;
    const toDate = document.getElementById("toDate").value;

     // Format the dates to "5-May-2025"
     const formattedFromDate = formatSKHRDate(fromDate);
    const formattedToDate = formatSKHRDate(toDate);

    // Create a printable window
    const printWindow = window.open("", "", "width=800, height=600");

    // Build the content for printing
    let printContent = `
        <html>
        <head>
            <title>Chander Shekher</title>
            <style>
                body {
                    font-family: Arial, sans-serif;
                    padding: 20px;
                }
                  table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 5px;
  font-size: 12px;
  table-layout: auto; /* Let column widths auto adjust */
  word-wrap: break-word;
}

table, th, td {
  border: 1px solid #c1c2c2;
  padding: 5px 5px;
  text-align: left;
   /* Prevent text from wrapping   white-space: nowrap; */
   white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis; /* Add ... if text overflows */
}

th {
  background-color: #013b76;
  color: white;
}

table tr:hover {
  background-color: yellow;
}

                
            </style>
        </head>
        <body>
            <h4>Chander Shekher Weight Report</h4>
            <p><strong>From:</strong> ${formattedFromDate} <strong>To:</strong> ${formattedToDate}</p>
            
            <div class="summary" style="display: flex; gap: 30px; margin-top: 20px; font-weight: bold; font-size: 16px;">
                <p>${totalWeightDiv.innerHTML}</p>
                <p>${totalAmountDiv.innerHTML}</p>
                <p>${retentionDiv.innerHTML}</p>
                <p>${tdsSKHRDiv.innerHTML}</p>
                <p>${billAmountDiv.innerHTML}</p>
            </div>
           
            <span style="color:black;font-size:90%;font-family:Arial Black;"id="resultIVDiv"> Weight/Bill Report:  </span> <br/>
            ${tableSKHRDiv.innerHTML}
        </body>
        </html>
    `;

    function formatSKHRDate(dateString) {
    const options = { year: 'numeric', month: 'short', day: 'numeric' };
    const date = new Date(dateString);
    return date.toLocaleDateString('en-GB', options); // This will return the date in the desired format: 5-May-2025
}
    // Write the content into the print window and trigger print
    printWindow.document.write(printContent);
    printWindow.document.close();  // Needed for IE
    printWindow.print();
    printWindow.close();
}
// print function stop
                          
// window.onload = () => {
 // filterSKHR();
   //};
 </script>
<!-- SHEKHER TABLE AND LEDGER SERCH BAR CODE AND SCRIPT STOP -->










<!-- यह एक नोट है, REFRESH BUTTON START HARE -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Single Button for Multiple Function Refresh</title>

  <style>
    /* 👇 Refresh button fixed to bottom-right corner */
    #refreshButton {
      position: fixed;
      bottom: 3px;
      right: 10px;
      padding: 2px 5px;
      background-color: #00254d;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      z-index: 1000;
    }

    #refreshButton:hover {
      background-color: #0056b3;
    }
  </style>

  <!-- ✅ Fixed Positioned Refresh Button -->
  <button id="refreshButton" onclick="refreshAll()">Refresh</button>

   <!-- Combine Refresh Script -->
  <script>
    function refreshAll() {
      filterDp();  // SRR TABLE 
      loadMonth();  //SALE PURCHSHAE MONTHLY SUMMRY
 
      loadDATAMIPLTABLE();
      loadIVCRSheet();   // IVCR ENTRY FORM TABLE
      loadusrAdminSheet();  // ADMIN USER 
      loadNoticeBoard();  // loding summry notice board
    }


    // ✅ Auto Refresh Every 1 Minute (60000 milliseconds)
  setInterval(refreshAll, 300000);  // auto refresh after 5 mnt
    // Optional: Run once on page load
  //  window.onload = refreshAll;
  </script>


</body>
</html>
<!-- यह एक नोट है, REFRESH BUTTON START STOP -->






<!-- यह एक नोट है, indian news headline script start -->
<script>
//  api key website: https://gnews.io/dashboard
//  user id : multitechsolution87@gmail.com ,  password:  Adv@2025

const apiNEWSKey = '3b9045bc736598e29bff337027ba6d78';  // 🔑 GNews API key
const ticker = document.getElementById('newsTickerContent');

fetch(`https://gnews.io/api/v4/top-headlines?lang=hi&country=in&max=10&token=${apiNEWSKey}`)
    .then(response => response.json())
    .then(data => {
        ticker.innerHTML = '';
        data.articles.forEach(article => {
            const span = document.createElement('span');
            span.innerHTML = `<span style="color:#b1f4fd ;font-size:100%;font-family:Magneto;">eS|MTally</span> 📰 ${article.title}`;
            ticker.appendChild(span);
        });
    })
    .catch(error => {
        ticker.innerHTML = `<span>❌ खबरें लोड नहीं हो सकीं।</span>`;
        console.error("News fetch error:", error);
    });
</script>
<!-- यह एक नोट है, indian news headline script stop -->








<!-- यह एक नोट है, PO SUMMRY CODE AND SCRIPT START -->


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PO/REFF NO</title>
  <style>
   
        
    #search123Input {
      margin-bottom: 10px;
      padding: 8px;
      width: 250px;
      font-size: 16px;
    }
   
    a {
      text-decoration: none;
      font-size: 18px;
    }
    .blue-bg { color: green; }
    .pink-bg { color: blue; }
    .green-bg { color: #4682b4; }
    .red-bg { color: red; }

    /* Modal styles */
    #dataModal {
       display: none;
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: rgb(230, 231, 231);
    
      padding: 20px;
      z-index: 1000;
      max-height: 75%;
      overflow: auto;
      width: 90%;
      max-width: 1600px;
      border: 10px solid #013135;
      border-radius: 20px;
    }
    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #00000066;
      z-index: 999;
    }
    .btnposummry {
      margin: 10px 5px 0 0;
      padding: 6px 12px;
      cursor: pointer;
    }


  </style>
</head>
<body>
  <!-- Modal Popup -->
  <div id="overlay" onclick="closeModal()"></div>
  <div id="dataModal">
    <h3>Multitech Infracon Pvt Ltd. <br/>Ledger Details</h3>
     <button class="btnposummry"  onclick="printModal()" >🖨️ Print</button>
    <button class="btnposummry"  onclick="closeModal()">❌ Close</button>
    <div id="modalContent"></div>
  </div>



<script>
const api123Key = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheet123Id = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
const range123 = "POREFF!A:R";
const api103Url = "https://script.google.com/macros/s/AKfycbzBXPXYoX9xp2IqWYXvVYMPhgERM41XQ8CyhOBWtpnFQy2SZIkQqBPlHTfl9-Z3nn8rXg/exec"; 
const apiPOUrl = "https://script.google.com/macros/s/AKfycbxqXzSs-JOBPEUWqrI0-SUVmtGzRJKBoR3srraxO_peECS7ELm-xxZqOUQisJjCwrPW4A/exec"; // नया API

const headerHTML = `
  <tr>
    <th>PO Link</th>
    <th>Progress %</th>
    <th>JOB NO.</th><th>Ledger</th><th>PO/Reff No</th><th>PO Amount</th>
    <th>Billing Amount</th><th>Balance</th><th>PO Weight</th><th>Billing Weight</th>
    <th>Balance</th><th>Status</th><th>User</th><th>Order By</th>
  </tr>`;

const visibleIndexes = [0,16, 6, 8, 12, 14, 9, 13, 15, 7, 1, 2];
let fullTableData = [];

// -------------------- Fetch & Render Main Table --------------------
async function fetch123Data() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet123Id}/values/${range123}?key=${api123Key}`;
  const response = await fetch(url);
  const data = await response.json();
  const rows = data.values || [];

  const header = rows[0];
  const dataRows = rows.slice(1);

  // Sorting
  dataRows.sort((a, b) => (parseFloat(b[0]) || 0) - (parseFloat(a[0]) || 0));

  fullTableData = [header, ...dataRows];

  renderPOSUMMRYTable(fullTableData);
  setupSearch(fullTableData);
}

function renderPOSUMMRYTable(data) {
  const table = document.getElementById("dataTable");
  table.innerHTML = "";

  const thead = document.createElement("thead");
  thead.innerHTML = headerHTML;
  table.appendChild(thead);

  const tbody = document.createElement("tbody");

  for (let i = 1; i < data.length; i++) {
    const row = document.createElement("tr");

    // --- नया कॉलम (PO Link) ---
    const poNo = data[i][6] || "";
    const poCell = document.createElement("td");

    if (poNo) {
      // पहले default "---" डाल देंगे
      poCell.textContent = "---";

      // फिर API hit करेंगे
      fetch(apiPOUrl + "?invoice=" + encodeURIComponent(poNo))

        .then(res => res.text())
        .then(url => {
          if (url && url !== "NOT_FOUND") {
            poCell.textContent = "View PO";
            poCell.style.color = "red";
            poCell.style.textDecoration = "underline";
            poCell.style.cursor = "pointer";
            poCell.onclick = () => window.open(url, "_blank");
          } else {
            poCell.textContent = "---"; // अगर match न मिले
            poCell.removeAttribute("style");
            poCell.onclick = null;
          }
        })
        .catch(() => {
          poCell.textContent = "---"; // error में भी "---"
          poCell.removeAttribute("style");
          poCell.onclick = null;
        });
    } else {
      poCell.textContent = "---";
    }
    row.appendChild(poCell);

    // --- Progress % ---
    const poAmount = parseFloat(data[i][8]) || 0;
    const billingAmount = parseFloat(data[i][12]) || 0;
    let progress = 0;
    let label = "---";

    if (poAmount !== 0) {
      progress = (billingAmount / poAmount) * 100;
      label = progress <= 100
        ? `${progress.toFixed()}% work complete`
        : `${(progress - 100).toFixed()}% work extra`;
    }

    const progressCell = document.createElement("td");
    progressCell.textContent = label;
    if (progress > 100) progressCell.classList.add("orange-bg");
    else if (progress >= 60) progressCell.classList.add("blue-bg");
    else if (progress >= 30) progressCell.classList.add("pink-bg");
    else progressCell.classList.add("green-bg");
    row.appendChild(progressCell);

    // --- बाकी Columns ---
    visibleIndexes.forEach(colIndex => {
      const td = document.createElement("td");
      const cellValue = data[i][colIndex] || "";

      // PO No. click → fetchReffNo
      if (colIndex === 6) {
        td.style.cursor = "pointer";
        td.style.color = "#2980b9";
        td.style.fontSize = "16PX";
        td.style.textDecoration = "underline";
        td.addEventListener("click", () => {
          const jobNo = cellValue;
          const ledgerName = data[i][16] || "---";
          const ledgerAddress = data[i][17] || "---";
          fetchReffNo(jobNo, ledgerName, ledgerAddress);
        });
      }

      // Link formatting
      if (typeof cellValue === 'string' && (cellValue.startsWith("http") || cellValue.startsWith("www"))) {
        const a = document.createElement("a");
        a.href = cellValue.startsWith("http") ? cellValue : "https://" + cellValue;
        a.innerHTML = "&#128221;";
        a.target = "_blank";
        td.appendChild(a);
      } else {
        td.textContent = cellValue;

        // Status formatting
        if (colIndex === 7) {
          td.style.fontWeight = "bold";
          td.style.fontSize = "13px";
          if (cellValue === "CANCELED") td.style.color = "#dc7633";
          else if (cellValue === "COMPLETED") td.style.color = "#48c9b0";
          else if (cellValue === "RUNNING") td.style.color = "#808b96";
          else if (cellValue === "PENDING") td.style.color = "#5dade2";
        }
      }

      // Red highlight for negative balance
      const col5Val = parseFloat(data[i][14]) || 0;
      const col8Val = parseFloat(data[i][15]) || 0;
      if (col5Val < 0 && colIndex === 14) td.classList.add("red-bg");
      if (col8Val < 0 && colIndex === 15) td.classList.add("red-bg");

      row.appendChild(td);
    });

    tbody.appendChild(row);
  }

  table.appendChild(tbody);
  displayporeffResults(data);
}

// -------------------- Status Summary --------------------
function displayporeffResults(entries) {
  const summaryDiv = document.getElementById("poSummaryBox");
  summaryDiv.innerHTML = "";

  if (!entries || entries.length <= 1) {
    summaryDiv.innerHTML = "<p>No matching records found.</p>";
    return;
  }

  let completed = 0, pending = 0, canceled = 0, running = 0;
  entries.slice(1).forEach(row => {
    const status = (row[7] || "").toLowerCase();
    if (status === "completed") completed++;
    else if (status === "pending") pending++;
    else if (status === "canceled") canceled++;
    else if (status === "running") running++;
  });

  summaryDiv.innerHTML = `
    ✅ Completed: <span class="complete">${completed}</span> |
    ⏳ Pending: <span class="pending">${pending}</span> |
    ❌ Canceled: <span class="canceled">${canceled}</span> |
    🔄 Running: <span class="running">${running}</span>
  `;
}

// -------------------- Search --------------------
function setupSearch(data) {
  const searchInput = document.getElementById("search123Input");
  searchInput.addEventListener("input", () => {
    const text = searchInput.value.toLowerCase();
    const filtered = data.filter((row, i) => {
      if (i === 0) return true;
      return row.some(cell => (cell || "").toLowerCase().includes(text));
    });
    renderPOSUMMRYTable(filtered);
  });
}

// -------------------- Modal --------------------
function openModal(htmlContent) {
  document.getElementById("modalContent").innerHTML = htmlContent;
  document.getElementById("dataModal").style.display = "block";
  document.getElementById("overlay").style.display = "block";
}
function closeModal() {
  document.getElementById("dataModal").style.display = "none";
  document.getElementById("overlay").style.display = "none";
}

// -------------------- Invoice Click → PDF --------------------
function attachInvoiceClickREFF(tableId, invoiceColIndex = 3) {
  const table = document.getElementById(tableId);
  if (!table) return;

  for (let i = 1; i < table.rows.length; i++) {
    const row = table.rows[i];
    const cell = row.cells[invoiceColIndex];
    if (!cell) continue;

    const invoiceNo = cell.textContent.trim();
    if (!invoiceNo) continue;

    const invoiceKey = invoiceNo.replace("/", "_");

    fetch(api103Url + "?invoice=" + encodeURIComponent(invoiceKey))
      .then(res => res.text())
      .then(url => {
        if (url && url !== "NOT_FOUND") {
          cell.style.color = "blue";
          cell.style.cursor = "pointer";
          cell.style.textDecoration = "underline";
          cell.onclick = null;
          cell.addEventListener("click", () => {
            window.open(url, "_blank");
          });
        } else {
          cell.style.color = "black";
          cell.style.cursor = "default";
          cell.style.textDecoration = "none";
        }
      })
      .catch(err => {
        console.error("Invoice fetch error:", err);
        cell.style.color = "black";
        cell.style.cursor = "default";
        cell.style.textDecoration = "none";
      });
  }
}

// -------------------- Fetch Ledger → Modal --------------------
async function fetchReffNo(jobNo, ledgerName = "---", ledgerAddress = "---") {
  const range124 = "LEDGER!B:K";
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet123Id}/values/${range124}?key=${api123Key}`;
  const res = await fetch(url);
  const data = await res.json();
  const rows = data.values || [];

  const headers = rows[0];
  const matched = rows.slice(1).filter(r => r[4] === jobNo);

  if (matched.length === 0) {
    openModal("<p>No Match Found</p>");
    return;
  }

  let totalG = 0, totalH = 0;
  matched.forEach(row => {
    totalG += parseFloat(row[5]) || 0;
    totalH += parseFloat(row[6]) || 0;
  });

  let html = `
   <p>
    <strong>Ledger Name:</strong> ${ledgerName}<br>
    <strong>Address:</strong> ${ledgerAddress}<br>
    <span style="color: rgb(1, 107, 37); font-weight: bold; font-size: 18px;">Total Billng :-</span> Rs. ${totalG.toFixed()} /
    <span style="color: blue; font-weight: bold; font-size: 18px;">Total Weight:-</span> ${totalH.toFixed()} Kg.
   </p>
   <table id="modalLedgerTable" border="1"><tr>`;

  headers.forEach(h => html += `<th>${h}</th>`);
  html += `</tr>`;

  matched.forEach(row => {
    const isCredit = (row[0] || "").toLowerCase().includes("credit note");
    const rowStyle = isCredit ? ` style="color: red;"` : "";
    html += `<tr${rowStyle}>`;

    headers.forEach((_, i) => {
      const cell = row[i] || "";
      if (typeof cell === "string" && (cell.startsWith("http") || cell.startsWith("www"))) {
        const href = cell.startsWith("http") ? cell : "https://" + cell;
        html += `<td><a href="${href}" target="_blank">&#128221;</a></td>`;
      } else {
        const overrideStyle = isCredit && i === 0 ? ` style="color: black;"` : "";
        html += `<td${overrideStyle}>${cell}</td>`;
      }
    });

    html += `</tr>`;
  });

  html += `</table>`;
  openModal(html);

  attachInvoiceClickREFF("modalLedgerTable", 3);
}



function printModal() {
  const content = document.getElementById("modalContent").innerHTML;

  const printWindow = window.open('', '', 'height=800,width=1000');
  printWindow.document.write(`
    <html>
      <head>
        <title>Print</title>

        <body>

           <span style="color:rgb(246, 156, 156);font-size:130%;font-family:Magneto;">eS |</span> 
  <span style="color:#a0d0f0;font-size:130%;font-family:Magneto;">MTally</span>
            <h4>Multitech Infracon Pvt. Ltd.</h4>
        <style>
          body {
            font-family: Arial, sans-serif;
            margin: 20px;
          }

          table {
  width: 100%;
  margin-top: 20px;
  border-collapse: collapse;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  font-size: 14px;
}

th, td {
  border: 1px solid #e0e0e0;
  padding: 10px 14px;
  text-align: left;
}

th {
  background-color: #004d80;
  color: white;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

tr:nth-child(even) {
  background-color: #f9f9f9;
}


        </style>
      </head>
      <body>
        ${content}
      </body>
    </html>
  `);

  printWindow.document.close();
  printWindow.focus();
  printWindow.print();
}

// -------------------- Init --------------------
fetch123Data();
</script>
</body>
</html>



<!-- यह एक नोट है, PO SUMMRY CODE AND SCRIPT STOP -->



<!-- यह एक नोट है, Admin Section SCript STart -->
<!-- Admin Section Combined Script Start -->
<script>
  async function loadusrAdminSheet() {
    const sheetConfigs = {
      mpr: {
        apiKey: "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM",
        sheetId: "1ECwXrxs8_FDWw1qAC6_qxEwP_HE3SGMM4qNKVZHlIS0",
        range: "MPR!J:R"
      },
      ivcr: {
        apiKey: "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM",
        sheetId: "1h3uC_0Ji4-NUhqrN0aIR-XwLZL5VdgilCBlIzC--SDA",
        range: "IVCR!W:AD"
      },
      sale: {
        apiKey: "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM",
        sheetId: "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4",
        range: "ADMIN!A:L"
      },
      po: {
        apiKey: "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM",
        sheetId: "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4",
        range: "POINDEX!G:Q"
      },
      psw: {
        apiKey: "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM",
        sheetId: "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4",
        range: "M1000!A:J"
      }
    };

    const selectedSheet = document.getElementById("sheetSelector").value;
    const { apiKey, sheetId, range } = sheetConfigs[selectedSheet];

    try {
      const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`);
      const data = await response.json();

      if (data.values && data.values.length > 0) {
        populateAdminTable(data.values);
        populateAdminDropdowns(data.values);
      } else {
        console.error("No data found");
        document.getElementById("userTableHead").innerHTML = "";
        document.getElementById("userTableBody").innerHTML = "<tr><td>No data found</td></tr>";
      }
    } catch (error) {
      console.error("Error fetching sheet:", error);
      document.getElementById("userTableBody").innerHTML = "<tr><td>Error loading data</td></tr>";
    }
  }

  function populateAdminTable(data) {
    const tableHead = document.getElementById("userTableHead");
    const tableBody = document.getElementById("userTableBody");
    tableHead.innerHTML = "";
    tableBody.innerHTML = "";

    const headerRow = document.createElement("tr");
    data[0].forEach(headerText => {
      const th = document.createElement("th");
      th.textContent = headerText;
      headerRow.appendChild(th);
    });
    tableHead.appendChild(headerRow);

    for (let i = 1; i < data.length; i++) {
      const row = document.createElement("tr");
      data[i].forEach((cellText, cellIndex) => {
        const td = createCell(cellText, "td");
        row.appendChild(td);
//***
        if (cellIndex === 2) {
          const type = cellText.trim().toLowerCase();
          if (type === "receipt") row.classList.add("receipt");
          else if (type === "billdr") row.classList.add("billdr");
          else if (type === "billcr") row.classList.add("billcr");
          else if (type === "bank") row.classList.add("billdr");
        }
        //***
      });
      tableBody.appendChild(row);
    }
  }

  function createCell(value, type) {
    const cell = document.createElement(type);
    if (typeof value === "string" && (value.startsWith("http") || value.startsWith("www"))) {
      const link = document.createElement("a");
      link.href = value;
      link.innerHTML = "🔗";
      link.target = "_blank";
      cell.appendChild(link);
    } else {
      cell.textContent = value;
    }
    return cell;
  }

  function populateAdminDropdowns(data) {
    const dropdown1 = document.getElementById('adminColumn1');
    const dropdown2 = document.getElementById('adminColumn2');
    const dropdown4 = document.getElementById('adminColumn4');

    const unique1 = [...new Set(data.slice(1).map(r => r[1]))].filter(Boolean);
    const unique2 = [...new Set(data.slice(1).map(r => r[2]))].filter(Boolean);
    const unique4 = [...new Set(data.slice(1).map(r => r[4]))].filter(Boolean);

    setDropdown(dropdown1, unique1);
    setDropdown(dropdown2, unique2);
    setDropdown(dropdown4, unique4);

    $(dropdown4).select2({ placeholder: "-- Select --", allowClear: true });

    dropdown1.onchange = filterAdminTable;
    dropdown2.onchange = filterAdminTable;
    dropdown4.onchange = filterAdminTable;
    document.getElementById('startAdmintDate').onchange = filterAdminTable;
    document.getElementById('endAdminDate').onchange = filterAdminTable;
    document.getElementById('searchbarAdmin').addEventListener('input', filterAdminTable);
  }

  function setDropdown(dropdown, items) {
    dropdown.innerHTML = '<option value="">-- Select --</option>';
    items.forEach(val => {
      const opt = document.createElement('option');
      opt.value = val;
      opt.textContent = val;
      dropdown.appendChild(opt);
    });
  }

  function filterAdminTable() {
    const f1 = document.getElementById('adminColumn1').value.toLowerCase();
    const f2 = document.getElementById('adminColumn2').value.toLowerCase();
    const f4 = $('#adminColumn4').val()?.toLowerCase();
    const fromDate = new Date(document.getElementById('startAdmintDate').value);
    const toDate = new Date(document.getElementById('endAdminDate').value);
    const searchQuery = document.getElementById('searchbarAdmin').value.toLowerCase().trim();
    const rows = document.querySelectorAll('#userTableBody tr');

    rows.forEach(row => {
      const cells = row.querySelectorAll("td");
      const date = new Date(cells[3]?.textContent.trim());
      const val1 = cells[1]?.textContent.toLowerCase();
      const val2 = cells[2]?.textContent.toLowerCase();
      const val4 = cells[4]?.textContent.toLowerCase();

      const match1 = !f1 || val1 === f1;
      const match2 = !f2 || val2 === f2;
      const match4 = !f4 || val4 === f4;
      const matchDate = (!isNaN(fromDate) ? date >= fromDate : true) && (!isNaN(toDate) ? date <= toDate : true);

      let searchMatch = !searchQuery;

      cells.forEach(cell => {
        const link = cell.querySelector("a");
        const textToCheck = link ? link.href.toLowerCase() : cell.textContent.toLowerCase();
        if (!link) cell.innerHTML = cell.textContent;

        if (searchQuery && textToCheck.includes(searchQuery)) {
          searchMatch = true;
          if (!link) {
            const regex = new RegExp(`(${searchQuery})`, 'gi');
            cell.innerHTML = cell.textContent.replace(regex, '<mark>$1</mark>');
          }
        }
      });

      row.classList.toggle('hidden', !(match1 && match2 && match4 && matchDate && searchMatch));
    });
  }

  function downloadAdminHTML() {
    const table = document.getElementById("userTable").cloneNode(true);
    const rows = table.querySelectorAll("tr");
    rows.forEach(r => r.classList.contains("hidden") && r.remove());

    const htmlContent = `<html><head><title>Filtered Table</title></head><body>${table.outerHTML}</body></html>`;
    const blob = new Blob([htmlContent], { type: "text/html" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "filtered_table.html";
    a.click();
  }

  function downloadAsExcel() {
    const table = document.getElementById("userTable").cloneNode(true);
    const rows = table.querySelectorAll("tr");
    rows.forEach(r => r.classList.contains("hidden") && r.remove());

    const excelContent = `
      <html xmlns:o="urn:schemas-microsoft-com:office:office"
            xmlns:x="urn:schemas-microsoft-com:office:excel"
            xmlns="http://www.w3.org/TR/REC-html40">
        <head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>
          <x:Name>Sheet1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions>
        </x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head>
        <body>${table.outerHTML}</body>
      </html>
    `;
    const blob = new Blob([excelContent], { type: "application/vnd.ms-excel" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "filtered_table.xls";
    a.click();
  }

  // Optional Auto Load
  // window.onload = loadusrAdminSheet;
</script>


<!-- यह एक नोट है, Admin Section SCript stop -->





<!-- यह एक नोट है, logo code start -->

<style>
#floatingBrand {
  position: fixed;
  top: 8px;
  right: 400px;
  z-index: 9999;
  background: transparent;
  padding: 5px 10px;
  pointer-events: auto; /* Prevent clicks if needed */
}

/* Sticky Note Style */
#noteTooltip {
  display: none;
  position: absolute;
  top: 40px;
  right: 0;
  background-color: #cceaff;
  border: 1px solid #013556;
  padding: 10px;
  width: 200px;
  font-family: Arial, sans-serif;
  font-size: 90%;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
  z-index: 10000;
  border-radius: 5px;
}
</style>
</style>

<div id="floatingBrand">
  <span style="color:rgb(246, 156, 156);font-size:130%;font-family:Magneto;">eS |</span> 
  <span style="color:#a0d0f0;font-size:130%;font-family:Magneto;">MTally</span>
   <div id="noteTooltip">Design By: eS|MTally <br/> Admin: Mukhtiyar Ahamad <br/> Contect: +91-9756735792</div>
</div>


<script>
const brand = document.getElementById('floatingBrand');
const tooltip = document.getElementById('noteTooltip');

// Show on hover
brand.addEventListener('mouseenter', () => {
  tooltip.style.display = 'block';
});

// Hide when mouse leaves
brand.addEventListener('mouseleave', () => {
  tooltip.style.display = 'none';
});
</script>
<!-- यह एक नोट है, logo code stop -->






<!-- job/reff VOUCHER form div code  start hare -->
<script>
  function showForm(type) {
  

    const contentMap = {
      MFDY: `
        
       <H3 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Entry Sr. No. For Entry Search</H3>

        <form id="modifyReffMDFYForm">
          <input type="hidden" id="formModeReffMDFY" name="formModeReffMDFY" value="new">
            <input type="number" id="searchReffMDFYSNo" placeholder="Enter S.No. to Modify Entry" >
            <button type="button" class="fetchbtn" onclick="fetchReffMDFYDetails()">Fetch Details</button>
            <button type="button" class="fetchbtn" id="modifyReffMDFYButton" onclick="modifyReffMDFYEntry()" style="display:none;">Modify Entry</button>
             <!-- Wait message div -->
<div id="waitReffMDFYMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
        </form>  

<H3 style="background-color: #004d80;color: WHITE;font-size: 100%; text-align: center;">Edit Modify Modify</H3>
       <form id="mainJBMDFYForm">
          <input type="hidden" name="SNo" id="sNo" />


          <!-- Hidden inputs to preserve fetched values -->
<input type="hidden" id="savedVoucher" name="Voucher">
<input type="hidden" id="savedType" name="Type">
<input type="hidden" id="savedRate" name="Rate">
<input type="hidden" id="savedNarration" name="Narration">
<input type="hidden" id="savedVType" name="VType">


          <label  style="font-size:100%;font-family:Arial;color: black ;font-weight: bold;">Voucher (Readonly)</label>
          <input type="text" id="msafMFDY70" name="Voucher" value="" readonly>

            <label  style="color:black;font-size:100%;font-family:Arial;color: black;font-weight: bold;">User Name (Readonly)</label>
            <input type="text" id="msafMFDY71" name="Type" value="" readonly>

           <label  style="color:#a93226;font-size:100%;font-family:Arial;font-weight: bold; ">Order By*</label>
          <select id="msafMFDY72" name="Date" required>
            <option value="RAHUL">RAHUL</option>
            <option value="TUSHAR AGARWAR (MD)">TUSHAR AGARWAL (MD)</option>
            <option value="LESHANT">LESHANT</option>
            <option value="OTHER">OTHER</option>
           </select>

           <label  style="color:#a93226 ;font-size:100%;font-family:Arial; font-weight: bold;">Clint Name*</label>
            <input type="text" id="msafMFDY73" name="Ledger" required placeholder="Enter Cline Name"> 

            <label  style="color:#a93226 ;font-size:100%;font-family:Arial; font-weight: bold;">Firm Name/ Order Details*</label>
            <input type="text" id="msafMFDY74" name="VNo" required placeholder="Enter Firm Name/ Order Details"> 

            <label  style="color:#a93226; font-size:100%;font-family:Arial; font-weight: bold;">Address*</label>
            <input type="text" id="msafMFDY75" name="Reff" placeholder="Enter Address"style="text-transform: uppercase;">
         
       

          <label  style="color:#a93226; font-size:100%;font-family:Arial; font-weight: bold;">Job/Reff No.*</label>
          <input type="text" id="msafMFDY76" name="Amount" placeholder="Enter Job/Reff No."style="text-transform: uppercase;">

          <label  style="color:#a93226; font-size:90%;font-family:Arial; font-weight: bold;">Status</label>
          <select id="msafMFDY77" name="Weight" required>
            <option value="RUNNING">Running</option>
            <option value="COMPLETED">Completed</option>
            <option value="CANCELED">Canceled</option>
            <option value="PENDING">Pending</option>
           </select>

          <input type="hidden" name="Timestamp" id="timestampReffMDFY">
          <input  style="display:none;" type="submit" id="submitReffMDFYButton" value="Submit">
        </form>
    
      `,
      CREAT: `
  <form id="mainREFFNOForm">
          <input type="hidden" name="SNo" id="sNo" />

          <label  style="font-size:100%;font-family:Arial;color: #a93226;font-weight: bold;">User*</label>
          <select id="msaf70" name="Voucher" required>
            <option value="JOB/REFF">Job Details</option>
           </select>

<label  style="color:black;font-size:100%;font-family:Arial;color: #a93226;font-weight: bold;">Select Job/Reff. User*</label>
<select id="msaf71" name="Type" required></select> 



           <label  style="color: #a93226;font-weight: bold; font-size:100%;font-family:Arial;">Order By</label>
          <select id="msaf72" name="Date" required>
            <option value="RAHUL">RAHUL</option>
            <option value="TUSHAR AGARWAR (MD)">TUSHAR AGARWAL (MD)</option>
            <option value="LESHANT">LESHANT</option>
            <option value="OTHER">OTHER</option>
           </select>

           <label  style="color: #a93226;font-weight: bold; font-size:100%;font-family:Arial;">Clint Name*</label>
            <input type="text" id="msaf73" name="Ledger" required placeholder="Enter Cline Name"> 

            <label  style="color: #a93226;font-weight: bold; font-size:100%;font-family:Arial;">Firm Name/ Order Details*</label>
            <input type="text" id="msaf74" name="VNo" required placeholder="Enter Firm Name/ Order Details"> 

            <label  style="color: #a93226;font-weight: bold; font-size:100%;font-family:Arial;">Address*</label>
            <input type="text" id="msaf75" name="Reff" placeholder="Enter Address"style="text-transform: uppercase;">
         
       

          <label  style="color: #a93226;font-weight: bold; font-size:100%;font-family:Arial;">Job/Reff No.*</label>
          <input type="text" id="msaf76" name="Amount" placeholder="Enter Job/Reff No."style="text-transform: uppercase;">

          <label  style="color: #a93226;font-weight: bold; font-size:90%;font-family:Arial;">Status</label>
          <select id="msaf77" name="Weight" required>
            <option value="RUNNING">Running</option>
            <option value="COMPLETED">Completed</option>
            <option value="CANCELED">Canceled</option>
            <option value="PENDING">Pending</option>
           </select>

          <input type="hidden" name="Timestamp" id="timestampREFFNO">
          <input type="submit" id="submitREFFNOButton" value="Submit">
        </form>
    

         <H3 style="color: red ;font-size: 100%; text-align: center;">**Select the Voucher option for Entry Mody</H3>

        <form id="modifyREFFNOForm">
          <input type="hidden" id="formModeREFFNO" name="formModeREFFNO" value="new">
            <input type="number" style="display:none;" id="searchREFFNOSNo" placeholder="Enter S.No. to Modify Entry" >
            <button type="button" class="fetchbtn" onclick="fetchREFFNODetails()" style="display:none;">Fetch Details</button>
            <button type="button" class="fetchbtn" id="modifyREFFNOButton" onclick="modifyREFFNOEntry()" style="display:none;">Modify Entry</button>
             <!-- Wait message div -->
<div id="waitREFFNOMessage" style="display:none; color:red; font-size:16px; font-weight:bold;"></div>
        </form>  

    <br/>
        <span style="color:rgb(248, 163, 163);font-size:130%;font-family:Magneto;">eS |</span> 
        <span style="color:#88c5ee;font-size:130%;font-family:Magneto;">MTally</span>
   
      `

    };

   
   document.getElementById("formContent").innerHTML = contentMap[type] || "";
  }

  // ✅ यह सुनिश्चित करता है कि पेज लोड होते ही default option का content दिखे
  //window.onload = function () {
    //  document.getElementById("designUSER").value = "CREAT";
    // showForm("CREAT");
  // };
  

</script>


<!-- job/reff VOUCHER form div code  stop hare -->


            
<!-- job/reff VOUCHER new entry form div script start hare 11111111111111111111111111111111 -->
<script>
  const scriptREFFNOURL = 'https://script.google.com/macros/s/AKfycbw0xCIuyevQ3rXPs_sa-9yQGZ50eSIFGMwta7Rq0GqEXHCWDJqi5e4xvdE1hh1NSdU/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainREFFNOForm") return;

    e.preventDefault();
     const formMode = document.getElementById("formModeREFFNO").value; //****
    const submitREFFNOButton = document.getElementById("submitREFFNOButton");
    submitREFFNOButton.disabled = true;
    submitREFFNOButton.value = "Wait..";

    const now = new Date();
    document.getElementById('timestampREFFNO').value = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    //****
    
    if (formMode === "modify") {
      await modifyREFFNOEntry();
    } else {
      await submitREFFNOEntry(form);
    }

    submitREFFNOButton.disabled = false;
    submitREFFNOButton.value = "Submit";
  });

  async function submitREFFNOEntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptREFFNOURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset(); // FORM RESET
        document.getElementById("formModeREFFNO").value = "new";
     
         fetchData();  // ✅ Refresh dropdowns or UI
         jobbPOReffload(); //

           // ✅ Remove DLT option after submit
        const jobreffDropdown = document.getElementById("msaf70");
        const dltJOBOption = [...jobreffDropdown.options].find(opt => opt.value === "DLT");
        if (dltJOBOption) {
          jobreffDropdown.removeChild(dltJOBOption);
        }
        //
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }
    //****
   

  async function fetchREFFNODetails() {
    const sNo = document.getElementById("searchREFFNOSNo").value;
    const waitMessage = document.getElementById("waitREFFNOMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

  //   document.getElementById("submitREFFNOButton").style.display = "none";  //****
    try {
      const response = await fetch(`${scriptREFFNOURL}?sNo=${sNo}`);
      const data = await response.json();

      if (data.result !== "error" && (data.Type === "PRAKHAR" || data.Type === "HARSHIT")) {
        document.getElementById("sNo").value = data.SNo;
        document.getElementById("msaf70").value = data.Voucher;
        document.getElementById("msaf71").value = data.Type;
        document.getElementById("msaf72").value = data.Date;
        document.getElementById("msaf73").value = data.Ledger;
        document.getElementById("msaf74").value = data.VNo;
        document.getElementById("msaf75").value = data.Reff;
        document.getElementById("msaf76").value = data.Amount;
        document.getElementById("msaf77").value = data.Weight;
      //  document.getElementById("modifyREFFNOButton").style.display = "inline-block";


       // ✅ Add "DLT - delete" option if it doesn't exist already
const jobreffDropdown = document.getElementById("msaf70");
if (![...jobreffDropdown.options].some(opt => opt.value === "DLT")) {
  const dltOptionJOBREFF = document.createElement("option");
  dltOptionJOBREFF.value = "DLT";
  dltOptionJOBREFF.text = "Delete";
  dltOptionJOBREFF.style.color = "red";
  dltOptionJOBREFF.style.backgroundColor = "blue";
  jobreffDropdown.appendChild(dltOptionJOBREFF);
}

       document.getElementById("formModeREFFNO").value = "modify"; // ✅ Set to modify
    //    document.getElementById("modifyREFFNOButton").style.display = "inline-block";

    // ✅ Show alert after successful data fetch
      alert(" Select Delete Option in User Section For Delete Entry");

      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

  async function modifyREFFNOEntry() {
    const waitMessage = document.getElementById("waitREFFNOMessage");
    waitMessage.innerText = "Please wait...";
    waitMessage.style.display = "block";


    const form = document.getElementById('mainREFFNOForm');

    // ✅ Set new timestamp
    const now = new Date();
    document.getElementById('timestampREFFNO').value = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;

    const formData = new FormData(form);
    formData.set('SNo', document.getElementById('sNo').value);

    try {
      const response = await fetch(scriptREFFNOURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry modified successfully!');
        form.reset();
        document.getElementById("formModeREFFNO").value = "new"; // ✅ Reset to new
      
         fetchData();  // ✅ Refresh dropdowns or UI
         jobbPOReffload(); //
        document.getElementById("submitREFFNOButton").style.display = "inline-block";
        document.getElementById("modifyREFFNOButton").style.display = "none";

          // ✅ Remove DLT option after modify
        const jobreffDropdown = document.getElementById("msaf71");
        const dltJOBOption = [...jobreffDropdown.options].find(opt => opt.value === "DLT");
        if (dltJOBOption) {
          jobreffDropdown.removeChild(dltJOBOption);
        }
        //
      } else {
        alert(`Error modifying entry: ${result.error}`);
      }
    } catch (error) {
      alert(`Error: ${error.message}`);
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }

    //*****
</script>

<!-- job/reff VOUCHER new entry form div script stop hare 11111111111111111111111111111111 -->



<!-- job/reff VOUCHER form entry modify form div script start hare 2222222222222222222222222222 -->

       <script>
  const scriptReffMDFYURL = 'https://script.google.com/macros/s/AKfycbw0xCIuyevQ3rXPs_sa-9yQGZ50eSIFGMwta7Rq0GqEXHCWDJqi5e4xvdE1hh1NSdU/exec';

  document.addEventListener("submit", async function (e) {
    const form = e.target;
    if (form.id !== "mainJBMDFYForm") return;

    e.preventDefault();

    const formMode = document.getElementById("formModeReffMDFY").value;
    const submitReffMDFYButton = document.getElementById("submitReffMDFYButton");
    submitReffMDFYButton.disabled = true;
    submitReffMDFYButton.value = "Wait..";

    const now = new Date();
    const timestamp = `${now.getMonth()+1}/${now.getDate()}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
    document.getElementById('timestampReffMDFY').value = timestamp;

    const formInputs = form.querySelectorAll('input, textarea');
    formInputs.forEach(input => {
      if (input.type === 'text' || input.type === 'textarea') {
        input.value = input.value.toUpperCase();
      }
    });

    if (formMode === "modify") {
      await modifyReffMDFYEntry(timestamp);
    } else {
      await submitReffMDFYEntry(form);
    }

    submitReffMDFYButton.disabled = false;
    submitReffMDFYButton.value = "Submit";
  });

  async function submitReffMDFYEntry(form) {
    const formData = new FormData(form);
    try {
      const response = await fetch(scriptReffMDFYURL, { method: 'POST', body: formData });
      const result = await response.json();

      if (result.result === 'success') {
        alert('Entry saved successfully!');
        form.reset();
        document.getElementById("formModeReffMDFY").value = "new";
      document.getElementById("submitReffMDFYButton").style.display = "none";
      
        fetchData();
        jobbPOReffload();

        const jobreffDropdown = document.getElementById("msafMFDY70");
        const dltJOBOption = [...jobreffDropdown.options].find(opt => opt.value === "DLT");
        if (dltJOBOption) {
          jobreffDropdown.removeChild(dltJOBOption);
        }
      } else {
        alert(`Error: ${result.error || 'Unknown error occurred.'}`);
      }
    } catch (error) {
      alert(`Error submitting the form: ${error.message}`);
    }
  }

  async function fetchReffMDFYDetails() {
    const sNo = document.getElementById("searchReffMDFYSNo").value;
    const waitMessage = document.getElementById("waitReffMDFYMessage");
    waitMessage.innerText = "Fetching data... Please wait...";
    waitMessage.style.display = 'block';

    try {
      const response = await fetch(`${scriptReffMDFYURL}?sNo=${sNo}`);
      const data = await response.json();

      if (data.result !== "error" && (data.Type === "PRAKHAR" || data.Type === "HARSHIT")) {
        document.getElementById("sNo").value = data.SNo;
        document.getElementById("msafMFDY70").value = data.Voucher;
        document.getElementById("msafMFDY71").value = data.Type;
        document.getElementById("msafMFDY72").value = data.Date;
        document.getElementById("msafMFDY73").value = data.Ledger;
        document.getElementById("msafMFDY74").value = data.VNo;
        document.getElementById("msafMFDY75").value = data.Reff;
        document.getElementById("msafMFDY76").value = data.Amount;
        document.getElementById("msafMFDY77").value = data.Weight;

        // ✅ Save to hidden fields for modify
        document.getElementById("savedVoucher").value = data.Voucher;
        document.getElementById("savedType").value = data.Type;
        document.getElementById("savedRate").value = data.Rate;
        document.getElementById("savedNarration").value = data.Narration;
        document.getElementById("savedVType").value = data.VType;

         document.getElementById("submitReffMDFYButton").style.display = "inline-block";  // Show modify

    

        document.getElementById("formModeReffMDFY").value = "modify";
        alert(" View Entry Details and Modify Field.");
      } else {
        alert("No record found for the given S.No.");
      }
    } catch (error) {
      console.error("Error fetching details:", error);
      alert("Please reconcile details or contact admin.");
    } finally {
      setTimeout(() => waitMessage.style.display = 'none', 2000);
    }
  }
async function modifyReffMDFYEntry(timestamp) {
  const form = document.getElementById("mainJBMDFYForm");
  const waitMessage = document.getElementById("waitReffMDFYMessage");
  waitMessage.innerText = "Please wait...";
  waitMessage.style.display = "block";

  const formData = new FormData();
  formData.append('SNo', document.getElementById('sNo').value);
  formData.append('Voucher', document.getElementById('savedVoucher').value);
  formData.append('Type', document.getElementById('savedType').value);
  formData.append('Date', document.getElementById('msafMFDY72').value);
  formData.append('Ledger', document.getElementById('msafMFDY73').value);
  formData.append('VNo', document.getElementById('msafMFDY74').value);
  formData.append('Rate', document.getElementById('savedRate').value);
  formData.append('Narration', document.getElementById('savedNarration').value);
  formData.append('VType', document.getElementById('savedVType').value);
  formData.append('Reff', document.getElementById('msafMFDY75').value);
  formData.append('Amount', document.getElementById('msafMFDY76').value);
  formData.append('Weight', document.getElementById('msafMFDY77').value);
  formData.append('timestamp', timestamp);
  formData.append('formMode', 'modify');

     

  try {
    const response = await fetch(scriptReffMDFYURL, {
      method: 'POST',
      body: formData
    });

    const result = await response.json();

    if (result.result === 'success') {
      alert('Entry modified successfully!');
      form.reset();
      document.getElementById("formModeReffMDFY").value = "new";
     
      fetchData();
      jobbPOReffload();
      document.getElementById("submitReffMDFYButton").style.display = "none";
    } else {
      alert(`Error modifying entry: ${result.error}`);
    }
  } catch (error) {
    alert(`Error: ${error.message}`);
  } finally {
    setTimeout(() => waitMessage.style.display = 'none', 2000);
  }
}

</script>

<!-- job/reff VOUCHER form entry modify form div script stop  hare 22222222222222222222222222-->




<!-- job/reff TOP 10 ENTRY WITH TOTAL JOB BY USER script START hare -->

<script>
   let sheetJRdata = []; // Store filtered and sorted data

// Function to load the data from Google Sheets
async function jobbPOReffload() {
    const apiKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
    const sheetId = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
    const range = 'FORM!A:N';
    const jobRefResultsDiv = document.getElementById("jobRefResults");

    try {
        jobRefResultsDiv.innerHTML = "<p>Loading job reference data...</p>";

        const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`
        );
        const data = await response.json();

        if (data.values) {
            // Filter and store only the entries where column K (index 10) is "JOB/REFF"
            sheetJRdata = data.values.filter(row => row.length > 10 && row[10] === "JOB/REFF");

            // Sort the filtered data by column A (index 0) in descending order
            sheetJRdata.sort((a, b) => (b[0] > a[0] ? 1 : -1));

            console.log("Filtered and Sorted Data:", sheetJRdata);

            // Display results and summary
            displayJOBNOResults(getFilteredJOBNOData("latestEntry"));
            displayJOBNOSummary();

            // Update `jobRefResults` div with summary
            jobRefResultsDiv.innerHTML = `
                <p><strong>Total Job/Ref:</strong> ${sheetJRdata.length}</p>
                <p><strong>Last Updated:</strong> ${new Date().toLocaleString()}</p>
            `;
        } else {
            jobRefResultsDiv.innerHTML = "<p>No data found in the specified range.</p>";
            console.error("No data found in the specified range.");
        }
    } catch (error) {
        jobRefResultsDiv.innerHTML = "<p>Error loading data.</p>";
        console.error("Error fetching data from Google Sheets:", error);
    }
}

// Function to handle the dropdown selection
function jobPOreffDropdown() {
    const filterType = document.getElementById("filterType").value;
    displayJOBNOResults(getFilteredJOBNOData(filterType));
}

// Function to filter data based on the selected option
function getFilteredJOBNOData(filterType) {
    let filteredData = [];
    switch (filterType) {
        case "latestEntry":
            filteredData = sheetJRdata.slice(0, 10); // Get last 10 entries
            break;
        case "allJobreff":
            filteredData = sheetJRdata; // Show all "JOB/REFF" entries
            break;
        case "userHarshit":
            filteredData = sheetJRdata.filter(row => row.length > 1 && row[1].toLowerCase() === "harshit");
            break;
        case "userPrakhar":
            filteredData = sheetJRdata.filter(row => row.length > 1 && row[1].toLowerCase() === "prakhar");
            break;
    }
    return filteredData;
}

// Function to display the filtered results in a table
function displayJOBNOResults(entries) {
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    if (entries.length === 0) {
        resultsDiv.innerHTML = "<p>No matching records found.</p>";
        return;
    }

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const tbody = document.createElement("tbody");

    // Create table header
    const headerRow = document.createElement("tr");
    const headers = ["S.No", "User", "Order By", "Client Name", "Firm Name/Details", "Address", "Job/Reff No.", "Status", "PO Amount", "PO Weight", "V.Code", "Pdf."];
    headers.forEach(headerText => {
        const th = document.createElement("th");
        th.textContent = headerText;
        headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    // Create table body with filtered entries
    entries.forEach(entry => {
        const row = document.createElement("tr");

        entry.forEach((cell, index) => {
            const td = document.createElement(index === 0 ? 'th' : 'td');

            // If the cell is a URL, make it clickable
            if (typeof cell === "string" && (cell.startsWith('http') || cell.startsWith('www'))) {
                const a = document.createElement('a');
                a.href = cell;
                a.innerHTML = "&#128221;"; // Icon (📑)
                a.target = "_blank";
                td.appendChild(a);
            } else {
                td.textContent = cell;
            }

            row.appendChild(td);
        });

        tbody.appendChild(row);
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    resultsDiv.appendChild(table);
}

// Function to display the summary of "Prakhar" and "Harshit" counts
function displayJOBNOSummary() {
    const summaryDiv = document.getElementById("summary");
    
    const prakharCount = sheetJRdata.filter(row => row.length > 1 && row[1].toLowerCase() === "prakhar").length;
    const harshitCount = sheetJRdata.filter(row => row.length > 1 && row[1].toLowerCase() === "harshit").length;

    summaryDiv.innerHTML = `
        <p><strong>Total Project By Prakhar:</strong> ${prakharCount}</p>
        <p><strong>Total Project By Harshit:</strong> ${harshitCount}</p>
    `;
}

// Run on page load
//  window.onload = jobbPOReffload;
</script>




<!-- job/reff TOP 10 ENTRY WITH TOTAL JOB BY USER  script stop hare -->



<script>
  function openDialog() {
    document.getElementById("daybookDialog").style.display = "block";
    document.getElementById("overlay").style.display = "block";
  }

  function closeDialog() {
    document.getElementById("daybookDialog").style.display = "none";
    document.getElementById("overlay").style.display = "none";
  }

  // ✅ Keyboard shortcuts
  document.addEventListener("keydown", function(event) {
    if (event.key === "F1") {
      event.preventDefault(); // Default browser help block kare
      document.getElementById("f1").click(); // F1: only open dialog
    }

    if (event.key === "F1") {
      event.preventDefault(); // Prevent default F2 action
      document.getElementById("f1").click(); // First open the dialog

      // Wait for DOM to update before focusing the search bar
      setTimeout(function() {
        const searchInput = document.getElementById("closeDialog");
        if (searchInput) {
          searchInput.focus();
        }
      }, 50); // small delay to ensure dialog is visible
    }

     if (event.key === "F2") {
      event.preventDefault(); // Default browser help block kare
      document.getElementById("f2").click(); // F1: only open dialog
    }

    if (event.key === "F3") {
      event.preventDefault(); // Prevent default F2 action
      document.getElementById("daybookButton").click(); // First open the dialog

      // Wait for DOM to update before focusing the search bar
      setTimeout(function() {
        const searchInput = document.getElementById("searchBar");
        if (searchInput) {
          searchInput.focus();
        }
      }, 50); // small delay to ensure dialog is visible
    }

     if (event.key === "F4") {
      event.preventDefault(); // Prevent default F4 action
      document.getElementById("f4").click(); // First open the dialog

      // Wait for DOM to update before focusing the search bar
      setTimeout(function() {
        const searchInput = document.getElementById("search123Input");
        if (searchInput) {
          searchInput.focus();
        }
      }, 50); // small delay to ensure dialog is visible
    }

     if (event.key === "F6") {
      event.preventDefault(); // Prevent default F6 action
      document.getElementById("f6").click(); // First open the dialog

      // Wait for DOM to update before focusing the search bar
      setTimeout(function() {
        const searchInput = document.getElementById("searchbarAdmin");
        if (searchInput) {
          searchInput.focus();
        }
      }, 50); // small delay to ensure dialog is visible
    }
  });
</script>




<!-- loading summry  script start hare -->

<script>
// ===== CSS injected via JS (no <style> tag used) =====
const css = `
   /* Status Colors */
  .status-loading    { background-color: #ff4d4d; color: #fff; font-weight: bold; }
  .status-processing { background-color: #fd2222; color: #fff; font-weight: bold; }
  .status-processed  { background-color: #28a745; color: #fff; font-weight: bold; }
  .status-complete   { background-color: #28a745; color: #fff; font-weight: bold; }
  .status-unloading  { background-color: #39b3d8; color: #fff; font-weight: bold; }
`;
(function applyCSS(c){
  const s = document.createElement('style');
  s.textContent = c;
  document.head.appendChild(s);
})(css);

// ===== Notice Board Script =====
const apiNBKey = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheetNBId = "1Bx0FqnXHadVATN9DGhUtRZr2EDgz10hfDEgIlwtSC_4";
const rangeNB = "DATABASE!K:R";

async function loadNoticeBoard() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetNBId}/values/${rangeNB}?key=${apiNBKey}`;
  const response = await fetch(url);
  const data = await response.json();
  
  const rows = data.values;
  const tbody = document.querySelector("#noticeBoard tbody");
  tbody.innerHTML = "";

  if (!rows || rows.length <= 1) {
    tbody.innerHTML = `<tr><td colspan="7">No Data Found</td></tr>`;
    return;
  }

  // Last 3 days range
  const today = new Date();
  let allowedDates = [];
  for (let i = 0; i < 3; i++) {
    let d = new Date();
    d.setDate(today.getDate() - i);
    allowedDates.push(formatDateToYYYYMMDD(d));
  }

  rows.forEach((row, index) => {
    if (index === 0) return; // skip header

    const dateInL = row[1]; // Column L
    const formattedDate = dateInL ? formatCustomDate(dateInL) : "";

    if (allowedDates.includes(formattedDate)) {
      const tr = document.createElement("tr");

      for (let i = 0; i <= 6; i++) {
        const td = document.createElement("td");
        td.textContent = row[i] || "";

        // Status color coding
        if (i === 5) {
          const status = (row[i] || "").toUpperCase();
          if (status === "LOADING") td.classList.add("status-loading");
          else if (status === "PROCESSING") td.classList.add("status-processing");
          else if (status === "PROCESSED") td.classList.add("status-processed");
          else if (status === "UNLOADING") td.classList.add("status-unloading");
          else if (status === "COMPLETE") td.classList.add("status-complete");
        }
        tr.appendChild(td);
      }

      tbody.appendChild(tr);
    }
  });
}

// Format date to YYYY-MM-DD
function formatDateToYYYYMMDD(dateObj) {
  const y = dateObj.getFullYear();
  const m = String(dateObj.getMonth() + 1).padStart(2, "0");
  const d = String(dateObj.getDate()).padStart(2, "0");
  return `${y}-${m}-${d}`;
}

// Convert "13-Aug-2025" to YYYY-MM-DD
function formatCustomDate(dateStr) {
  const months = {
    Jan: "01", Feb: "02", Mar: "03", Apr: "04", May: "05", Jun: "06",
    Jul: "07", Aug: "08", Sep: "09", Oct: "10", Nov: "11", Dec: "12"
  };
  const parts = dateStr.split("-");
  if (parts.length === 3) {
    const day = parts[0].padStart(2, "0");
    const month = months[parts[1]];
    const year = parts[2];
    return `${year}-${month}-${day}`;
  }
  return "";
}

loadNoticeBoard();
</script>
<!-- loading summry  script stop hare -->












<!-- DAYBOOK SECTION TABLE SCRIPT START---------------------------------------- -->
<script>
let val = [];

// ---------------- Collect Data from MIPLDATATABLE ----------------
function collectDataFromMainTable() {
  const mainTable = document.getElementById("MIPLDATATABLE");
  if (!mainTable) return;

  val = [];
  for (let i = 0; i < mainTable.rows.length; i++) {
    const row = [];
    const lastIndex = mainTable.rows[i].cells.length - 1; // last col skip
    for (let j = 0; j < lastIndex; j++) {
      const cell = mainTable.rows[i].cells[j];
      row.push({ text: cell.innerText.trim() });
    }
    val.push(row);
  }

  if (val.length > 0) {
    applyFilters(); // Apply both date + search filters
  }
}

// ---------------- Render Data in miplTable ----------------
function renderMiplTable(data) {
  const miplTable = document.getElementById("miplTable");
  miplTable.innerHTML = "";
  miplTable.classList.remove("hidden");

  data.forEach((row, rowIndex) => {
    const tr = document.createElement("tr");

    // Skip last column (Action)
    row.forEach((cell, colIndex) => {
      const td = document.createElement(rowIndex === 0 ? "th" : "td");
      td.textContent = cell.text;
      tr.appendChild(td);
    });

    if (rowIndex !== 0) {
      const type = row[1]?.text?.toUpperCase() || "";
      if (type === "BANK") tr.style.color = "red";
      else if (type === "CHALLAN") tr.style.color = "grey";
      else if (type === "CREDIT NOTE") tr.style.color = "green";
      else tr.style.color = "black";
    }

    miplTable.appendChild(tr);
  });

  highlightInvoiceCells();
}


// ---------------- Totals Calculation ----------------
function calculateTotals(data) {
  let totalInvoice = 0, totalWeight = 0, totalBank = 0, totalTds = 0;

  data.forEach((row, i) => {
    if (i === 0) return; // skip header

    const type = (row[1]?.text || "").toUpperCase(); // column 2
    const invoiceAmt = parseFloat(row[6]?.text || 0); // column 7
    const weight = parseFloat(row[7]?.text || 0);     // column 8

    if (!isNaN(invoiceAmt)) totalInvoice += invoiceAmt;
    if (!isNaN(weight)) totalWeight += weight;

    if (type === "BANK") {
      const bank = parseFloat(row[4]?.text || 0); // column 5
      if (!isNaN(bank)) totalBank += bank;
    }

    if (type === "TDS") {
      const tds = parseFloat(row[4]?.text || 0); // column 5
      if (!isNaN(tds)) totalTds += tds;
    }
  });

  const balance = totalInvoice - totalBank - totalTds;

  document.getElementById("totalInvoice").textContent = totalInvoice.toFixed();
  document.getElementById("totalWeight").textContent = totalWeight.toFixed();
  document.getElementById("totalBankInvoice").textContent = totalBank.toFixed();
  document.getElementById("totalTdsInvoice").textContent = totalTds.toFixed();
  document.getElementById("balance").textContent = "Balance: Rs. " + balance.toFixed();
}


// ---------------- Date Formatter ----------------
function formatDate(inputDate) {
  const date = new Date(inputDate);
  const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  return `${date.getDate()}-${months[date.getMonth()]}-${date.getFullYear()}`;
}

// ---------------- Combined Filter ----------------
function applyFilters() {
  const searchInput = document.getElementById("searchBar");
  const dateInput = document.getElementById("dateFilter");

  const searchText = searchInput.value.toLowerCase();
  const dateValue = dateInput.value;
  const formattedDate = dateValue ? formatDate(dateValue) : null;

  let filtered;

  if (searchText) {
    // ✅ Search over entire table (no date filter)
    filtered = val.filter((row, index) => {
      if (index === 0) return true;
      const rowText = row.map(c => c.text.toLowerCase()).join(" ");
      return rowText.includes(searchText);
    });
  } else {
    // ✅ No search — apply only date filter
    filtered = val.filter((row, index) => {
      if (index === 0) return true;
      const rowDate = row[2]?.text;
      return !formattedDate || rowDate === formattedDate;
    });
  }

  renderMiplTable(filtered);
  calculateTotals(filtered);
}

// ---------------- Setup Filters ----------------
function setupSearchFilter() {
  const searchInput = document.getElementById("searchBar");
  const dateInput = document.getElementById("dateFilter");

  searchInput.addEventListener("input", applyFilters);
  dateInput.addEventListener("change", applyFilters);
}

// ---------------- Highlight Invoices ----------------
function highlightInvoiceCells() {
  const table = document.getElementById("miplTable");
  if (!table) return;

  const rows = table.getElementsByTagName("tr");

  for (let row of rows) {
    const cells = row.cells;
    if (!cells || cells.length < 5) continue;

    const typeText = cells[1].innerText.trim().toUpperCase();
    const invoiceCell = cells[4];
    const invoiceNo = invoiceCell.innerText.trim();

    if (typeText === "TAX INVOICE" && invoiceNo) {
      invoiceCell.style.color = "#2B6AF3"; // COLOER CODE
      invoiceCell.style.cursor = "pointer";
      invoiceCell.title = "Click to open PDF";

      invoiceCell.addEventListener("mouseover", () => {
        invoiceCell.style.textDecoration = "underline";
      });
      invoiceCell.addEventListener("mouseout", () => {
        invoiceCell.style.textDecoration = "none";
      });
    }
  }
}

// ---------------- PDF on Invoice Click ----------------
const apidaybookUrl = "https://script.google.com/macros/s/AKfycbwRAHlS8JeIXSEbPVjUNVrXkpfVOmNc2z95OZsygdzebtk-sgLV-86eWyZ20jVHspYe/exec";
//https://script.google.com/macros/s/AKfycbzBXPXYoX9xp2IqWYXvVYMPhgERM41XQ8CyhOBWtpnFQy2SZIkQqBPlHTfl9-Z3nn8rXg/exec

document.getElementById("miplTable").addEventListener("click", function(e) {
  const clickedCell = e.target;
  const row = clickedCell.parentElement;
  const cells = row.cells;
  if (!cells || cells.length < 5) return;
  if (clickedCell.cellIndex !== 4) return;

  const typeText = cells[1].innerText.trim().toUpperCase();
  const invoiceNo = clickedCell.innerText.trim();
  if (typeText !== "TAX INVOICE" || !invoiceNo) return;

  clickedCell.style.color = "#0BCBAE"; // COLOER CODE
  clickedCell.style.textDecoration = "underline";

  const invoiceKey = invoiceNo.replace("/", "_");
  fetch(apidaybookUrl + "?invoice=" + encodeURIComponent(invoiceKey))
    .then(res => res.text())
    .then(url => {
      if (url === "NOT_FOUND") {
        alert("PDF not found for Invoice: " + invoiceNo);
      } else {
        window.open(url, "_blank");
      }
    })
    .catch(err => {
      console.error(err);
      alert("Error fetching PDF link.");
    });
});

// ---------------- Print Table ----------------
function printdaybook() {
  const table = document.getElementById("miplTable");
  if (!table) return;

  let totalInvoice = 0, totalWeight = 0, totalBank = 0, totalTds = 0;

  for (let i = 1; i < table.rows.length; i++) { // Skip header row
    const row = table.rows[i];

    const type = row.cells[1]?.innerText.trim().toUpperCase(); // column 2
    const inv = parseFloat(row.cells[6]?.innerText.replace(/,/g, "")) || 0; // column 7
    const wgt = parseFloat(row.cells[7]?.innerText.replace(/,/g, "")) || 0; // column 8

    totalInvoice += inv;
    totalWeight += wgt;

    if (type === "BANK") {
      const bank = parseFloat(row.cells[4]?.innerText.replace(/,/g, "")) || 0;
      totalBank += bank;
    }

    if (type === "TDS") {
      const tds = parseFloat(row.cells[4]?.innerText.replace(/,/g, "")) || 0;
      totalTds += tds;
    }
  }

  const balance = totalInvoice - totalBank - totalTds;
  const content = table.outerHTML;

  const printWindow = window.open('', '', 'height=800,width=1000');
  printWindow.document.write(`
    <html>
      <head>
        <title>Print</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; color:#333; }
          h4 { margin: 0; }
          table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 12px; text-align: left; }
            table th, table td { border: 1px solid #ddd; padding: 5px; }
            table th { background-color: #f4f4f4; font-weight: bold; }
          tr:nth-child(even) { background-color: #f9f9f9; }
          tr:hover { background-color: #eef7ff; }

          #totals { margin-top: 12px; padding: 10px; font-size: 14px;
                    border: 1px solid #ccc; border-radius: 6px;
                    background: #fafafa; font-weight: 600; }
          #totals span { margin-right: 15px; }
          .amt { color: #680268; }
          .wgt { color: #037e71; }
          .rec { color: #8f3f02; }
          .tds { color: blue; }
          .bal { color: green; font-weight: bold; }
        </style>
      </head>
      <body>
        <span style="color:rgb(246, 156, 156);font-size:130%;font-family:Magneto;">eS |</span> 
        <span style="color:#a0d0f0;font-size:130%;font-family:Magneto;">MTally</span>
        <h4>Multitech Infracon Pvt. Ltd.</h4>

        <div id="totals">
           <span class="amt">Invoice Amt: Rs. ${totalInvoice.toFixed()}</span> |
           <span class="wgt">Weight: ${totalWeight.toFixed()} Kg</span> |
           <span class="rec">Receipt: Rs. ${totalBank.toFixed()}</span> |
           <span class="tds">TDS: Rs. ${totalTds.toFixed()}</span> |
           <span class="bal">Balance: Rs. ${balance.toFixed()}</span>
        </div>

        ${content}
      </body>
    </html>
  `);

  printWindow.document.close();
  printWindow.focus();
  printWindow.print();
}


// ---------------- Init ----------------
document.addEventListener("DOMContentLoaded", () => {
  const dateInput = document.getElementById("dateFilter");
  const today = new Date();
  dateInput.value = today.toISOString().slice(0, 10);

  setupSearchFilter();
  collectDataFromMainTable();

  const targetNode = document.getElementById("MIPLDATATABLE");
  const observer = new MutationObserver(collectDataFromMainTable);
  observer.observe(targetNode, { childList: true, subtree: true });
});
</script>



<!-- DAYBOOK SECTION TABLE SCRIPT STOP---------------------------------------- -->












<!---------------------------- DATAMIPLTABLE SCRIPT START HARE ---------------------------------------- -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice Table with PDF Open</title>

</head>
<body>

<script>
const api101Key = "AIzaSyBe-AlG9lpyXyC7KV-AavR6tbqOc75iYdM";
const sheet101Id = "1cXqnV7kKebvzk6-BAuuBNSmDnpJOyCqh7LRVB6sHiL4";
const range101 = 'LEDGER!A:K';
const api101Url = "https://script.google.com/macros/s/AKfycbwRAHlS8JeIXSEbPVjUNVrXkpfVOmNc2z95OZsygdzebtk-sgLV-86eWyZ20jVHspYe/exec";

let allTableData = [];

// -------------------- Fetch Table --------------------
async function loadDATAMIPLTABLE() {
  const table = document.getElementById("MIPLDATATABLE");
  table.innerHTML = "<tr><th>Loading...</th></tr>";

  try {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheet101Id}/values/${range101}?key=${api101Key}`;
    const response = await fetch(url);
    const data = await response.json();

    if (!data.values || data.values.length === 0) {
      table.innerHTML = "<tr><td>No data found</td></tr>";
      return;
    }

    allTableData = data.values;
    renderDATAMIPLTABLE(allTableData);

  } catch (err) {
    console.error(err);
    table.innerHTML = "<tr><td>Error loading data</td></tr>";
  }
}

// -------------------- Render Table with Actions --------------------
// -------------------- Render Table with Actions --------------------
function renderDATAMIPLTABLE(dataArray) {
  const table = document.getElementById("MIPLDATATABLE");
  table.innerHTML = "";

  const thead = document.createElement("thead");
  const tbody = document.createElement("tbody");

  dataArray.forEach((row, rowIndex) => {
    const tr = document.createElement("tr");

    row.forEach(cell => {
      if (rowIndex === 0) {
        const th = document.createElement("th");
        th.textContent = cell || "";
        tr.appendChild(th);
      } else {
        const td = document.createElement("td");
        td.textContent = cell || "";
        tr.appendChild(td);
      }
    });

    // ---------------- Row color condition ----------------
    if (rowIndex > 0) {
      const typeCell = row[1]?.toUpperCase().trim();
      if (typeCell === "BANK") {
        tr.style.color = "red";
      } else if (typeCell === "CREDIT NOTE") {
        tr.style.color = "grey";
      } else if (typeCell === "CHALLAN") {
        tr.style.color = "green";
      }
    }

    // ---------------- Actions column ----------------
    if (rowIndex === 0) {
      const th = document.createElement("th");
      th.textContent = "Actions";
      tr.appendChild(th);
      thead.appendChild(tr);
    } else {
      const actionTd = document.createElement("td");

      const typeCell = row[1]?.toUpperCase().trim();
      const invoiceNo = row[4]?.trim();

      if (invoiceNo && typeCell === "TAX INVOICE") {
        const invoiceKey = invoiceNo.replace("/", "_");
        const packingKey = invoiceNo;

        const container = document.createElement("div");
        container.style.display = "flex";
        container.style.gap = "12px";

        // --- BILL button ---
        const viewInvoiceBtn = document.createElement("button");
        viewInvoiceBtn.textContent = "BILL";
        viewInvoiceBtn.style.color = "white";
        viewInvoiceBtn.style.background = "#1F39FF";
        viewInvoiceBtn.style.border = "none";
        viewInvoiceBtn.style.padding = "3px 8px";
        viewInvoiceBtn.style.cursor = "pointer";
        viewInvoiceBtn.style.borderRadius = "4px";

        viewInvoiceBtn.addEventListener("click", () => {
          fetch(api101Url + "?invoice=" + encodeURIComponent(invoiceKey))
            .then(res => res.text())
            .then(url => {
              if (url !== "NOT_FOUND") {
                window.open(url, "_blank");
              } else {
                alert("Invoice not found!");
              }
            })
            .catch(err => {
              console.error(err);
              alert("Error fetching invoice");
            });
        });

        // --- PL LIST button ---
        const viewPackingBtn = document.createElement("button");
        viewPackingBtn.textContent = "PL LIST";
        viewPackingBtn.style.color = "white";
        viewPackingBtn.style.background = "#28A745";
        viewPackingBtn.style.border = "none";
        viewPackingBtn.style.padding = "3px 8px";
        viewPackingBtn.style.cursor = "pointer";
        viewPackingBtn.style.borderRadius = "4px";

        viewPackingBtn.addEventListener("click", () => {
          fetch(api101Url + "?invoice=" + encodeURIComponent(packingKey))
            .then(res => res.text())
            .then(url => {
              if (url !== "NOT_FOUND") {
                window.open(url, "_blank");
              } else {
                alert("Packing list not found!");
              }
            })
            .catch(err => {
              console.error(err);
              alert("Error fetching packing list");
            });
        });

        container.appendChild(viewInvoiceBtn);
        container.appendChild(viewPackingBtn);
        actionTd.appendChild(container);
      }

      tr.appendChild(actionTd);
      tbody.appendChild(tr);
    }
  });

  table.appendChild(thead);
  table.appendChild(tbody);
}



// -------------------- Search bar Function --------------------
function searchDataMIPL() {
  const query = document.getElementById("DATASEARCMIPL").value.trim().toLowerCase();

  if (!query) {
    renderDATAMIPLTABLE(allTableData);
    return;
  }

  const filtered = allTableData.filter((row, rowIndex) => {
    if (rowIndex === 0) return true; // header keep
    return row.some(cell => cell && cell.toString().toLowerCase().includes(query));
  });

  renderDATAMIPLTABLE(filtered);

  // Highlight matched text
  const table = document.getElementById("MIPLDATATABLE");
  if (table) {
    for (let i = 1; i < table.rows.length; i++) {
      for (let j = 0; j < table.rows[i].cells.length - 1; j++) { // last column skip (Actions)
        const cell = table.rows[i].cells[j];
        const originalText = filtered[i]?.[j] || "";
        if (originalText.toLowerCase().includes(query)) {
          const regex = new RegExp(`(${query})`, "gi");
          cell.innerHTML = originalText.replace(regex, `<span style="background:yellow; font-weight:bold;">$1</span>`);
        } else {
          cell.textContent = originalText;
        }
      }
    }
  }
}

// -------------------- Init --------------------
document.addEventListener("DOMContentLoaded", () => {
  loadDATAMIPLTABLE();
  const searchInput = document.getElementById("DATASEARCMIPL");
  if (searchInput) {
    searchInput.addEventListener("keyup", searchDataMIPL);
  }
});
</script>



</body>
</html>

<!---------------------------- DATAMIPLTABLE SCRIPT START STOP ---------------------------------------- -->

